<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="‰∏™‰∫∫Á®ãÂ∫è">
<title>Á¨¨‰∏âÊñπhisÂíå‰ΩìÊ£ÄÊé•Âè£Áõ∏ÂÖ≥ÂÜÖÂÆπ</title>

<link rel='canonical' href='https://work.717170.xyz/p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/'>

<link rel="stylesheet" href="/scss/style.min.9f449ccc662f48c455f81316fd5cb87099956cabbb7a108c4681662ea647628e.css"><meta property='og:title' content="Á¨¨‰∏âÊñπhisÂíå‰ΩìÊ£ÄÊé•Âè£Áõ∏ÂÖ≥ÂÜÖÂÆπ">
<meta property='og:description' content="‰∏™‰∫∫Á®ãÂ∫è">
<meta property='og:url' content='https://work.717170.xyz/p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/'>
<meta property='og:site_name' content='Êú®Â≠êÊ¥ã'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-01-12T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-01-12T23:59:59&#43;00:00'/><meta property='og:image' content='https://work.717170.xyz/p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/assets/image-20240416202732597-20241220161447-o63hdgy.png' />
<meta name="twitter:title" content="Á¨¨‰∏âÊñπhisÂíå‰ΩìÊ£ÄÊé•Âè£Áõ∏ÂÖ≥ÂÜÖÂÆπ">
<meta name="twitter:description" content="‰∏™‰∫∫Á®ãÂ∫è"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://work.717170.xyz/p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/assets/image-20240416202732597-20241220161447-o63hdgy.png' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/touxiang_hu_3261c9b36eb249a9.jpg" width="300"
                            height="285" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Êú®Â≠êÊ¥ã</a></h1>
            <h2 class="site-description">To be or not to be.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/muziyangg'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://gitee.com/muziyangg'
                        target="_blank"
                        title="Gitee"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1756364241553" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1459" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M739.76 462H484.2a22.22 22.22 0 0 0-22.2 22.21v55.56A22.24 22.24 0 0 0 484.19 562h155.57A22.22 22.22 0 0 1 662 584.22v11.11A66.67 66.67 0 0 1 595.31 662H384.19A22.22 22.22 0 0 1 362 639.79V428.68A66.67 66.67 0 0 1 428.64 362h311.07a22.21 22.21 0 0 0 22.22-22.2v-55.56A22.22 22.22 0 0 0 739.79 262h-311.1A166.67 166.67 0 0 0 262 428.68v311.1A22.22 22.22 0 0 0 284.22 762H612a150 150 0 0 0 150-150V484.23A22.23 22.23 0 0 0 739.77 462z m0 0" fill="#231815" p-id="1460"></path></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>È¶ñÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>ÂΩíÊ°£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>ÊêúÁ¥¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/link/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>ÂèãÈìæ</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>ÊöóËâ≤Ê®°Âºè</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#Âú®Ê†áÊú¨Êé•Êî∂Ê†∏Êî∂ÊñπÊ≥ïÂ¢ûÂä†Ë∞ÉÁî®Á¨¨‰∏âÊñπÊ†áÊú¨Êé•Êî∂ÊñπÊ≥ï">Âú®Ê†áÊú¨Êé•Êî∂Ê†∏Êî∂ÊñπÊ≥ïÂ¢ûÂä†Ë∞ÉÁî®Á¨¨‰∏âÊñπÊ†áÊú¨Êé•Êî∂ÊñπÊ≥ï</a></li>
    <li><a href="#Ê†áÊú¨Êé•Êî∂">Ê†áÊú¨Êé•Êî∂</a></li>
    <li><a href="#Ê†áÊú¨ÂõûÂÜôÊé•Êî∂Áä∂ÊÄÅ‰ø°ÊÅØ">Ê†áÊú¨ÂõûÂÜôÊé•Êî∂Áä∂ÊÄÅ‰ø°ÊÅØ</a></li>
    <li><a href="#Âõû‰º†‰ΩìÊ£ÄÁªìÊûú‰ø°ÊÅØ">Âõû‰º†‰ΩìÊ£ÄÁªìÊûú‰ø°ÊÅØ</a></li>
    <li><a href="#Ëé∑ÂèñÊ†áÊú¨‰ø°ÊÅØ">Ëé∑ÂèñÊ†áÊú¨‰ø°ÊÅØ</a></li>
    <li><a href="#Ê†áÊú¨Ê†∏Êî∂È°µÈù¢Êú™Ê†∏Êî∂ÂåªÂò±‰ø°ÊÅØ">Ê†áÊú¨Ê†∏Êî∂È°µÈù¢Êú™Ê†∏Êî∂ÂåªÂò±‰ø°ÊÅØ</a></li>
  </ol>

  <ol>
    <li><a href="#Ê†áÊú¨Êé•Êî∂Ê†∏Êî∂ÊñπÊ≥ï">Ê†áÊú¨Êé•Êî∂Ê†∏Êî∂ÊñπÊ≥ï</a></li>
    <li><a href="#Â§ñÈÉ®Ê†áÊú¨Êé•Êî∂ÊñπÊ≥ï">Â§ñÈÉ®Ê†áÊú¨Êé•Êî∂ÊñπÊ≥ï</a></li>
    <li><a href="#Âπ≥Âè∞ÁªÑÂõû‰º†ÁªìÊûúÊñπÊ≥ï">Âπ≥Âè∞ÁªÑÂõû‰º†ÁªìÊûúÊñπÊ≥ï</a></li>
    <li><a href="#Âπ≥Âè∞ÁªÑËé∑ÂèñÊ†áÊú¨Áî≥ËØ∑Âçï‰ø°ÊÅØ">Âπ≥Âè∞ÁªÑËé∑ÂèñÊ†áÊú¨Áî≥ËØ∑Âçï‰ø°ÊÅØ</a></li>
    <li><a href="#Êü•ËØ¢Êú™Ê†∏Êî∂ÂåªÂò±">Êü•ËØ¢Êú™Ê†∏Êî∂ÂåªÂò±</a></li>
  </ol>

  <ol>
    <li><a href="#jsonËØªÂèñËß£ÊûêÊñπÊ≥ï">jsonËØªÂèñËß£ÊûêÊñπÊ≥ï</a></li>
    <li><a href="#jsonÁºñÂÜôÊñπÊ≥ï">jsonÁºñÂÜôÊñπÊ≥ï</a></li>
    <li><a href="#Â∞ÜÊï∞ÊçÆËΩ¨ÊàêÊµÅÊï∞ÊçÆ">Â∞ÜÊï∞ÊçÆËΩ¨ÊàêÊµÅÊï∞ÊçÆ</a></li>
    <li><a href="#ÂàáÊç¢ÂëΩÂêçÁ©∫Èó¥ÊñπÊ≥ï">ÂàáÊç¢ÂëΩÂêçÁ©∫Èó¥ÊñπÊ≥ï</a></li>
    <li><a href="#xmlËØªÂèñÊñπÊ≥ï">xmlËØªÂèñÊñπÊ≥ï</a></li>
    <li><a href="#xmlÁºñÂÜôÊñπÊ≥ï">xmlÁºñÂÜôÊñπÊ≥ï</a></li>
  </ol>

  <ol>
    <li><a href="#Â≠óÊÆµÂØπÁÖß">Â≠óÊÆµÂØπÁÖß</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/">
                <img src="/p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/assets/image-20240416202732597-20241220161447-o63hdgy_hu_7250d1fa37ff287b.png"
                        srcset="/p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/assets/image-20240416202732597-20241220161447-o63hdgy_hu_7250d1fa37ff287b.png 800w, /p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/assets/image-20240416202732597-20241220161447-o63hdgy_hu_721eb5b95bc3938d.png 1600w"
                        width="800" 
                        height="411" 
                        loading="lazy"
                        alt="Featured image of post Á¨¨‰∏âÊñπhisÂíå‰ΩìÊ£ÄÊé•Âè£Áõ∏ÂÖ≥ÂÜÖÂÆπ" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E4%B8%AA%E4%BA%BA%E7%A8%8B%E5%BA%8F/" >
                ‰∏™‰∫∫Á®ãÂ∫è
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/">Á¨¨‰∏âÊñπhisÂíå‰ΩìÊ£ÄÊé•Âè£Áõ∏ÂÖ≥ÂÜÖÂÆπ</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            ‰∏™‰∫∫Á®ãÂ∫è
        </h3>
        
    </div>

        
        <footer class="article-time">
            
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                    <time class="article-time--published">2025-01-12</time>
                </div>
            

            
            
                        ÊúÄÂêéÊõ¥Êñ∞‰∫é
                        <time class="article-time--updated" datetime="2025-01-12 23:59:59 &#43;0000 UTC" title="2025-01-12 23:59:59 &#43;0000 UTC">
                            2025-01-12 23:59:59
                        </time>
			
			
			
				<div>
					<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



					<time class="article-words">
						29933Â≠ó
					</time>
				</div>
			
			

            
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                    <time class="article-time--reading">
                        ÈòÖËØªÊó∂Èïø: 60 ÂàÜÈíü
                    </time>
                </div>
            
        </footer>
    


    
</div>
</header>



    <section class="article-content">
    
    
    <h1 id="Á¨¨‰∏âÊñπhisÊé•Âè£Áõ∏ÂÖ≥ÂÜÖÂÆπ">Á¨¨‰∏âÊñπhisÊé•Âè£Áõ∏ÂÖ≥ÂÜÖÂÆπ
</h1><h2 id="Âú®Ê†áÊú¨Êé•Êî∂Ê†∏Êî∂ÊñπÊ≥ïÂ¢ûÂä†Ë∞ÉÁî®Á¨¨‰∏âÊñπÊ†áÊú¨Êé•Êî∂ÊñπÊ≥ï">Âú®Ê†áÊú¨Êé•Êî∂Ê†∏Êî∂ÊñπÊ≥ïÂ¢ûÂä†Ë∞ÉÁî®Á¨¨‰∏âÊñπÊ†áÊú¨Êé•Êî∂ÊñπÊ≥ï
</h2><blockquote>
<p><a class="link" href="#%e6%a0%87%e6%9c%ac%e6%8e%a5%e6%94%b6%e6%a0%b8%e6%94%b6%e6%96%b9%e6%b3%95" >Ê†áÊú¨Êé•Êî∂Ê†∏Êî∂ÊñπÊ≥ï</a></p></blockquote>
<p><img src="/p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/assets/image-20240416202732597-20241220161447-o63hdgy.png"
	width="1789"
	height="919"
	srcset="/p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/assets/image-20240416202732597-20241220161447-o63hdgy_hu_1675482cbb45cc73.png 480w, /p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/assets/image-20240416202732597-20241220161447-o63hdgy_hu_5bbc1316a6230272.png 1024w"
	loading="lazy"
	
		alt="image-20240416202732597"
	
	
		class="gallery-image" 
		data-flex-grow="194"
		data-flex-basis="467px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//*****************‰∏âÊñπHISÊ†∏Êî∂Ëµ∑Âßã********************//
</span></span><span class="line"><span class="cl">	;b ;run
</span></span><span class="line"><span class="cl">	s quitret=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $e(Labno)=&#34;*&#34; d
</span></span><span class="line"><span class="cl">	.s ret=##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdListNew(Labno, UserCode, AssayNo, EpisodeNo, WorkGroupMachineDR, TransmitDate, HospitalDR, RecFlag, ReceiveNotes, SpecimenQualityDR, CarryUserDR, &#34;&#34;, RackNo, IP, WorkGroupDR,Sessions)
</span></span><span class="line"><span class="cl">	.i ret&#39;=0 s quitret=ret
</span></span><span class="line"><span class="cl">	.e  s quitret=1
</span></span><span class="line"><span class="cl">	;b ;quitret
</span></span><span class="line"><span class="cl">	i $e(Labno)=&#34;*&#34; try{s return=##Class(LIS.Service.ENS.TransReport).ReturnStatus(Labno,quitret)}catch{}
</span></span><span class="line"><span class="cl">	i $l(quitret) q quitret
</span></span><span class="line"><span class="cl">	//*****************‰∏âÊñπHISÊ†∏Êî∂ÁªàÊ≠¢********************//
</span></span><span class="line"><span class="cl">	//*****************‰∏âÊñπ‰ΩìÊ£ÄÊ†∏Êî∂Ëµ∑Âßã********************//
</span></span><span class="line"><span class="cl">	b ;run
</span></span><span class="line"><span class="cl">	s quitret=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(Labno)=14 d
</span></span><span class="line"><span class="cl">	.s ret=##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdListNew(Labno, UserCode, AssayNo, EpisodeNo, WorkGroupMachineDR, TransmitDate, HospitalDR, RecFlag, ReceiveNotes, SpecimenQualityDR, CarryUserDR, &#34;&#34;, RackNo, IP, WorkGroupDR,Sessions)
</span></span><span class="line"><span class="cl">	.i ret&#39;=0 s quitret=ret
</span></span><span class="line"><span class="cl">	.e  s quitret=1
</span></span><span class="line"><span class="cl">	b ;quitret
</span></span><span class="line"><span class="cl">	try{s return=##Class(LIS.Service.ENS.TransReport).ReturnStatus(Labno,quitret)}catch{}
</span></span><span class="line"><span class="cl">	i $l(quitret) q quitret
</span></span><span class="line"><span class="cl">	//*****************‰∏âÊñπ‰ΩìÊ£ÄÊ†∏Êî∂ÁªàÊ≠¢********************//
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="Ê†áÊú¨Êé•Êî∂">Ê†áÊú¨Êé•Êî∂
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Creator</span><span class="err">Ôºö</span>        <span class="n">yanghaoran</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">CreateDate</span><span class="err">Ôºö</span> 	 <span class="mi">20240407</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Description</span><span class="err">Ôºö</span>    <span class="err">Êé•Êî∂Â§ñÈÉ®Ê†áÊú¨</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Table</span><span class="err">Ôºö</span>          <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="ne">Input</span><span class="err">Ôºö</span>          <span class="err">Ê£ÄÈ™åÂè∑</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Output</span><span class="err">Ôºö</span>     <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Return</span><span class="err">Ôºö</span>     <span class="err">ÈîôËØØ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Others</span><span class="err">Ôºö</span>     <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span>     <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdListNew(&#34;2779164&#34;,&#34;113&#34;,&#34;&#34;,&#34;1&#34;,&#34;2&#34;,&#34;20160819&#34;,&#34;1&#34;,&#34;H&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdListNew(&#34;**4868149*&#34;,&#34;demo&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;20240409&#34;,&#34;1&#34;,&#34;C&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;10.49.25.10&#34;,&#34;1&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdListNew(&#34;**4860462*&#34;,&#34;demo&#34;,&#34;&#34;,&#34;3&#34;,&#34;13&#34;,&#34;20240408&#34;,&#34;1&#34;,&#34;H&#34;,&#34;&#34;,&#34;2&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;10.49.25.9&#34;,&#34;5&#34;,&#34;8280^5^0^2^1&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdListNew(&#34;24041406012005&#34;,&#34;demo&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;20240415&#34;,&#34;1&#34;,&#34;C&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;10.49.25.10&#34;,&#34;1&#34;,&#34;8280^1^0^2^1&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">ReceiveLisOrdListNew</span><span class="p">(</span><span class="n">Labno</span><span class="p">,</span> <span class="n">UserDR</span><span class="p">,</span> <span class="n">AssayNo</span><span class="p">,</span> <span class="n">EpisodeNo</span><span class="p">,</span> <span class="n">WorkGroupMachineDR</span><span class="p">,</span> <span class="n">TransmitDate</span><span class="p">,</span> <span class="n">RecHospitalDR</span><span class="p">,</span> <span class="n">RecFlag</span><span class="p">,</span> <span class="n">ReceiveNotes</span><span class="p">,</span> <span class="n">SpecimenQualityDR</span><span class="p">,</span> <span class="n">CarryUserDR</span><span class="p">,</span> <span class="n">PlacerLabno</span><span class="p">,</span> <span class="n">RackNo</span><span class="p">,</span> <span class="n">OperIP</span><span class="p">,</span> <span class="n">WorkGroupDR</span><span class="p">,</span> <span class="n">Sessions</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Labno</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">Labno</span><span class="p">),</span><span class="n">UserDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">UserDR</span><span class="p">),</span><span class="n">EpisodeNo</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">EpisodeNo</span><span class="p">),</span><span class="n">WorkGroupMachineDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">WorkGroupMachineDR</span><span class="p">),</span><span class="n">RecHospitalDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">RecHospitalDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RecFlag</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">RecFlag</span><span class="p">),</span><span class="n">ReceiveNotes</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">ReceiveNotes</span><span class="p">),</span><span class="n">SpecimenQualityDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">SpecimenQualityDR</span><span class="p">),</span><span class="n">TransmitDate</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">TransmitDate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">TransmitDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">TransmitDate</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">),</span><span class="n">CarryUserDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">CarryUserDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AssayNo</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">AssayNo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">PlacerLabno</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">PlacerLabno</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">RackNo</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">RackNo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">OperIP</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">OperIP</span><span class="p">),</span><span class="n">WorkGroupDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">WorkGroupDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">b</span> <span class="p">;</span><span class="n">ReceiveLisOrdListNew</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">UserDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">SYSUserI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="n">UserDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">Set</span> <span class="o">$</span><span class="n">ZTrap</span> <span class="o">=</span> <span class="s2">&#34;ErrorHandle&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="s2">&#34;LIS.Service.ENS.TransReport&#34;</span><span class="p">,</span><span class="s2">&#34;ReceiveLisOrdList&#34;</span><span class="p">)</span><span class="o">=$</span><span class="n">lb</span><span class="p">(</span><span class="n">Labno</span><span class="p">,</span> <span class="n">UserDR</span><span class="p">,</span> <span class="n">AssayNo</span><span class="p">,</span> <span class="n">EpisodeNo</span><span class="p">,</span> <span class="n">WorkGroupMachineDR</span><span class="p">,</span> <span class="n">TransmitDate</span><span class="p">,</span> <span class="n">RecHospitalDR</span><span class="p">,</span> <span class="n">RecFlag</span><span class="p">,</span> <span class="n">ReceiveNotes</span><span class="p">,</span> <span class="n">SpecimenQualityDR</span><span class="p">,</span> <span class="n">CarryUserDR</span><span class="p">,</span> <span class="n">PlacerLabno</span><span class="p">,</span> <span class="n">RackNo</span><span class="p">,</span> <span class="n">OperIP</span><span class="p">,</span> <span class="n">WorkGroupDR</span><span class="p">,</span> <span class="n">Sessions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(Labno) q &#34;-1^Ê£ÄÈ™åÂè∑‰∏∫Á©∫ÔºÅ&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="mi">20160822</span> <span class="n">yy</span> <span class="err">Âà§Êñ≠ÊòØÂê¶ÊúâËÆ∞Êé•Êî∂‰∫ÜÊ†áÊú¨</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">DHCLis</span><span class="p">(</span><span class="s2">&#34;ReceveFormOtherHis&#34;</span><span class="p">,</span><span class="n">Labno</span><span class="p">))</span> <span class="n">q</span> <span class="s2">&#34;-1^ËØ•Ê†áÊú¨Â∑≤ÁªèÊ†∏Êî∂&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="s2">&#34;&lt;Request&gt;&lt;ResultCode&gt;0&lt;/ResultCode&gt;&lt;ResultContent&gt;ÊàêÂäü&lt;/ResultContent&gt;&lt;Orders&gt;&lt;OrderList&gt;&lt;OrdID&gt;&lt;/OrdID&gt;&lt;LabNo&gt;1600904130&lt;/LabNo&gt;&lt;ArcimCode&gt;L002&lt;/ArcimCode&gt;&lt;ArcimDesc&gt;Ë°ÄÂ∏∏ËßÑ&lt;/ArcimDesc&gt;&lt;OrderQty&gt;1&lt;/OrderQty&gt;&lt;BillCode&gt;P&lt;/BillCode&gt;&lt;SpecimenTypeCode&gt;&lt;/SpecimenTypeCode&gt;&lt;SpecimenTypeDesc&gt;&lt;/SpecimenTypeDesc&gt;&lt;SpVolume&gt;&lt;/SpVolume&gt;&lt;ColInfo&gt;&lt;/ColInfo&gt;&lt;Container&gt;&lt;/Container&gt;&lt;GTSeq&gt;&lt;/GTSeq&gt;&lt;SpecFlag&gt;&lt;/SpecFlag&gt;&lt;VerifyDate&gt;2016-04-26&lt;/VerifyDate&gt;&lt;VerifyTime&gt;13:43:09&lt;/VerifyTime&gt;&lt;ColDate&gt;&lt;/ColDate&gt;&lt;ColTime&gt;&lt;/ColTime&gt;&lt;AppDeptCode&gt;&lt;/AppDeptCode&gt;&lt;AppDeptDesc&gt;‰ΩìÊ£ÄÁßë&lt;/AppDeptDesc&gt;&lt;RecDeptCode&gt;&lt;/RecDeptCode&gt;&lt;RecDeptDesc&gt;&lt;/RecDeptDesc&gt;&lt;TSPrice&gt;20&lt;/TSPrice&gt;&lt;OrderStatus&gt;E&lt;/OrderStatus&gt;&lt;DocCode&gt;&lt;/DocCode&gt;&lt;DocDesc&gt;&lt;/DocDesc&gt;&lt;RepLoct&gt;&lt;/RepLoct&gt;&lt;RepDate&gt;&lt;/RepDate&gt;&lt;RepTime&gt;&lt;/RepTime&gt;&lt;Note&gt;&lt;/Note&gt;&lt;AdmNo&gt;&lt;/AdmNo&gt;&lt;AdmDate&gt;2016-04-26&lt;/AdmDate&gt;&lt;AdmTime&gt;13:43:09&lt;/AdmTime&gt;&lt;AdmTypeCode&gt;&lt;/AdmTypeCode&gt;&lt;AdmTypeDesc&gt;‰ΩìÊ£Ä&lt;/AdmTypeDesc&gt;&lt;FeeType&gt;&lt;/FeeType&gt;&lt;PatientWard&gt;&lt;/PatientWard&gt;&lt;BedNo&gt;&lt;/BedNo&gt;&lt;Diagnose&gt;&lt;/Diagnose&gt;&lt;RegisterNo&gt;16009041&lt;/RegisterNo&gt;&lt;PatientName&gt;ÊµãËØïÔºàÁ´•Ôºâ&lt;/PatientName&gt;&lt;SexCode&gt;M&lt;/SexCode&gt;&lt;SexDesc&gt;Áî∑&lt;/SexDesc&gt;&lt;DOB&gt;1987-04-26&lt;/DOB&gt;&lt;Age&gt;29Â≤Å&lt;/Age&gt;&lt;DocumentID&gt;D16008409&lt;/DocumentID&gt;&lt;PatientAddress&gt;&lt;/PatientAddress&gt;&lt;IdentityCardNo&gt;&lt;/IdentityCardNo&gt;&lt;Telephone&gt;&lt;/Telephone&gt;&lt;SpecUserCode&gt;&lt;/SpecUserCode&gt;&lt;StartDate&gt;&lt;/StartDate&gt;&lt;StartTime&gt;&lt;/StartTime&gt;&lt;SendFlag&gt;NW&lt;/SendFlag&gt;&lt;/OrderList&gt;&lt;/Orders&gt;&lt;/Request&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="n">retObj</span><span class="o">=</span><span class="c1">##Class(UtilsController.LIS.UtilsControllerHttpSoap12Endpoint).%New()</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="n">retObj</span><span class="o">.</span><span class="n">ReceiveLisOrdList</span><span class="p">(</span><span class="n">Labno</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="mi">20160818</span> <span class="n">yy</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="ne">Input</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">TMPLISORDINFOS</span><span class="p">(</span><span class="s2">&#34;LisOrdInfos&#34;</span><span class="p">,</span><span class="n">Labno</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">CurNamespace</span><span class="o">=$</span><span class="n">ZUTIL</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">WebNamespace</span><span class="o">=</span><span class="c1">##Class(OTH.SYSParameter).GetWebNamespace()</span>
</span></span><span class="line"><span class="cl">	<span class="n">NEW</span> <span class="o">$</span><span class="n">NAMESPACE</span> 
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="o">$</span><span class="n">NAMESPACE</span><span class="o">=</span> <span class="n">WebNamespace</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="c1">##Class(LISAPP.LIS.BLL.DHCReceiveInterface).GetLabNoInfoSFHIS(Labno,&#34;&#34;,&#34;&#34;) </span>
</span></span><span class="line"><span class="cl">	<span class="n">b</span> <span class="p">;</span><span class="ne">Input</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="o">$</span><span class="n">NAMESPACE</span><span class="o">=</span> <span class="n">CurNamespace</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(Input) q &#34;-1^Êú™Êü•ËØ¢Âà∞Ê†áÊú¨‰ø°ÊÅØÔºÅ&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">repid</span><span class="o">=$</span><span class="n">i</span><span class="p">(</span><span class="o">^</span><span class="n">CacheTemp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">k</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">100</span>
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="n">UncheckInfo</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="o">//</span><span class="err">Êú™Ê†∏Êî∂ÂåªÂò±‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">ËØªÂèñÂåªÂò±</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">=</span> <span class="c1">##class(LIS.Util.COM.XML).FromXML(Input)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">s</span> <span class="n">ResultCode</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">ResultCode</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span> <span class="n">ResultContent</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">ResultContent</span>
</span></span><span class="line"><span class="cl">            <span class="n">i</span> <span class="p">(</span><span class="n">ResultCode</span><span class="o">=-</span><span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	            <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^&#34;</span><span class="n">_ResultContent</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">b</span> <span class="p">;</span><span class="n">ResultCode</span>
</span></span><span class="line"><span class="cl">            <span class="n">i</span> <span class="p">(</span><span class="n">ResultCode</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">||</span><span class="p">(</span><span class="n">ResultCode</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objMldVis</span><span class="o">=</span><span class="c1">##Class(LIS.Model.RPVisitNumber).%New()</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">Counts</span><span class="o">=+</span><span class="n">obj</span><span class="o">.</span><span class="n">Orders</span><span class="o">.%</span><span class="n">pIndex</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="p">(</span><span class="n">RegNo</span><span class="p">,</span><span class="n">AdmNo</span><span class="p">,</span><span class="n">AdmTypeCode</span><span class="p">,</span><span class="n">MedicalRecordNo</span><span class="p">,</span><span class="n">SpecimenTypeCode</span><span class="p">,</span><span class="n">AdmDate</span><span class="p">,</span><span class="n">AdmTime</span><span class="p">,</span><span class="n">PatName</span><span class="p">,</span><span class="n">SexCode</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="p">(</span><span class="n">DOB</span><span class="p">,</span><span class="n">Age</span><span class="p">,</span><span class="n">AppDeptCode</span><span class="p">,</span><span class="n">AppDeptDesc</span><span class="p">,</span><span class="n">DocCode</span><span class="p">,</span><span class="n">DocDesc</span><span class="p">,</span><span class="n">VerifyDate</span><span class="p">,</span><span class="n">VerifyTime</span><span class="p">,</span><span class="n">Diagnose</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="p">(</span><span class="n">Telephone</span><span class="p">,</span><span class="n">IdentityCardNo</span><span class="p">,</span><span class="n">PatientAddress</span><span class="p">,</span><span class="n">Note</span><span class="p">,</span><span class="n">ColDate</span><span class="p">,</span><span class="n">ColTime</span><span class="p">,</span><span class="n">SpecUserCode</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">err</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">f</span> <span class="n">tmpi</span><span class="o">=</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">:(</span><span class="n">Counts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">OrderList</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Orders</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">tmpi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">b</span> <span class="p">;</span><span class="n">OrderList</span>
</span></span><span class="line"><span class="cl">                    <span class="o">//</span><span class="n">s</span> <span class="n">LabNo</span><span class="o">=</span><span class="n">OrderList</span><span class="o">.</span><span class="n">LabNo</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ArcimCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">ArcimCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ArcimDesc</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">ArcimDesc</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">TSPrice</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">TSPrice</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">b</span> <span class="p">;</span><span class="n">a901</span>
</span></span><span class="line"><span class="cl">                    <span class="o">///</span><span class="err">Ëé∑Âèñ</span><span class="n">HISCodeÂÖ≥ËÅîÁ†ÅÂåªÂò±</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexHISCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(ArcimCode),&#34;&#34;))   //</span>
</span></span><span class="line"><span class="cl">                    <span class="n">b</span> <span class="p">;</span><span class="n">a902</span>
</span></span><span class="line"><span class="cl">                    <span class="o">///</span><span class="err">Ëé∑ÂèñÂåªÂò±‰ª£Á†ÅÂÖ≥ËÅî</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(TestSetDR) s TestSetDR=$o(^dbo.BTTestSetI(&#34;IndexCode&#34;,RecHospitalDR,##Class(LIS.Util.Common).IndexData(ArcimCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(TestSetDR) s err=&#34;-1^Ê£ÄÈ™åÂåªÂò±„Äê&#34;_ArcimDesc_&#34;„ÄëÊú™ÂØπÁÖßÔºö&#34;_ArcimCode q</span>
</span></span><span class="line"><span class="cl">                    <span class="n">b</span> <span class="p">;</span><span class="n">a904</span>
</span></span><span class="line"><span class="cl">                    <span class="o">///</span><span class="err">Âà§Êñ≠ÂåªÂò±ÊòØÂê¶Ê†∏Êî∂</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno))){</span>
</span></span><span class="line"><span class="cl">	                       <span class="n">s</span> <span class="n">mVisitNumberDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">	                       <span class="n">s</span> <span class="n">RowID</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">mVisitNumberDR</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	                       <span class="p">;</span><span class="n">s</span> <span class="n">RowID</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexReportID&#34;</span><span class="p">,</span><span class="n">mVisitNumberDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	                       <span class="n">b</span> <span class="p">;</span><span class="n">a905</span>
</span></span><span class="line"><span class="cl">	                       
</span></span><span class="line"><span class="cl">	                       <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">RowID</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		                       
</span></span><span class="line"><span class="cl">		                       <span class="p">;</span><span class="k">continue</span>
</span></span><span class="line"><span class="cl">		                       
</span></span><span class="line"><span class="cl">		                       <span class="n">s</span> <span class="n">WGMDR</span><span class="o">=$</span><span class="n">LG</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetD</span><span class="p">(</span><span class="n">RowID</span><span class="p">)),</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		                       <span class="n">I</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">WGMDR</span><span class="p">)</span> <span class="k">continue</span>
</span></span><span class="line"><span class="cl">		                       
</span></span><span class="line"><span class="cl">		                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">		                    
</span></span><span class="line"><span class="cl">	                <span class="p">}</span>
</span></span><span class="line"><span class="cl">	                <span class="n">b</span> <span class="p">;</span><span class="n">a903</span>
</span></span><span class="line"><span class="cl">                    <span class="o">///</span><span class="err">Ê†∏Êî∂Âà§Êñ≠ÂåªÂò±ÊòØÂê¶Êú¨Â∑•‰ΩúÂ∞èÁªÑ</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>   
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">Reterr</span><span class="o">=</span><span class="c1">##Class(LIS.Service.ENS.TransReport).GetTSDefWGroupMiInfo(TestSetDR,WorkGroupMachineDR)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="n">Reterr</span><span class="s1">&#39;=0 d</span>
</span></span><span class="line"><span class="cl">                        <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(TSPrice) s TSPrice=&#34;Êú™Ëé∑ÂèñÂà∞‰ª∑Ê†º&#34;	//YHR 20240409 ËÆ∞ÂΩïÊú™Ê†∏Êî∂ÂåªÂò±</span>
</span></span><span class="line"><span class="cl">                        <span class="o">.</span><span class="n">s</span> <span class="o">^</span><span class="n">LISTMPDATA</span><span class="p">(</span><span class="s2">&#34;WHSYZ&#34;</span><span class="p">,</span><span class="n">Labno</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">)</span><span class="o">=</span><span class="n">TSPrice</span>
</span></span><span class="line"><span class="cl">                        <span class="p">;</span><span class="n">b</span> <span class="p">;</span><span class="n">a</span> <span class="n">MI</span><span class="o">.</span><span class="n">Special</span><span class="o">.</span><span class="n">RecordData</span>	
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="n">Reterr</span><span class="s1">&#39;=0 s UncheckInfo=Reterr_&#34;,&#34;_UncheckInfo continue</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">					
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;RecTS&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">)</span><span class="o">=</span><span class="n">TSPrice</span>   <span class="o">//</span><span class="err">Êé•Êî∂ÂåªÂò±ÂàóË°®</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;SpecimenDR&#34;</span><span class="p">)</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetD</span><span class="p">(</span><span class="n">TestSetDR</span><span class="p">)),</span><span class="mi">10</span><span class="p">)</span>	<span class="o">//</span><span class="n">YHR</span> <span class="mi">20240409</span> <span class="err">Ê†áÊú¨ÈªòËÆ§Ê†áÊú¨Á±ªÂûã</span>
</span></span><span class="line"><span class="cl">                    <span class="n">k</span> <span class="o">^</span><span class="n">LISTMPDATA</span><span class="p">(</span><span class="s2">&#34;WHSYZ&#34;</span><span class="p">,</span><span class="n">Labno</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">b</span> <span class="p">;</span><span class="n">a102</span>
</span></span><span class="line"><span class="cl">                    
</span></span><span class="line"><span class="cl">                    <span class="o">//</span><span class="mi">20160818</span> <span class="n">yy</span>                   
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">OrderID</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">OrdID</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>                                        
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">SpecimenTypeCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">SpecimenTypeCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">RegNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">RegisterNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AdmTypeCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AdmTypeCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AdmNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AdmNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">MedicalRecordNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">DocumentID</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AdmDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AdmDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AdmTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AdmTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">PatName</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">PatientName</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">SexCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">SexCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="n">SexCode</span><span class="o">=</span><span class="s2">&#34;1&#34;</span> <span class="n">s</span> <span class="n">SexCode</span><span class="o">=</span><span class="s2">&#34;M&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="n">SexCode</span><span class="o">=</span><span class="s2">&#34;2&#34;</span> <span class="n">s</span> <span class="n">SexCode</span><span class="o">=</span><span class="s2">&#34;F&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">DOB</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">DOB</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>                   
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">Age</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">Age</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AppDeptCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AppDeptCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AppDeptDesc</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AppDeptDesc</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">DocCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">DocCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">DocDesc</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">DocDesc</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">VerifyDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">VerifyDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">VerifyTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">VerifyTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">Diagnose</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">Diagnose</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">Telephone</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">Telephone</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">IdentityCardNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">IdentityCardNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">PatientAddress</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">PatientAddress</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">Note</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">Note</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ColDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">ColDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ColTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">ColTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">SpecUserCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">SpecUserCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">BedNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">BedNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span> <span class="p">;</span><span class="n">FGJS</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">err</span><span class="p">),</span><span class="n">err</span><span class="s1">&#39;=0 s RetValue=err q RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">I</span> <span class="s1">&#39;$D(^TMP($zn,$j,repid,&#34;RecTS&#34;)),RecFlag=&#34;C&#34; s RetValue=&#34;Êó†ÂèØÊé•Êî∂ÂåªÂò±ÔºÅ&#34; q RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">I</span> <span class="s1">&#39;$D(^TMP($zn,$j,repid,&#34;RecTS&#34;)),RecFlag=&#34;H&#34;,$l(UncheckInfo) s RetValue=&#34;Êú¨Â∑•‰ΩúÂ∞èÁªÑÊó†ÂèØÊ†∏Êî∂ÂåªÂò±,ËØ∑ÈÄÅËá≥&#34;_UncheckInfo_&#34;ÂÅöÊ£ÄÈ™å&#34; q RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span> <span class="p">;</span><span class="n">a101</span>
</span></span><span class="line"><span class="cl">                <span class="n">I</span> <span class="s1">&#39;$D(^TMP($zn,$j,repid,&#34;RecTS&#34;)),RecFlag=&#34;H&#34; s RetValue=&#34;Êó†ÂèØÊ†∏Êî∂ÂåªÂò±ÔºÅ&#34; q RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="s2">&#34;YY&#34;</span><span class="p">,</span><span class="s2">&#34;age&#34;</span><span class="p">)</span><span class="o">=</span><span class="n">Age</span>
</span></span><span class="line"><span class="cl">                <span class="o">///</span><span class="err">‰øùÂ≠òÊ†áÊú¨‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno))) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">VisitNumberDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumber).%OpenId(VisitNumberDR)</span>
</span></span><span class="line"><span class="cl">                <span class="n">e</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumber).%New()</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">VisitNumber</span><span class="o">=</span><span class="n">Labno</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RegNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">RegNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">///</span><span class="err">Â∞±ËØäÁ±ªÂûã</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">AdmissionTypeDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="s1">&#39;$l(AdmTypeCode) s AdmTypeCode=&#34;P&#34;  //ÈªòËÆ§‰ΩìÊ£Ä</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AdmTypeCode</span><span class="p">)</span> <span class="n">s</span> <span class="n">AdmissionTypeDR</span><span class="o">=</span><span class="c1">##Class(HIS.DHCReceiveProcess).GetAdmissionTypeDR(AdmTypeCode)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AdmissionTypeDR</span><span class="o">=</span><span class="n">AdmissionTypeDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AdmNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">AdmNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">;</span><span class="mi">20160819</span> <span class="n">yy</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">MedicalRecordNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">MedicalRecordNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">AdmDate</span><span class="p">)</span> <span class="n">s</span> <span class="n">AdmDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">AdmDate</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AdmTime</span><span class="p">)</span> <span class="n">s</span> <span class="n">AdmTime</span><span class="o">=$</span><span class="n">zth</span><span class="p">(</span><span class="n">AdmTime</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AdmDate</span><span class="o">=</span><span class="n">AdmDate</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AdmTime</span><span class="o">=</span><span class="n">AdmTime</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CertTypeDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">CertTypeDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CertNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">CertNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">IDNumber</span><span class="o">=</span><span class="n">IdentityCardNo</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PaymentTypeDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PaymentTypeDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SurName</span><span class="o">=</span><span class="n">PatName</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">GivenName</span><span class="o">=</span><span class="n">PatName</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">SpeciesDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTSpeciesI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(SexCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpeciesDR</span><span class="o">=</span><span class="n">SpeciesDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">DOB</span><span class="p">)</span> <span class="n">s</span> <span class="n">DOB</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">DOB</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">BirthTime</span><span class="p">)</span> <span class="n">s</span> <span class="n">BirthTime</span><span class="o">=$</span><span class="n">zth</span><span class="p">(</span><span class="n">BirthTime</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BirthDate</span><span class="o">=</span><span class="n">DOB</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BirthTime</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="n">AgeUnitDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">Age</span><span class="p">[</span><span class="s2">&#34;Â≤Å&#34;</span> <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;Y&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">Age</span><span class="p">[</span><span class="s2">&#34;Êúà&#34;</span> <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;M&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">Age</span><span class="p">[</span><span class="s2">&#34;Â§©&#34;</span> <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;D&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">Age</span><span class="p">[</span><span class="s2">&#34;Êó∂&#34;</span> <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;H&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AgeCode</span><span class="p">)</span> <span class="n">s</span> <span class="n">AgeUnitDR</span><span class="o">=</span><span class="c1">##Class(HIS.DHCReceiveProcess).GetAgeUnitDR(AgeCode)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Age</span><span class="o">=+</span><span class="n">Age</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AgeUnitDR</span><span class="o">=</span><span class="n">AgeUnitDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">EthnicityDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">EthnicityDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">HospitalDR</span><span class="o">=</span><span class="n">RecHospitalDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">LocationDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTLocationI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(AppDeptCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">LocationDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AppDeptCode</span><span class="p">)</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTLocationI</span><span class="p">(</span><span class="s2">&#34;IndexHISCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(AppDeptCode))) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">LocationDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTLocationI</span><span class="p">(</span><span class="s2">&#34;IndexHISCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(AppDeptCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.//</span><span class="err">Ê≤°ÊúâÈÖçÂ§ñÈÉ®‰ª£Á†ÅÔºåËÄÉËôëÊòØÂê¶Ëá™Âä®ÊèíÂÖ•</span>
</span></span><span class="line"><span class="cl">                <span class="o">.//</span><span class="n">i</span> <span class="s1">&#39;$l(LocationDR) s LocationDR=##Class(HIS.DHCReceiveProcess).GetLocationDR(AppDeptCode,AppDeptCode,AppDeptDesc,RecHospitalDR)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">LocationDR</span><span class="o">=</span><span class="n">LocationDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">DoctorDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">DocCode</span><span class="p">)</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTDoctorI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(DocCode))) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">DoctorDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTDoctorI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(DocCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.//</span><span class="err">Ê≤°ÊúâÈÖçÂ§ñÈÉ®‰ª£Á†ÅÔºåËÄÉËôëÊòØÂê¶Ëá™Âä®ÊèíÂÖ•</span>
</span></span><span class="line"><span class="cl">                <span class="o">.//</span><span class="n">i</span> <span class="s1">&#39;$l(DoctorDR) s DoctorDR=##Class(HIS.DHCReceiveProcess).GetDoctorDR(DocCode,DocDesc,RecHospitalDR)</span>
</span></span><span class="line"><span class="cl">                <span class="p">;</span><span class="n">b</span> <span class="p">;</span><span class="n">DoctorDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">DoctorDR</span><span class="o">=</span><span class="n">DoctorDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">VerifyDate</span><span class="p">)</span> <span class="n">s</span> <span class="n">VerifyDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">VerifyDate</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">VerifyTime</span><span class="p">)</span> <span class="n">s</span> <span class="n">VerifyTime</span><span class="o">=$</span><span class="n">zth</span><span class="p">(</span><span class="n">VerifyTime</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RequestDate</span><span class="o">=</span><span class="n">VerifyDate</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RequestTime</span><span class="o">=</span><span class="n">VerifyTime</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">WardDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">WardDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BedNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">BedNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Symptom</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">Diagnose</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">MobileNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">MobileNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PhoneNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">Telephone</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">EMail</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">EMail</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Height</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Height</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Weight</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Weight</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BloodPressure</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">BloodPressure</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ClinicalConditionsDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ClinicalConditionsDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">LMPDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">LMPDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">Preg</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">zcvt</span><span class="p">(</span><span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Pregnant</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span><span class="s2">&#34;U&#34;</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;TRUE&#34;</span> <span class="n">s</span> <span class="n">Preg</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Pregnant</span><span class="o">=</span><span class="n">Preg</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PregnantWeeks</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PregnantWeeks</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AboDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">AboDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RhDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">RhDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Address</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">PatientAddress</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PostCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PostCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">InfectFlag</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">InfectFlag</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">Infect</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">zcvt</span><span class="p">(</span><span class="n">InfectFlag</span><span class="p">,</span><span class="s2">&#34;U&#34;</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;TRUE&#34;</span> <span class="n">s</span> <span class="n">Infect</span><span class="o">=</span><span class="mi">1</span>             
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">InfectFlag</span><span class="o">=</span><span class="n">Infect</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">InfectAlert</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">InfectAlert</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">SpecialFlag</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">SpecialFlag</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">Special</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">zcvt</span><span class="p">(</span><span class="n">SpecialFlag</span><span class="p">,</span><span class="s2">&#34;U&#34;</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;TRUE&#34;</span> <span class="n">s</span> <span class="n">Special</span><span class="o">=</span><span class="mi">1</span> 
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecialFlag</span><span class="o">=</span><span class="n">Special</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PregnantNum</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PregnantNum</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ChildbirthNum</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ChildbirthNum</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="mi">20160823</span> <span class="n">yy</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReqNotes</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">Note</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReqNotes</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderID</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BedNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">BedNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RequestNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">RequestNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">Urgent</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Urgent</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">UrgentFlag</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">zcvt</span><span class="p">(</span><span class="n">Urgent</span><span class="p">,</span><span class="s2">&#34;U&#34;</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;TRUE&#34;</span> <span class="n">s</span> <span class="n">UrgentFlag</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Urgent</span><span class="o">=</span><span class="n">UrgentFlag</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">ColDate</span><span class="p">)</span> <span class="n">s</span> <span class="n">ColDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">ColDate</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">ColTime</span><span class="p">),(</span><span class="n">ColTime</span><span class="p">[</span><span class="s2">&#34;:&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">ColTime</span><span class="o">=$</span><span class="n">zth</span><span class="p">(</span><span class="n">ColTime</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">ColDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">ColTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectUserDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">CollectUserDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AnatomicalSiteDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">AnatomicalSiteDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectPositon</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">CollectPositon</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">SpecimenDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTSpecimenI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(SpecimenTypeCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="s1">&#39;$l(SpecimenDR) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenDR</span><span class="o">=</span><span class="n">SpecimenDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ContainerDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectNotes</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">H24UVolume</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">H24UTimePeriod</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BodyTemp</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Confidential</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryTime</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryUserDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;C&#34;</span><span class="p">)</span> <span class="n">d</span> <span class="o">///</span><span class="err">ÈõÜ‰∏≠Êé•Êî∂</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveTime</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveUserDR</span><span class="o">=</span><span class="n">UserDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">CarryUserDR</span><span class="p">),</span><span class="s1">&#39;$l(objVisitNumber.CarryUserDR) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryDate</span> <span class="o">=</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryTime</span> <span class="o">=</span> <span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryUserDR</span> <span class="o">=</span> <span class="n">CarryUserDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveNotes</span><span class="o">=</span><span class="n">ReceiveNotes</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenQualityDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">SpecimenQualityDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span><span class="p">)</span> <span class="n">d</span> <span class="o">///</span><span class="err">Ê†áÊú¨Ê†∏Êî∂</span> <span class="err">Â¶ÇÊûúÂ≠óÊÆµ‰∏∫Á©∫</span> 
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveTime</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveUserDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveUserDR</span><span class="o">=</span><span class="n">UserDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenQualityDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenQualityDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">SpecimenQualityDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>		<span class="o">//</span><span class="n">YHR</span> <span class="mi">20240409</span> <span class="err">‰øùÂ≠òÊ†áÊú¨Ë¥®Èáè</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">b</span> <span class="p">;</span><span class="n">SpecimenQualityDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberD</span><span class="p">(</span><span class="n">VisitNumberDR</span><span class="p">)),</span><span class="mi">56</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;SpecimenDR&#34;</span><span class="p">))</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">                <span class="o">...</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;SpecimenDR&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">e</span>  <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberD</span><span class="p">(</span><span class="n">VisitNumberDR</span><span class="p">)),</span><span class="mi">56</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span> <span class="p">;</span><span class="n">SpecimenDR</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveHospitalDR</span><span class="o">=</span><span class="n">RecHospitalDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">InStorageTime</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">InStorageUserDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">OutStorageTime</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">OutStorageUserDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">OutStorageType</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="s1">&#39;=&#34;S&#34;) d ///ÊãíÊî∂‰øùÂ≠ò‰∏ç‰øùÂ≠òÊó∂Èó¥</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">AddDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">AddTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">AddUserDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddUserDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(AddDate) s AddDate=$tr($zd(+$h,3),&#34;-&#34;)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(AddTime) s AddTime=$p($h,&#34;,&#34;,2)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(AddUserDR) s AddUserDR=UserDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddDate</span><span class="o">=</span><span class="n">AddDate</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddTime</span><span class="o">=</span><span class="n">AddTime</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddUserDR</span><span class="o">=</span><span class="n">AddUserDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddType</span><span class="o">=</span><span class="s2">&#34;3&#34;</span>       <span class="o">///</span><span class="mi">1</span><span class="err">Êù°Á†Å</span><span class="p">,</span><span class="mi">2</span><span class="err">ÊâãÂ∑•</span><span class="p">,</span><span class="mi">3</span><span class="err">Á¨¨‰∏âÊñπ</span><span class="p">,</span><span class="mi">4</span><span class="err">ÂÖ∂ÂÆÉ</span><span class="p">(</span><span class="err">ÊãíÊî∂‰øùÂ≠ò</span><span class="p">)</span>                
</span></span><span class="line"><span class="cl">                <span class="p">;</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RequestNo</span><span class="o">=</span><span class="n">OrderID</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span> <span class="p">;</span><span class="n">a903</span>
</span></span><span class="line"><span class="cl">             	<span class="n">i</span> <span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;A&#34;</span> <span class="n">D</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">ArriveDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">ArriveTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">ArriveUserDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveUserDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(ArriveDate) s ArriveDate=$tr($zd(+$h,3),&#34;-&#34;)</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(ArriveTime) s ArriveTime=$p($h,&#34;,&#34;,2)</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(ArriveUserDR) s ArriveUserDR=UserDR</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveWorkGroupDR</span><span class="o">=</span><span class="n">WorkGroupDR</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveDate</span><span class="o">=</span><span class="n">ArriveDate</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveTime</span><span class="o">=</span><span class="n">ArriveTime</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveUserDR</span><span class="o">=</span><span class="n">ArriveUserDR</span>
</span></span><span class="line"><span class="cl">				<span class="n">b</span> <span class="p">;</span><span class="n">a904</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">sc</span><span class="o">=</span><span class="n">objVisitNumber</span><span class="o">.%</span><span class="n">Save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">;</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">VisitNumberDR</span><span class="o">=</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RowID</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">Else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^Ê†áÊú¨‰ø°ÊÅØ‰øùÂ≠òÂ§±Ë¥•:&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">GetErrorText</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span> <span class="p">;</span><span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">RetValue</span><span class="s1">&#39;=0 q RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">err</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">IsReceived</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">f</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;RecTS&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">q</span><span class="p">:</span><span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">TestSetFee</span><span class="o">=+$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;RecTS&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">RowID</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">RowID</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumberTestSet).%OpenId(RowID)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumberTestSet).%New()</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">Recieved</span><span class="s1">&#39;=1  s IsReceived=0</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">VisitNumberDR</span><span class="o">=</span><span class="n">VisitNumberDR</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">TestSetDR</span><span class="o">=</span><span class="n">TestSetDR</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">Recieved</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(AssayNo),$l(WorkGroupMachineDR)   {</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">CommDirection</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTWorkGroupMachineD</span><span class="p">(</span><span class="n">WorkGroupMachineDR</span><span class="p">),</span><span class="mi">11</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="n">CommDirection</span><span class="o">=</span><span class="s2">&#34;UP&#34;</span> <span class="n">s</span> <span class="n">AssayNo</span><span class="o">=</span><span class="n">Labno</span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="n">CommDirection</span><span class="o">=</span><span class="s2">&#34;BI&#34;</span> <span class="n">s</span> <span class="n">AssayNo</span><span class="o">=</span><span class="n">Labno</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">WorkGroupMachineDR</span><span class="o">=</span><span class="n">WorkGroupMachineDR</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">TransmitDate</span><span class="o">=</span><span class="n">TransmitDate</span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="s1">&#39;$l(AssayNo) s AssayNo=EpisodeNo </span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="s1">&#39;$l(AssayNo) s AssayNo=Labno</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">AssayNo</span><span class="o">=</span><span class="n">AssayNo</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">TestSetFee</span><span class="o">=</span><span class="n">TestSetFee</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">HISOrderID</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">Sequence</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">sc</span><span class="o">=</span><span class="n">objTestSets</span><span class="o">.%</span><span class="n">Save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                        <span class="o">//</span><span class="err">Êõ¥Êñ∞‰∏ä‰º†ËÆ∞ÂΩï</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="c1">##Class(MI.MachineUpload).Upload(Labno,TestSetDR,WorkGroupMachineDR)</span>
</span></span><span class="line"><span class="cl">                     <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Else</span> <span class="p">{</span><span class="n">s</span> <span class="n">err</span><span class="o">=$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">GetErrorText</span><span class="p">(</span><span class="n">sc</span><span class="p">)}</span>        
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span> <span class="o">//</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;C&#34;</span><span class="p">,</span><span class="n">IsReceived</span><span class="o">=</span><span class="mi">1</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^Ê†áÊú¨Â∑≤Êé•Êî∂&#34;</span> <span class="n">q</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^Ê£ÄÈ™åÂåªÂò±‰øùÂ≠òÂ§±Ë¥•:&#34;</span><span class="n">_err</span> <span class="n">q</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="o">///</span><span class="err">Êä•ÂëäÊ†∏Êî∂</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span><span class="p">){</span> 
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumberReport).%New()</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">VisitNumberDR</span><span class="o">=</span><span class="n">VisitNumberDR</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">TransmitDate</span><span class="o">=</span><span class="n">TransmitDate</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">WorkGroupMachineDR</span><span class="o">=</span><span class="n">WorkGroupMachineDR</span>   
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">OrderNo</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(AssayNo) s AssayNo=EpisodeNo </span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(AssayNo) s AssayNo=Labno</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AssayNo</span><span class="o">=</span><span class="n">AssayNo</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AccessionNo</span><span class="o">=</span><span class="s2">&#34;&#34;</span>   <span class="o">///</span><span class="err">ÁªÜËèåÂàÜÁ¶ªÂè∑</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">EpisodeNo</span><span class="o">=</span><span class="n">EpisodeNo</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AcceptDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AcceptTime</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AcceptUserDR</span><span class="o">=</span><span class="n">UserDR</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">Status</span><span class="o">=</span><span class="mi">1</span>  <span class="o">//</span><span class="err">Êä•ÂëäÁä∂ÊÄÅ</span><span class="p">(</span><span class="mi">1</span><span class="err">ÁôªËÆ∞Ôºå</span><span class="mi">2</span><span class="err">ÂàùÂÆ°Ôºå</span><span class="mi">3</span><span class="err">ÂÆ°Ê†∏Ôºå</span><span class="mi">4</span><span class="err">Â§çÊü•Ôºå</span><span class="mi">5</span><span class="err">ÂèñÊ∂àÂÆ°Ê†∏Ôºå</span><span class="mi">6</span><span class="err">‰ΩúÂ∫üÔºå</span><span class="n">OÂÖ∂‰ªñ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">RackNo</span><span class="o">=</span><span class="n">RackNo</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="n">objVisitNumberReport</span><span class="o">.%</span><span class="n">Save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="n">b</span> <span class="o">//</span><span class="mi">901</span>
</span></span><span class="line"><span class="cl">                    <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span> <span class="p">{</span><span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">0</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Else</span> <span class="p">{</span><span class="n">s</span> <span class="n">err</span><span class="o">=</span><span class="s2">&#34;Ê†áÊú¨‰ø°ÊÅØÊ†∏Êî∂Â§±Ë¥•:&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">GetErrorText</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="n">Quit</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	                <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	                <span class="n">f</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;RecTS&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">))</span> <span class="o">//</span><span class="err">Êú¨Ê¨°Ê†∏Êî∂ÂåªÂò±</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">q</span><span class="p">:</span><span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">s</span> <span class="n">RowID</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">RowID</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	                         <span class="n">s</span> <span class="n">objTestSets</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumberTestSet).%OpenId(RowID)</span>
</span></span><span class="line"><span class="cl">	                         <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">VisitNumberReportDR</span><span class="o">=</span><span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">RowID</span>
</span></span><span class="line"><span class="cl">	                         <span class="n">s</span> <span class="n">sc</span><span class="o">=</span><span class="n">objTestSets</span><span class="o">.%</span><span class="n">Save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		                     <span class="n">If</span> <span class="p">(</span><span class="s1">&#39;$SYSTEM.Status.IsOK(sc)) {</span>
</span></span><span class="line"><span class="cl">		                       <span class="n">s</span> <span class="n">err</span><span class="o">=$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">GetErrorText</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span> <span class="n">q</span> 
</span></span><span class="line"><span class="cl">		                     <span class="p">}</span>    
</span></span><span class="line"><span class="cl">	                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">	                    <span class="o">//</span><span class="err">ÊåâÂåªÂò±ÁîüÊàêÊä•ÂëäÈ°πÁõÆÁªìÊûú</span>
</span></span><span class="line"><span class="cl">						<span class="n">s</span> <span class="n">retVal</span><span class="o">=</span><span class="c1">##Class(LISSP.DHCRPVisitNumberReport).SaveReportTestCode(objVisitNumberReport.RowID,TestSetDR)</span>
</span></span><span class="line"><span class="cl">						<span class="n">i</span> <span class="n">retVal</span><span class="s1">&#39;=1 s err=retVal q </span>
</span></span><span class="line"><span class="cl">	                 <span class="p">}</span> 
</span></span><span class="line"><span class="cl">	                 <span class="n">b</span> <span class="o">//</span><span class="mi">902</span>
</span></span><span class="line"><span class="cl">	                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^Ê£ÄÈ™åÂåªÂò±‰øùÂ≠òÂ§±Ë¥•:&#34;</span><span class="n">_err</span> <span class="n">q</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">                    <span class="o">//</span><span class="err">Êõ¥Êñ∞Â∑•‰ΩúÂ∞èÁªÑÊµÅÊ∞¥Âè∑</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">CurDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">WorkGroupMachineDR</span><span class="p">),</span><span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">EpisodeNo</span><span class="p">)</span> <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="c1">##Class(HIS.DHCCommon).SaveWorkGroupMachineEpis(WorkGroupMachineDR,CurDate,EpisodeNo)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="n">ret</span><span class="s1">&#39;=1,err=&#34;Êõ¥Êñ∞Â∑•‰ΩúÂ∞èÁªÑÊµÅÊ∞¥Âè∑Â§±Ë¥•:&#34;_ret Quit</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^&#34;</span><span class="n">_err</span> <span class="n">q</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="o">///</span><span class="err">ÊèíÂÖ•Ê†áÊú¨Ê†∏Êî∂Êìç‰ΩúËÆ∞ÂΩï</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="p">(</span><span class="n">OperateDate</span><span class="p">,</span><span class="n">OperateTime</span><span class="p">,</span><span class="n">OperateTypeCode</span><span class="p">,</span><span class="n">OperateNotes</span><span class="p">,</span><span class="n">RejectTypeDR</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">OperateNotes</span><span class="o">=</span><span class="n">ReceiveNotes</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;A&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">OperateTypeCode</span><span class="o">=</span><span class="mi">30</span>  <span class="o">//</span><span class="err">ÈÄÅËææ</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;S&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">OperateTypeCode</span><span class="o">=</span><span class="mi">31</span>  <span class="o">///</span><span class="err">‰øùÂ≠ò</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;C&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">OperateTypeCode</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">OperateNotes</span><span class="o">=</span><span class="n">OperIP</span>  <span class="o">///</span><span class="err">Êé•Êî∂</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">OperateTypeCode</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">OperateNotes</span><span class="o">=</span><span class="n">OperIP</span>  <span class="o">///</span><span class="err">Ê†∏Êî∂</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span>										<span class="n">VisitNumberDR</span><span class="p">,</span> <span class="n">OperateDate</span><span class="p">,</span> <span class="n">OperateTime</span><span class="p">,</span> <span class="n">UserID</span><span class="p">,</span> <span class="n">OperateNotes</span><span class="p">,</span> <span class="n">OperateTypeCode</span><span class="p">,</span> <span class="n">WorkGroupMachineDR</span><span class="p">,</span> <span class="n">RejectTypeDR</span><span class="p">,</span> <span class="n">IPAddress</span><span class="p">,</span> <span class="n">WorkGroupDR</span><span class="p">,</span> <span class="n">Sessions</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="c1">##Class(HIS.DHCCommon).SaveRecord(VisitNumberDR,OperateDate, OperateTime, UserDR, OperateNotes, OperateTypeCode, WorkGroupMachineDR, RejectTypeDR,OperIP,WorkGroupDR,Sessions)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">ret</span><span class="s1">&#39;=1  s RetValue=&#34;Ê†áÊú¨Êìç‰ΩúËÆ∞ÂΩï‰øùÂ≠òÂ§±Ë¥•:&#34;_ret q RetValue</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">     <span class="o">/*</span>
</span></span><span class="line"><span class="cl">    <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">Else</span> 
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>			
</span></span><span class="line"><span class="cl">    <span class="o">*/</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">UncheckInfo</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="n">RetValue_</span><span class="s2">&#34;UncheckInfo&#34;</span><span class="n">_UncheckInfo</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">UncheckInfo</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">1</span><span class="n">_</span><span class="s2">&#34;^Êú™Ê†∏Êî∂ÂåªÂò±:&#34;</span><span class="n">_UncheckInfo</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="p">;</span><span class="n">CSRetValue</span>
</span></span><span class="line"><span class="cl">    <span class="n">Q</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">ErrorHandle</span>
</span></span><span class="line"><span class="cl">    <span class="n">TROLLBACK</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^ÈîôËØØ&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">ZERROR</span><span class="p">,</span><span class="s2">&#34;^&#34;</span><span class="p">,</span><span class="s2">&#34;--&#34;</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34;.ÈîôËØØ‰ª£Á†Å:&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">ECODE</span>
</span></span><span class="line"><span class="cl">    <span class="n">Quit</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="Ê†áÊú¨ÂõûÂÜôÊé•Êî∂Áä∂ÊÄÅ‰ø°ÊÅØ">Ê†áÊú¨ÂõûÂÜôÊé•Êî∂Áä∂ÊÄÅ‰ø°ÊÅØ
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/// w ##Class(LIS.Service.ENS.TransReport).ReturnStatus(&#34;**4868149*&#34;,1).Read()
</span></span><span class="line"><span class="cl">/// w ##Class(LIS.Service.ENS.TransReport).ReturnStatus(&#34;**8015454*&#34;,1).Read()
</span></span><span class="line"><span class="cl">/// ÂõûÂÜôÊ†áÊú¨Êé•ÂèóÁä∂ÊÄÅ‰ø°ÊÅØ
</span></span><span class="line"><span class="cl">ClassMethod ReturnStatus(Labno, ret)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	s Labno=$tr(Labno,&#34;*&#34;)
</span></span><span class="line"><span class="cl">	s Labno=$tr(Labno,&#34;\&#34;)
</span></span><span class="line"><span class="cl">	//Ëé∑ÂèñÊï∞ÊçÆ
</span></span><span class="line"><span class="cl">	s return=&#34;&#34;
</span></span><span class="line"><span class="cl">	i ret=1 d
</span></span><span class="line"><span class="cl">	.s ResultCode=&#34;T&#34;
</span></span><span class="line"><span class="cl">	.s ResultContent=&#34;&#34;
</span></span><span class="line"><span class="cl">	e  d
</span></span><span class="line"><span class="cl">	.s ResultCode=&#34;F&#34;
</span></span><span class="line"><span class="cl">	.s ResultContent=ret
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	//ÊãºË£Öjson
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	S Main={}
</span></span><span class="line"><span class="cl">    s Main.&#34;receivestatus&#34;=ResultCode
</span></span><span class="line"><span class="cl">    s Date=$h
</span></span><span class="line"><span class="cl">    s Main.&#34;receivedate&#34;=$tr($zd($p(Date,&#34;,&#34;,1),3),&#34;-&#34;,&#34;.&#34;)
</span></span><span class="line"><span class="cl">    s Main.&#34;receivetime&#34;=$tr($zd($p(Date,&#34;,&#34;,1),3),&#34;-&#34;,&#34;.&#34;)_&#34; &#34;_$zt($p(Date,&#34;,&#34;,2),1)
</span></span><span class="line"><span class="cl">    s Main.&#34;labno&#34;=Labno
</span></span><span class="line"><span class="cl">    set OutStr=Main.%ToJSON()
</span></span><span class="line"><span class="cl">    s stream=##class(%GlobalCharacterStream).%New()
</span></span><span class="line"><span class="cl">    d stream.Write(OutStr)
</span></span><span class="line"><span class="cl">    b ;a OutStr
</span></span><span class="line"><span class="cl">	s CurNamespace=$ZUTIL(5)
</span></span><span class="line"><span class="cl">	s WebNamespace=##Class(OTH.SYSParameter).GetWebNamespace()
</span></span><span class="line"><span class="cl">	NEW $NAMESPACE 
</span></span><span class="line"><span class="cl">	s $NAMESPACE= WebNamespace
</span></span><span class="line"><span class="cl">	i $e(Labno,1)=4 s return=##class(web.DHCENS.STBLL.SOAP.HISSystemServieSoap).HIPMessageServerS(&#34;MES0023&#34;,stream)
</span></span><span class="line"><span class="cl">	i $e(Labno,1)=8 s return=##class(web.DHCENS.STBLL.SOAP.HISSystemServieSoap).HIPMessageServerS(&#34;MES0027&#34;,stream)		//YHR 20240416 Êä§ÁêÜÈô¢ÂõûÂÜô
</span></span><span class="line"><span class="cl">	;s ^YHR(&#34;HXBG&#34;,Labno)=return.Read()
</span></span><span class="line"><span class="cl">	b ;Input
</span></span><span class="line"><span class="cl">	s $NAMESPACE= CurNamespace
</span></span><span class="line"><span class="cl">	q return
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="Âõû‰º†‰ΩìÊ£ÄÁªìÊûú‰ø°ÊÅØ">Âõû‰º†‰ΩìÊ£ÄÁªìÊûú‰ø°ÊÅØ
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/// CreatorÔºö        liuzf
</span></span><span class="line"><span class="cl">/// CreateDateÔºö 2016-04-27
</span></span><span class="line"><span class="cl">/// DescriptionÔºö    ÂèëÈÄÅÊ†áÊú¨ÁªìÊûúÂà∞‰ΩìÊ£Ä
</span></span><span class="line"><span class="cl">/// TableÔºö          Êó†
</span></span><span class="line"><span class="cl">/// InputÔºö          Ê£ÄÈ™åÂè∑
</span></span><span class="line"><span class="cl">/// OutputÔºö     Êó†
</span></span><span class="line"><span class="cl">/// ReturnÔºö     ÈîôËØØ‰ø°ÊÅØ
</span></span><span class="line"><span class="cl">/// OthersÔºö     Êó†
</span></span><span class="line"><span class="cl">/// w ##Class(LIS.Service.ENS.TransReport).GetReport(&#34;206&#34;,&#34;&#34;)
</span></span><span class="line"><span class="cl">ClassMethod GetReport(ReportDR As %String, ByRef error As %String) As %String
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    s ReportDR=$g(ReportDR)
</span></span><span class="line"><span class="cl">    //Set $ZTrap = &#34;ErrorHandle&#34;
</span></span><span class="line"><span class="cl">    //Âü∫Êú¨‰ø°ÊÅØ
</span></span><span class="line"><span class="cl">    s ^TMP(&#34;YY&#34;,&#34;ReportDR&#34;)=ReportDR
</span></span><span class="line"><span class="cl">    s RetStr=&#34;&#34;
</span></span><span class="line"><span class="cl">    i &#39;$l(ReportDR) q $$ReturnOut(&#34;Êó†Ê≠§Êä•Âëä&#34;)
</span></span><span class="line"><span class="cl">    i &#39;$l(ReportDR) q $$ReturnOut(&#34;Êó†Ê≠§Êä•Âëä&#34;)
</span></span><span class="line"><span class="cl">    s ReportData=$g(^dbo.RPVisitNumberReportD(ReportDR))
</span></span><span class="line"><span class="cl">    i $lg(ReportData,22)&#39;=3 q $$ReturnOut(&#34;Êä•ÂëäÊú™ÂÆ°Ê†∏&#34;)
</span></span><span class="line"><span class="cl">    s VisitNumberDR=$lg(ReportData,2)
</span></span><span class="line"><span class="cl">    i &#39;$l(VisitNumberDR) q $$ReturnOut(&#34;Êó†Ê≠§Êä•Âëä&#34;)
</span></span><span class="line"><span class="cl">    s VisitNumberData=$g(^dbo.RPVisitNumberD(VisitNumberDR))
</span></span><span class="line"><span class="cl">    s LabNo=$lg(VisitNumberData,2)
</span></span><span class="line"><span class="cl">    s gName=$lg(VisitNumberData,14)
</span></span><span class="line"><span class="cl">    s sName=$lg(VisitNumberData,13)
</span></span><span class="line"><span class="cl">    s patname=gName_&#34; &#34;_sName
</span></span><span class="line"><span class="cl">    i gName=sName s patname=gName
</span></span><span class="line"><span class="cl">    s spname=&#34;&#34;             ;ÊÄßÂà´
</span></span><span class="line"><span class="cl">    s SpeciesDR=$lg(VisitNumberData,15)
</span></span><span class="line"><span class="cl">    i $l(SpeciesDR) s spname=$lg(^dbo.BTSpeciesD(SpeciesDR),3)
</span></span><span class="line"><span class="cl">    s patDOB=$lg(VisitNumberData,16)
</span></span><span class="line"><span class="cl">    i (patDOB&lt;10000000) s patDOB=$zd(patDOB,8)
</span></span><span class="line"><span class="cl">    i $l(patDOB) s patDOB=##Class(LIS.Util.Common).FormatDate(patDOB)
</span></span><span class="line"><span class="cl">    s Age=$lg(VisitNumberData,18)
</span></span><span class="line"><span class="cl">    s AgeUnitDR=$lg(VisitNumberData,19),AgeUnit=&#34;&#34;
</span></span><span class="line"><span class="cl">    i $l(AgeUnitDR) s AgeUnit=$lg($g(^dbo.BTAgeUnitD(AgeUnitDR)),3)
</span></span><span class="line"><span class="cl">    s patage=Age_AgeUnit
</span></span><span class="line"><span class="cl">    //
</span></span><span class="line"><span class="cl">    s SpecimenDR=$lg(VisitNumberData,56),specmen=&#34;&#34;   ;Ê†áÊú¨Á±ªÂûã
</span></span><span class="line"><span class="cl">    i $l(SpecimenDR) s specmen=$lg($g(^dbo.BTSpecimenD(SpecimenDR)),3)  
</span></span><span class="line"><span class="cl">    s tsname=&#34;&#34;,TSCode=&#34;&#34;
</span></span><span class="line"><span class="cl">    s TestSetDR=&#34;&#34; f  s TestSetDR=$o(^dbo.RPVisitNumberTestSetI(&#34;IndexMaster&#34;,VisitNumberDR,TestSetDR)) q:TestSetDR=&#34;&#34;  d
</span></span><span class="line"><span class="cl">    .i $l(tsname) s tsname=tsname_&#34;+&#34;_$lg(^dbo.BTTestSetD(TestSetDR),3),TSCode=TSCode_&#34;+&#34;_$lg(^dbo.BTTestSetD(TestSetDR),2)
</span></span><span class="line"><span class="cl">    .e  s tsname=$lg(^dbo.BTTestSetD(TestSetDR),3),TSCode=$lg(^dbo.BTTestSetD(TestSetDR),2)
</span></span><span class="line"><span class="cl">    i $l(specmen,&#34;(&#34;)&gt;1 s specmen=$p(specmen,&#34;(&#34;,1)
</span></span><span class="line"><span class="cl">    //
</span></span><span class="line"><span class="cl">    s patloc=&#34;&#34;                    ;ÁßëÂÆ§
</span></span><span class="line"><span class="cl">    s LocationDR=$lg(VisitNumberData,22)
</span></span><span class="line"><span class="cl">    i $l(LocationDR) s patloc=$lg($g(^dbo.BTLocationD(LocationDR)),3)
</span></span><span class="line"><span class="cl">    //Áî≥ËØ∑Êó•Êúü
</span></span><span class="line"><span class="cl">    s requestdate=$lg(VisitNumberData,24)
</span></span><span class="line"><span class="cl">    i (requestdate&lt;10000000) s requestdate=$zd(requestdate,8) 
</span></span><span class="line"><span class="cl">    i $l(requestdate) s requestdate=##Class(LIS.Util.Common).FormatDate(requestdate)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    //
</span></span><span class="line"><span class="cl">    s (recdate,rectime,recusr,entrydate,entrytime,entryusr,authdate,authtime,authusr)=&#34;&#34;
</span></span><span class="line"><span class="cl">    s recdate=$lg(VisitNumberData,66)   ;Êé•Êî∂Êó•Êúü
</span></span><span class="line"><span class="cl">    s rectime=$lg(VisitNumberData,67)   ;Êé•Êî∂Êó∂Èó¥
</span></span><span class="line"><span class="cl">    i $l(recdate) s recdate=##Class(LIS.Util.Common).FormatDate(recdate)
</span></span><span class="line"><span class="cl">    i $l(rectime) s rectime=##Class(LIS.Util.Common).FormatTime(rectime)
</span></span><span class="line"><span class="cl">    s ReceiveUserDR=$lg(VisitNumberData,68)
</span></span><span class="line"><span class="cl">    i $l(ReceiveUserDR) s recusr=$lg($g(^dbo.SYSUserD(ReceiveUserDR)),3) 
</span></span><span class="line"><span class="cl">    s entrydate=$lg(ReportData,16)      ;ÂàùÂÆ°Êó•Êúü
</span></span><span class="line"><span class="cl">    s entrytime=$lg(ReportData,17)      ;ÂàùÂÆ°Êó∂Èó¥
</span></span><span class="line"><span class="cl">    i $l(entrydate) s entrydate=##Class(LIS.Util.Common).FormatDate(entrydate)
</span></span><span class="line"><span class="cl">    i $l(entrytime) s entrytime=##Class(LIS.Util.Common).FormatTime(entrytime)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    s EntryUserDR=$lg(ReportData,18)
</span></span><span class="line"><span class="cl">    i $l(EntryUserDR) s entryusr=$lg($g(^dbo.SYSUserD(EntryUserDR)),3)
</span></span><span class="line"><span class="cl">    s authdate=$lg(ReportData,19)       ;Ê†∏Êî∂Êó•Êúü
</span></span><span class="line"><span class="cl">    s authtime=$lg(ReportData,20)       ;Ê†∏Êî∂Êó∂Èó¥
</span></span><span class="line"><span class="cl">    i $l(authdate) s authdate=##Class(LIS.Util.Common).FormatDate(authdate)
</span></span><span class="line"><span class="cl">    i $l(authtime) s authtime=##Class(LIS.Util.Common).FormatTime(authtime)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    s AuthUserDR=$lg(ReportData,21)
</span></span><span class="line"><span class="cl">    i $l(AuthUserDR) s authusr=$lg($g(^dbo.SYSUserD(AuthUserDR)),3)
</span></span><span class="line"><span class="cl">    //
</span></span><span class="line"><span class="cl">    s coldate=$lg(VisitNumberData,51)   ;ÈááÈõÜÊó•Êúü
</span></span><span class="line"><span class="cl">    s coltime=$lg(VisitNumberData,52)   ;ÈááÈõÜÊó∂Èó¥
</span></span><span class="line"><span class="cl">    i $l(coldate) s coldate=##Class(LIS.Util.Common).FormatDate(coldate)
</span></span><span class="line"><span class="cl">    i $l(coltime) s coltime=##Class(LIS.Util.Common).FormatTime(coltime)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    s CollDT=&#34;&#34;
</span></span><span class="line"><span class="cl">    i $l(coldate) s CollDT=coldate_&#34; &#34;_coltime
</span></span><span class="line"><span class="cl">    //
</span></span><span class="line"><span class="cl">    s (recDT,entryDT,authDT)=&#34;&#34;
</span></span><span class="line"><span class="cl">    i $l(recdate) s recDT=recdate_&#34; &#34;_rectime
</span></span><span class="line"><span class="cl">    i $l(entrydate) s entryDT=entrydate_&#34; &#34;_entrytime
</span></span><span class="line"><span class="cl">    i $l(authdate) s authDT=authdate_&#34; &#34;_authtime
</span></span><span class="line"><span class="cl">    //
</span></span><span class="line"><span class="cl">    s debtor=$lg(VisitNumberData,3)  ;ÁôªËÆ∞Âè∑
</span></span><span class="line"><span class="cl">    s DoctorDR=$lg(VisitNumberData,23)
</span></span><span class="line"><span class="cl">    s docname=&#34;&#34;                    ;ÂåªÁîü
</span></span><span class="line"><span class="cl">    i $l(DoctorDR) s docname=$lg($g(^dbo.BTDoctorD(DoctorDR)),3)
</span></span><span class="line"><span class="cl">    //ËØäÊñ≠
</span></span><span class="line"><span class="cl">    s patdiag=&#34;&#34;
</span></span><span class="line"><span class="cl">    s DiseaseDR=&#34;&#34; f  s DiseaseDR=$o(^dbo.RPVisitNumberDiagnoseI(&#34;IndexMaster&#34;,VisitNumberDR,DiseaseDR)) q:DiseaseDR=&#34;&#34;  d
</span></span><span class="line"><span class="cl">    .i $l(patdiag) s patdiag=patdiag_&#34;+&#34;_$lg(^dbo.BTDiseaseD(DiseaseDR),4)
</span></span><span class="line"><span class="cl">    .e  s patdiag=$lg(^dbo.BTDiseaseD(DiseaseDR),4)
</span></span><span class="line"><span class="cl">    //‰ª™Âô®,ÁóÖÂå∫,Â∫äÂè∑,ÊµÅÊ∞¥Âè∑
</span></span><span class="line"><span class="cl">    s Machine=&#34;&#34;
</span></span><span class="line"><span class="cl">    //s MachineDR=$lg(ResultData,14)
</span></span><span class="line"><span class="cl">    //i $l(MachineDR) s Machine=$lg($g(^dbo.BTMIMachineParameterD(MachineDR)),3)
</span></span><span class="line"><span class="cl">    s bed=$lg(VisitNumberData,27)    ;Â∫äÂè∑
</span></span><span class="line"><span class="cl">    s WardName=&#34;&#34;
</span></span><span class="line"><span class="cl">    s WardDR=$lg(VisitNumberData,26)
</span></span><span class="line"><span class="cl">    i $l(WardDR) s WardName=$lg($g(^dbo.BTWardD(WardDR)),3)
</span></span><span class="line"><span class="cl">    s episode=$lg(ReportData,8)
</span></span><span class="line"><span class="cl">    //Ê£ÄÈ™åÁßë-Èó®ËØäÊ£ÄÈ™åÁªÑ\Lab Manager#84322268
</span></span><span class="line"><span class="cl">    s Depart=&#34;&#34;
</span></span><span class="line"><span class="cl">    s WorkGroupMachineDR=$lg(ReportData,4)
</span></span><span class="line"><span class="cl">    i $l(WorkGroupMachineDR) s WorkGroupDR=$lg($g(^dbo.BTWorkGroupMachineD(WorkGroupMachineDR)),4)
</span></span><span class="line"><span class="cl">    i $l(WorkGroupDR) s DepartPhone=$lg($g(^dbo.BTWorkGroupD(WorkGroupDR)),6)
</span></span><span class="line"><span class="cl">    // 20141114
</span></span><span class="line"><span class="cl">    s AdmID=$lg(VisitNumberData,6)
</span></span><span class="line"><span class="cl">    s AdmNo=$lg(VisitNumberData,5)
</span></span><span class="line"><span class="cl">    s Notes=$lg(VisitNumberData,48)
</span></span><span class="line"><span class="cl">    s requestNo=$p($lg(VisitNumberData,48),&#34;^&#34;)
</span></span><span class="line"><span class="cl">    s PDFFileDR=$o(^dbo.RPVisitNumberReportFileI(&#34;IndexMater&#34;,ReportDR,&#34;&#34;)),PDFFile=&#34;&#34;
</span></span><span class="line"><span class="cl">    i $l(PDFFileDR) s PDFFile=$lg($g(^dbo.RPVisitNumberReportFileD(PDFFileDR)),6)		//YHR 20240409 Âõû‰º†PDFÈìæÊé•
</span></span><span class="line"><span class="cl">    S obj=##Class(LIS.Service.ENS.Data.ReportMsg).%New()
</span></span><span class="line"><span class="cl">    s obj.OrdID=requestNo
</span></span><span class="line"><span class="cl">    s obj.LabNo=LabNo
</span></span><span class="line"><span class="cl">    s obj.ReportID=ReportDR ///Êä•ÂëäID
</span></span><span class="line"><span class="cl">    s obj.ReportUrl=&#34;&#34;      //Êä•ÂëäÂú∞ÂùÄ
</span></span><span class="line"><span class="cl">    s obj.RecUser=recusr            //Êé•Êî∂ËÄÖ
</span></span><span class="line"><span class="cl">    s obj.RecUserCode=ReceiveUserDR //Êé•Êî∂ËÄÖ‰ª£Á†Å
</span></span><span class="line"><span class="cl">    s obj.RecDate=recdate       //Êé•Êî∂Êó•Êúü
</span></span><span class="line"><span class="cl">    s obj.RecTime=rectime       //Êé•Êî∂Êó∂Èó¥
</span></span><span class="line"><span class="cl">    s obj.EntryUser=entryusr    //ÂΩïÂÖ•ËÄÖ
</span></span><span class="line"><span class="cl">    s obj.EntryUserCode=EntryUserDR //ÂΩïÂÖ•ËÄÖ‰ª£Á†Å
</span></span><span class="line"><span class="cl">    s obj.EntryDate=entrydate   //ÂΩïÂÖ•Êó•Êúü
</span></span><span class="line"><span class="cl">    s obj.EntryTime=entrytime   //ÂΩïÂÖ•Êó∂Èó¥
</span></span><span class="line"><span class="cl">    s obj.AuthUser=authusr      //ÂÆ°Ê†∏ËÄÖ
</span></span><span class="line"><span class="cl">    s obj.AuthUserCode=AuthUserDR   //ÂÆ°Ê†∏ËÄÖ‰ª£Á†Å
</span></span><span class="line"><span class="cl">    s obj.AuthDate=authdate //ÂÆ°Ê†∏Êó•Êúü
</span></span><span class="line"><span class="cl">    s obj.AuthTime=authtime //ÂÆ°Ê†∏Êó∂Èó¥
</span></span><span class="line"><span class="cl">    s obj.Notes=Notes       //Êä•ÂëäÂ§áÊ≥®
</span></span><span class="line"><span class="cl">    s obj.ImageFile=&#34;&#34;      //ÂõæÂÉèÁöÑË∑ØÂæÑÔºàÂ§öÂπÖÂõæ‰ΩøÁî®@ÂàÜÂâ≤Ôºâ 
</span></span><span class="line"><span class="cl">    s obj.MainWarnDesc=&#34;&#34;   //Âç±ÊÄ•ÂÄºËØ¥Êòé 
</span></span><span class="line"><span class="cl">    s obj.PDFFile=PDFFile
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    //ÁªìÊûú
</span></span><span class="line"><span class="cl">    Set result = ##class(%ResultSet).%New(&#34;LIS.Service.ENS.Business.ReportResult:QryTestSetResult&#34;)
</span></span><span class="line"><span class="cl">    Set sc = result.Execute(ReportDR)
</span></span><span class="line"><span class="cl">    While (result.Next(.sc)) // go to the next row of the result set
</span></span><span class="line"><span class="cl">     {
</span></span><span class="line"><span class="cl">        If ($SYSTEM.Status.IsOK(sc)) // check if this succeeded without errors
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                s objRes=##Class(LIS.Service.ENS.Data.ResultMsg).%New()
</span></span><span class="line"><span class="cl">                s objRes.LabNo=LabNo
</span></span><span class="line"><span class="cl">                s objRes.TestSetCode=result.Data(&#34;TestSetCode&#34;)
</span></span><span class="line"><span class="cl">                s objRes.TestCode=result.Data(&#34;TestCode&#34;)
</span></span><span class="line"><span class="cl">                s objRes.TestName=result.Data(&#34;TestName&#34;)
</span></span><span class="line"><span class="cl">                s objRes.TestEngName=result.Data(&#34;TestSync&#34;)
</span></span><span class="line"><span class="cl">                s objRes.Result=result.Data(&#34;Result&#34;)
</span></span><span class="line"><span class="cl">                s ResFlag=result.Data(&#34;ResFlag&#34;)
</span></span><span class="line"><span class="cl">                i &#39;$l(ResFlag) s ResFlag=&#34;N&#34;
</span></span><span class="line"><span class="cl">                s objRes.ResultFlag=ResFlag
</span></span><span class="line"><span class="cl">                s objRes.Units=result.Data(&#34;Unit&#34;)
</span></span><span class="line"><span class="cl">                s Ranges=result.Data(&#34;Ranges&#34;)
</span></span><span class="line"><span class="cl">                i &#39;$l(Ranges) s Ranges=&#34; &#34;
</span></span><span class="line"><span class="cl">                s objRes.Ranges=Ranges
</span></span><span class="line"><span class="cl">                s MICFlag=result.Data(&#34;MICFlag&#34;)
</span></span><span class="line"><span class="cl">                //whf add 2016-8-29
</span></span><span class="line"><span class="cl">                i MICFlag=&#34;Y&#34;
</span></span><span class="line"><span class="cl">                {
</span></span><span class="line"><span class="cl">                    s objRes.MICFlag=&#34;Y&#34;
</span></span><span class="line"><span class="cl">                    s objRes.Result=result.Data(&#34;OrganismCode&#34;)
</span></span><span class="line"><span class="cl">                    s objRes.MICName=result.Data(&#34;OrganismDesc&#34;)
</span></span><span class="line"><span class="cl">                }
</span></span><span class="line"><span class="cl">                //
</span></span><span class="line"><span class="cl">                s objRes.Sequence=result.Data(&#34;Sequence&#34;) //ÊòæÁ§∫È°∫Â∫è 20141114 huhm
</span></span><span class="line"><span class="cl">                ///ÁªÜËèåÁªìÊûúID
</span></span><span class="line"><span class="cl">                s SenResultId=result.Data(&#34;SenResultId&#34;)
</span></span><span class="line"><span class="cl">                i $l(SenResultId) 
</span></span><span class="line"><span class="cl">                {
</span></span><span class="line"><span class="cl">                    s sen=##class(%ResultSet).%New(&#34;LIS.Service.ENS.Business.ReportResult:QryTestSetResultSen&#34;)
</span></span><span class="line"><span class="cl">                    Set st = sen.Execute(SenResultId)
</span></span><span class="line"><span class="cl">                    While (sen.Next(.st))
</span></span><span class="line"><span class="cl">                    {
</span></span><span class="line"><span class="cl">                       If ($SYSTEM.Status.IsOK(st)) 
</span></span><span class="line"><span class="cl">                       {
</span></span><span class="line"><span class="cl">                           //WCode,AntCode,AntName,SenCode,SenName,SenMethod,SenValue
</span></span><span class="line"><span class="cl">                           s objSen=##Class(LIS.Service.ENS.Data.OrgResultMsg).%New()
</span></span><span class="line"><span class="cl">                           s objSen.BugsCode=result.Data(&#34;OrganismCode&#34;)
</span></span><span class="line"><span class="cl">                           s objSen.AntiCode=sen.Data(&#34;AntCode&#34;)
</span></span><span class="line"><span class="cl">                           s objSen.AntiName=sen.Data(&#34;AntName&#34;)
</span></span><span class="line"><span class="cl">                           s objSen.Result=sen.Data(&#34;SenName&#34;)
</span></span><span class="line"><span class="cl">                           s objSen.KBRes=sen.Data(&#34;SenMethod&#34;)
</span></span><span class="line"><span class="cl">                           s objSen.MICRes=sen.Data(&#34;SenValue&#34;)
</span></span><span class="line"><span class="cl">                           s objSen.Order=sen.Data(&#34;Order&#34;)
</span></span><span class="line"><span class="cl">                           d objRes.OrgResultMsgs.Insert(objSen)
</span></span><span class="line"><span class="cl">                          //
</span></span><span class="line"><span class="cl">                       }
</span></span><span class="line"><span class="cl">                    }
</span></span><span class="line"><span class="cl">                }
</span></span><span class="line"><span class="cl">                d obj.ResultMsgs.Insert(objRes)
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">     }
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    s Input=&#34;&#34;
</span></span><span class="line"><span class="cl">    //d obj.XMLExportToStream(.Input)
</span></span><span class="line"><span class="cl">    //Set objStream=##class(%GlobalCharacterStream).%New()
</span></span><span class="line"><span class="cl">    // d objStream.Write(&#34;&lt;ReportData&gt;&#34;)
</span></span><span class="line"><span class="cl">    d obj.XMLExportToString(.Input)
</span></span><span class="line"><span class="cl">    ;s retObj=##Class(UtilsController.LIS.UtilsControllerHttpSoap12Endpoint).%New()
</span></span><span class="line"><span class="cl">    ;s Input=retObj.ReportMsg(Input)
</span></span><span class="line"><span class="cl">    ;s Input=&#34;&lt;Request&gt;&lt;Header&gt;&lt;SourceSystem&gt;NFYY&lt;/SourceSystem&gt;&lt;MessageID&gt;ÂåªÈô¢‰ø°ÊÅØÂπ≥Âè∞&lt;/MessageID&gt;&lt;/Header&gt;&lt;Body&gt;&#34;_Input_&#34;&lt;/Body&gt;&lt;/Request&gt;&#34;
</span></span><span class="line"><span class="cl">    s Input=&#34;&lt;Response&gt;&#34;_Input_&#34;&lt;/Response&gt;&#34;
</span></span><span class="line"><span class="cl">    Set objStream=##class(%GlobalCharacterStream).%New()
</span></span><span class="line"><span class="cl">    d objStream.Write(Input)
</span></span><span class="line"><span class="cl">    s ^TMP(&#34;Au&#34;,LabNo)=Input      
</span></span><span class="line"><span class="cl">    ;s $NameSpace=&#34;DHC-APP&#34;
</span></span><span class="line"><span class="cl">    ;s Input=##class(web.DHCENS.EnsHISService).DHCHisInterface(&#34;S00000046&#34;,objStream)
</span></span><span class="line"><span class="cl">    ;s $NameSpace=&#34;DHC-LISDATA&#34;
</span></span><span class="line"><span class="cl">    s ^TMP(&#34;AuReport&#34;,LabNo)=Input      
</span></span><span class="line"><span class="cl">    q Input 
</span></span><span class="line"><span class="cl">ErrorHandle
</span></span><span class="line"><span class="cl">    s err=$tr(&#34;Êü•ËØ¢ÂºÇÂ∏∏.ÈîôËØØ&#34;_$tr($ZERROR,&#34;^&#34;,&#34;--&#34;)_&#34;.ÈîôËØØ‰ª£Á†Å:&#34;_$ECODE,&#34;&lt;&gt;&#34;)
</span></span><span class="line"><span class="cl">    Quit $$ReturnOut(err)
</span></span><span class="line"><span class="cl">ReturnOut(err)
</span></span><span class="line"><span class="cl">    //Set objStream=##class(%GlobalCharacterStream).%New()
</span></span><span class="line"><span class="cl">    //d objStream.Write(&#34;&lt;ReportData&gt;&#34;)
</span></span><span class="line"><span class="cl">    //d objStream.Write(&#34;&lt;ReturnValue&gt;-1^&#34;_err_&#34;&lt;/ReturnValue&gt;&#34;)
</span></span><span class="line"><span class="cl">    //Do objStream.Write(&#34;&lt;/ReportData&gt;&#34;)
</span></span><span class="line"><span class="cl">    q &#34;-1^&#34;_err
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="Ëé∑ÂèñÊ†áÊú¨‰ø°ÊÅØ">Ëé∑ÂèñÊ†áÊú¨‰ø°ÊÅØ
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">DHC-APP Á©∫Èó¥
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// Ëé∑ÂèñÊ†áÊú¨‰ø°ÊÅØ
</span></span><span class="line"><span class="cl">/// /// Other: W ##Class(LISAPP.LIS.BLL.DHCReceiveInterface).GetLabNoInfoSFHIS(&#34;**2630749*&#34;,&#34;0&#34;,&#34;dhcc&#34;).Read()
</span></span><span class="line"><span class="cl">/// Other: W ##Class(LISAPP.LIS.BLL.DHCReceiveInterface).GetLabNoInfoSFHIS(&#34;24041406012005&#34;,&#34;0&#34;,&#34;dhcc&#34;).Read()
</span></span><span class="line"><span class="cl">/// Other: W ##Class(LISAPP.LIS.BLL.DHCReceiveInterface).GetLabNoInfoSFHIS(&#34;**8015454*&#34;,&#34;0&#34;,&#34;dhcc&#34;).Read()
</span></span><span class="line"><span class="cl">ClassMethod GetLabNoInfoSFHIS(Labno As %String, RetType As %String, UserCode As %String) As %GlobalCharacterStream
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	s stream=##class(%GlobalCharacterStream).%New()
</span></span><span class="line"><span class="cl">	d stream.Write(Labno)
</span></span><span class="line"><span class="cl">	i $e(Labno)=&#34;*&#34; d
</span></span><span class="line"><span class="cl">	.i $e(Labno,3)=4 s Param=##class(web.DHCENS.STBLL.SOAP.HISSystemServieSoap).HIPMessageServerS(&#34;MES0022&#34;,stream)
</span></span><span class="line"><span class="cl">	.i $e(Labno,3)=8 s Param=##class(web.DHCENS.STBLL.SOAP.HISSystemServieSoap).HIPMessageServerS(&#34;MES0026&#34;,stream)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	i $l(Labno)=14 s Param=##class(web.DHCENS.STBLL.SOAP.HISSystemServieSoap).HIPMessageServerS(&#34;MES0024&#34;,stream)
</span></span><span class="line"><span class="cl">	i $l(Labno)=14 q Param
</span></span><span class="line"><span class="cl">	;s Param=##class(web.DHCENS.STBLL.SOAP.HISSystemServieSoap).test()
</span></span><span class="line"><span class="cl">	s RetValue=&#34;&#34;
</span></span><span class="line"><span class="cl">	B ;Param
</span></span><span class="line"><span class="cl">	s RequestXML=##class(LIS.Util.COM.XML).New(&#34;Request&#34;)
</span></span><span class="line"><span class="cl">	s OrdersXML=##class(LIS.Util.COM.XML).New(&#34;Orders&#34;)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	/*
</span></span><span class="line"><span class="cl">	Set objItems=##class(LIS.Util.COM.JSONUtils).%New().FromJSON(Param)
</span></span><span class="line"><span class="cl">	i &#39;$l(Param.Read()){
</span></span><span class="line"><span class="cl">		s objVisitNumber=##class(LIS.Util.COM.XML).New(&#34;OrderList&#34;)
</span></span><span class="line"><span class="cl">		s RequestXML.ResultCode=&#34;-1&#34;
</span></span><span class="line"><span class="cl">		s RequestXML.ResultContent=&#34;Êü•ËØ¢Ê†áÊú¨‰ø°ÊÅØÂ§±Ë¥•:HISÊù°Á†Å‰ø°ÊÅØ‰∏çÂ≠òÂú®ÔºÅ&#34; 		//YHR 20240410 ËÄÅÁ≥ªÁªüÊü•ËØ¢ËøîÂõû‰ø°ÊÅØ‰∏∫Á©∫Êó∂ËøîÂõû
</span></span><span class="line"><span class="cl">   		d OrdersXML.Insert(objVisitNumber)
</span></span><span class="line"><span class="cl">    	d RequestXML.Insert(OrdersXML)
</span></span><span class="line"><span class="cl">		s RetValue=RequestXML.ToXMLStream()
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	Quit:$LENGTH(RetValue) RetValue
</span></span><span class="line"><span class="cl">	*/
</span></span><span class="line"><span class="cl">	/*
</span></span><span class="line"><span class="cl">	s ParamXML=Param.Read()
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	If ($p(Param.Read(),&#34;^&#34;,1) &lt;= 0)
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">		s objVisitNumber=##class(LIS.Util.COM.XML).New(&#34;OrderList&#34;)
</span></span><span class="line"><span class="cl">		s RequestXML.ResultCode=&#34;-1&#34;
</span></span><span class="line"><span class="cl">		s RequestXML.ResultContent=&#34;Êü•ËØ¢Ê†áÊú¨‰ø°ÊÅØÂ§±Ë¥•:HISÊù°Á†Å‰ø°ÊÅØ‰∏çÂ≠òÂú®ÔºÅ&#34; 		//YHR 20240408 ËÄÅÁ≥ªÁªüÊü•ËØ¢‰∏çÂà∞Ê†áÊú¨Êó∂ËøîÂõû
</span></span><span class="line"><span class="cl">   		d OrdersXML.Insert(objVisitNumber)
</span></span><span class="line"><span class="cl">    	d RequestXML.Insert(OrdersXML)
</span></span><span class="line"><span class="cl">		s RetValue=RequestXML.ToXMLStream()
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">	Quit:$LENGTH(RetValue) RetValue
</span></span><span class="line"><span class="cl">	*/
</span></span><span class="line"><span class="cl">	Set objItems=##class(LIS.Util.COM.JSONUtils).%New().FromJSON(Param)
</span></span><span class="line"><span class="cl">	If (objItems.Size() &lt;= 0)
</span></span><span class="line"><span class="cl">    {
</span></span><span class="line"><span class="cl">		s objVisitNumber=##class(LIS.Util.COM.XML).New(&#34;OrderList&#34;)
</span></span><span class="line"><span class="cl">		s RequestXML.ResultCode=&#34;-1&#34;
</span></span><span class="line"><span class="cl">		s RequestXML.ResultContent=&#34;Êü•ËØ¢Ê†áÊú¨‰ø°ÊÅØÂ§±Ë¥•:HISÊù°Á†Å‰ø°ÊÅØ‰∏çÂ≠òÂú®ÔºÅ&#34; 		//YHR 20240408 ËÄÅÁ≥ªÁªüÊü•ËØ¢‰∏çÂà∞Ê†áÊú¨Êó∂ËøîÂõû
</span></span><span class="line"><span class="cl">   		d OrdersXML.Insert(objVisitNumber)
</span></span><span class="line"><span class="cl">    	d RequestXML.Insert(OrdersXML)
</span></span><span class="line"><span class="cl">		s RetValue=RequestXML.ToXMLStream()
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">	Quit:$LENGTH(RetValue) RetValue
</span></span><span class="line"><span class="cl">	For i = 1:1:objItems.Size() {
</span></span><span class="line"><span class="cl">		Set obj=objItems.Get(i-1)
</span></span><span class="line"><span class="cl">		b ;a101
</span></span><span class="line"><span class="cl">		Quit:&#39;$LENGTH(obj)
</span></span><span class="line"><span class="cl">	s objVisitNumber=##class(LIS.Util.COM.XML).New(&#34;OrderList&#34;)
</span></span><span class="line"><span class="cl">	s (LABNO,ARCIMCODE,ARCIMDESC,ORDERQTY,BILLCODE,SPECIMENTYPECODE,SPECIMENTYPEDESC,SPVOLUME,COLINFO,COLDATE,COLTIME,SPECUSERCODE,CONTAINER,GTSEQ,SPECFLAG,VERIFYDATE,VERIFYTIME,APPDEPTCODE,APPDEPTDESC,RECDEPTCODE,RECDEPTDESC,TSPRICE,ORDERSTATUS,DOCCODE,DOCDESC,REPLOCT,REPDATE,REPTIME,NOTE,ADMNO,ADMDATE,ADMTIME,ADMTYPECODE,ADMTYPEDESC,FEETYPE,PATIENTWARD,BEDNO,DIAGNOSE,REGISTERNO,PATIENTNAME,SEXCODE,SEXDESC,DOB,AGE,AGEUNIT,DOCUMENTID,PATIENTADDRESS,IDENTITYCARDNO,TELEPHONE,SPECUSERCODE,SPECUSERNAME,STARTDATE,STARTTIME,SENDFLAG,SPECREMARK,CARRYDATE,CARRYTIME,CARRYUSERDR,CARRYUSERNAME,CARRYNOTE)=&#34;&#34;
</span></span><span class="line"><span class="cl">	s LABNO=obj.LABNO        ;Ê†áÊú¨Êù°Á†ÅÂè∑
</span></span><span class="line"><span class="cl">	s ARCIMCODE=obj.ARCIMCODE        ;ÂåªÂò±‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s ARCIMDESC=obj.ARCIMDESC        ;ÂåªÂò±ÂêçÁß∞
</span></span><span class="line"><span class="cl">	s ORDERQTY=obj.ORDERQTY        ;ÂåªÂò±Êï∞Èáè
</span></span><span class="line"><span class="cl">	s BILLCODE=obj.BILLCODE        ;Ë¥¶ÂçïÁä∂ÊÄÅ‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s SPECIMENTYPECODE=obj.SPECIMENTYPECODE        ;Ê†áÊú¨Á±ªÂûã‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s SPECIMENTYPEDESC=obj.SPECIMENTYPEDESC        ;Ê†áÊú¨Á±ªÂûãÂêçÁß∞
</span></span><span class="line"><span class="cl">	s SPVOLUME=obj.SPVOLUME        ;Ê†áÊú¨ÈááÈõÜÈáè
</span></span><span class="line"><span class="cl">	s COLINFO=obj.COLINFO        ;Ê†áÊú¨ÈááÈõÜËØ¥Êòé
</span></span><span class="line"><span class="cl">	s COLDATE=obj.COLDATE        ;Ê†áÊú¨ÈááÈõÜÊó•Êúü
</span></span><span class="line"><span class="cl">	s COLTIME=obj.COLTIME        ;Ê†áÊú¨ÈááÈõÜÊó∂Èó¥
</span></span><span class="line"><span class="cl">	s SPECUSERCODE=obj.SPECUSERCODE        ;Ê†áÊú¨ÈááÈõÜÁî®Êà∑‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s CONTAINER=obj.CONTAINER        ;Ê†áÊú¨ÈááÈõÜÂÆπÂô®‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s GTSEQ=obj.GTSEQ        ;Á≥ñËÄêÈáèÂ∫èÂè∑
</span></span><span class="line"><span class="cl">	s SPECFLAG=obj.SPECFLAG        ;ÁâπÊÆäÊ†áÂøó
</span></span><span class="line"><span class="cl">	s VERIFYDATE=obj.VERIFYDATE        ;ÂåªÂò±Áî≥ËØ∑Êó•Êúü
</span></span><span class="line"><span class="cl">	s VERIFYTIME=obj.VERIFYTIME        ;ÂåªÂò±Áî≥ËØ∑Êó∂Èó¥
</span></span><span class="line"><span class="cl">	s APPDEPTCODE=obj.APPDEPTCODE        ;Áî≥ËØ∑ÁßëÂÆ§‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s APPDEPTDESC=obj.APPDEPTDESC        ;Áî≥ËØ∑ÁßëÂÆ§ÂêçÁß∞
</span></span><span class="line"><span class="cl">	s RECDEPTCODE=obj.RECDEPTCODE        ;Êé•Êî∂ÁßëÂÆ§‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s RECDEPTDESC=obj.RECDEPTDESC        ;Êé•Êî∂ÁßëÂÆ§ÂêçÁß∞
</span></span><span class="line"><span class="cl">	s TSPRICE=obj.TSPRICE        ;ÂåªÂò±Ë¥πÁî®
</span></span><span class="line"><span class="cl">	s ORDERSTATUS=obj.ORDERSTATUS        ;ÂåªÂò±Áä∂ÊÄÅ
</span></span><span class="line"><span class="cl">	s DOCCODE=obj.DOCCODE        ;Áî≥ËØ∑ÂåªÁîü‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s DOCDESC=obj.DOCDESC        ;Áî≥ËØ∑ÂåªÁîüÂßìÂêç
</span></span><span class="line"><span class="cl">	s REPLOCT=obj.REPLOCT        ;ÂèñÊä•ÂëäÂú∞ÁÇπ
</span></span><span class="line"><span class="cl">	s REPDATE=obj.REPDATE        ;ÂèñÊä•ÂëäÊó•Êúü
</span></span><span class="line"><span class="cl">	s REPTIME=obj.REPTIME        ;ÂèñÊä•ÂëäÊó∂Èó¥
</span></span><span class="line"><span class="cl">	s NOTE=obj.NOTE        ;ÂåªÂò±Áî≥ËØ∑ËØ¥Êòé
</span></span><span class="line"><span class="cl">	s ADMNO=obj.ADMNO        ;Â∞±ËØäÂè∑
</span></span><span class="line"><span class="cl">	s ADMDATE=obj.ADMDATE        ;Â∞±ËØäÊó•Êúü
</span></span><span class="line"><span class="cl">	s ADMTIME=obj.ADMTIME        ;Â∞±ËØäÊó∂Èó¥
</span></span><span class="line"><span class="cl">	s ADMTYPECODE=obj.ADMTYPECODE        ;Â∞±ËØäÁ±ªÂûã‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s ADMTYPEDESC=obj.ADMTYPEDESC        ;Â∞±ËØäÁ±ªÂûãÂêçÁß∞
</span></span><span class="line"><span class="cl">	s FEETYPE=obj.FEETYPE        ;Ë¥πÁî®Á±ªÂûã
</span></span><span class="line"><span class="cl">	s PATIENTWARD=obj.PATIENTWARD        ;ÁóÖÊàø
</span></span><span class="line"><span class="cl">	s BEDNO=obj.BEDNO        ;Â∫äÂè∑
</span></span><span class="line"><span class="cl">	s DIAGNOSE=obj.DIAGNOSE        ;ËØäÊñ≠
</span></span><span class="line"><span class="cl">	s REGISTERNO=obj.REGISTERNO        ;ÁôªËÆ∞Âè∑/ÁóÖ‰∫∫ID
</span></span><span class="line"><span class="cl">	s PATIENTNAME=obj.PATIENTNAME        ;ÂßìÂêç
</span></span><span class="line"><span class="cl">	s SEXCODE=obj.SEXCODE        ;ÊÄßÂà´‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s SEXDESC=obj.SEXDESC        ;ÊÄßÂà´ÂêçÁß∞
</span></span><span class="line"><span class="cl">	s DOB=obj.DOB        ;Âá∫ÁîüÊó•Êúü
</span></span><span class="line"><span class="cl">	s AGE=obj.AGE        ;Âπ¥ÈæÑ
</span></span><span class="line"><span class="cl">	s AGEUNIT=obj.AGEUNIT        ;Âπ¥ÈæÑÊèèËø∞
</span></span><span class="line"><span class="cl">	s DOCUMENTID=obj.DOCUMENTID        ;ÁóÖÊ°àÂè∑
</span></span><span class="line"><span class="cl">	s PATIENTADDRESS=obj.PATIENTADDRESS        ;Âú∞ÂùÄ
</span></span><span class="line"><span class="cl">	s IDENTITYCARDNO=obj.IDENTITYCARDNO        ;Â∞±ËØäÂç°Âè∑
</span></span><span class="line"><span class="cl">	s TELEPHONE=obj.TELEPHONE        ;ËÅîÁ≥ªÁîµËØù
</span></span><span class="line"><span class="cl">	s SPECUSERCODE=obj.SPECUSERCODE        ;ÈááÈõÜ‰∫∫‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s SPECUSERNAME=obj.SPECUSERNAME        ;ÈááÈõÜ‰∫∫ÂêçÁß∞
</span></span><span class="line"><span class="cl">	s STARTDATE=obj.STARTDATE        ;Ë¶ÅÊ±ÇÊâßË°åÊó•Êúü
</span></span><span class="line"><span class="cl">	s STARTTIME=obj.STARTTIME        ;Ë¶ÅÊ±ÇÊâßË°åÊó∂Èó¥
</span></span><span class="line"><span class="cl">	s SENDFLAG=obj.SENDFLAG        ;Ê†áËØÜ
</span></span><span class="line"><span class="cl">	s SPECREMARK=obj.SPECREMARK        ;ÈááÈõÜËØ¥ÊòéÂ§áÊ≥®
</span></span><span class="line"><span class="cl">	s CARRYDATE=obj.CARRYDATE        ;ËøêÈÄÅÊó•Êúü
</span></span><span class="line"><span class="cl">	s CARRYTIME=obj.CARRYTIME        ;ËøêÈÄÅÊó∂Èó¥
</span></span><span class="line"><span class="cl">	s CARRYUSERDR=obj.CARRYUSERDR        ;ËøêÈÄÅ‰∫∫‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s CARRYUSERNAME=obj.CARRYUSERNAME        ;ËøêÈÄÅ‰∫∫ÂêçÁß∞
</span></span><span class="line"><span class="cl">	s CARRYNOTE=obj.CARRYNOTE        ;ËøêÈÄÅËØ¥Êòé
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	s objVisitNumber.OrdID=&#34;&#34;
</span></span><span class="line"><span class="cl">	s objVisitNumber.LabNo=LABNO        ;Ê†áÊú¨Êù°Á†ÅÂè∑
</span></span><span class="line"><span class="cl">	s objVisitNumber.ArcimCode=ARCIMCODE        ;ÂåªÂò±‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s objVisitNumber.ArcimDesc=ARCIMDESC        ;ÂåªÂò±ÂêçÁß∞
</span></span><span class="line"><span class="cl">	s objVisitNumber.OrderQty=ORDERQTY        ;ÂåªÂò±Êï∞Èáè
</span></span><span class="line"><span class="cl">	s objVisitNumber.BillCode=BILLCODE        ;Ë¥¶ÂçïÁä∂ÊÄÅ‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s objVisitNumber.SpecimenTypeCode=SPECIMENTYPECODE        ;Ê†áÊú¨Á±ªÂûã‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s objVisitNumber.SpecimenTypeDesc=SPECIMENTYPEDESC        ;Ê†áÊú¨Á±ªÂûãÂêçÁß∞
</span></span><span class="line"><span class="cl">	s objVisitNumber.SpVolume=SPVOLUME        ;Ê†áÊú¨ÈááÈõÜÈáè
</span></span><span class="line"><span class="cl">	s objVisitNumber.ColInfo=COLINFO        ;Ê†áÊú¨ÈááÈõÜËØ¥Êòé
</span></span><span class="line"><span class="cl">	s objVisitNumber.ColDate=COLDATE        ;Ê†áÊú¨ÈááÈõÜÊó•Êúü
</span></span><span class="line"><span class="cl">	s objVisitNumber.ColTime=COLTIME        ;Ê†áÊú¨ÈááÈõÜÊó∂Èó¥
</span></span><span class="line"><span class="cl">	s objVisitNumber.SpecUserCode=SPECUSERCODE        ;Ê†áÊú¨ÈááÈõÜÁî®Êà∑‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s objVisitNumber.Container=CONTAINER        ;Ê†áÊú¨ÈááÈõÜÂÆπÂô®‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s objVisitNumber.GTSeq=GTSEQ        ;Á≥ñËÄêÈáèÂ∫èÂè∑
</span></span><span class="line"><span class="cl">	s objVisitNumber.SpecFlag=SPECFLAG        ;ÁâπÊÆäÊ†áÂøó
</span></span><span class="line"><span class="cl">	s objVisitNumber.VerifyDate=VERIFYDATE        ;ÂåªÂò±Áî≥ËØ∑Êó•Êúü
</span></span><span class="line"><span class="cl">	s objVisitNumber.VerifyTime=VERIFYTIME        ;ÂåªÂò±Áî≥ËØ∑Êó∂Èó¥
</span></span><span class="line"><span class="cl">	s objVisitNumber.AppDeptCode=APPDEPTCODE        ;Áî≥ËØ∑ÁßëÂÆ§‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s objVisitNumber.AppDeptDesc=APPDEPTDESC        ;Áî≥ËØ∑ÁßëÂÆ§ÂêçÁß∞
</span></span><span class="line"><span class="cl">	s objVisitNumber.RecDeptCode=RECDEPTCODE        ;Êé•Êî∂ÁßëÂÆ§‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s objVisitNumber.RecDeptDesc=RECDEPTDESC        ;Êé•Êî∂ÁßëÂÆ§ÂêçÁß∞
</span></span><span class="line"><span class="cl">	s objVisitNumber.TSPrice=TSPRICE        ;ÂåªÂò±Ë¥πÁî®
</span></span><span class="line"><span class="cl">	s objVisitNumber.OrderStatus=ORDERSTATUS        ;ÂåªÂò±Áä∂ÊÄÅ
</span></span><span class="line"><span class="cl">	s objVisitNumber.DocCode=DOCCODE        ;Áî≥ËØ∑ÂåªÁîü‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s objVisitNumber.DocDesc=DOCDESC        ;Áî≥ËØ∑ÂåªÁîüÂßìÂêç
</span></span><span class="line"><span class="cl">	s objVisitNumber.RepLoct=REPLOCT        ;ÂèñÊä•ÂëäÂú∞ÁÇπ
</span></span><span class="line"><span class="cl">	s objVisitNumber.RepDate=REPDATE        ;ÂèñÊä•ÂëäÊó•Êúü
</span></span><span class="line"><span class="cl">	s objVisitNumber.RepTime=REPTIME        ;ÂèñÊä•ÂëäÊó∂Èó¥
</span></span><span class="line"><span class="cl">	s objVisitNumber.Note=NOTE        ;ÂåªÂò±Áî≥ËØ∑ËØ¥Êòé
</span></span><span class="line"><span class="cl">	s objVisitNumber.AdmNo=ADMNO        ;Â∞±ËØäÂè∑
</span></span><span class="line"><span class="cl">	s objVisitNumber.AdmDate=ADMDATE        ;Â∞±ËØäÊó•Êúü
</span></span><span class="line"><span class="cl">	s objVisitNumber.AdmTime=ADMTIME        ;Â∞±ËØäÊó∂Èó¥
</span></span><span class="line"><span class="cl">	s objVisitNumber.AdmTypeCode=ADMTYPECODE        ;Â∞±ËØäÁ±ªÂûã‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s objVisitNumber.AdmTypeDesc=ADMTYPEDESC        ;Â∞±ËØäÁ±ªÂûãÂêçÁß∞
</span></span><span class="line"><span class="cl">	s objVisitNumber.FeeType=FEETYPE        ;Ë¥πÁî®Á±ªÂûã
</span></span><span class="line"><span class="cl">	s objVisitNumber.PatientWard=PATIENTWARD        ;ÁóÖÊàø
</span></span><span class="line"><span class="cl">	s objVisitNumber.BedNo=BEDNO        ;Â∫äÂè∑
</span></span><span class="line"><span class="cl">	s objVisitNumber.Diagnose=DIAGNOSE        ;ËØäÊñ≠
</span></span><span class="line"><span class="cl">	s objVisitNumber.RegisterNo=REGISTERNO        ;ÁôªËÆ∞Âè∑/ÁóÖ‰∫∫ID
</span></span><span class="line"><span class="cl">	s objVisitNumber.PatientName=PATIENTNAME        ;ÂßìÂêç
</span></span><span class="line"><span class="cl">	s objVisitNumber.SexCode=SEXCODE        ;ÊÄßÂà´‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s objVisitNumber.SexDesc=SEXDESC        ;ÊÄßÂà´ÂêçÁß∞
</span></span><span class="line"><span class="cl">	s objVisitNumber.DOB=DOB        ;Âá∫ÁîüÊó•Êúü
</span></span><span class="line"><span class="cl">	s objVisitNumber.Age=AGE        ;Âπ¥ÈæÑ
</span></span><span class="line"><span class="cl">	s objVisitNumber.AgeUnit=AGEUNIT        ;Âπ¥ÈæÑÊèèËø∞
</span></span><span class="line"><span class="cl">	s objVisitNumber.DocumentID=DOCUMENTID        ;ÁóÖÊ°àÂè∑
</span></span><span class="line"><span class="cl">	s objVisitNumber.PatientAddress=PATIENTADDRESS        ;Âú∞ÂùÄ
</span></span><span class="line"><span class="cl">	s objVisitNumber.IdentityCardNo=IDENTITYCARDNO        ;Â∞±ËØäÂç°Âè∑
</span></span><span class="line"><span class="cl">	s objVisitNumber.Telephone=TELEPHONE        ;ËÅîÁ≥ªÁîµËØù
</span></span><span class="line"><span class="cl">	s objVisitNumber.SpecUserCode=SPECUSERCODE        ;ÈááÈõÜ‰∫∫‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s objVisitNumber.SpecUserName=SPECUSERNAME        ;ÈááÈõÜ‰∫∫ÂêçÁß∞
</span></span><span class="line"><span class="cl">	s objVisitNumber.StartDate=STARTDATE        ;Ë¶ÅÊ±ÇÊâßË°åÊó•Êúü
</span></span><span class="line"><span class="cl">	s objVisitNumber.StartTime=STARTTIME        ;Ë¶ÅÊ±ÇÊâßË°åÊó∂Èó¥
</span></span><span class="line"><span class="cl">	s objVisitNumber.SendFlag=SENDFLAG        ;Ê†áËØÜ
</span></span><span class="line"><span class="cl">	s objVisitNumber.SpecRemark=SPECREMARK        ;ÈááÈõÜËØ¥ÊòéÂ§áÊ≥®
</span></span><span class="line"><span class="cl">	s objVisitNumber.CarryDate=CARRYDATE        ;ËøêÈÄÅÊó•Êúü
</span></span><span class="line"><span class="cl">	s objVisitNumber.CarryTime=CARRYTIME        ;ËøêÈÄÅÊó∂Èó¥
</span></span><span class="line"><span class="cl">	s objVisitNumber.CarryUserDR=CARRYUSERDR        ;ËøêÈÄÅ‰∫∫‰ª£Á†Å
</span></span><span class="line"><span class="cl">	s objVisitNumber.CarryUserName=CARRYUSERNAME        ;ËøêÈÄÅ‰∫∫ÂêçÁß∞
</span></span><span class="line"><span class="cl">	s objVisitNumber.CarryNote=CARRYNOTE        ;ËøêÈÄÅËØ¥Êòé
</span></span><span class="line"><span class="cl">	d OrdersXML.Insert(objVisitNumber)
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">    d RequestXML.Insert(OrdersXML)
</span></span><span class="line"><span class="cl">	s RequestXML.ResultCode=&#34;0&#34;
</span></span><span class="line"><span class="cl">	s RequestXML.ResultContent=&#34;ÊàêÂäü&#34; 
</span></span><span class="line"><span class="cl">	q RequestXML.ToXMLStream()
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="Ê†áÊú¨Ê†∏Êî∂È°µÈù¢Êú™Ê†∏Êî∂ÂåªÂò±‰ø°ÊÅØ">Ê†áÊú¨Ê†∏Êî∂È°µÈù¢Êú™Ê†∏Êî∂ÂåªÂò±‰ø°ÊÅØ
</h2><p><img src="/p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/assets/image-20240416212805778-20241220161447-kpi0604.png"
	width="1744"
	height="529"
	srcset="/p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/assets/image-20240416212805778-20241220161447-kpi0604_hu_6c5655539763edc8.png 480w, /p/%E7%AC%AC%E4%B8%89%E6%96%B9his%E5%92%8C%E4%BD%93%E6%A3%80%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B920250112235959/assets/image-20240416212805778-20241220161447-kpi0604_hu_4a2313b0ba15c464.png 1024w"
	loading="lazy"
	
		alt="image-20240416212805778"
	
	
		class="gallery-image" 
		data-flex-grow="329"
		data-flex-basis="791px"
	
></p>
<blockquote>
<p>LIS.WS.BLL.DHCRPVisitNumberReport		QryWorkListByLabno</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">	i $e(fLabno)=&#34;*&#34;,$d(^LISTMPDATA(&#34;WHSYZ&#34;,Labno)) d		//YHR 20240409 Êé•Êî∂Ê†áÊú¨Êó∂Êü•ËØ¢ËÄÅÁ≥ªÁªüÊú™Ê†∏Êî∂ÂåªÂò±
</span></span><span class="line"><span class="cl"> 	.s AllTSList=&#34;&#34;
</span></span><span class="line"><span class="cl"> 	.s TestSetDR=&#34;&#34; f  s TestSetDR=$o(^LISTMPDATA(&#34;WHSYZ&#34;,fLabno,TestSetDR)) q:TestSetDR=&#34;&#34;  d
</span></span><span class="line"><span class="cl"> 	..s AllTSList=AllTSList_TestSetDR_&#34;@@&#34;
</span></span><span class="line"><span class="cl"> 	..b ;a103
</span></span><span class="line"><span class="cl"> 	.s NoCheckList=##Class(LISSP.DHCRPVisitNumber).GetUnCheckTSInfo(fLabno,AllTSList,Sessions,&#34;1&#34;) //Êü•ËØ¢
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="‰ΩøÁî®ÊñπÊ≥ï">‰ΩøÁî®ÊñπÊ≥ï
</h1><h2 id="Ê†áÊú¨Êé•Êî∂Ê†∏Êî∂ÊñπÊ≥ï">Ê†áÊú¨Êé•Êî∂Ê†∏Êî∂ÊñπÊ≥ï
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/// CreatorÔºö      liuzf
</span></span><span class="line"><span class="cl">/// CreatDateÔºö    20131207
</span></span><span class="line"><span class="cl">/// Description:Ôºö Ê†áÊú¨Êé•Êî∂Â≠òÂÇ®ËøáÁ®ã
</span></span><span class="line"><span class="cl">/// TableÔºö        dbo.RPVisitNumber,dbo.RP_VisitNumberReport,dbo.RP_VisitNumberRecord
</span></span><span class="line"><span class="cl">/// InputÔºö        Labno:Ê£ÄÈ™åÂè∑,ParamÂèÇÊï∞ÂÜÖÂÆπXMLÊ†ºÂºè
</span></span><span class="line"><span class="cl">/// 								Param.P0 C:ÈõÜ‰∏≠Êé•Êî∂ H:Ê†∏Êî∂
</span></span><span class="line"><span class="cl">/// 								Param.P1Ê£ÄÊµãÂè∑(ÊµÅÊ∞¥Âè∑/Êù°Á†ÅÂè∑)
</span></span><span class="line"><span class="cl">/// 								Param.P2ÁªÜËèåÈâ¥ÂÆöÂè∑
</span></span><span class="line"><span class="cl">/// 								Param.P3ÊµÅÊ∞¥Âè∑
</span></span><span class="line"><span class="cl">/// 								Param.P4Ê†∏Êî∂ËÄÖ
</span></span><span class="line"><span class="cl">/// 								Param.P5Êé•Êî∂Â§áÊ≥®ReceiveNotes
</span></span><span class="line"><span class="cl">/// 								Param.P6Êé•Êî∂Ë¥®ÈáèSpecimenQualityDR
</span></span><span class="line"><span class="cl">/// 								Param.P7Êé•Êî∂ÂåªÂò±ÂàóË°®VisTSDRLists
</span></span><span class="line"><span class="cl">///                                 Param.P14 ExParaList Ê†ºÂºèÔºöÈÄÅËææ‰∫∫‰ø°ÊÅØ@
</span></span><span class="line"><span class="cl">/// OutputÔºö       Êó†
</span></span><span class="line"><span class="cl">/// ReturnÔºö       ‰øùÂ≠òÁªìÊûú 
</span></span><span class="line"><span class="cl">/// Others: 	   w ##Class(LISSP.DHCRPVisitNumber).ReceiveVisitNumber(&#34;0000003001&#34;,&#34;&lt;Data&gt;&lt;P13&gt;222.132.155.199&lt;/P13&gt;&lt;P12&gt;&lt;/P12&gt;&lt;P5&gt;&lt;/P5&gt;&lt;P7&gt;&lt;/P7&gt;&lt;P2&gt;&lt;/P2&gt;&lt;P0&gt;C&lt;/P0&gt;&lt;P1&gt;&lt;/P1&gt;&lt;P3&gt;&lt;/P3&gt;&lt;P11&gt;&lt;/P11&gt;&lt;P8&gt;&lt;/P8&gt;&lt;P14&gt;@&lt;/P14&gt;&lt;P10&gt;&lt;/P10&gt;&lt;P9&gt;&lt;/P9&gt;&lt;P6&gt;&lt;/P6&gt;&lt;P4&gt;113&lt;/P4&gt;&lt;/Data&gt;&#34;,&#34;113^4^0^13^1&#34;)
</span></span><span class="line"><span class="cl">/// w ##Class(LISSP.DHCRPVisitNumber).ReceiveVisitNumber(&#34;**4860462*&#34;,&#34;&lt;Data&gt;&lt;P8&gt;&lt;/P8&gt;&lt;P13&gt;10.49.25.10&lt;/P13&gt;&lt;P7&gt;&lt;/P7&gt;&lt;P9&gt;&lt;/P9&gt;&lt;P6&gt;&lt;/P6&gt;&lt;P0&gt;C&lt;/P0&gt;&lt;P11&gt;&lt;/P11&gt;&lt;P5&gt;&lt;/P5&gt;&lt;P1&gt;&lt;/P1&gt;&lt;P14&gt;@&lt;/P14&gt;&lt;P10&gt;&lt;/P10&gt;&lt;P2&gt;&lt;/P2&gt;&lt;P3&gt;&lt;/P3&gt;&lt;P12&gt;&lt;/P12&gt;&lt;P4&gt;&lt;/P4&gt;&lt;/Data&gt;&#34;,&#34;8280^1^0^2^1&#34;)
</span></span><span class="line"><span class="cl">/// w ##Class(LISSP.DHCRPVisitNumber).ReceiveVisitNumber(&#34;**4868149*&#34;,&#34;&lt;Data&gt;&lt;P8&gt;1&lt;/P8&gt;&lt;P13&gt;10.49.25.9&lt;/P13&gt;&lt;P7&gt;&lt;/P7&gt;&lt;P9&gt;&lt;/P9&gt;&lt;P6&gt;2&lt;/P6&gt;&lt;P0&gt;H&lt;/P0&gt;&lt;P11&gt;@&lt;/P11&gt;&lt;P5&gt;&lt;/P5&gt;&lt;P1&gt;&lt;/P1&gt;&lt;P14&gt;@&lt;/P14&gt;&lt;P10&gt;2024-04-09&lt;/P10&gt;&lt;P2&gt;&lt;/P2&gt;&lt;P3&gt;2&lt;/P3&gt;&lt;P12&gt;&lt;/P12&gt;&lt;P4&gt;8280&lt;/P4&gt;&lt;/Data&gt;&#34;,&#34;8280^1^0^2^1&#34;)
</span></span><span class="line"><span class="cl">ClassMethod ReceiveVisitNumber(Labno As %String, Param As %String(MAXLEN=32767), Sessions As %String, Output RetValue As %String(MAXLEN=32767)) As %String [ SqlProc ]
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	s ^TMPLIS(&#34;ReceiveVisitNumber&#34;)=$lb(Labno,Param,Sessions)
</span></span><span class="line"><span class="cl">	S Labno=$g(Labno),Param=$g(Param),Sessions=$g(Sessions)
</span></span><span class="line"><span class="cl">	Set UserID=$p(Sessions,&#34;^&#34;,1),WorkGroupDR=$p(Sessions,&#34;^&#34;,2)
</span></span><span class="line"><span class="cl">	Set HospitalDR=$p(Sessions,&#34;^&#34;,5)
</span></span><span class="line"><span class="cl">	i &#39;$l(UserID) s RetValue=&#34;-1^&#34;_##Class(LIS.Util.SYSLanguagePak).TranslateDataMTHD(&#34;Ê†áÊú¨Êé•Êî∂&#34;,&#34;The receiving user does not exist&#34;,&#34;Êé•Êî∂Áî®Êà∑‰∏çÂ≠òÂú®&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,Sessions) q RetValue
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	//i &#39;$l(WorkGroupDR) s RetValue=&#34;-1^Â∑•‰ΩúÁªÑÁî®Êà∑‰∏çÂ≠òÂú®&#34; q RetValue	
</span></span><span class="line"><span class="cl">	;i Labno=&#34;0000001242&#34; s ^TMPLIS(&#34;$zn&#34;,&#34;ReceiveVisitNumber&#34;,&#34;KSS2001&#34;)=$lb(Labno, Param, Sessions, RetValue) s RetValue=&#34;1&#34; q RetValue
</span></span><span class="line"><span class="cl">	s WebNamespace=##Class(OTH.SYSParameter).GetWebNamespace()
</span></span><span class="line"><span class="cl">	//Áªü‰∏ÄË∞ÉÊï¥Êù°Á†ÅÁ±ªÂûãO ËÄÅhis,HÊñ∞his,T‰ΩìÊ£Ä
</span></span><span class="line"><span class="cl">	s LabNoType=##Class(LIS.Common.DHCVisitNumber).GetLabNoType(Labno) 
</span></span><span class="line"><span class="cl">    //Ê†áÊú¨Êé•Êî∂Áªü‰∏ÄÂÖ•Âè£
</span></span><span class="line"><span class="cl">	s UserCode=$lg($g(^dbo.SYSUserD(UserID)),2)
</span></span><span class="line"><span class="cl">	//Ëé∑ÂèñÊé•Êî∂ÂèÇÊï∞
</span></span><span class="line"><span class="cl">	s (P0,P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12,P13,P14)=&#34;&#34;
</span></span><span class="line"><span class="cl">    Set reader = ##class(%XML.Reader).%New()
</span></span><span class="line"><span class="cl">    Do reader.OpenString(Param)
</span></span><span class="line"><span class="cl">    Do reader.Correlate(&#34;Data&#34;,&#34;LIS.WS.Model.InputParameter&#34;)
</span></span><span class="line"><span class="cl">    s err=&#34;&#34;,RetValue=0,seqj=0
</span></span><span class="line"><span class="cl">    While (reader.Next(.obj,.sc)) 
</span></span><span class="line"><span class="cl">    { 
</span></span><span class="line"><span class="cl">	    If ($SYSTEM.Status.IsOK(sc)) // check if this succeeded without errors
</span></span><span class="line"><span class="cl">	    {
</span></span><span class="line"><span class="cl">		    s RecFlag=$tr(obj.P0,$c(0))   ///C:ÈõÜ‰∏≠Êé•Êî∂ H:Ê†∏Êî∂
</span></span><span class="line"><span class="cl">		    s AssayNo=$tr(obj.P1,$c(0))
</span></span><span class="line"><span class="cl">		    s AccessionNo=$tr(obj.P2,$c(0))
</span></span><span class="line"><span class="cl">		    s EpisodeNo=$tr(obj.P3,$c(0))
</span></span><span class="line"><span class="cl">		    s AcceptUserDR=$tr(obj.P4,$c(0))
</span></span><span class="line"><span class="cl">		    s ReceiveNotes=$tr(obj.P5,$c(0))
</span></span><span class="line"><span class="cl">		    s SpecimenQualityDR=$tr(obj.P6,$c(0))
</span></span><span class="line"><span class="cl">		    s VisTSDRLists=$tr(obj.P7,$c(0))
</span></span><span class="line"><span class="cl">		    s WorkGroupMachineDR=$tr(obj.P8,$c(0))
</span></span><span class="line"><span class="cl">		    s CarryUserDR = $tr(obj.P9,$c(0))
</span></span><span class="line"><span class="cl">		    s TransmitDate = $tr(obj.P10,$c(0)) 
</span></span><span class="line"><span class="cl">			i &#39;$l(TransmitDate) s TransmitDate=$tr($zd(+$h,3),&#34;-&#34;)
</span></span><span class="line"><span class="cl">			S CheckTestSetDRList=$tr(obj.P11,$c(0))
</span></span><span class="line"><span class="cl">			s TestSetQueryDR=&#34;&#34;
</span></span><span class="line"><span class="cl">			I CheckTestSetDRList[&#34;@&#34; S TestSetQueryDR=$P(CheckTestSetDRList,&#34;@&#34;,2) S CheckTestSetDRList=$P(CheckTestSetDRList,&#34;@&#34;,1) 
</span></span><span class="line"><span class="cl">			i TestSetQueryDR=&#34;All&#34; s TestSetQueryDR=&#34;&#34;
</span></span><span class="line"><span class="cl">			s RackNo=$tr(obj.P12,$c(0))
</span></span><span class="line"><span class="cl">			s IP=$tr(obj.P13,$c(0))
</span></span><span class="line"><span class="cl">			s ExParaList=$tr(obj.P14,$c(0))
</span></span><span class="line"><span class="cl">		    s ArriveInfo=$p(ExParaList,&#34;@&#34;,1) //Á¨¨‰∏Ä‰ΩçÊòØËøêÈÄÅ‰ø°ÊÅØ
</span></span><span class="line"><span class="cl">		    s ConcessionFlag=$p(ExParaList,&#34;@&#34;,2) //Á¨¨‰∫å‰ΩçËÆ©Ê≠•Ê†áËØÜ
</span></span><span class="line"><span class="cl">		    s MachineCheckFlag=$p(ExParaList,&#34;@&#34;,3) //Á¨¨‰∏â‰Ωç‰ª™Âô®Ê†∏Êî∂ÁöÑÊ†áËØÜ
</span></span><span class="line"><span class="cl">		    s IsCheckTLevel=$p(ExParaList,&#34;@&#34;,4) //Á¨¨Âõõ‰ΩçÊòØÂê¶Ê†°È™å‰∫ãÂä°Â±ÇÁ∫ß,Ë°ÄÂ∫ì‰∫ãÂä°Ë∞ÉÁî®Êé•Êî∂ÈÄªËæëÔºåÈò≤Ê≠¢ËØØÂà§Êñ≠‰∫ãÂä°Â±ÇÁ∫ß
</span></span><span class="line"><span class="cl">		    s IsMiCheck=$p(ExParaList,&#34;@&#34;,5) //Á¨¨‰∫î‰ΩçÊòØÂê¶ÊòØ‰ª™Âô®Ëá™Âä®Ê†∏Êî∂
</span></span><span class="line"><span class="cl">		    i &#39;$l(IsCheckTLevel) s IsCheckTLevel=1 
</span></span><span class="line"><span class="cl">	    }
</span></span><span class="line"><span class="cl">    }	
</span></span><span class="line"><span class="cl">    //Ê†∏Êî∂Ê†áÊú¨Êó•ÊúüÂà§Êñ≠
</span></span><span class="line"><span class="cl">    K ^DHCLabNoInfoStream(Labno)
</span></span><span class="line"><span class="cl">    K ^DHCLabNoInfoStreamTime(Labno)
</span></span><span class="line"><span class="cl">    s TransmitDate=$tr(TransmitDate,&#34;-&#34;)
</span></span><span class="line"><span class="cl">    i &#39;$l($g(TransmitDate)) s TransmitDate=$tr($zd(+$h,3),&#34;-&#34;)
</span></span><span class="line"><span class="cl">    s AllTSList=&#34;&#34;
</span></span><span class="line"><span class="cl">    i RecFlag=&#34;H&#34;,TransmitDate&lt;$zd(+$h,8) s RetValue=&#34;-1^&#34;_##Class(LIS.Util.SYSLanguagePak).TranslateDataMTHD(&#34;Ê†áÊú¨Êé•Êî∂&#34;,&#34;The specimen date is less than the current date, please select the current date&#34;,&#34;Ê†áÊú¨Êó•ÊúüÂ∞è‰∫éÂΩìÂâçÊó•ÊúüÔºåËØ∑ÈÄâÊã©ÂΩìÂâçÊó•Êúü&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,Sessions) q RetValue
</span></span><span class="line"><span class="cl">	//*****************‰∏âÊñπHISÊ†∏Êî∂Ëµ∑Âßã********************//
</span></span><span class="line"><span class="cl">	;b ;run
</span></span><span class="line"><span class="cl">	s quitret=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $e(Labno)=&#34;*&#34; d
</span></span><span class="line"><span class="cl">	.s ret=##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdListNew(Labno, UserCode, AssayNo, EpisodeNo, WorkGroupMachineDR, TransmitDate, HospitalDR, RecFlag, ReceiveNotes, SpecimenQualityDR, CarryUserDR, &#34;&#34;, RackNo, IP, WorkGroupDR,Sessions)
</span></span><span class="line"><span class="cl">	.i ret&#39;=0 s quitret=ret
</span></span><span class="line"><span class="cl">	.e  s quitret=1
</span></span><span class="line"><span class="cl">	;b ;quitret
</span></span><span class="line"><span class="cl">	i $e(Labno)=&#34;*&#34; try{s return=##Class(LIS.Service.ENS.TransReport).ReturnStatus(Labno,quitret)}catch{}
</span></span><span class="line"><span class="cl">	i $l(quitret) q quitret
</span></span><span class="line"><span class="cl">	//*****************‰∏âÊñπHISÊ†∏Êî∂ÁªàÊ≠¢********************//
</span></span><span class="line"><span class="cl">	//*****************‰∏âÊñπ‰ΩìÊ£ÄÊ†∏Êî∂Ëµ∑Âßã********************//
</span></span><span class="line"><span class="cl">	b ;run
</span></span><span class="line"><span class="cl">	s quitret=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(Labno)=14 d
</span></span><span class="line"><span class="cl">	.s ret=##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdListNew(Labno, UserCode, AssayNo, EpisodeNo, WorkGroupMachineDR, TransmitDate, HospitalDR, RecFlag, ReceiveNotes, SpecimenQualityDR, CarryUserDR, &#34;&#34;, RackNo, IP, WorkGroupDR,Sessions)
</span></span><span class="line"><span class="cl">	.i ret&#39;=0 s quitret=ret
</span></span><span class="line"><span class="cl">	.e  s quitret=1
</span></span><span class="line"><span class="cl">	b ;quitret
</span></span><span class="line"><span class="cl">	try{s return=##Class(LIS.Service.ENS.TransReport).ReturnStatus(Labno,quitret)}catch{}
</span></span><span class="line"><span class="cl">	i $l(quitret) q quitret
</span></span><span class="line"><span class="cl">	//*****************‰∏âÊñπ‰ΩìÊ£ÄÊ†∏Êî∂ÁªàÊ≠¢********************//
</span></span><span class="line"><span class="cl">	s ret=##Class(HIS.DHCReceiveCommon).CheckSampleInfo(Labno, WorkGroupMachineDR, WorkGroupDR, HospitalDR,RecFlag,UserCode,.AllTSList,&#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;,Sessions)
</span></span><span class="line"><span class="cl">	s seqj=$p(ret,&#34;^&#34;,1)
</span></span><span class="line"><span class="cl">	s recTSList=$p(ret,&#34;^&#34;,2)
</span></span><span class="line"><span class="cl">    //ÂèØÊé•Êî∂Ê†∏Êî∂ÂåªÂò±
</span></span><span class="line"><span class="cl">	i seqj&lt;=0 s RetValue=&#34;-1^&#34;_##Class(LIS.Util.SYSLanguagePak).TranslateDataMTHD(&#34;Ê†áÊú¨Êé•Êî∂&#34;,&#34;Failed to query specimen information&#34;,&#34;Êü•ËØ¢Ê†áÊú¨‰ø°ÊÅØÂ§±Ë¥•&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,Sessions)_&#34;:&#34;_recTSList  q RetValue
</span></span><span class="line"><span class="cl">	//Ê†∏Êî∂ÂåªÂò±ÁªÑÈÄâÊã©
</span></span><span class="line"><span class="cl">	s SplitStr=&#34;@S@&#34;,ItemSpitStr=&#34;@I@&#34;
</span></span><span class="line"><span class="cl">	if RecFlag=&#34;H&#34;,($L(CheckTestSetDRList)||$l(TestSetQueryDR))
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		s CheckRecTSList=&#34;&#34;
</span></span><span class="line"><span class="cl">		f i=1:1:$l(recTSList,ItemSpitStr)
</span></span><span class="line"><span class="cl">	    {
</span></span><span class="line"><span class="cl">			 s TSItem=$p(recTSList,ItemSpitStr,i)
</span></span><span class="line"><span class="cl">			 i &#39;$l(TSItem) continue
</span></span><span class="line"><span class="cl">			 s RecTSDR=$p(TSItem,SplitStr,1) //ÊåâÂãæÈÄâÂåªÂò±ËøõË°åÊ†∏Êî∂ËøáÊª§\
</span></span><span class="line"><span class="cl">			 i (((&#34;,&#34;_CheckTestSetDRList_&#34;,&#34;)[(&#34;,&#34;_RecTSDR_&#34;,&#34;))||($l(TestSetQueryDR)&amp;&amp;$d(^dbo.BTWorkGroupMachineRuleTSI(&#34;IndexMaster&#34;,TestSetQueryDR,RecTSDR)))) S CheckRecTSList=CheckRecTSList_ItemSpitStr_TSItem b //?2
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">		s recTSList=CheckRecTSList //ÊåâÂåªÂò±ËøõË°åÊ†∏Êî∂
</span></span><span class="line"><span class="cl">		i &#39;$l(recTSList) s RetValue=&#34;-1^&#34;_##Class(LIS.Util.SYSLanguagePak).TranslateDataMTHD(&#34;Ê†áÊú¨Êé•Êî∂&#34;,&#34;There are no orders for this order group to be approved&#34;,&#34;Êó†ÂèØÊ†∏Êî∂ËØ•ÂåªÂò±ÁªÑÂåªÂò±&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,Sessions)_&#34;ÔºÅ&#34; q RetValue
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    //Áî®Êù•ËÆ∞ÂΩïÊòØÂê¶Êõ¥Êñ∞ËøêÈÄÅ‰ø°ÊÅØÔºåÊ†áÊú¨Ë¥®ÈáèÁ≠â
</span></span><span class="line"><span class="cl">	s RecInfoFlag=&#34;0&#34; 
</span></span><span class="line"><span class="cl">	//ÈÅçÂéÜÂèØÊé•Êî∂ÂåªÂò±ÂØπÂ∫îÂ∑•‰ΩúÂ∞èÁªÑËÆæÁΩÆ
</span></span><span class="line"><span class="cl">	i RecFlag=&#34;C&#34;
</span></span><span class="line"><span class="cl">	{  
</span></span><span class="line"><span class="cl">	  s LABIsAutoCheck=&#34;&#34;
</span></span><span class="line"><span class="cl">      f i=1:1:$l(recTSList,ItemSpitStr) 
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">	    s TSItem=$p(recTSList,ItemSpitStr,i)
</span></span><span class="line"><span class="cl">        i &#39;$l(TSItem) continue
</span></span><span class="line"><span class="cl">        s RecTSDR=$p(TSItem,SplitStr,1)  
</span></span><span class="line"><span class="cl">	    s DefaultWGMDR=$lg($G(^dbo.BTTestSetD(RecTSDR)),13) //ÂåªÂò±ÈªòËÆ§Â∑•‰ΩúÂ∞èÁªÑ
</span></span><span class="line"><span class="cl">	    i &#39;$l(DefaultWGMDR) continue
</span></span><span class="line"><span class="cl">	    s paramDR = $o(^dbo.SYSParameterI(&#34;IndexCode&#34;,&#34; LABISAUTOCHECK&#34;, &#34; WGM&#34;,&#34; &#34;_DefaultWGMDR,&#34;&#34;))
</span></span><span class="line"><span class="cl">        i $l(paramDR) s LABIsAutoCheck=LABIsAutoCheck_$lg(^dbo.SYSParameterD(paramDR),5)
</span></span><span class="line"><span class="cl">        e  s LABIsAutoCheck=LABIsAutoCheck_&#34;0&#34;
</span></span><span class="line"><span class="cl">	  }
</span></span><span class="line"><span class="cl">	  i LABIsAutoCheck[&#34;1&#34;,LABIsAutoCheck&#39;[&#34;0&#34; s WorkGroupMachineDR=&#34;AUTO&#34;,RecFlag=&#34;H&#34;,RecInfoFlag=&#34;1&#34; //Â¶ÇÊûúÊâÄÊúâÂåªÂò±ÈªòËÆ§Â∑•‰ΩúÂ∞èÁªÑÈÉΩÁª¥Êä§‰∫ÜÊåâËá™Âä®ÊéíÊ†∑Â§ÑÁêÜ
</span></span><span class="line"><span class="cl">    }  
</span></span><span class="line"><span class="cl">    //Êé•Êî∂Ê†áÊú¨                                       
</span></span><span class="line"><span class="cl">	s RetValue=##Class(HIS.DHCReceiveCommon).ReceiveAllBS(Labno,UserCode,recTSList,AssayNo,EpisodeNo,WorkGroupMachineDR,TransmitDate,HospitalDR,RecFlag,ReceiveNotes,SpecimenQualityDR,CarryUserDR,RecInfoFlag,RackNo,IP,WorkGroupDR,ArriveInfo,ConcessionFlag,IsCheckTLevel,IsMiCheck,Sessions)
</span></span><span class="line"><span class="cl">	//ËøîÂõûÂåªÂò±‰ø°ÊÅØÁªÑË£Ö‰∏≤
</span></span><span class="line"><span class="cl">	i RecFlag=&#34;H&#34;,RetValue=1
</span></span><span class="line"><span class="cl">	{ 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	    S IsShowUncheckInfo=&#34;1&#34;
</span></span><span class="line"><span class="cl">	    s paramDR = $o(^dbo.SYSParameterI(&#34;IndexCode&#34;,&#34; ISSHOWUNCHECKINFO&#34;, &#34; WGM&#34;,&#34; &#34;_WorkGroupMachineDR,&#34;&#34;))
</span></span><span class="line"><span class="cl">        i $l(paramDR) s IsShowUncheckInfo=$lg(^dbo.SYSParameterD(paramDR),5)
</span></span><span class="line"><span class="cl">        //ÊòØÂê¶Â±ïÁ§∫Êú™Ê†∏Êî∂‰ø°ÊÅØ
</span></span><span class="line"><span class="cl">        i IsShowUncheckInfo=1
</span></span><span class="line"><span class="cl">        {
</span></span><span class="line"><span class="cl">	       	s RetInfo=..GetUnCheckTSInfo(Labno,AllTSList,Sessions)
</span></span><span class="line"><span class="cl">		    i $l(RetInfo) s RetValue=RetValue_&#34;^&#34;_##Class(LIS.Util.SYSLanguagePak).TranslateDataMTHD(&#34;Ê†áÊú¨Êé•Êî∂&#34;,&#34;The following medical advice has not been received. Please note to keep the specimen&#34;,&#34;‰ª•‰∏ãÂåªÂò±Êú™Ê†∏Êî∂ËØ∑Ê≥®ÊÑèÁïôÂèñÊ†áÊú¨&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,Sessions)_RetInfo 
</span></span><span class="line"><span class="cl">	    }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    K ^DHCLabNoInfoStream(Labno)
</span></span><span class="line"><span class="cl">    K ^DHCLabNoInfoStreamTime(Labno)
</span></span><span class="line"><span class="cl">	q RetValue
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">ErrorHandle
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	s RetValue=&#34;-1^&#34;_##Class(LIS.Util.SYSLanguagePak).TranslateDataMTHD(&#34;Ê†áÊú¨Êé•Êî∂&#34;,&#34;Error&#34;,&#34;ÈîôËØØ&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,Sessions)_$tr($ZERROR,&#34;^&#34;,&#34;--&#34;)_&#34;.&#34;_##Class(LIS.Util.SYSLanguagePak).TranslateDataMTHD(&#34;Ê†áÊú¨Êé•Êî∂&#34;,&#34;Error Code&#34;,&#34;ÈîôËØØ‰ª£Á†Å&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,Sessions)_&#34;:&#34;_$ECODE
</span></span><span class="line"><span class="cl">    Quit RetValue
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="Â§ñÈÉ®Ê†áÊú¨Êé•Êî∂ÊñπÊ≥ï">Â§ñÈÉ®Ê†áÊú¨Êé•Êî∂ÊñπÊ≥ï
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">   1
</span><span class="lnt">   2
</span><span class="lnt">   3
</span><span class="lnt">   4
</span><span class="lnt">   5
</span><span class="lnt">   6
</span><span class="lnt">   7
</span><span class="lnt">   8
</span><span class="lnt">   9
</span><span class="lnt">  10
</span><span class="lnt">  11
</span><span class="lnt">  12
</span><span class="lnt">  13
</span><span class="lnt">  14
</span><span class="lnt">  15
</span><span class="lnt">  16
</span><span class="lnt">  17
</span><span class="lnt">  18
</span><span class="lnt">  19
</span><span class="lnt">  20
</span><span class="lnt">  21
</span><span class="lnt">  22
</span><span class="lnt">  23
</span><span class="lnt">  24
</span><span class="lnt">  25
</span><span class="lnt">  26
</span><span class="lnt">  27
</span><span class="lnt">  28
</span><span class="lnt">  29
</span><span class="lnt">  30
</span><span class="lnt">  31
</span><span class="lnt">  32
</span><span class="lnt">  33
</span><span class="lnt">  34
</span><span class="lnt">  35
</span><span class="lnt">  36
</span><span class="lnt">  37
</span><span class="lnt">  38
</span><span class="lnt">  39
</span><span class="lnt">  40
</span><span class="lnt">  41
</span><span class="lnt">  42
</span><span class="lnt">  43
</span><span class="lnt">  44
</span><span class="lnt">  45
</span><span class="lnt">  46
</span><span class="lnt">  47
</span><span class="lnt">  48
</span><span class="lnt">  49
</span><span class="lnt">  50
</span><span class="lnt">  51
</span><span class="lnt">  52
</span><span class="lnt">  53
</span><span class="lnt">  54
</span><span class="lnt">  55
</span><span class="lnt">  56
</span><span class="lnt">  57
</span><span class="lnt">  58
</span><span class="lnt">  59
</span><span class="lnt">  60
</span><span class="lnt">  61
</span><span class="lnt">  62
</span><span class="lnt">  63
</span><span class="lnt">  64
</span><span class="lnt">  65
</span><span class="lnt">  66
</span><span class="lnt">  67
</span><span class="lnt">  68
</span><span class="lnt">  69
</span><span class="lnt">  70
</span><span class="lnt">  71
</span><span class="lnt">  72
</span><span class="lnt">  73
</span><span class="lnt">  74
</span><span class="lnt">  75
</span><span class="lnt">  76
</span><span class="lnt">  77
</span><span class="lnt">  78
</span><span class="lnt">  79
</span><span class="lnt">  80
</span><span class="lnt">  81
</span><span class="lnt">  82
</span><span class="lnt">  83
</span><span class="lnt">  84
</span><span class="lnt">  85
</span><span class="lnt">  86
</span><span class="lnt">  87
</span><span class="lnt">  88
</span><span class="lnt">  89
</span><span class="lnt">  90
</span><span class="lnt">  91
</span><span class="lnt">  92
</span><span class="lnt">  93
</span><span class="lnt">  94
</span><span class="lnt">  95
</span><span class="lnt">  96
</span><span class="lnt">  97
</span><span class="lnt">  98
</span><span class="lnt">  99
</span><span class="lnt"> 100
</span><span class="lnt"> 101
</span><span class="lnt"> 102
</span><span class="lnt"> 103
</span><span class="lnt"> 104
</span><span class="lnt"> 105
</span><span class="lnt"> 106
</span><span class="lnt"> 107
</span><span class="lnt"> 108
</span><span class="lnt"> 109
</span><span class="lnt"> 110
</span><span class="lnt"> 111
</span><span class="lnt"> 112
</span><span class="lnt"> 113
</span><span class="lnt"> 114
</span><span class="lnt"> 115
</span><span class="lnt"> 116
</span><span class="lnt"> 117
</span><span class="lnt"> 118
</span><span class="lnt"> 119
</span><span class="lnt"> 120
</span><span class="lnt"> 121
</span><span class="lnt"> 122
</span><span class="lnt"> 123
</span><span class="lnt"> 124
</span><span class="lnt"> 125
</span><span class="lnt"> 126
</span><span class="lnt"> 127
</span><span class="lnt"> 128
</span><span class="lnt"> 129
</span><span class="lnt"> 130
</span><span class="lnt"> 131
</span><span class="lnt"> 132
</span><span class="lnt"> 133
</span><span class="lnt"> 134
</span><span class="lnt"> 135
</span><span class="lnt"> 136
</span><span class="lnt"> 137
</span><span class="lnt"> 138
</span><span class="lnt"> 139
</span><span class="lnt"> 140
</span><span class="lnt"> 141
</span><span class="lnt"> 142
</span><span class="lnt"> 143
</span><span class="lnt"> 144
</span><span class="lnt"> 145
</span><span class="lnt"> 146
</span><span class="lnt"> 147
</span><span class="lnt"> 148
</span><span class="lnt"> 149
</span><span class="lnt"> 150
</span><span class="lnt"> 151
</span><span class="lnt"> 152
</span><span class="lnt"> 153
</span><span class="lnt"> 154
</span><span class="lnt"> 155
</span><span class="lnt"> 156
</span><span class="lnt"> 157
</span><span class="lnt"> 158
</span><span class="lnt"> 159
</span><span class="lnt"> 160
</span><span class="lnt"> 161
</span><span class="lnt"> 162
</span><span class="lnt"> 163
</span><span class="lnt"> 164
</span><span class="lnt"> 165
</span><span class="lnt"> 166
</span><span class="lnt"> 167
</span><span class="lnt"> 168
</span><span class="lnt"> 169
</span><span class="lnt"> 170
</span><span class="lnt"> 171
</span><span class="lnt"> 172
</span><span class="lnt"> 173
</span><span class="lnt"> 174
</span><span class="lnt"> 175
</span><span class="lnt"> 176
</span><span class="lnt"> 177
</span><span class="lnt"> 178
</span><span class="lnt"> 179
</span><span class="lnt"> 180
</span><span class="lnt"> 181
</span><span class="lnt"> 182
</span><span class="lnt"> 183
</span><span class="lnt"> 184
</span><span class="lnt"> 185
</span><span class="lnt"> 186
</span><span class="lnt"> 187
</span><span class="lnt"> 188
</span><span class="lnt"> 189
</span><span class="lnt"> 190
</span><span class="lnt"> 191
</span><span class="lnt"> 192
</span><span class="lnt"> 193
</span><span class="lnt"> 194
</span><span class="lnt"> 195
</span><span class="lnt"> 196
</span><span class="lnt"> 197
</span><span class="lnt"> 198
</span><span class="lnt"> 199
</span><span class="lnt"> 200
</span><span class="lnt"> 201
</span><span class="lnt"> 202
</span><span class="lnt"> 203
</span><span class="lnt"> 204
</span><span class="lnt"> 205
</span><span class="lnt"> 206
</span><span class="lnt"> 207
</span><span class="lnt"> 208
</span><span class="lnt"> 209
</span><span class="lnt"> 210
</span><span class="lnt"> 211
</span><span class="lnt"> 212
</span><span class="lnt"> 213
</span><span class="lnt"> 214
</span><span class="lnt"> 215
</span><span class="lnt"> 216
</span><span class="lnt"> 217
</span><span class="lnt"> 218
</span><span class="lnt"> 219
</span><span class="lnt"> 220
</span><span class="lnt"> 221
</span><span class="lnt"> 222
</span><span class="lnt"> 223
</span><span class="lnt"> 224
</span><span class="lnt"> 225
</span><span class="lnt"> 226
</span><span class="lnt"> 227
</span><span class="lnt"> 228
</span><span class="lnt"> 229
</span><span class="lnt"> 230
</span><span class="lnt"> 231
</span><span class="lnt"> 232
</span><span class="lnt"> 233
</span><span class="lnt"> 234
</span><span class="lnt"> 235
</span><span class="lnt"> 236
</span><span class="lnt"> 237
</span><span class="lnt"> 238
</span><span class="lnt"> 239
</span><span class="lnt"> 240
</span><span class="lnt"> 241
</span><span class="lnt"> 242
</span><span class="lnt"> 243
</span><span class="lnt"> 244
</span><span class="lnt"> 245
</span><span class="lnt"> 246
</span><span class="lnt"> 247
</span><span class="lnt"> 248
</span><span class="lnt"> 249
</span><span class="lnt"> 250
</span><span class="lnt"> 251
</span><span class="lnt"> 252
</span><span class="lnt"> 253
</span><span class="lnt"> 254
</span><span class="lnt"> 255
</span><span class="lnt"> 256
</span><span class="lnt"> 257
</span><span class="lnt"> 258
</span><span class="lnt"> 259
</span><span class="lnt"> 260
</span><span class="lnt"> 261
</span><span class="lnt"> 262
</span><span class="lnt"> 263
</span><span class="lnt"> 264
</span><span class="lnt"> 265
</span><span class="lnt"> 266
</span><span class="lnt"> 267
</span><span class="lnt"> 268
</span><span class="lnt"> 269
</span><span class="lnt"> 270
</span><span class="lnt"> 271
</span><span class="lnt"> 272
</span><span class="lnt"> 273
</span><span class="lnt"> 274
</span><span class="lnt"> 275
</span><span class="lnt"> 276
</span><span class="lnt"> 277
</span><span class="lnt"> 278
</span><span class="lnt"> 279
</span><span class="lnt"> 280
</span><span class="lnt"> 281
</span><span class="lnt"> 282
</span><span class="lnt"> 283
</span><span class="lnt"> 284
</span><span class="lnt"> 285
</span><span class="lnt"> 286
</span><span class="lnt"> 287
</span><span class="lnt"> 288
</span><span class="lnt"> 289
</span><span class="lnt"> 290
</span><span class="lnt"> 291
</span><span class="lnt"> 292
</span><span class="lnt"> 293
</span><span class="lnt"> 294
</span><span class="lnt"> 295
</span><span class="lnt"> 296
</span><span class="lnt"> 297
</span><span class="lnt"> 298
</span><span class="lnt"> 299
</span><span class="lnt"> 300
</span><span class="lnt"> 301
</span><span class="lnt"> 302
</span><span class="lnt"> 303
</span><span class="lnt"> 304
</span><span class="lnt"> 305
</span><span class="lnt"> 306
</span><span class="lnt"> 307
</span><span class="lnt"> 308
</span><span class="lnt"> 309
</span><span class="lnt"> 310
</span><span class="lnt"> 311
</span><span class="lnt"> 312
</span><span class="lnt"> 313
</span><span class="lnt"> 314
</span><span class="lnt"> 315
</span><span class="lnt"> 316
</span><span class="lnt"> 317
</span><span class="lnt"> 318
</span><span class="lnt"> 319
</span><span class="lnt"> 320
</span><span class="lnt"> 321
</span><span class="lnt"> 322
</span><span class="lnt"> 323
</span><span class="lnt"> 324
</span><span class="lnt"> 325
</span><span class="lnt"> 326
</span><span class="lnt"> 327
</span><span class="lnt"> 328
</span><span class="lnt"> 329
</span><span class="lnt"> 330
</span><span class="lnt"> 331
</span><span class="lnt"> 332
</span><span class="lnt"> 333
</span><span class="lnt"> 334
</span><span class="lnt"> 335
</span><span class="lnt"> 336
</span><span class="lnt"> 337
</span><span class="lnt"> 338
</span><span class="lnt"> 339
</span><span class="lnt"> 340
</span><span class="lnt"> 341
</span><span class="lnt"> 342
</span><span class="lnt"> 343
</span><span class="lnt"> 344
</span><span class="lnt"> 345
</span><span class="lnt"> 346
</span><span class="lnt"> 347
</span><span class="lnt"> 348
</span><span class="lnt"> 349
</span><span class="lnt"> 350
</span><span class="lnt"> 351
</span><span class="lnt"> 352
</span><span class="lnt"> 353
</span><span class="lnt"> 354
</span><span class="lnt"> 355
</span><span class="lnt"> 356
</span><span class="lnt"> 357
</span><span class="lnt"> 358
</span><span class="lnt"> 359
</span><span class="lnt"> 360
</span><span class="lnt"> 361
</span><span class="lnt"> 362
</span><span class="lnt"> 363
</span><span class="lnt"> 364
</span><span class="lnt"> 365
</span><span class="lnt"> 366
</span><span class="lnt"> 367
</span><span class="lnt"> 368
</span><span class="lnt"> 369
</span><span class="lnt"> 370
</span><span class="lnt"> 371
</span><span class="lnt"> 372
</span><span class="lnt"> 373
</span><span class="lnt"> 374
</span><span class="lnt"> 375
</span><span class="lnt"> 376
</span><span class="lnt"> 377
</span><span class="lnt"> 378
</span><span class="lnt"> 379
</span><span class="lnt"> 380
</span><span class="lnt"> 381
</span><span class="lnt"> 382
</span><span class="lnt"> 383
</span><span class="lnt"> 384
</span><span class="lnt"> 385
</span><span class="lnt"> 386
</span><span class="lnt"> 387
</span><span class="lnt"> 388
</span><span class="lnt"> 389
</span><span class="lnt"> 390
</span><span class="lnt"> 391
</span><span class="lnt"> 392
</span><span class="lnt"> 393
</span><span class="lnt"> 394
</span><span class="lnt"> 395
</span><span class="lnt"> 396
</span><span class="lnt"> 397
</span><span class="lnt"> 398
</span><span class="lnt"> 399
</span><span class="lnt"> 400
</span><span class="lnt"> 401
</span><span class="lnt"> 402
</span><span class="lnt"> 403
</span><span class="lnt"> 404
</span><span class="lnt"> 405
</span><span class="lnt"> 406
</span><span class="lnt"> 407
</span><span class="lnt"> 408
</span><span class="lnt"> 409
</span><span class="lnt"> 410
</span><span class="lnt"> 411
</span><span class="lnt"> 412
</span><span class="lnt"> 413
</span><span class="lnt"> 414
</span><span class="lnt"> 415
</span><span class="lnt"> 416
</span><span class="lnt"> 417
</span><span class="lnt"> 418
</span><span class="lnt"> 419
</span><span class="lnt"> 420
</span><span class="lnt"> 421
</span><span class="lnt"> 422
</span><span class="lnt"> 423
</span><span class="lnt"> 424
</span><span class="lnt"> 425
</span><span class="lnt"> 426
</span><span class="lnt"> 427
</span><span class="lnt"> 428
</span><span class="lnt"> 429
</span><span class="lnt"> 430
</span><span class="lnt"> 431
</span><span class="lnt"> 432
</span><span class="lnt"> 433
</span><span class="lnt"> 434
</span><span class="lnt"> 435
</span><span class="lnt"> 436
</span><span class="lnt"> 437
</span><span class="lnt"> 438
</span><span class="lnt"> 439
</span><span class="lnt"> 440
</span><span class="lnt"> 441
</span><span class="lnt"> 442
</span><span class="lnt"> 443
</span><span class="lnt"> 444
</span><span class="lnt"> 445
</span><span class="lnt"> 446
</span><span class="lnt"> 447
</span><span class="lnt"> 448
</span><span class="lnt"> 449
</span><span class="lnt"> 450
</span><span class="lnt"> 451
</span><span class="lnt"> 452
</span><span class="lnt"> 453
</span><span class="lnt"> 454
</span><span class="lnt"> 455
</span><span class="lnt"> 456
</span><span class="lnt"> 457
</span><span class="lnt"> 458
</span><span class="lnt"> 459
</span><span class="lnt"> 460
</span><span class="lnt"> 461
</span><span class="lnt"> 462
</span><span class="lnt"> 463
</span><span class="lnt"> 464
</span><span class="lnt"> 465
</span><span class="lnt"> 466
</span><span class="lnt"> 467
</span><span class="lnt"> 468
</span><span class="lnt"> 469
</span><span class="lnt"> 470
</span><span class="lnt"> 471
</span><span class="lnt"> 472
</span><span class="lnt"> 473
</span><span class="lnt"> 474
</span><span class="lnt"> 475
</span><span class="lnt"> 476
</span><span class="lnt"> 477
</span><span class="lnt"> 478
</span><span class="lnt"> 479
</span><span class="lnt"> 480
</span><span class="lnt"> 481
</span><span class="lnt"> 482
</span><span class="lnt"> 483
</span><span class="lnt"> 484
</span><span class="lnt"> 485
</span><span class="lnt"> 486
</span><span class="lnt"> 487
</span><span class="lnt"> 488
</span><span class="lnt"> 489
</span><span class="lnt"> 490
</span><span class="lnt"> 491
</span><span class="lnt"> 492
</span><span class="lnt"> 493
</span><span class="lnt"> 494
</span><span class="lnt"> 495
</span><span class="lnt"> 496
</span><span class="lnt"> 497
</span><span class="lnt"> 498
</span><span class="lnt"> 499
</span><span class="lnt"> 500
</span><span class="lnt"> 501
</span><span class="lnt"> 502
</span><span class="lnt"> 503
</span><span class="lnt"> 504
</span><span class="lnt"> 505
</span><span class="lnt"> 506
</span><span class="lnt"> 507
</span><span class="lnt"> 508
</span><span class="lnt"> 509
</span><span class="lnt"> 510
</span><span class="lnt"> 511
</span><span class="lnt"> 512
</span><span class="lnt"> 513
</span><span class="lnt"> 514
</span><span class="lnt"> 515
</span><span class="lnt"> 516
</span><span class="lnt"> 517
</span><span class="lnt"> 518
</span><span class="lnt"> 519
</span><span class="lnt"> 520
</span><span class="lnt"> 521
</span><span class="lnt"> 522
</span><span class="lnt"> 523
</span><span class="lnt"> 524
</span><span class="lnt"> 525
</span><span class="lnt"> 526
</span><span class="lnt"> 527
</span><span class="lnt"> 528
</span><span class="lnt"> 529
</span><span class="lnt"> 530
</span><span class="lnt"> 531
</span><span class="lnt"> 532
</span><span class="lnt"> 533
</span><span class="lnt"> 534
</span><span class="lnt"> 535
</span><span class="lnt"> 536
</span><span class="lnt"> 537
</span><span class="lnt"> 538
</span><span class="lnt"> 539
</span><span class="lnt"> 540
</span><span class="lnt"> 541
</span><span class="lnt"> 542
</span><span class="lnt"> 543
</span><span class="lnt"> 544
</span><span class="lnt"> 545
</span><span class="lnt"> 546
</span><span class="lnt"> 547
</span><span class="lnt"> 548
</span><span class="lnt"> 549
</span><span class="lnt"> 550
</span><span class="lnt"> 551
</span><span class="lnt"> 552
</span><span class="lnt"> 553
</span><span class="lnt"> 554
</span><span class="lnt"> 555
</span><span class="lnt"> 556
</span><span class="lnt"> 557
</span><span class="lnt"> 558
</span><span class="lnt"> 559
</span><span class="lnt"> 560
</span><span class="lnt"> 561
</span><span class="lnt"> 562
</span><span class="lnt"> 563
</span><span class="lnt"> 564
</span><span class="lnt"> 565
</span><span class="lnt"> 566
</span><span class="lnt"> 567
</span><span class="lnt"> 568
</span><span class="lnt"> 569
</span><span class="lnt"> 570
</span><span class="lnt"> 571
</span><span class="lnt"> 572
</span><span class="lnt"> 573
</span><span class="lnt"> 574
</span><span class="lnt"> 575
</span><span class="lnt"> 576
</span><span class="lnt"> 577
</span><span class="lnt"> 578
</span><span class="lnt"> 579
</span><span class="lnt"> 580
</span><span class="lnt"> 581
</span><span class="lnt"> 582
</span><span class="lnt"> 583
</span><span class="lnt"> 584
</span><span class="lnt"> 585
</span><span class="lnt"> 586
</span><span class="lnt"> 587
</span><span class="lnt"> 588
</span><span class="lnt"> 589
</span><span class="lnt"> 590
</span><span class="lnt"> 591
</span><span class="lnt"> 592
</span><span class="lnt"> 593
</span><span class="lnt"> 594
</span><span class="lnt"> 595
</span><span class="lnt"> 596
</span><span class="lnt"> 597
</span><span class="lnt"> 598
</span><span class="lnt"> 599
</span><span class="lnt"> 600
</span><span class="lnt"> 601
</span><span class="lnt"> 602
</span><span class="lnt"> 603
</span><span class="lnt"> 604
</span><span class="lnt"> 605
</span><span class="lnt"> 606
</span><span class="lnt"> 607
</span><span class="lnt"> 608
</span><span class="lnt"> 609
</span><span class="lnt"> 610
</span><span class="lnt"> 611
</span><span class="lnt"> 612
</span><span class="lnt"> 613
</span><span class="lnt"> 614
</span><span class="lnt"> 615
</span><span class="lnt"> 616
</span><span class="lnt"> 617
</span><span class="lnt"> 618
</span><span class="lnt"> 619
</span><span class="lnt"> 620
</span><span class="lnt"> 621
</span><span class="lnt"> 622
</span><span class="lnt"> 623
</span><span class="lnt"> 624
</span><span class="lnt"> 625
</span><span class="lnt"> 626
</span><span class="lnt"> 627
</span><span class="lnt"> 628
</span><span class="lnt"> 629
</span><span class="lnt"> 630
</span><span class="lnt"> 631
</span><span class="lnt"> 632
</span><span class="lnt"> 633
</span><span class="lnt"> 634
</span><span class="lnt"> 635
</span><span class="lnt"> 636
</span><span class="lnt"> 637
</span><span class="lnt"> 638
</span><span class="lnt"> 639
</span><span class="lnt"> 640
</span><span class="lnt"> 641
</span><span class="lnt"> 642
</span><span class="lnt"> 643
</span><span class="lnt"> 644
</span><span class="lnt"> 645
</span><span class="lnt"> 646
</span><span class="lnt"> 647
</span><span class="lnt"> 648
</span><span class="lnt"> 649
</span><span class="lnt"> 650
</span><span class="lnt"> 651
</span><span class="lnt"> 652
</span><span class="lnt"> 653
</span><span class="lnt"> 654
</span><span class="lnt"> 655
</span><span class="lnt"> 656
</span><span class="lnt"> 657
</span><span class="lnt"> 658
</span><span class="lnt"> 659
</span><span class="lnt"> 660
</span><span class="lnt"> 661
</span><span class="lnt"> 662
</span><span class="lnt"> 663
</span><span class="lnt"> 664
</span><span class="lnt"> 665
</span><span class="lnt"> 666
</span><span class="lnt"> 667
</span><span class="lnt"> 668
</span><span class="lnt"> 669
</span><span class="lnt"> 670
</span><span class="lnt"> 671
</span><span class="lnt"> 672
</span><span class="lnt"> 673
</span><span class="lnt"> 674
</span><span class="lnt"> 675
</span><span class="lnt"> 676
</span><span class="lnt"> 677
</span><span class="lnt"> 678
</span><span class="lnt"> 679
</span><span class="lnt"> 680
</span><span class="lnt"> 681
</span><span class="lnt"> 682
</span><span class="lnt"> 683
</span><span class="lnt"> 684
</span><span class="lnt"> 685
</span><span class="lnt"> 686
</span><span class="lnt"> 687
</span><span class="lnt"> 688
</span><span class="lnt"> 689
</span><span class="lnt"> 690
</span><span class="lnt"> 691
</span><span class="lnt"> 692
</span><span class="lnt"> 693
</span><span class="lnt"> 694
</span><span class="lnt"> 695
</span><span class="lnt"> 696
</span><span class="lnt"> 697
</span><span class="lnt"> 698
</span><span class="lnt"> 699
</span><span class="lnt"> 700
</span><span class="lnt"> 701
</span><span class="lnt"> 702
</span><span class="lnt"> 703
</span><span class="lnt"> 704
</span><span class="lnt"> 705
</span><span class="lnt"> 706
</span><span class="lnt"> 707
</span><span class="lnt"> 708
</span><span class="lnt"> 709
</span><span class="lnt"> 710
</span><span class="lnt"> 711
</span><span class="lnt"> 712
</span><span class="lnt"> 713
</span><span class="lnt"> 714
</span><span class="lnt"> 715
</span><span class="lnt"> 716
</span><span class="lnt"> 717
</span><span class="lnt"> 718
</span><span class="lnt"> 719
</span><span class="lnt"> 720
</span><span class="lnt"> 721
</span><span class="lnt"> 722
</span><span class="lnt"> 723
</span><span class="lnt"> 724
</span><span class="lnt"> 725
</span><span class="lnt"> 726
</span><span class="lnt"> 727
</span><span class="lnt"> 728
</span><span class="lnt"> 729
</span><span class="lnt"> 730
</span><span class="lnt"> 731
</span><span class="lnt"> 732
</span><span class="lnt"> 733
</span><span class="lnt"> 734
</span><span class="lnt"> 735
</span><span class="lnt"> 736
</span><span class="lnt"> 737
</span><span class="lnt"> 738
</span><span class="lnt"> 739
</span><span class="lnt"> 740
</span><span class="lnt"> 741
</span><span class="lnt"> 742
</span><span class="lnt"> 743
</span><span class="lnt"> 744
</span><span class="lnt"> 745
</span><span class="lnt"> 746
</span><span class="lnt"> 747
</span><span class="lnt"> 748
</span><span class="lnt"> 749
</span><span class="lnt"> 750
</span><span class="lnt"> 751
</span><span class="lnt"> 752
</span><span class="lnt"> 753
</span><span class="lnt"> 754
</span><span class="lnt"> 755
</span><span class="lnt"> 756
</span><span class="lnt"> 757
</span><span class="lnt"> 758
</span><span class="lnt"> 759
</span><span class="lnt"> 760
</span><span class="lnt"> 761
</span><span class="lnt"> 762
</span><span class="lnt"> 763
</span><span class="lnt"> 764
</span><span class="lnt"> 765
</span><span class="lnt"> 766
</span><span class="lnt"> 767
</span><span class="lnt"> 768
</span><span class="lnt"> 769
</span><span class="lnt"> 770
</span><span class="lnt"> 771
</span><span class="lnt"> 772
</span><span class="lnt"> 773
</span><span class="lnt"> 774
</span><span class="lnt"> 775
</span><span class="lnt"> 776
</span><span class="lnt"> 777
</span><span class="lnt"> 778
</span><span class="lnt"> 779
</span><span class="lnt"> 780
</span><span class="lnt"> 781
</span><span class="lnt"> 782
</span><span class="lnt"> 783
</span><span class="lnt"> 784
</span><span class="lnt"> 785
</span><span class="lnt"> 786
</span><span class="lnt"> 787
</span><span class="lnt"> 788
</span><span class="lnt"> 789
</span><span class="lnt"> 790
</span><span class="lnt"> 791
</span><span class="lnt"> 792
</span><span class="lnt"> 793
</span><span class="lnt"> 794
</span><span class="lnt"> 795
</span><span class="lnt"> 796
</span><span class="lnt"> 797
</span><span class="lnt"> 798
</span><span class="lnt"> 799
</span><span class="lnt"> 800
</span><span class="lnt"> 801
</span><span class="lnt"> 802
</span><span class="lnt"> 803
</span><span class="lnt"> 804
</span><span class="lnt"> 805
</span><span class="lnt"> 806
</span><span class="lnt"> 807
</span><span class="lnt"> 808
</span><span class="lnt"> 809
</span><span class="lnt"> 810
</span><span class="lnt"> 811
</span><span class="lnt"> 812
</span><span class="lnt"> 813
</span><span class="lnt"> 814
</span><span class="lnt"> 815
</span><span class="lnt"> 816
</span><span class="lnt"> 817
</span><span class="lnt"> 818
</span><span class="lnt"> 819
</span><span class="lnt"> 820
</span><span class="lnt"> 821
</span><span class="lnt"> 822
</span><span class="lnt"> 823
</span><span class="lnt"> 824
</span><span class="lnt"> 825
</span><span class="lnt"> 826
</span><span class="lnt"> 827
</span><span class="lnt"> 828
</span><span class="lnt"> 829
</span><span class="lnt"> 830
</span><span class="lnt"> 831
</span><span class="lnt"> 832
</span><span class="lnt"> 833
</span><span class="lnt"> 834
</span><span class="lnt"> 835
</span><span class="lnt"> 836
</span><span class="lnt"> 837
</span><span class="lnt"> 838
</span><span class="lnt"> 839
</span><span class="lnt"> 840
</span><span class="lnt"> 841
</span><span class="lnt"> 842
</span><span class="lnt"> 843
</span><span class="lnt"> 844
</span><span class="lnt"> 845
</span><span class="lnt"> 846
</span><span class="lnt"> 847
</span><span class="lnt"> 848
</span><span class="lnt"> 849
</span><span class="lnt"> 850
</span><span class="lnt"> 851
</span><span class="lnt"> 852
</span><span class="lnt"> 853
</span><span class="lnt"> 854
</span><span class="lnt"> 855
</span><span class="lnt"> 856
</span><span class="lnt"> 857
</span><span class="lnt"> 858
</span><span class="lnt"> 859
</span><span class="lnt"> 860
</span><span class="lnt"> 861
</span><span class="lnt"> 862
</span><span class="lnt"> 863
</span><span class="lnt"> 864
</span><span class="lnt"> 865
</span><span class="lnt"> 866
</span><span class="lnt"> 867
</span><span class="lnt"> 868
</span><span class="lnt"> 869
</span><span class="lnt"> 870
</span><span class="lnt"> 871
</span><span class="lnt"> 872
</span><span class="lnt"> 873
</span><span class="lnt"> 874
</span><span class="lnt"> 875
</span><span class="lnt"> 876
</span><span class="lnt"> 877
</span><span class="lnt"> 878
</span><span class="lnt"> 879
</span><span class="lnt"> 880
</span><span class="lnt"> 881
</span><span class="lnt"> 882
</span><span class="lnt"> 883
</span><span class="lnt"> 884
</span><span class="lnt"> 885
</span><span class="lnt"> 886
</span><span class="lnt"> 887
</span><span class="lnt"> 888
</span><span class="lnt"> 889
</span><span class="lnt"> 890
</span><span class="lnt"> 891
</span><span class="lnt"> 892
</span><span class="lnt"> 893
</span><span class="lnt"> 894
</span><span class="lnt"> 895
</span><span class="lnt"> 896
</span><span class="lnt"> 897
</span><span class="lnt"> 898
</span><span class="lnt"> 899
</span><span class="lnt"> 900
</span><span class="lnt"> 901
</span><span class="lnt"> 902
</span><span class="lnt"> 903
</span><span class="lnt"> 904
</span><span class="lnt"> 905
</span><span class="lnt"> 906
</span><span class="lnt"> 907
</span><span class="lnt"> 908
</span><span class="lnt"> 909
</span><span class="lnt"> 910
</span><span class="lnt"> 911
</span><span class="lnt"> 912
</span><span class="lnt"> 913
</span><span class="lnt"> 914
</span><span class="lnt"> 915
</span><span class="lnt"> 916
</span><span class="lnt"> 917
</span><span class="lnt"> 918
</span><span class="lnt"> 919
</span><span class="lnt"> 920
</span><span class="lnt"> 921
</span><span class="lnt"> 922
</span><span class="lnt"> 923
</span><span class="lnt"> 924
</span><span class="lnt"> 925
</span><span class="lnt"> 926
</span><span class="lnt"> 927
</span><span class="lnt"> 928
</span><span class="lnt"> 929
</span><span class="lnt"> 930
</span><span class="lnt"> 931
</span><span class="lnt"> 932
</span><span class="lnt"> 933
</span><span class="lnt"> 934
</span><span class="lnt"> 935
</span><span class="lnt"> 936
</span><span class="lnt"> 937
</span><span class="lnt"> 938
</span><span class="lnt"> 939
</span><span class="lnt"> 940
</span><span class="lnt"> 941
</span><span class="lnt"> 942
</span><span class="lnt"> 943
</span><span class="lnt"> 944
</span><span class="lnt"> 945
</span><span class="lnt"> 946
</span><span class="lnt"> 947
</span><span class="lnt"> 948
</span><span class="lnt"> 949
</span><span class="lnt"> 950
</span><span class="lnt"> 951
</span><span class="lnt"> 952
</span><span class="lnt"> 953
</span><span class="lnt"> 954
</span><span class="lnt"> 955
</span><span class="lnt"> 956
</span><span class="lnt"> 957
</span><span class="lnt"> 958
</span><span class="lnt"> 959
</span><span class="lnt"> 960
</span><span class="lnt"> 961
</span><span class="lnt"> 962
</span><span class="lnt"> 963
</span><span class="lnt"> 964
</span><span class="lnt"> 965
</span><span class="lnt"> 966
</span><span class="lnt"> 967
</span><span class="lnt"> 968
</span><span class="lnt"> 969
</span><span class="lnt"> 970
</span><span class="lnt"> 971
</span><span class="lnt"> 972
</span><span class="lnt"> 973
</span><span class="lnt"> 974
</span><span class="lnt"> 975
</span><span class="lnt"> 976
</span><span class="lnt"> 977
</span><span class="lnt"> 978
</span><span class="lnt"> 979
</span><span class="lnt"> 980
</span><span class="lnt"> 981
</span><span class="lnt"> 982
</span><span class="lnt"> 983
</span><span class="lnt"> 984
</span><span class="lnt"> 985
</span><span class="lnt"> 986
</span><span class="lnt"> 987
</span><span class="lnt"> 988
</span><span class="lnt"> 989
</span><span class="lnt"> 990
</span><span class="lnt"> 991
</span><span class="lnt"> 992
</span><span class="lnt"> 993
</span><span class="lnt"> 994
</span><span class="lnt"> 995
</span><span class="lnt"> 996
</span><span class="lnt"> 997
</span><span class="lnt"> 998
</span><span class="lnt"> 999
</span><span class="lnt">1000
</span><span class="lnt">1001
</span><span class="lnt">1002
</span><span class="lnt">1003
</span><span class="lnt">1004
</span><span class="lnt">1005
</span><span class="lnt">1006
</span><span class="lnt">1007
</span><span class="lnt">1008
</span><span class="lnt">1009
</span><span class="lnt">1010
</span><span class="lnt">1011
</span><span class="lnt">1012
</span><span class="lnt">1013
</span><span class="lnt">1014
</span><span class="lnt">1015
</span><span class="lnt">1016
</span><span class="lnt">1017
</span><span class="lnt">1018
</span><span class="lnt">1019
</span><span class="lnt">1020
</span><span class="lnt">1021
</span><span class="lnt">1022
</span><span class="lnt">1023
</span><span class="lnt">1024
</span><span class="lnt">1025
</span><span class="lnt">1026
</span><span class="lnt">1027
</span><span class="lnt">1028
</span><span class="lnt">1029
</span><span class="lnt">1030
</span><span class="lnt">1031
</span><span class="lnt">1032
</span><span class="lnt">1033
</span><span class="lnt">1034
</span><span class="lnt">1035
</span><span class="lnt">1036
</span><span class="lnt">1037
</span><span class="lnt">1038
</span><span class="lnt">1039
</span><span class="lnt">1040
</span><span class="lnt">1041
</span><span class="lnt">1042
</span><span class="lnt">1043
</span><span class="lnt">1044
</span><span class="lnt">1045
</span><span class="lnt">1046
</span><span class="lnt">1047
</span><span class="lnt">1048
</span><span class="lnt">1049
</span><span class="lnt">1050
</span><span class="lnt">1051
</span><span class="lnt">1052
</span><span class="lnt">1053
</span><span class="lnt">1054
</span><span class="lnt">1055
</span><span class="lnt">1056
</span><span class="lnt">1057
</span><span class="lnt">1058
</span><span class="lnt">1059
</span><span class="lnt">1060
</span><span class="lnt">1061
</span><span class="lnt">1062
</span><span class="lnt">1063
</span><span class="lnt">1064
</span><span class="lnt">1065
</span><span class="lnt">1066
</span><span class="lnt">1067
</span><span class="lnt">1068
</span><span class="lnt">1069
</span><span class="lnt">1070
</span><span class="lnt">1071
</span><span class="lnt">1072
</span><span class="lnt">1073
</span><span class="lnt">1074
</span><span class="lnt">1075
</span><span class="lnt">1076
</span><span class="lnt">1077
</span><span class="lnt">1078
</span><span class="lnt">1079
</span><span class="lnt">1080
</span><span class="lnt">1081
</span><span class="lnt">1082
</span><span class="lnt">1083
</span><span class="lnt">1084
</span><span class="lnt">1085
</span><span class="lnt">1086
</span><span class="lnt">1087
</span><span class="lnt">1088
</span><span class="lnt">1089
</span><span class="lnt">1090
</span><span class="lnt">1091
</span><span class="lnt">1092
</span><span class="lnt">1093
</span><span class="lnt">1094
</span><span class="lnt">1095
</span><span class="lnt">1096
</span><span class="lnt">1097
</span><span class="lnt">1098
</span><span class="lnt">1099
</span><span class="lnt">1100
</span><span class="lnt">1101
</span><span class="lnt">1102
</span><span class="lnt">1103
</span><span class="lnt">1104
</span><span class="lnt">1105
</span><span class="lnt">1106
</span><span class="lnt">1107
</span><span class="lnt">1108
</span><span class="lnt">1109
</span><span class="lnt">1110
</span><span class="lnt">1111
</span><span class="lnt">1112
</span><span class="lnt">1113
</span><span class="lnt">1114
</span><span class="lnt">1115
</span><span class="lnt">1116
</span><span class="lnt">1117
</span><span class="lnt">1118
</span><span class="lnt">1119
</span><span class="lnt">1120
</span><span class="lnt">1121
</span><span class="lnt">1122
</span><span class="lnt">1123
</span><span class="lnt">1124
</span><span class="lnt">1125
</span><span class="lnt">1126
</span><span class="lnt">1127
</span><span class="lnt">1128
</span><span class="lnt">1129
</span><span class="lnt">1130
</span><span class="lnt">1131
</span><span class="lnt">1132
</span><span class="lnt">1133
</span><span class="lnt">1134
</span><span class="lnt">1135
</span><span class="lnt">1136
</span><span class="lnt">1137
</span><span class="lnt">1138
</span><span class="lnt">1139
</span><span class="lnt">1140
</span><span class="lnt">1141
</span><span class="lnt">1142
</span><span class="lnt">1143
</span><span class="lnt">1144
</span><span class="lnt">1145
</span><span class="lnt">1146
</span><span class="lnt">1147
</span><span class="lnt">1148
</span><span class="lnt">1149
</span><span class="lnt">1150
</span><span class="lnt">1151
</span><span class="lnt">1152
</span><span class="lnt">1153
</span><span class="lnt">1154
</span><span class="lnt">1155
</span><span class="lnt">1156
</span><span class="lnt">1157
</span><span class="lnt">1158
</span><span class="lnt">1159
</span><span class="lnt">1160
</span><span class="lnt">1161
</span><span class="lnt">1162
</span><span class="lnt">1163
</span><span class="lnt">1164
</span><span class="lnt">1165
</span><span class="lnt">1166
</span><span class="lnt">1167
</span><span class="lnt">1168
</span><span class="lnt">1169
</span><span class="lnt">1170
</span><span class="lnt">1171
</span><span class="lnt">1172
</span><span class="lnt">1173
</span><span class="lnt">1174
</span><span class="lnt">1175
</span><span class="lnt">1176
</span><span class="lnt">1177
</span><span class="lnt">1178
</span><span class="lnt">1179
</span><span class="lnt">1180
</span><span class="lnt">1181
</span><span class="lnt">1182
</span><span class="lnt">1183
</span><span class="lnt">1184
</span><span class="lnt">1185
</span><span class="lnt">1186
</span><span class="lnt">1187
</span><span class="lnt">1188
</span><span class="lnt">1189
</span><span class="lnt">1190
</span><span class="lnt">1191
</span><span class="lnt">1192
</span><span class="lnt">1193
</span><span class="lnt">1194
</span><span class="lnt">1195
</span><span class="lnt">1196
</span><span class="lnt">1197
</span><span class="lnt">1198
</span><span class="lnt">1199
</span><span class="lnt">1200
</span><span class="lnt">1201
</span><span class="lnt">1202
</span><span class="lnt">1203
</span><span class="lnt">1204
</span><span class="lnt">1205
</span><span class="lnt">1206
</span><span class="lnt">1207
</span><span class="lnt">1208
</span><span class="lnt">1209
</span><span class="lnt">1210
</span><span class="lnt">1211
</span><span class="lnt">1212
</span><span class="lnt">1213
</span><span class="lnt">1214
</span><span class="lnt">1215
</span><span class="lnt">1216
</span><span class="lnt">1217
</span><span class="lnt">1218
</span><span class="lnt">1219
</span><span class="lnt">1220
</span><span class="lnt">1221
</span><span class="lnt">1222
</span><span class="lnt">1223
</span><span class="lnt">1224
</span><span class="lnt">1225
</span><span class="lnt">1226
</span><span class="lnt">1227
</span><span class="lnt">1228
</span><span class="lnt">1229
</span><span class="lnt">1230
</span><span class="lnt">1231
</span><span class="lnt">1232
</span><span class="lnt">1233
</span><span class="lnt">1234
</span><span class="lnt">1235
</span><span class="lnt">1236
</span><span class="lnt">1237
</span><span class="lnt">1238
</span><span class="lnt">1239
</span><span class="lnt">1240
</span><span class="lnt">1241
</span><span class="lnt">1242
</span><span class="lnt">1243
</span><span class="lnt">1244
</span><span class="lnt">1245
</span><span class="lnt">1246
</span><span class="lnt">1247
</span><span class="lnt">1248
</span><span class="lnt">1249
</span><span class="lnt">1250
</span><span class="lnt">1251
</span><span class="lnt">1252
</span><span class="lnt">1253
</span><span class="lnt">1254
</span><span class="lnt">1255
</span><span class="lnt">1256
</span><span class="lnt">1257
</span><span class="lnt">1258
</span><span class="lnt">1259
</span><span class="lnt">1260
</span><span class="lnt">1261
</span><span class="lnt">1262
</span><span class="lnt">1263
</span><span class="lnt">1264
</span><span class="lnt">1265
</span><span class="lnt">1266
</span><span class="lnt">1267
</span><span class="lnt">1268
</span><span class="lnt">1269
</span><span class="lnt">1270
</span><span class="lnt">1271
</span><span class="lnt">1272
</span><span class="lnt">1273
</span><span class="lnt">1274
</span><span class="lnt">1275
</span><span class="lnt">1276
</span><span class="lnt">1277
</span><span class="lnt">1278
</span><span class="lnt">1279
</span><span class="lnt">1280
</span><span class="lnt">1281
</span><span class="lnt">1282
</span><span class="lnt">1283
</span><span class="lnt">1284
</span><span class="lnt">1285
</span><span class="lnt">1286
</span><span class="lnt">1287
</span><span class="lnt">1288
</span><span class="lnt">1289
</span><span class="lnt">1290
</span><span class="lnt">1291
</span><span class="lnt">1292
</span><span class="lnt">1293
</span><span class="lnt">1294
</span><span class="lnt">1295
</span><span class="lnt">1296
</span><span class="lnt">1297
</span><span class="lnt">1298
</span><span class="lnt">1299
</span><span class="lnt">1300
</span><span class="lnt">1301
</span><span class="lnt">1302
</span><span class="lnt">1303
</span><span class="lnt">1304
</span><span class="lnt">1305
</span><span class="lnt">1306
</span><span class="lnt">1307
</span><span class="lnt">1308
</span><span class="lnt">1309
</span><span class="lnt">1310
</span><span class="lnt">1311
</span><span class="lnt">1312
</span><span class="lnt">1313
</span><span class="lnt">1314
</span><span class="lnt">1315
</span><span class="lnt">1316
</span><span class="lnt">1317
</span><span class="lnt">1318
</span><span class="lnt">1319
</span><span class="lnt">1320
</span><span class="lnt">1321
</span><span class="lnt">1322
</span><span class="lnt">1323
</span><span class="lnt">1324
</span><span class="lnt">1325
</span><span class="lnt">1326
</span><span class="lnt">1327
</span><span class="lnt">1328
</span><span class="lnt">1329
</span><span class="lnt">1330
</span><span class="lnt">1331
</span><span class="lnt">1332
</span><span class="lnt">1333
</span><span class="lnt">1334
</span><span class="lnt">1335
</span><span class="lnt">1336
</span><span class="lnt">1337
</span><span class="lnt">1338
</span><span class="lnt">1339
</span><span class="lnt">1340
</span><span class="lnt">1341
</span><span class="lnt">1342
</span><span class="lnt">1343
</span><span class="lnt">1344
</span><span class="lnt">1345
</span><span class="lnt">1346
</span><span class="lnt">1347
</span><span class="lnt">1348
</span><span class="lnt">1349
</span><span class="lnt">1350
</span><span class="lnt">1351
</span><span class="lnt">1352
</span><span class="lnt">1353
</span><span class="lnt">1354
</span><span class="lnt">1355
</span><span class="lnt">1356
</span><span class="lnt">1357
</span><span class="lnt">1358
</span><span class="lnt">1359
</span><span class="lnt">1360
</span><span class="lnt">1361
</span><span class="lnt">1362
</span><span class="lnt">1363
</span><span class="lnt">1364
</span><span class="lnt">1365
</span><span class="lnt">1366
</span><span class="lnt">1367
</span><span class="lnt">1368
</span><span class="lnt">1369
</span><span class="lnt">1370
</span><span class="lnt">1371
</span><span class="lnt">1372
</span><span class="lnt">1373
</span><span class="lnt">1374
</span><span class="lnt">1375
</span><span class="lnt">1376
</span><span class="lnt">1377
</span><span class="lnt">1378
</span><span class="lnt">1379
</span><span class="lnt">1380
</span><span class="lnt">1381
</span><span class="lnt">1382
</span><span class="lnt">1383
</span><span class="lnt">1384
</span><span class="lnt">1385
</span><span class="lnt">1386
</span><span class="lnt">1387
</span><span class="lnt">1388
</span><span class="lnt">1389
</span><span class="lnt">1390
</span><span class="lnt">1391
</span><span class="lnt">1392
</span><span class="lnt">1393
</span><span class="lnt">1394
</span><span class="lnt">1395
</span><span class="lnt">1396
</span><span class="lnt">1397
</span><span class="lnt">1398
</span><span class="lnt">1399
</span><span class="lnt">1400
</span><span class="lnt">1401
</span><span class="lnt">1402
</span><span class="lnt">1403
</span><span class="lnt">1404
</span><span class="lnt">1405
</span><span class="lnt">1406
</span><span class="lnt">1407
</span><span class="lnt">1408
</span><span class="lnt">1409
</span><span class="lnt">1410
</span><span class="lnt">1411
</span><span class="lnt">1412
</span><span class="lnt">1413
</span><span class="lnt">1414
</span><span class="lnt">1415
</span><span class="lnt">1416
</span><span class="lnt">1417
</span><span class="lnt">1418
</span><span class="lnt">1419
</span><span class="lnt">1420
</span><span class="lnt">1421
</span><span class="lnt">1422
</span><span class="lnt">1423
</span><span class="lnt">1424
</span><span class="lnt">1425
</span><span class="lnt">1426
</span><span class="lnt">1427
</span><span class="lnt">1428
</span><span class="lnt">1429
</span><span class="lnt">1430
</span><span class="lnt">1431
</span><span class="lnt">1432
</span><span class="lnt">1433
</span><span class="lnt">1434
</span><span class="lnt">1435
</span><span class="lnt">1436
</span><span class="lnt">1437
</span><span class="lnt">1438
</span><span class="lnt">1439
</span><span class="lnt">1440
</span><span class="lnt">1441
</span><span class="lnt">1442
</span><span class="lnt">1443
</span><span class="lnt">1444
</span><span class="lnt">1445
</span><span class="lnt">1446
</span><span class="lnt">1447
</span><span class="lnt">1448
</span><span class="lnt">1449
</span><span class="lnt">1450
</span><span class="lnt">1451
</span><span class="lnt">1452
</span><span class="lnt">1453
</span><span class="lnt">1454
</span><span class="lnt">1455
</span><span class="lnt">1456
</span><span class="lnt">1457
</span><span class="lnt">1458
</span><span class="lnt">1459
</span><span class="lnt">1460
</span><span class="lnt">1461
</span><span class="lnt">1462
</span><span class="lnt">1463
</span><span class="lnt">1464
</span><span class="lnt">1465
</span><span class="lnt">1466
</span><span class="lnt">1467
</span><span class="lnt">1468
</span><span class="lnt">1469
</span><span class="lnt">1470
</span><span class="lnt">1471
</span><span class="lnt">1472
</span><span class="lnt">1473
</span><span class="lnt">1474
</span><span class="lnt">1475
</span><span class="lnt">1476
</span><span class="lnt">1477
</span><span class="lnt">1478
</span><span class="lnt">1479
</span><span class="lnt">1480
</span><span class="lnt">1481
</span><span class="lnt">1482
</span><span class="lnt">1483
</span><span class="lnt">1484
</span><span class="lnt">1485
</span><span class="lnt">1486
</span><span class="lnt">1487
</span><span class="lnt">1488
</span><span class="lnt">1489
</span><span class="lnt">1490
</span><span class="lnt">1491
</span><span class="lnt">1492
</span><span class="lnt">1493
</span><span class="lnt">1494
</span><span class="lnt">1495
</span><span class="lnt">1496
</span><span class="lnt">1497
</span><span class="lnt">1498
</span><span class="lnt">1499
</span><span class="lnt">1500
</span><span class="lnt">1501
</span><span class="lnt">1502
</span><span class="lnt">1503
</span><span class="lnt">1504
</span><span class="lnt">1505
</span><span class="lnt">1506
</span><span class="lnt">1507
</span><span class="lnt">1508
</span><span class="lnt">1509
</span><span class="lnt">1510
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">Class</span> <span class="n">LIS</span><span class="o">.</span><span class="n">Service</span><span class="o">.</span><span class="n">ENS</span><span class="o">.</span><span class="n">TransReport</span> <span class="n">Extends</span> <span class="o">%</span><span class="n">RegisteredObject</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Creator</span><span class="err">Ôºö</span>        <span class="n">yanghaoran</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">CreateDate</span><span class="err">Ôºö</span> 	 <span class="mi">20240407</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Description</span><span class="err">Ôºö</span>    <span class="err">Êé•Êî∂Â§ñÈÉ®Ê†áÊú¨</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Table</span><span class="err">Ôºö</span>          <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="ne">Input</span><span class="err">Ôºö</span>          <span class="err">Ê£ÄÈ™åÂè∑</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Output</span><span class="err">Ôºö</span>     <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Return</span><span class="err">Ôºö</span>     <span class="err">ÈîôËØØ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Others</span><span class="err">Ôºö</span>     <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span>     <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdListNew(&#34;2779164&#34;,&#34;113&#34;,&#34;&#34;,&#34;1&#34;,&#34;2&#34;,&#34;20160819&#34;,&#34;1&#34;,&#34;H&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdListNew(&#34;**4868149*&#34;,&#34;demo&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;20240409&#34;,&#34;1&#34;,&#34;C&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;10.49.25.10&#34;,&#34;1&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdListNew(&#34;**4860462*&#34;,&#34;demo&#34;,&#34;&#34;,&#34;3&#34;,&#34;13&#34;,&#34;20240408&#34;,&#34;1&#34;,&#34;H&#34;,&#34;&#34;,&#34;2&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;10.49.25.9&#34;,&#34;5&#34;,&#34;8280^5^0^2^1&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdListNew(&#34;24041406012005&#34;,&#34;demo&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;20240415&#34;,&#34;1&#34;,&#34;C&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;10.49.25.10&#34;,&#34;1&#34;,&#34;8280^1^0^2^1&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">ReceiveLisOrdListNew</span><span class="p">(</span><span class="n">Labno</span><span class="p">,</span> <span class="n">UserDR</span><span class="p">,</span> <span class="n">AssayNo</span><span class="p">,</span> <span class="n">EpisodeNo</span><span class="p">,</span> <span class="n">WorkGroupMachineDR</span><span class="p">,</span> <span class="n">TransmitDate</span><span class="p">,</span> <span class="n">RecHospitalDR</span><span class="p">,</span> <span class="n">RecFlag</span><span class="p">,</span> <span class="n">ReceiveNotes</span><span class="p">,</span> <span class="n">SpecimenQualityDR</span><span class="p">,</span> <span class="n">CarryUserDR</span><span class="p">,</span> <span class="n">PlacerLabno</span><span class="p">,</span> <span class="n">RackNo</span><span class="p">,</span> <span class="n">OperIP</span><span class="p">,</span> <span class="n">WorkGroupDR</span><span class="p">,</span> <span class="n">Sessions</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Labno</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">Labno</span><span class="p">),</span><span class="n">UserDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">UserDR</span><span class="p">),</span><span class="n">EpisodeNo</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">EpisodeNo</span><span class="p">),</span><span class="n">WorkGroupMachineDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">WorkGroupMachineDR</span><span class="p">),</span><span class="n">RecHospitalDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">RecHospitalDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RecFlag</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">RecFlag</span><span class="p">),</span><span class="n">ReceiveNotes</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">ReceiveNotes</span><span class="p">),</span><span class="n">SpecimenQualityDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">SpecimenQualityDR</span><span class="p">),</span><span class="n">TransmitDate</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">TransmitDate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">TransmitDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">TransmitDate</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">),</span><span class="n">CarryUserDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">CarryUserDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AssayNo</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">AssayNo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">PlacerLabno</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">PlacerLabno</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">RackNo</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">RackNo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">OperIP</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">OperIP</span><span class="p">),</span><span class="n">WorkGroupDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">WorkGroupDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">b</span> <span class="p">;</span><span class="n">ReceiveLisOrdListNew</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">UserDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">SYSUserI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="n">UserDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">Set</span> <span class="o">$</span><span class="n">ZTrap</span> <span class="o">=</span> <span class="s2">&#34;ErrorHandle&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="s2">&#34;LIS.Service.ENS.TransReport&#34;</span><span class="p">,</span><span class="s2">&#34;ReceiveLisOrdList&#34;</span><span class="p">)</span><span class="o">=$</span><span class="n">lb</span><span class="p">(</span><span class="n">Labno</span><span class="p">,</span> <span class="n">UserDR</span><span class="p">,</span> <span class="n">AssayNo</span><span class="p">,</span> <span class="n">EpisodeNo</span><span class="p">,</span> <span class="n">WorkGroupMachineDR</span><span class="p">,</span> <span class="n">TransmitDate</span><span class="p">,</span> <span class="n">RecHospitalDR</span><span class="p">,</span> <span class="n">RecFlag</span><span class="p">,</span> <span class="n">ReceiveNotes</span><span class="p">,</span> <span class="n">SpecimenQualityDR</span><span class="p">,</span> <span class="n">CarryUserDR</span><span class="p">,</span> <span class="n">PlacerLabno</span><span class="p">,</span> <span class="n">RackNo</span><span class="p">,</span> <span class="n">OperIP</span><span class="p">,</span> <span class="n">WorkGroupDR</span><span class="p">,</span> <span class="n">Sessions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(Labno) q &#34;-1^Ê£ÄÈ™åÂè∑‰∏∫Á©∫ÔºÅ&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="mi">20160822</span> <span class="n">yy</span> <span class="err">Âà§Êñ≠ÊòØÂê¶ÊúâËÆ∞Êé•Êî∂‰∫ÜÊ†áÊú¨</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">DHCLis</span><span class="p">(</span><span class="s2">&#34;ReceveFormOtherHis&#34;</span><span class="p">,</span><span class="n">Labno</span><span class="p">))</span> <span class="n">q</span> <span class="s2">&#34;-1^ËØ•Ê†áÊú¨Â∑≤ÁªèÊ†∏Êî∂&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="s2">&#34;&lt;Request&gt;&lt;ResultCode&gt;0&lt;/ResultCode&gt;&lt;ResultContent&gt;ÊàêÂäü&lt;/ResultContent&gt;&lt;Orders&gt;&lt;OrderList&gt;&lt;OrdID&gt;&lt;/OrdID&gt;&lt;LabNo&gt;1600904130&lt;/LabNo&gt;&lt;ArcimCode&gt;L002&lt;/ArcimCode&gt;&lt;ArcimDesc&gt;Ë°ÄÂ∏∏ËßÑ&lt;/ArcimDesc&gt;&lt;OrderQty&gt;1&lt;/OrderQty&gt;&lt;BillCode&gt;P&lt;/BillCode&gt;&lt;SpecimenTypeCode&gt;&lt;/SpecimenTypeCode&gt;&lt;SpecimenTypeDesc&gt;&lt;/SpecimenTypeDesc&gt;&lt;SpVolume&gt;&lt;/SpVolume&gt;&lt;ColInfo&gt;&lt;/ColInfo&gt;&lt;Container&gt;&lt;/Container&gt;&lt;GTSeq&gt;&lt;/GTSeq&gt;&lt;SpecFlag&gt;&lt;/SpecFlag&gt;&lt;VerifyDate&gt;2016-04-26&lt;/VerifyDate&gt;&lt;VerifyTime&gt;13:43:09&lt;/VerifyTime&gt;&lt;ColDate&gt;&lt;/ColDate&gt;&lt;ColTime&gt;&lt;/ColTime&gt;&lt;AppDeptCode&gt;&lt;/AppDeptCode&gt;&lt;AppDeptDesc&gt;‰ΩìÊ£ÄÁßë&lt;/AppDeptDesc&gt;&lt;RecDeptCode&gt;&lt;/RecDeptCode&gt;&lt;RecDeptDesc&gt;&lt;/RecDeptDesc&gt;&lt;TSPrice&gt;20&lt;/TSPrice&gt;&lt;OrderStatus&gt;E&lt;/OrderStatus&gt;&lt;DocCode&gt;&lt;/DocCode&gt;&lt;DocDesc&gt;&lt;/DocDesc&gt;&lt;RepLoct&gt;&lt;/RepLoct&gt;&lt;RepDate&gt;&lt;/RepDate&gt;&lt;RepTime&gt;&lt;/RepTime&gt;&lt;Note&gt;&lt;/Note&gt;&lt;AdmNo&gt;&lt;/AdmNo&gt;&lt;AdmDate&gt;2016-04-26&lt;/AdmDate&gt;&lt;AdmTime&gt;13:43:09&lt;/AdmTime&gt;&lt;AdmTypeCode&gt;&lt;/AdmTypeCode&gt;&lt;AdmTypeDesc&gt;‰ΩìÊ£Ä&lt;/AdmTypeDesc&gt;&lt;FeeType&gt;&lt;/FeeType&gt;&lt;PatientWard&gt;&lt;/PatientWard&gt;&lt;BedNo&gt;&lt;/BedNo&gt;&lt;Diagnose&gt;&lt;/Diagnose&gt;&lt;RegisterNo&gt;16009041&lt;/RegisterNo&gt;&lt;PatientName&gt;ÊµãËØïÔºàÁ´•Ôºâ&lt;/PatientName&gt;&lt;SexCode&gt;M&lt;/SexCode&gt;&lt;SexDesc&gt;Áî∑&lt;/SexDesc&gt;&lt;DOB&gt;1987-04-26&lt;/DOB&gt;&lt;Age&gt;29Â≤Å&lt;/Age&gt;&lt;DocumentID&gt;D16008409&lt;/DocumentID&gt;&lt;PatientAddress&gt;&lt;/PatientAddress&gt;&lt;IdentityCardNo&gt;&lt;/IdentityCardNo&gt;&lt;Telephone&gt;&lt;/Telephone&gt;&lt;SpecUserCode&gt;&lt;/SpecUserCode&gt;&lt;StartDate&gt;&lt;/StartDate&gt;&lt;StartTime&gt;&lt;/StartTime&gt;&lt;SendFlag&gt;NW&lt;/SendFlag&gt;&lt;/OrderList&gt;&lt;/Orders&gt;&lt;/Request&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="n">retObj</span><span class="o">=</span><span class="c1">##Class(UtilsController.LIS.UtilsControllerHttpSoap12Endpoint).%New()</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="n">retObj</span><span class="o">.</span><span class="n">ReceiveLisOrdList</span><span class="p">(</span><span class="n">Labno</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="mi">20160818</span> <span class="n">yy</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="ne">Input</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">TMPLISORDINFOS</span><span class="p">(</span><span class="s2">&#34;LisOrdInfos&#34;</span><span class="p">,</span><span class="n">Labno</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">CurNamespace</span><span class="o">=$</span><span class="n">ZUTIL</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">WebNamespace</span><span class="o">=</span><span class="c1">##Class(OTH.SYSParameter).GetWebNamespace()</span>
</span></span><span class="line"><span class="cl">	<span class="n">NEW</span> <span class="o">$</span><span class="n">NAMESPACE</span> 
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="o">$</span><span class="n">NAMESPACE</span><span class="o">=</span> <span class="n">WebNamespace</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="c1">##Class(LISAPP.LIS.BLL.DHCReceiveInterface).GetLabNoInfoSFHIS(Labno,&#34;&#34;,&#34;&#34;) </span>
</span></span><span class="line"><span class="cl">	<span class="n">b</span> <span class="p">;</span><span class="ne">Input</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="o">$</span><span class="n">NAMESPACE</span><span class="o">=</span> <span class="n">CurNamespace</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(Input) q &#34;-1^Êú™Êü•ËØ¢Âà∞Ê†áÊú¨‰ø°ÊÅØÔºÅ&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">repid</span><span class="o">=$</span><span class="n">i</span><span class="p">(</span><span class="o">^</span><span class="n">CacheTemp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">k</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">100</span>
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="n">UncheckInfo</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="o">//</span><span class="err">Êú™Ê†∏Êî∂ÂåªÂò±‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">ËØªÂèñÂåªÂò±</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">=</span> <span class="c1">##class(LIS.Util.COM.XML).FromXML(Input)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">s</span> <span class="n">ResultCode</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">ResultCode</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span> <span class="n">ResultContent</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">ResultContent</span>
</span></span><span class="line"><span class="cl">            <span class="n">i</span> <span class="p">(</span><span class="n">ResultCode</span><span class="o">=-</span><span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	            <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^&#34;</span><span class="n">_ResultContent</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">b</span> <span class="p">;</span><span class="n">ResultCode</span>
</span></span><span class="line"><span class="cl">            <span class="n">i</span> <span class="p">(</span><span class="n">ResultCode</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">||</span><span class="p">(</span><span class="n">ResultCode</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objMldVis</span><span class="o">=</span><span class="c1">##Class(LIS.Model.RPVisitNumber).%New()</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">Counts</span><span class="o">=+</span><span class="n">obj</span><span class="o">.</span><span class="n">Orders</span><span class="o">.%</span><span class="n">pIndex</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="p">(</span><span class="n">RegNo</span><span class="p">,</span><span class="n">AdmNo</span><span class="p">,</span><span class="n">AdmTypeCode</span><span class="p">,</span><span class="n">MedicalRecordNo</span><span class="p">,</span><span class="n">SpecimenTypeCode</span><span class="p">,</span><span class="n">AdmDate</span><span class="p">,</span><span class="n">AdmTime</span><span class="p">,</span><span class="n">PatName</span><span class="p">,</span><span class="n">SexCode</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="p">(</span><span class="n">DOB</span><span class="p">,</span><span class="n">Age</span><span class="p">,</span><span class="n">AppDeptCode</span><span class="p">,</span><span class="n">AppDeptDesc</span><span class="p">,</span><span class="n">DocCode</span><span class="p">,</span><span class="n">DocDesc</span><span class="p">,</span><span class="n">VerifyDate</span><span class="p">,</span><span class="n">VerifyTime</span><span class="p">,</span><span class="n">Diagnose</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="p">(</span><span class="n">Telephone</span><span class="p">,</span><span class="n">IdentityCardNo</span><span class="p">,</span><span class="n">PatientAddress</span><span class="p">,</span><span class="n">Note</span><span class="p">,</span><span class="n">ColDate</span><span class="p">,</span><span class="n">ColTime</span><span class="p">,</span><span class="n">SpecUserCode</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">err</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">f</span> <span class="n">tmpi</span><span class="o">=</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">:(</span><span class="n">Counts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">OrderList</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Orders</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">tmpi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">b</span> <span class="p">;</span><span class="n">OrderList</span>
</span></span><span class="line"><span class="cl">                    <span class="o">//</span><span class="n">s</span> <span class="n">LabNo</span><span class="o">=</span><span class="n">OrderList</span><span class="o">.</span><span class="n">LabNo</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ArcimCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">ArcimCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ArcimDesc</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">ArcimDesc</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">TSPrice</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">TSPrice</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">b</span> <span class="p">;</span><span class="n">a901</span>
</span></span><span class="line"><span class="cl">                    <span class="o">///</span><span class="err">Ëé∑Âèñ</span><span class="n">HISCodeÂÖ≥ËÅîÁ†ÅÂåªÂò±</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexHISCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(ArcimCode),&#34;&#34;))   //</span>
</span></span><span class="line"><span class="cl">                    <span class="n">b</span> <span class="p">;</span><span class="n">a902</span>
</span></span><span class="line"><span class="cl">                    <span class="o">///</span><span class="err">Ëé∑ÂèñÂåªÂò±‰ª£Á†ÅÂÖ≥ËÅî</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(TestSetDR) s TestSetDR=$o(^dbo.BTTestSetI(&#34;IndexCode&#34;,RecHospitalDR,##Class(LIS.Util.Common).IndexData(ArcimCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(TestSetDR) s err=&#34;-1^Ê£ÄÈ™åÂåªÂò±„Äê&#34;_ArcimDesc_&#34;„ÄëÊú™ÂØπÁÖßÔºö&#34;_ArcimCode q</span>
</span></span><span class="line"><span class="cl">                    <span class="n">b</span> <span class="p">;</span><span class="n">a904</span>
</span></span><span class="line"><span class="cl">                    <span class="o">///</span><span class="err">Âà§Êñ≠ÂåªÂò±ÊòØÂê¶Ê†∏Êî∂</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno))){</span>
</span></span><span class="line"><span class="cl">	                       <span class="n">s</span> <span class="n">mVisitNumberDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">	                       <span class="n">s</span> <span class="n">RowID</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">mVisitNumberDR</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	                       <span class="p">;</span><span class="n">s</span> <span class="n">RowID</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexReportID&#34;</span><span class="p">,</span><span class="n">mVisitNumberDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	                       <span class="n">b</span> <span class="p">;</span><span class="n">a905</span>
</span></span><span class="line"><span class="cl">	                       
</span></span><span class="line"><span class="cl">	                       <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">RowID</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		                       
</span></span><span class="line"><span class="cl">		                       <span class="p">;</span><span class="k">continue</span>
</span></span><span class="line"><span class="cl">		                       
</span></span><span class="line"><span class="cl">		                       <span class="n">s</span> <span class="n">WGMDR</span><span class="o">=$</span><span class="n">LG</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetD</span><span class="p">(</span><span class="n">RowID</span><span class="p">)),</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		                       <span class="n">I</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">WGMDR</span><span class="p">)</span> <span class="k">continue</span>
</span></span><span class="line"><span class="cl">		                       
</span></span><span class="line"><span class="cl">		                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">		                    
</span></span><span class="line"><span class="cl">	                <span class="p">}</span>
</span></span><span class="line"><span class="cl">	                <span class="n">b</span> <span class="p">;</span><span class="n">a903</span>
</span></span><span class="line"><span class="cl">                    <span class="o">///</span><span class="err">Ê†∏Êî∂Âà§Êñ≠ÂåªÂò±ÊòØÂê¶Êú¨Â∑•‰ΩúÂ∞èÁªÑ</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>   
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">Reterr</span><span class="o">=</span><span class="c1">##Class(LIS.Service.ENS.TransReport).GetTSDefWGroupMiInfo(TestSetDR,WorkGroupMachineDR)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="n">Reterr</span><span class="s1">&#39;=0 d</span>
</span></span><span class="line"><span class="cl">                        <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(TSPrice) s TSPrice=&#34;Êú™Ëé∑ÂèñÂà∞‰ª∑Ê†º&#34;	//YHR 20240409 ËÆ∞ÂΩïÊú™Ê†∏Êî∂ÂåªÂò±</span>
</span></span><span class="line"><span class="cl">                        <span class="o">.</span><span class="n">s</span> <span class="o">^</span><span class="n">LISTMPDATA</span><span class="p">(</span><span class="s2">&#34;WHSYZ&#34;</span><span class="p">,</span><span class="n">Labno</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">)</span><span class="o">=</span><span class="n">TSPrice</span>
</span></span><span class="line"><span class="cl">                        <span class="p">;</span><span class="n">b</span> <span class="p">;</span><span class="n">a</span> <span class="n">MI</span><span class="o">.</span><span class="n">Special</span><span class="o">.</span><span class="n">RecordData</span>	
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="n">Reterr</span><span class="s1">&#39;=0 s UncheckInfo=Reterr_&#34;,&#34;_UncheckInfo continue</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">					
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;RecTS&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">)</span><span class="o">=</span><span class="n">TSPrice</span>   <span class="o">//</span><span class="err">Êé•Êî∂ÂåªÂò±ÂàóË°®</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;SpecimenDR&#34;</span><span class="p">)</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetD</span><span class="p">(</span><span class="n">TestSetDR</span><span class="p">)),</span><span class="mi">10</span><span class="p">)</span>	<span class="o">//</span><span class="n">YHR</span> <span class="mi">20240409</span> <span class="err">Ê†áÊú¨ÈªòËÆ§Ê†áÊú¨Á±ªÂûã</span>
</span></span><span class="line"><span class="cl">                    <span class="n">k</span> <span class="o">^</span><span class="n">LISTMPDATA</span><span class="p">(</span><span class="s2">&#34;WHSYZ&#34;</span><span class="p">,</span><span class="n">Labno</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">b</span> <span class="p">;</span><span class="n">a102</span>
</span></span><span class="line"><span class="cl">                    
</span></span><span class="line"><span class="cl">                    <span class="o">//</span><span class="mi">20160818</span> <span class="n">yy</span>                   
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">OrderID</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">OrdID</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>                                        
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">SpecimenTypeCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">SpecimenTypeCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">RegNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">RegisterNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AdmTypeCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AdmTypeCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AdmNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AdmNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">MedicalRecordNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">DocumentID</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AdmDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AdmDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AdmTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AdmTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">PatName</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">PatientName</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">SexCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">SexCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="n">SexCode</span><span class="o">=</span><span class="s2">&#34;1&#34;</span> <span class="n">s</span> <span class="n">SexCode</span><span class="o">=</span><span class="s2">&#34;M&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="n">SexCode</span><span class="o">=</span><span class="s2">&#34;2&#34;</span> <span class="n">s</span> <span class="n">SexCode</span><span class="o">=</span><span class="s2">&#34;F&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">DOB</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">DOB</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>                   
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">Age</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">Age</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AppDeptCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AppDeptCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AppDeptDesc</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AppDeptDesc</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">DocCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">DocCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">DocDesc</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">DocDesc</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">VerifyDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">VerifyDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">VerifyTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">VerifyTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">Diagnose</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">Diagnose</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">Telephone</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">Telephone</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">IdentityCardNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">IdentityCardNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">PatientAddress</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">PatientAddress</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">Note</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">Note</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ColDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">ColDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ColTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">ColTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">SpecUserCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">SpecUserCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">BedNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">BedNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span> <span class="p">;</span><span class="n">FGJS</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">err</span><span class="p">),</span><span class="n">err</span><span class="s1">&#39;=0 s RetValue=err q RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">I</span> <span class="s1">&#39;$D(^TMP($zn,$j,repid,&#34;RecTS&#34;)),RecFlag=&#34;C&#34; s RetValue=&#34;Êó†ÂèØÊé•Êî∂ÂåªÂò±ÔºÅ&#34; q RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">I</span> <span class="s1">&#39;$D(^TMP($zn,$j,repid,&#34;RecTS&#34;)),RecFlag=&#34;H&#34;,$l(UncheckInfo) s RetValue=&#34;Êú¨Â∑•‰ΩúÂ∞èÁªÑÊó†ÂèØÊ†∏Êî∂ÂåªÂò±,ËØ∑ÈÄÅËá≥&#34;_UncheckInfo_&#34;ÂÅöÊ£ÄÈ™å&#34; q RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span> <span class="p">;</span><span class="n">a101</span>
</span></span><span class="line"><span class="cl">                <span class="n">I</span> <span class="s1">&#39;$D(^TMP($zn,$j,repid,&#34;RecTS&#34;)),RecFlag=&#34;H&#34; s RetValue=&#34;Êó†ÂèØÊ†∏Êî∂ÂåªÂò±ÔºÅ&#34; q RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="s2">&#34;YY&#34;</span><span class="p">,</span><span class="s2">&#34;age&#34;</span><span class="p">)</span><span class="o">=</span><span class="n">Age</span>
</span></span><span class="line"><span class="cl">                <span class="o">///</span><span class="err">‰øùÂ≠òÊ†áÊú¨‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno))) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">VisitNumberDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumber).%OpenId(VisitNumberDR)</span>
</span></span><span class="line"><span class="cl">                <span class="n">e</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumber).%New()</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">VisitNumber</span><span class="o">=</span><span class="n">Labno</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RegNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">RegNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">///</span><span class="err">Â∞±ËØäÁ±ªÂûã</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">AdmissionTypeDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="s1">&#39;$l(AdmTypeCode) s AdmTypeCode=&#34;P&#34;  //ÈªòËÆ§‰ΩìÊ£Ä</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AdmTypeCode</span><span class="p">)</span> <span class="n">s</span> <span class="n">AdmissionTypeDR</span><span class="o">=</span><span class="c1">##Class(HIS.DHCReceiveProcess).GetAdmissionTypeDR(AdmTypeCode)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AdmissionTypeDR</span><span class="o">=</span><span class="n">AdmissionTypeDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AdmNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">AdmNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">;</span><span class="mi">20160819</span> <span class="n">yy</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">MedicalRecordNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">MedicalRecordNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">AdmDate</span><span class="p">)</span> <span class="n">s</span> <span class="n">AdmDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">AdmDate</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AdmTime</span><span class="p">)</span> <span class="n">s</span> <span class="n">AdmTime</span><span class="o">=$</span><span class="n">zth</span><span class="p">(</span><span class="n">AdmTime</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AdmDate</span><span class="o">=</span><span class="n">AdmDate</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AdmTime</span><span class="o">=</span><span class="n">AdmTime</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CertTypeDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">CertTypeDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CertNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">CertNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">IDNumber</span><span class="o">=</span><span class="n">IdentityCardNo</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PaymentTypeDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PaymentTypeDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SurName</span><span class="o">=</span><span class="n">PatName</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">GivenName</span><span class="o">=</span><span class="n">PatName</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">SpeciesDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTSpeciesI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(SexCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpeciesDR</span><span class="o">=</span><span class="n">SpeciesDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">DOB</span><span class="p">)</span> <span class="n">s</span> <span class="n">DOB</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">DOB</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">BirthTime</span><span class="p">)</span> <span class="n">s</span> <span class="n">BirthTime</span><span class="o">=$</span><span class="n">zth</span><span class="p">(</span><span class="n">BirthTime</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BirthDate</span><span class="o">=</span><span class="n">DOB</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BirthTime</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="n">AgeUnitDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">Age</span><span class="p">[</span><span class="s2">&#34;Â≤Å&#34;</span> <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;Y&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">Age</span><span class="p">[</span><span class="s2">&#34;Êúà&#34;</span> <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;M&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">Age</span><span class="p">[</span><span class="s2">&#34;Â§©&#34;</span> <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;D&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">Age</span><span class="p">[</span><span class="s2">&#34;Êó∂&#34;</span> <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;H&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AgeCode</span><span class="p">)</span> <span class="n">s</span> <span class="n">AgeUnitDR</span><span class="o">=</span><span class="c1">##Class(HIS.DHCReceiveProcess).GetAgeUnitDR(AgeCode)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Age</span><span class="o">=+</span><span class="n">Age</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AgeUnitDR</span><span class="o">=</span><span class="n">AgeUnitDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">EthnicityDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">EthnicityDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">HospitalDR</span><span class="o">=</span><span class="n">RecHospitalDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">LocationDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTLocationI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(AppDeptCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">LocationDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AppDeptCode</span><span class="p">)</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTLocationI</span><span class="p">(</span><span class="s2">&#34;IndexHISCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(AppDeptCode))) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">LocationDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTLocationI</span><span class="p">(</span><span class="s2">&#34;IndexHISCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(AppDeptCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.//</span><span class="err">Ê≤°ÊúâÈÖçÂ§ñÈÉ®‰ª£Á†ÅÔºåËÄÉËôëÊòØÂê¶Ëá™Âä®ÊèíÂÖ•</span>
</span></span><span class="line"><span class="cl">                <span class="o">.//</span><span class="n">i</span> <span class="s1">&#39;$l(LocationDR) s LocationDR=##Class(HIS.DHCReceiveProcess).GetLocationDR(AppDeptCode,AppDeptCode,AppDeptDesc,RecHospitalDR)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">LocationDR</span><span class="o">=</span><span class="n">LocationDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">DoctorDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">DocCode</span><span class="p">)</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTDoctorI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(DocCode))) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">DoctorDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTDoctorI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(DocCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.//</span><span class="err">Ê≤°ÊúâÈÖçÂ§ñÈÉ®‰ª£Á†ÅÔºåËÄÉËôëÊòØÂê¶Ëá™Âä®ÊèíÂÖ•</span>
</span></span><span class="line"><span class="cl">                <span class="o">.//</span><span class="n">i</span> <span class="s1">&#39;$l(DoctorDR) s DoctorDR=##Class(HIS.DHCReceiveProcess).GetDoctorDR(DocCode,DocDesc,RecHospitalDR)</span>
</span></span><span class="line"><span class="cl">                <span class="p">;</span><span class="n">b</span> <span class="p">;</span><span class="n">DoctorDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">DoctorDR</span><span class="o">=</span><span class="n">DoctorDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">VerifyDate</span><span class="p">)</span> <span class="n">s</span> <span class="n">VerifyDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">VerifyDate</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">VerifyTime</span><span class="p">)</span> <span class="n">s</span> <span class="n">VerifyTime</span><span class="o">=$</span><span class="n">zth</span><span class="p">(</span><span class="n">VerifyTime</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RequestDate</span><span class="o">=</span><span class="n">VerifyDate</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RequestTime</span><span class="o">=</span><span class="n">VerifyTime</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">WardDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">WardDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BedNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">BedNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Symptom</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">Diagnose</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">MobileNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">MobileNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PhoneNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">Telephone</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">EMail</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">EMail</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Height</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Height</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Weight</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Weight</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BloodPressure</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">BloodPressure</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ClinicalConditionsDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ClinicalConditionsDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">LMPDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">LMPDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">Preg</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">zcvt</span><span class="p">(</span><span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Pregnant</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span><span class="s2">&#34;U&#34;</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;TRUE&#34;</span> <span class="n">s</span> <span class="n">Preg</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Pregnant</span><span class="o">=</span><span class="n">Preg</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PregnantWeeks</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PregnantWeeks</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AboDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">AboDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RhDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">RhDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Address</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">PatientAddress</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PostCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PostCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">InfectFlag</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">InfectFlag</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">Infect</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">zcvt</span><span class="p">(</span><span class="n">InfectFlag</span><span class="p">,</span><span class="s2">&#34;U&#34;</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;TRUE&#34;</span> <span class="n">s</span> <span class="n">Infect</span><span class="o">=</span><span class="mi">1</span>             
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">InfectFlag</span><span class="o">=</span><span class="n">Infect</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">InfectAlert</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">InfectAlert</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">SpecialFlag</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">SpecialFlag</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">Special</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">zcvt</span><span class="p">(</span><span class="n">SpecialFlag</span><span class="p">,</span><span class="s2">&#34;U&#34;</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;TRUE&#34;</span> <span class="n">s</span> <span class="n">Special</span><span class="o">=</span><span class="mi">1</span> 
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecialFlag</span><span class="o">=</span><span class="n">Special</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PregnantNum</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PregnantNum</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ChildbirthNum</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ChildbirthNum</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="mi">20160823</span> <span class="n">yy</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReqNotes</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">Note</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReqNotes</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderID</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BedNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">BedNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RequestNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">RequestNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">Urgent</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Urgent</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">UrgentFlag</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">zcvt</span><span class="p">(</span><span class="n">Urgent</span><span class="p">,</span><span class="s2">&#34;U&#34;</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;TRUE&#34;</span> <span class="n">s</span> <span class="n">UrgentFlag</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Urgent</span><span class="o">=</span><span class="n">UrgentFlag</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">ColDate</span><span class="p">)</span> <span class="n">s</span> <span class="n">ColDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">ColDate</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">ColTime</span><span class="p">),(</span><span class="n">ColTime</span><span class="p">[</span><span class="s2">&#34;:&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">ColTime</span><span class="o">=$</span><span class="n">zth</span><span class="p">(</span><span class="n">ColTime</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">ColDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">ColTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectUserDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">CollectUserDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AnatomicalSiteDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">AnatomicalSiteDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectPositon</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">CollectPositon</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">SpecimenDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTSpecimenI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(SpecimenTypeCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="s1">&#39;$l(SpecimenDR) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenDR</span><span class="o">=</span><span class="n">SpecimenDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ContainerDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectNotes</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">H24UVolume</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">H24UTimePeriod</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BodyTemp</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Confidential</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryTime</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryUserDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;C&#34;</span><span class="p">)</span> <span class="n">d</span> <span class="o">///</span><span class="err">ÈõÜ‰∏≠Êé•Êî∂</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveTime</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveUserDR</span><span class="o">=</span><span class="n">UserDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">CarryUserDR</span><span class="p">),</span><span class="s1">&#39;$l(objVisitNumber.CarryUserDR) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryDate</span> <span class="o">=</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryTime</span> <span class="o">=</span> <span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryUserDR</span> <span class="o">=</span> <span class="n">CarryUserDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveNotes</span><span class="o">=</span><span class="n">ReceiveNotes</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenQualityDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">SpecimenQualityDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span><span class="p">)</span> <span class="n">d</span> <span class="o">///</span><span class="err">Ê†áÊú¨Ê†∏Êî∂</span> <span class="err">Â¶ÇÊûúÂ≠óÊÆµ‰∏∫Á©∫</span> 
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveTime</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveUserDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveUserDR</span><span class="o">=</span><span class="n">UserDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenQualityDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenQualityDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">SpecimenQualityDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>		<span class="o">//</span><span class="n">YHR</span> <span class="mi">20240409</span> <span class="err">‰øùÂ≠òÊ†áÊú¨Ë¥®Èáè</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">b</span> <span class="p">;</span><span class="n">SpecimenQualityDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberD</span><span class="p">(</span><span class="n">VisitNumberDR</span><span class="p">)),</span><span class="mi">56</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;SpecimenDR&#34;</span><span class="p">))</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">                <span class="o">...</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;SpecimenDR&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">e</span>  <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberD</span><span class="p">(</span><span class="n">VisitNumberDR</span><span class="p">)),</span><span class="mi">56</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span> <span class="p">;</span><span class="n">SpecimenDR</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveHospitalDR</span><span class="o">=</span><span class="n">RecHospitalDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">InStorageTime</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">InStorageUserDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">OutStorageTime</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">OutStorageUserDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">OutStorageType</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="s1">&#39;=&#34;S&#34;) d ///ÊãíÊî∂‰øùÂ≠ò‰∏ç‰øùÂ≠òÊó∂Èó¥</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">AddDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">AddTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">AddUserDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddUserDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(AddDate) s AddDate=$tr($zd(+$h,3),&#34;-&#34;)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(AddTime) s AddTime=$p($h,&#34;,&#34;,2)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(AddUserDR) s AddUserDR=UserDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddDate</span><span class="o">=</span><span class="n">AddDate</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddTime</span><span class="o">=</span><span class="n">AddTime</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddUserDR</span><span class="o">=</span><span class="n">AddUserDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddType</span><span class="o">=</span><span class="s2">&#34;3&#34;</span>       <span class="o">///</span><span class="mi">1</span><span class="err">Êù°Á†Å</span><span class="p">,</span><span class="mi">2</span><span class="err">ÊâãÂ∑•</span><span class="p">,</span><span class="mi">3</span><span class="err">Á¨¨‰∏âÊñπ</span><span class="p">,</span><span class="mi">4</span><span class="err">ÂÖ∂ÂÆÉ</span><span class="p">(</span><span class="err">ÊãíÊî∂‰øùÂ≠ò</span><span class="p">)</span>                
</span></span><span class="line"><span class="cl">                <span class="p">;</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RequestNo</span><span class="o">=</span><span class="n">OrderID</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span> <span class="p">;</span><span class="n">a903</span>
</span></span><span class="line"><span class="cl">             	<span class="n">i</span> <span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;A&#34;</span> <span class="n">D</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">ArriveDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">ArriveTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">ArriveUserDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveUserDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(ArriveDate) s ArriveDate=$tr($zd(+$h,3),&#34;-&#34;)</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(ArriveTime) s ArriveTime=$p($h,&#34;,&#34;,2)</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(ArriveUserDR) s ArriveUserDR=UserDR</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveWorkGroupDR</span><span class="o">=</span><span class="n">WorkGroupDR</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveDate</span><span class="o">=</span><span class="n">ArriveDate</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveTime</span><span class="o">=</span><span class="n">ArriveTime</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveUserDR</span><span class="o">=</span><span class="n">ArriveUserDR</span>
</span></span><span class="line"><span class="cl">				<span class="n">b</span> <span class="p">;</span><span class="n">a904</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">sc</span><span class="o">=</span><span class="n">objVisitNumber</span><span class="o">.%</span><span class="n">Save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">;</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">VisitNumberDR</span><span class="o">=</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RowID</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">Else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^Ê†áÊú¨‰ø°ÊÅØ‰øùÂ≠òÂ§±Ë¥•:&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">GetErrorText</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span> <span class="p">;</span><span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">RetValue</span><span class="s1">&#39;=0 q RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">err</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">IsReceived</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">f</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;RecTS&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">q</span><span class="p">:</span><span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">TestSetFee</span><span class="o">=+$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;RecTS&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">RowID</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">RowID</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumberTestSet).%OpenId(RowID)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumberTestSet).%New()</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">Recieved</span><span class="s1">&#39;=1  s IsReceived=0</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">VisitNumberDR</span><span class="o">=</span><span class="n">VisitNumberDR</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">TestSetDR</span><span class="o">=</span><span class="n">TestSetDR</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">Recieved</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(AssayNo),$l(WorkGroupMachineDR)   {</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">CommDirection</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTWorkGroupMachineD</span><span class="p">(</span><span class="n">WorkGroupMachineDR</span><span class="p">),</span><span class="mi">11</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="n">CommDirection</span><span class="o">=</span><span class="s2">&#34;UP&#34;</span> <span class="n">s</span> <span class="n">AssayNo</span><span class="o">=</span><span class="n">Labno</span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="n">CommDirection</span><span class="o">=</span><span class="s2">&#34;BI&#34;</span> <span class="n">s</span> <span class="n">AssayNo</span><span class="o">=</span><span class="n">Labno</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">WorkGroupMachineDR</span><span class="o">=</span><span class="n">WorkGroupMachineDR</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">TransmitDate</span><span class="o">=</span><span class="n">TransmitDate</span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="s1">&#39;$l(AssayNo) s AssayNo=EpisodeNo </span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="s1">&#39;$l(AssayNo) s AssayNo=Labno</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">AssayNo</span><span class="o">=</span><span class="n">AssayNo</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">TestSetFee</span><span class="o">=</span><span class="n">TestSetFee</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">HISOrderID</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">Sequence</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">sc</span><span class="o">=</span><span class="n">objTestSets</span><span class="o">.%</span><span class="n">Save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                        <span class="o">//</span><span class="err">Êõ¥Êñ∞‰∏ä‰º†ËÆ∞ÂΩï</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="c1">##Class(MI.MachineUpload).Upload(Labno,TestSetDR,WorkGroupMachineDR)</span>
</span></span><span class="line"><span class="cl">                     <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Else</span> <span class="p">{</span><span class="n">s</span> <span class="n">err</span><span class="o">=$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">GetErrorText</span><span class="p">(</span><span class="n">sc</span><span class="p">)}</span>        
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span> <span class="o">//</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;C&#34;</span><span class="p">,</span><span class="n">IsReceived</span><span class="o">=</span><span class="mi">1</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^Ê†áÊú¨Â∑≤Êé•Êî∂&#34;</span> <span class="n">q</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^Ê£ÄÈ™åÂåªÂò±‰øùÂ≠òÂ§±Ë¥•:&#34;</span><span class="n">_err</span> <span class="n">q</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="o">///</span><span class="err">Êä•ÂëäÊ†∏Êî∂</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span><span class="p">){</span> 
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumberReport).%New()</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">VisitNumberDR</span><span class="o">=</span><span class="n">VisitNumberDR</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">TransmitDate</span><span class="o">=</span><span class="n">TransmitDate</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">WorkGroupMachineDR</span><span class="o">=</span><span class="n">WorkGroupMachineDR</span>   
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">OrderNo</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(AssayNo) s AssayNo=EpisodeNo </span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(AssayNo) s AssayNo=Labno</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AssayNo</span><span class="o">=</span><span class="n">AssayNo</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AccessionNo</span><span class="o">=</span><span class="s2">&#34;&#34;</span>   <span class="o">///</span><span class="err">ÁªÜËèåÂàÜÁ¶ªÂè∑</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">EpisodeNo</span><span class="o">=</span><span class="n">EpisodeNo</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AcceptDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AcceptTime</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AcceptUserDR</span><span class="o">=</span><span class="n">UserDR</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">Status</span><span class="o">=</span><span class="mi">1</span>  <span class="o">//</span><span class="err">Êä•ÂëäÁä∂ÊÄÅ</span><span class="p">(</span><span class="mi">1</span><span class="err">ÁôªËÆ∞Ôºå</span><span class="mi">2</span><span class="err">ÂàùÂÆ°Ôºå</span><span class="mi">3</span><span class="err">ÂÆ°Ê†∏Ôºå</span><span class="mi">4</span><span class="err">Â§çÊü•Ôºå</span><span class="mi">5</span><span class="err">ÂèñÊ∂àÂÆ°Ê†∏Ôºå</span><span class="mi">6</span><span class="err">‰ΩúÂ∫üÔºå</span><span class="n">OÂÖ∂‰ªñ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">RackNo</span><span class="o">=</span><span class="n">RackNo</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="n">objVisitNumberReport</span><span class="o">.%</span><span class="n">Save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="n">b</span> <span class="o">//</span><span class="mi">901</span>
</span></span><span class="line"><span class="cl">                    <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span> <span class="p">{</span><span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">0</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Else</span> <span class="p">{</span><span class="n">s</span> <span class="n">err</span><span class="o">=</span><span class="s2">&#34;Ê†áÊú¨‰ø°ÊÅØÊ†∏Êî∂Â§±Ë¥•:&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">GetErrorText</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="n">Quit</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	                <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	                <span class="n">f</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;RecTS&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">))</span> <span class="o">//</span><span class="err">Êú¨Ê¨°Ê†∏Êî∂ÂåªÂò±</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">q</span><span class="p">:</span><span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">s</span> <span class="n">RowID</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">RowID</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	                         <span class="n">s</span> <span class="n">objTestSets</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumberTestSet).%OpenId(RowID)</span>
</span></span><span class="line"><span class="cl">	                         <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">VisitNumberReportDR</span><span class="o">=</span><span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">RowID</span>
</span></span><span class="line"><span class="cl">	                         <span class="n">s</span> <span class="n">sc</span><span class="o">=</span><span class="n">objTestSets</span><span class="o">.%</span><span class="n">Save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		                     <span class="n">If</span> <span class="p">(</span><span class="s1">&#39;$SYSTEM.Status.IsOK(sc)) {</span>
</span></span><span class="line"><span class="cl">		                       <span class="n">s</span> <span class="n">err</span><span class="o">=$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">GetErrorText</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span> <span class="n">q</span> 
</span></span><span class="line"><span class="cl">		                     <span class="p">}</span>    
</span></span><span class="line"><span class="cl">	                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">	                    <span class="o">//</span><span class="err">ÊåâÂåªÂò±ÁîüÊàêÊä•ÂëäÈ°πÁõÆÁªìÊûú</span>
</span></span><span class="line"><span class="cl">						<span class="n">s</span> <span class="n">retVal</span><span class="o">=</span><span class="c1">##Class(LISSP.DHCRPVisitNumberReport).SaveReportTestCode(objVisitNumberReport.RowID,TestSetDR)</span>
</span></span><span class="line"><span class="cl">						<span class="n">i</span> <span class="n">retVal</span><span class="s1">&#39;=1 s err=retVal q </span>
</span></span><span class="line"><span class="cl">	                 <span class="p">}</span> 
</span></span><span class="line"><span class="cl">	                 <span class="n">b</span> <span class="o">//</span><span class="mi">902</span>
</span></span><span class="line"><span class="cl">	                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^Ê£ÄÈ™åÂåªÂò±‰øùÂ≠òÂ§±Ë¥•:&#34;</span><span class="n">_err</span> <span class="n">q</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">                    <span class="o">//</span><span class="err">Êõ¥Êñ∞Â∑•‰ΩúÂ∞èÁªÑÊµÅÊ∞¥Âè∑</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">CurDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">WorkGroupMachineDR</span><span class="p">),</span><span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">EpisodeNo</span><span class="p">)</span> <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="c1">##Class(HIS.DHCCommon).SaveWorkGroupMachineEpis(WorkGroupMachineDR,CurDate,EpisodeNo)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="n">ret</span><span class="s1">&#39;=1,err=&#34;Êõ¥Êñ∞Â∑•‰ΩúÂ∞èÁªÑÊµÅÊ∞¥Âè∑Â§±Ë¥•:&#34;_ret Quit</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^&#34;</span><span class="n">_err</span> <span class="n">q</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="o">///</span><span class="err">ÊèíÂÖ•Ê†áÊú¨Ê†∏Êî∂Êìç‰ΩúËÆ∞ÂΩï</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="p">(</span><span class="n">OperateDate</span><span class="p">,</span><span class="n">OperateTime</span><span class="p">,</span><span class="n">OperateTypeCode</span><span class="p">,</span><span class="n">OperateNotes</span><span class="p">,</span><span class="n">RejectTypeDR</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">OperateNotes</span><span class="o">=</span><span class="n">ReceiveNotes</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;A&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">OperateTypeCode</span><span class="o">=</span><span class="mi">30</span>  <span class="o">//</span><span class="err">ÈÄÅËææ</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;S&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">OperateTypeCode</span><span class="o">=</span><span class="mi">31</span>  <span class="o">///</span><span class="err">‰øùÂ≠ò</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;C&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">OperateTypeCode</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">OperateNotes</span><span class="o">=</span><span class="n">OperIP</span>  <span class="o">///</span><span class="err">Êé•Êî∂</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">OperateTypeCode</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">OperateNotes</span><span class="o">=</span><span class="n">OperIP</span>  <span class="o">///</span><span class="err">Ê†∏Êî∂</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span>										<span class="n">VisitNumberDR</span><span class="p">,</span> <span class="n">OperateDate</span><span class="p">,</span> <span class="n">OperateTime</span><span class="p">,</span> <span class="n">UserID</span><span class="p">,</span> <span class="n">OperateNotes</span><span class="p">,</span> <span class="n">OperateTypeCode</span><span class="p">,</span> <span class="n">WorkGroupMachineDR</span><span class="p">,</span> <span class="n">RejectTypeDR</span><span class="p">,</span> <span class="n">IPAddress</span><span class="p">,</span> <span class="n">WorkGroupDR</span><span class="p">,</span> <span class="n">Sessions</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="c1">##Class(HIS.DHCCommon).SaveRecord(VisitNumberDR,OperateDate, OperateTime, UserDR, OperateNotes, OperateTypeCode, WorkGroupMachineDR, RejectTypeDR,OperIP,WorkGroupDR,Sessions)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">ret</span><span class="s1">&#39;=1  s RetValue=&#34;Ê†áÊú¨Êìç‰ΩúËÆ∞ÂΩï‰øùÂ≠òÂ§±Ë¥•:&#34;_ret q RetValue</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">     <span class="o">/*</span>
</span></span><span class="line"><span class="cl">    <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">Else</span> 
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>			
</span></span><span class="line"><span class="cl">    <span class="o">*/</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">UncheckInfo</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="n">RetValue_</span><span class="s2">&#34;UncheckInfo&#34;</span><span class="n">_UncheckInfo</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">UncheckInfo</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">1</span><span class="n">_</span><span class="s2">&#34;^Êú™Ê†∏Êî∂ÂåªÂò±:&#34;</span><span class="n">_UncheckInfo</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="p">;</span><span class="n">CSRetValue</span>
</span></span><span class="line"><span class="cl">    <span class="n">Q</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">ErrorHandle</span>
</span></span><span class="line"><span class="cl">    <span class="n">TROLLBACK</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^ÈîôËØØ&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">ZERROR</span><span class="p">,</span><span class="s2">&#34;^&#34;</span><span class="p">,</span><span class="s2">&#34;--&#34;</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34;.ÈîôËØØ‰ª£Á†Å:&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">ECODE</span>
</span></span><span class="line"><span class="cl">    <span class="n">Quit</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).ReturnStatus(&#34;**4868149*&#34;,1).Read()</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).ReturnStatus(&#34;**8015454*&#34;,1).Read()</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="err">ÂõûÂÜôÊ†áÊú¨Êé•ÂèóÁä∂ÊÄÅ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">ReturnStatus</span><span class="p">(</span><span class="n">Labno</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">Labno</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">Labno</span><span class="p">,</span><span class="s2">&#34;*&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">Labno</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">Labno</span><span class="p">,</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">//</span><span class="err">Ëé∑ÂèñÊï∞ÊçÆ</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="k">return</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="n">ret</span><span class="o">=</span><span class="mi">1</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ResultCode</span><span class="o">=</span><span class="s2">&#34;T&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ResultContent</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">e</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ResultCode</span><span class="o">=</span><span class="s2">&#34;F&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ResultContent</span><span class="o">=</span><span class="n">ret</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="o">//</span><span class="err">ÊãºË£Ö</span><span class="n">json</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">S</span> <span class="n">Main</span><span class="o">=</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Main</span><span class="o">.</span><span class="s2">&#34;receivestatus&#34;</span><span class="o">=</span><span class="n">ResultCode</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Date</span><span class="o">=$</span><span class="n">h</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Main</span><span class="o">.</span><span class="s2">&#34;receivedate&#34;</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="n">Date</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">,</span><span class="s2">&#34;.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Main</span><span class="o">.</span><span class="s2">&#34;receivetime&#34;</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="n">Date</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">,</span><span class="s2">&#34;.&#34;</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34; &#34;</span><span class="n">_</span><span class="o">$</span><span class="n">zt</span><span class="p">(</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="n">Date</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Main</span><span class="o">.</span><span class="s2">&#34;labno&#34;</span><span class="o">=</span><span class="n">Labno</span>
</span></span><span class="line"><span class="cl">    <span class="n">set</span> <span class="n">OutStr</span><span class="o">=</span><span class="n">Main</span><span class="o">.%</span><span class="n">ToJSON</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">stream</span><span class="o">=</span><span class="c1">##class(%GlobalCharacterStream).%New()</span>
</span></span><span class="line"><span class="cl">    <span class="n">d</span> <span class="n">stream</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">OutStr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="p">;</span><span class="n">a</span> <span class="n">OutStr</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">CurNamespace</span><span class="o">=$</span><span class="n">ZUTIL</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">WebNamespace</span><span class="o">=</span><span class="c1">##Class(OTH.SYSParameter).GetWebNamespace()</span>
</span></span><span class="line"><span class="cl">	<span class="n">NEW</span> <span class="o">$</span><span class="n">NAMESPACE</span> 
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="o">$</span><span class="n">NAMESPACE</span><span class="o">=</span> <span class="n">WebNamespace</span>
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="o">$</span><span class="n">e</span><span class="p">(</span><span class="n">Labno</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mi">4</span> <span class="n">s</span> <span class="k">return</span><span class="o">=</span><span class="c1">##class(web.DHCENS.STBLL.SOAP.HISSystemServieSoap).HIPMessageServerS(&#34;MES0023&#34;,stream)</span>
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="o">$</span><span class="n">e</span><span class="p">(</span><span class="n">Labno</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mi">8</span> <span class="n">s</span> <span class="k">return</span><span class="o">=</span><span class="c1">##class(web.DHCENS.STBLL.SOAP.HISSystemServieSoap).HIPMessageServerS(&#34;MES0027&#34;,stream)		//YHR 20240416 Êä§ÁêÜÈô¢ÂõûÂÜô</span>
</span></span><span class="line"><span class="cl">	<span class="p">;</span><span class="n">s</span> <span class="o">^</span><span class="n">YHR</span><span class="p">(</span><span class="s2">&#34;HXBG&#34;</span><span class="p">,</span><span class="n">Labno</span><span class="p">)</span><span class="o">=</span><span class="k">return</span><span class="o">.</span><span class="n">Read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="n">b</span> <span class="p">;</span><span class="ne">Input</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="o">$</span><span class="n">NAMESPACE</span><span class="o">=</span> <span class="n">CurNamespace</span>
</span></span><span class="line"><span class="cl">	<span class="n">q</span> <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Creator</span><span class="err">Ôºö</span>        <span class="n">liuzf</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">CreateDate</span><span class="err">Ôºö</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">27</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Description</span><span class="err">Ôºö</span>    <span class="err">Êé•Êî∂Â§ñÈÉ®Ê†áÊú¨</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Table</span><span class="err">Ôºö</span>          <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="ne">Input</span><span class="err">Ôºö</span>          <span class="err">Ê£ÄÈ™åÂè∑</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Output</span><span class="err">Ôºö</span>     <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Return</span><span class="err">Ôºö</span>     <span class="err">ÈîôËØØ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Others</span><span class="err">Ôºö</span>     <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span>     <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdList(&#34;2779164&#34;,&#34;113&#34;,&#34;&#34;,&#34;1&#34;,&#34;2&#34;,&#34;20160819&#34;,&#34;1&#34;,&#34;H&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdList(Labno, UserDR, AssayNo, EpisodeNo, WorkGroupMachineDR, TransmitDate, RecHospitalDR, RecFlag, ReceiveNotes, SpecimenQualityDR, CarryUserDR, PlacerLabno, RackNo, OperIP, WorkGroupDR)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).ReceiveLisOrdList(&#34;**4860462*&#34;,&#34;demo&#34;,&#34;&#34;,&#34;3&#34;,&#34;13&#34;,&#34;20240408&#34;,&#34;1&#34;,&#34;H&#34;,&#34;&#34;,&#34;2&#34;,&#34;&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">ReceiveLisOrdList</span><span class="p">(</span><span class="n">Labno</span><span class="p">,</span> <span class="n">UserDR</span><span class="p">,</span> <span class="n">AssayNo</span><span class="p">,</span> <span class="n">EpisodeNo</span><span class="p">,</span> <span class="n">WorkGroupMachineDR</span><span class="p">,</span> <span class="n">TransmitDate</span><span class="p">,</span> <span class="n">RecHospitalDR</span><span class="p">,</span> <span class="n">RecFlag</span><span class="p">,</span> <span class="n">ReceiveNotes</span><span class="p">,</span> <span class="n">SpecimenQualityDR</span><span class="p">,</span> <span class="n">CarryUserDR</span><span class="p">,</span> <span class="n">PlacerLabno</span><span class="p">,</span> <span class="n">RackNo</span><span class="p">,</span> <span class="n">OperIP</span><span class="p">,</span> <span class="n">WorkGroupDR</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Labno</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">Labno</span><span class="p">),</span><span class="n">UserDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">UserDR</span><span class="p">),</span><span class="n">EpisodeNo</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">EpisodeNo</span><span class="p">),</span><span class="n">WorkGroupMachineDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">WorkGroupMachineDR</span><span class="p">),</span><span class="n">RecHospitalDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">RecHospitalDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RecFlag</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">RecFlag</span><span class="p">),</span><span class="n">ReceiveNotes</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">ReceiveNotes</span><span class="p">),</span><span class="n">SpecimenQualityDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">SpecimenQualityDR</span><span class="p">),</span><span class="n">TransmitDate</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">TransmitDate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">TransmitDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">TransmitDate</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">),</span><span class="n">CarryUserDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">CarryUserDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AssayNo</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">AssayNo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">PlacerLabno</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">PlacerLabno</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">RackNo</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">RackNo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">OperIP</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">OperIP</span><span class="p">),</span><span class="n">WorkGroupDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">WorkGroupDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="o">$</span><span class="n">ZTrap</span> <span class="o">=</span> <span class="s2">&#34;ErrorHandle&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="s2">&#34;LIS.Service.ENS.TransReport&#34;</span><span class="p">,</span><span class="s2">&#34;ReceiveLisOrdList&#34;</span><span class="p">)</span><span class="o">=$</span><span class="n">lb</span><span class="p">(</span><span class="n">Labno</span><span class="p">,</span> <span class="n">UserDR</span><span class="p">,</span> <span class="n">AssayNo</span><span class="p">,</span><span class="n">EpisodeNo</span><span class="p">,</span> <span class="n">WorkGroupMachineDR</span><span class="p">,</span> <span class="n">TransmitDate</span><span class="p">,</span> <span class="n">RecHospitalDR</span><span class="p">,</span> <span class="n">RecFlag</span><span class="p">,</span> <span class="n">ReceiveNotes</span><span class="p">,</span> <span class="n">SpecimenQualityDR</span><span class="p">,</span><span class="n">CarryUserDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(Labno) q &#34;-1^Ê£ÄÈ™åÂè∑‰∏∫Á©∫ÔºÅ&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="mi">20160822</span> <span class="n">yy</span> <span class="err">Âà§Êñ≠ÊòØÂê¶ÊúâËÆ∞Êé•Êî∂‰∫ÜÊ†áÊú¨</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">DHCLis</span><span class="p">(</span><span class="s2">&#34;ReceveFormOtherHis&#34;</span><span class="p">,</span><span class="n">Labno</span><span class="p">))</span> <span class="n">q</span> <span class="s2">&#34;-1^ËØ•Ê†áÊú¨Â∑≤ÁªèÊ†∏Êî∂&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="s2">&#34;&lt;Request&gt;&lt;ResultCode&gt;0&lt;/ResultCode&gt;&lt;ResultContent&gt;ÊàêÂäü&lt;/ResultContent&gt;&lt;Orders&gt;&lt;OrderList&gt;&lt;OrdID&gt;&lt;/OrdID&gt;&lt;LabNo&gt;1600904130&lt;/LabNo&gt;&lt;ArcimCode&gt;L002&lt;/ArcimCode&gt;&lt;ArcimDesc&gt;Ë°ÄÂ∏∏ËßÑ&lt;/ArcimDesc&gt;&lt;OrderQty&gt;1&lt;/OrderQty&gt;&lt;BillCode&gt;P&lt;/BillCode&gt;&lt;SpecimenTypeCode&gt;&lt;/SpecimenTypeCode&gt;&lt;SpecimenTypeDesc&gt;&lt;/SpecimenTypeDesc&gt;&lt;SpVolume&gt;&lt;/SpVolume&gt;&lt;ColInfo&gt;&lt;/ColInfo&gt;&lt;Container&gt;&lt;/Container&gt;&lt;GTSeq&gt;&lt;/GTSeq&gt;&lt;SpecFlag&gt;&lt;/SpecFlag&gt;&lt;VerifyDate&gt;2016-04-26&lt;/VerifyDate&gt;&lt;VerifyTime&gt;13:43:09&lt;/VerifyTime&gt;&lt;ColDate&gt;&lt;/ColDate&gt;&lt;ColTime&gt;&lt;/ColTime&gt;&lt;AppDeptCode&gt;&lt;/AppDeptCode&gt;&lt;AppDeptDesc&gt;‰ΩìÊ£ÄÁßë&lt;/AppDeptDesc&gt;&lt;RecDeptCode&gt;&lt;/RecDeptCode&gt;&lt;RecDeptDesc&gt;&lt;/RecDeptDesc&gt;&lt;TSPrice&gt;20&lt;/TSPrice&gt;&lt;OrderStatus&gt;E&lt;/OrderStatus&gt;&lt;DocCode&gt;&lt;/DocCode&gt;&lt;DocDesc&gt;&lt;/DocDesc&gt;&lt;RepLoct&gt;&lt;/RepLoct&gt;&lt;RepDate&gt;&lt;/RepDate&gt;&lt;RepTime&gt;&lt;/RepTime&gt;&lt;Note&gt;&lt;/Note&gt;&lt;AdmNo&gt;&lt;/AdmNo&gt;&lt;AdmDate&gt;2016-04-26&lt;/AdmDate&gt;&lt;AdmTime&gt;13:43:09&lt;/AdmTime&gt;&lt;AdmTypeCode&gt;&lt;/AdmTypeCode&gt;&lt;AdmTypeDesc&gt;‰ΩìÊ£Ä&lt;/AdmTypeDesc&gt;&lt;FeeType&gt;&lt;/FeeType&gt;&lt;PatientWard&gt;&lt;/PatientWard&gt;&lt;BedNo&gt;&lt;/BedNo&gt;&lt;Diagnose&gt;&lt;/Diagnose&gt;&lt;RegisterNo&gt;16009041&lt;/RegisterNo&gt;&lt;PatientName&gt;ÊµãËØïÔºàÁ´•Ôºâ&lt;/PatientName&gt;&lt;SexCode&gt;M&lt;/SexCode&gt;&lt;SexDesc&gt;Áî∑&lt;/SexDesc&gt;&lt;DOB&gt;1987-04-26&lt;/DOB&gt;&lt;Age&gt;29Â≤Å&lt;/Age&gt;&lt;DocumentID&gt;D16008409&lt;/DocumentID&gt;&lt;PatientAddress&gt;&lt;/PatientAddress&gt;&lt;IdentityCardNo&gt;&lt;/IdentityCardNo&gt;&lt;Telephone&gt;&lt;/Telephone&gt;&lt;SpecUserCode&gt;&lt;/SpecUserCode&gt;&lt;StartDate&gt;&lt;/StartDate&gt;&lt;StartTime&gt;&lt;/StartTime&gt;&lt;SendFlag&gt;NW&lt;/SendFlag&gt;&lt;/OrderList&gt;&lt;/Orders&gt;&lt;/Request&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">TSTART</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="n">retObj</span><span class="o">=</span><span class="c1">##Class(UtilsController.LIS.UtilsControllerHttpSoap12Endpoint).%New()</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="n">retObj</span><span class="o">.</span><span class="n">ReceiveLisOrdList</span><span class="p">(</span><span class="n">Labno</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="mi">20160818</span> <span class="n">yy</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="ne">Input</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">TMPLISORDINFOS</span><span class="p">(</span><span class="s2">&#34;LisOrdInfos&#34;</span><span class="p">,</span><span class="n">Labno</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">CurNamespace</span><span class="o">=$</span><span class="n">ZUTIL</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">WebNamespace</span><span class="o">=</span><span class="c1">##Class(OTH.SYSParameter).GetWebNamespace()</span>
</span></span><span class="line"><span class="cl">	<span class="n">NEW</span> <span class="o">$</span><span class="n">NAMESPACE</span> 
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="o">$</span><span class="n">NAMESPACE</span><span class="o">=</span> <span class="n">WebNamespace</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="c1">##Class(LISAPP.LIS.BLL.DHCReceiveInterface).GetLabNoInfoSFHIS(&#34;00000000613&#34;,&#34;0&#34;,&#34;dhcc&#34;) </span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="o">$</span><span class="n">NAMESPACE</span><span class="o">=</span> <span class="n">CurNamespace</span>
</span></span><span class="line"><span class="cl">	<span class="n">b</span> <span class="p">;</span><span class="n">a101</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(Input) q &#34;-1^Êú™Êü•ËØ¢Âà∞Ê†áÊú¨‰ø°ÊÅØÔºÅ&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">repid</span><span class="o">=$</span><span class="n">i</span><span class="p">(</span><span class="o">^</span><span class="n">CacheTemp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">k</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">100</span>
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="n">UncheckInfo</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="o">//</span><span class="err">Êú™Ê†∏Êî∂ÂåªÂò±‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">reader</span> <span class="o">=</span> <span class="c1">##class(%XML.Reader).%New()</span>
</span></span><span class="line"><span class="cl">    <span class="n">Do</span> <span class="n">reader</span><span class="o">.</span><span class="n">OpenString</span><span class="p">(</span><span class="ne">Input</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Do</span> <span class="n">reader</span><span class="o">.</span><span class="n">Correlate</span><span class="p">(</span><span class="s2">&#34;Request&#34;</span><span class="p">,</span><span class="s2">&#34;LIS.Service.ENS.Data.RequestOrderMsg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="p">;</span><span class="n">a102</span>
</span></span><span class="line"><span class="cl">    <span class="n">While</span> <span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">Next</span><span class="p">(</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span><span class="o">.</span><span class="n">sc</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span> <span class="n">ResultCode</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">ResultCode</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span> <span class="n">ResultContent</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">ResultContent</span>
</span></span><span class="line"><span class="cl">            <span class="n">i</span> <span class="p">(</span><span class="n">ResultCode</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objMldVis</span><span class="o">=</span><span class="c1">##Class(LIS.Model.RPVisitNumber).%New()</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">Counts</span><span class="o">=+</span><span class="n">obj</span><span class="o">.</span><span class="n">Orders</span><span class="o">.</span><span class="n">Count</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="p">(</span><span class="n">RegNo</span><span class="p">,</span><span class="n">AdmNo</span><span class="p">,</span><span class="n">AdmTypeCode</span><span class="p">,</span><span class="n">MedicalRecordNo</span><span class="p">,</span><span class="n">SpecimenTypeCode</span><span class="p">,</span><span class="n">AdmDate</span><span class="p">,</span><span class="n">AdmTime</span><span class="p">,</span><span class="n">PatName</span><span class="p">,</span><span class="n">SexCode</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="p">(</span><span class="n">DOB</span><span class="p">,</span><span class="n">Age</span><span class="p">,</span><span class="n">AppDeptCode</span><span class="p">,</span><span class="n">AppDeptDesc</span><span class="p">,</span><span class="n">DocCode</span><span class="p">,</span><span class="n">DocDesc</span><span class="p">,</span><span class="n">VerifyDate</span><span class="p">,</span><span class="n">VerifyTime</span><span class="p">,</span><span class="n">Diagnose</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="p">(</span><span class="n">Telephone</span><span class="p">,</span><span class="n">IdentityCardNo</span><span class="p">,</span><span class="n">PatientAddress</span><span class="p">,</span><span class="n">Note</span><span class="p">,</span><span class="n">ColDate</span><span class="p">,</span><span class="n">ColTime</span><span class="p">,</span><span class="n">SpecUserCode</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">err</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">f</span> <span class="n">tmpi</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="n">Counts</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">OrderList</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Orders</span><span class="o">.</span><span class="n">GetAt</span><span class="p">(</span><span class="n">tmpi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="o">//</span><span class="n">s</span> <span class="n">LabNo</span><span class="o">=</span><span class="n">OrderList</span><span class="o">.</span><span class="n">LabNo</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ArcimCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">ArcimCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">TSPrice</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">TSPrice</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="o">///</span><span class="err">Ëé∑Âèñ</span><span class="n">HISCodeÂÖ≥ËÅîÁ†ÅÂåªÂò±</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexHISCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(ArcimCode),&#34;&#34;))   //</span>
</span></span><span class="line"><span class="cl">                    <span class="o">///</span><span class="err">Ëé∑ÂèñÂåªÂò±‰ª£Á†ÅÂÖ≥ËÅî</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(TestSetDR) s TestSetDR=$o(^dbo.BTTestSetI(&#34;IndexCode&#34;,RecHospitalDR,##Class(LIS.Util.Common).IndexData(ArcimCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(TestSetDR) s err=&#34;-1^Ê£ÄÈ™åÂåªÂò±ÂØπÁÖßÈîôËØØÔºö&#34;_ArcimCode q</span>
</span></span><span class="line"><span class="cl">                    <span class="o">///</span><span class="err">Âà§Êñ≠ÂåªÂò±ÊòØÂê¶Ê†∏Êî∂</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno))){</span>
</span></span><span class="line"><span class="cl">	                       <span class="n">s</span> <span class="n">mVisitNumberDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">	                       <span class="n">s</span> <span class="n">RowID</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">mVisitNumberDR</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	                       <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">RowID</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		                       <span class="n">s</span> <span class="n">WGMDR</span><span class="o">=$</span><span class="n">LG</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetD</span><span class="p">(</span><span class="n">RowID</span><span class="p">)),</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		                       <span class="n">I</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">WGMDR</span><span class="p">)</span> <span class="k">continue</span>
</span></span><span class="line"><span class="cl">		                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">	                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="o">///</span><span class="err">Ê†∏Êî∂Âà§Êñ≠ÂåªÂò±ÊòØÂê¶Êú¨Â∑•‰ΩúÂ∞èÁªÑ</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>   
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">Reterr</span><span class="o">=</span><span class="c1">##Class(LIS.Service.ENS.TransReport).GetTSDefWGroupMiInfo(TestSetDR,WorkGroupMachineDR)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="n">Reterr</span><span class="s1">&#39;=0 s UncheckInfo=Reterr_&#34;,&#34;_UncheckInfo continue</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;RecTS&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">)</span><span class="o">=</span><span class="n">TSPrice</span>   <span class="o">//</span><span class="err">Êé•Êî∂ÂåªÂò±ÂàóË°®</span>
</span></span><span class="line"><span class="cl">                    
</span></span><span class="line"><span class="cl">                    <span class="o">//</span><span class="mi">20160818</span> <span class="n">yy</span>                   
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">OrderID</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">OrdID</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>                                        
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">SpecimenTypeCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">SpecimenTypeCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">RegNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">RegisterNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AdmTypeCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AdmTypeCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AdmNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AdmNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">MedicalRecordNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">DocumentID</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AdmDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AdmDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AdmTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AdmTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">PatName</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">PatientName</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">SexCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">SexCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="n">SexCode</span><span class="o">=</span><span class="s2">&#34;1&#34;</span> <span class="n">s</span> <span class="n">SexCode</span><span class="o">=</span><span class="s2">&#34;M&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="n">SexCode</span><span class="o">=</span><span class="s2">&#34;2&#34;</span> <span class="n">s</span> <span class="n">SexCode</span><span class="o">=</span><span class="s2">&#34;F&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">DOB</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">DOB</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>                   
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">Age</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">Age</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AppDeptCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AppDeptCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">AppDeptDesc</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">AppDeptDesc</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">DocCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">DocCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">DocDesc</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">DocDesc</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">VerifyDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">VerifyDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">VerifyTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">VerifyTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">Diagnose</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">Diagnose</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">Telephone</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">Telephone</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">IdentityCardNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">IdentityCardNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">PatientAddress</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">PatientAddress</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">Note</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">Note</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ColDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">ColDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ColTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">ColTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">SpecUserCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">SpecUserCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">BedNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderList</span><span class="o">.</span><span class="n">BedNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">err</span><span class="p">),</span><span class="n">err</span><span class="s1">&#39;=0 s RetValue=err q</span>
</span></span><span class="line"><span class="cl">                <span class="n">I</span> <span class="s1">&#39;$D(^TMP($zn,$j,repid,&#34;RecTS&#34;)),RecFlag=&#34;C&#34; s RetValue=&#34;Êó†ÂèØÊé•Êî∂ÂåªÂò±ÔºÅ&#34; q </span>
</span></span><span class="line"><span class="cl">                <span class="n">I</span> <span class="s1">&#39;$D(^TMP($zn,$j,repid,&#34;RecTS&#34;)),RecFlag=&#34;H&#34;,$l(UncheckInfo) s RetValue=&#34;Êú¨Â∑•‰ΩúÂ∞èÁªÑÊó†ÂèØÊ†∏Êî∂ÂåªÂò±,ËØ∑ÈÄÅËá≥&#34;_UncheckInfo_&#34;ÂÅöÊ£ÄÈ™å&#34; q </span>
</span></span><span class="line"><span class="cl">                <span class="n">I</span> <span class="s1">&#39;$D(^TMP($zn,$j,repid,&#34;RecTS&#34;)),RecFlag=&#34;H&#34; s RetValue=&#34;Êó†ÂèØÊ†∏Êî∂ÂåªÂò±ÔºÅ&#34; q </span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="s2">&#34;YY&#34;</span><span class="p">,</span><span class="s2">&#34;age&#34;</span><span class="p">)</span><span class="o">=</span><span class="n">Age</span>
</span></span><span class="line"><span class="cl">                <span class="o">///</span><span class="err">‰øùÂ≠òÊ†áÊú¨‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno))) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">VisitNumberDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumber).%OpenId(VisitNumberDR)</span>
</span></span><span class="line"><span class="cl">                <span class="n">e</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumber).%New()</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">VisitNumber</span><span class="o">=</span><span class="n">Labno</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RegNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">RegNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">///</span><span class="err">Â∞±ËØäÁ±ªÂûã</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">AdmissionTypeDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="s1">&#39;$l(AdmTypeCode) s AdmTypeCode=&#34;P&#34;  //ÈªòËÆ§‰ΩìÊ£Ä</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AdmTypeCode</span><span class="p">)</span> <span class="n">s</span> <span class="n">AdmissionTypeDR</span><span class="o">=</span><span class="c1">##Class(HIS.DHCReceiveProcess).GetAdmissionTypeDR(AdmTypeCode)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AdmissionTypeDR</span><span class="o">=</span><span class="n">AdmissionTypeDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AdmNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">AdmNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">;</span><span class="mi">20160819</span> <span class="n">yy</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">MedicalRecordNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">MedicalRecordNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">AdmDate</span><span class="p">)</span> <span class="n">s</span> <span class="n">AdmDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">AdmDate</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AdmTime</span><span class="p">)</span> <span class="n">s</span> <span class="n">AdmTime</span><span class="o">=$</span><span class="n">zth</span><span class="p">(</span><span class="n">AdmTime</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AdmDate</span><span class="o">=</span><span class="n">AdmDate</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AdmTime</span><span class="o">=</span><span class="n">AdmTime</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CertTypeDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">CertTypeDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CertNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">CertNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">IDNumber</span><span class="o">=</span><span class="n">IdentityCardNo</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PaymentTypeDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PaymentTypeDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SurName</span><span class="o">=</span><span class="n">PatName</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">GivenName</span><span class="o">=</span><span class="n">PatName</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">SpeciesDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTSpeciesI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(SexCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpeciesDR</span><span class="o">=</span><span class="n">SpeciesDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">DOB</span><span class="p">)</span> <span class="n">s</span> <span class="n">DOB</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">DOB</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">BirthTime</span><span class="p">)</span> <span class="n">s</span> <span class="n">BirthTime</span><span class="o">=$</span><span class="n">zth</span><span class="p">(</span><span class="n">BirthTime</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BirthDate</span><span class="o">=</span><span class="n">DOB</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BirthTime</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="n">AgeUnitDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">Age</span><span class="p">[</span><span class="s2">&#34;Â≤Å&#34;</span> <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;Y&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">Age</span><span class="p">[</span><span class="s2">&#34;Êúà&#34;</span> <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;M&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">Age</span><span class="p">[</span><span class="s2">&#34;Â§©&#34;</span> <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;D&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">Age</span><span class="p">[</span><span class="s2">&#34;Êó∂&#34;</span> <span class="n">s</span> <span class="n">AgeCode</span><span class="o">=</span><span class="s2">&#34;H&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AgeCode</span><span class="p">)</span> <span class="n">s</span> <span class="n">AgeUnitDR</span><span class="o">=</span><span class="c1">##Class(HIS.DHCReceiveProcess).GetAgeUnitDR(AgeCode)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Age</span><span class="o">=+</span><span class="n">Age</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AgeUnitDR</span><span class="o">=</span><span class="n">AgeUnitDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">EthnicityDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">EthnicityDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">HospitalDR</span><span class="o">=</span><span class="n">RecHospitalDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">LocationDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTLocationI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(AppDeptCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">LocationDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AppDeptCode</span><span class="p">)</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTLocationI</span><span class="p">(</span><span class="s2">&#34;IndexHISCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(AppDeptCode))) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">LocationDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTLocationI</span><span class="p">(</span><span class="s2">&#34;IndexHISCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(AppDeptCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.//</span><span class="err">Ê≤°ÊúâÈÖçÂ§ñÈÉ®‰ª£Á†ÅÔºåËÄÉËôëÊòØÂê¶Ëá™Âä®ÊèíÂÖ•</span>
</span></span><span class="line"><span class="cl">                <span class="o">.//</span><span class="n">i</span> <span class="s1">&#39;$l(LocationDR) s LocationDR=##Class(HIS.DHCReceiveProcess).GetLocationDR(AppDeptCode,AppDeptCode,AppDeptDesc,RecHospitalDR)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">LocationDR</span><span class="o">=</span><span class="n">LocationDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">DoctorDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">DocCode</span><span class="p">)</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTDoctorI</span><span class="p">(</span><span class="s2">&#34;IndexHISCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(DocCode))) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">DoctorDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTDoctorI</span><span class="p">(</span><span class="s2">&#34;IndexHISCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(DocCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.//</span><span class="err">Ê≤°ÊúâÈÖçÂ§ñÈÉ®‰ª£Á†ÅÔºåËÄÉËôëÊòØÂê¶Ëá™Âä®ÊèíÂÖ•</span>
</span></span><span class="line"><span class="cl">                <span class="o">.//</span><span class="n">i</span> <span class="s1">&#39;$l(DoctorDR) s DoctorDR=##Class(HIS.DHCReceiveProcess).GetDoctorDR(DocCode,DocDesc,RecHospitalDR)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">DoctorDR</span><span class="o">=</span><span class="n">DoctorDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">VerifyDate</span><span class="p">)</span> <span class="n">s</span> <span class="n">VerifyDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">VerifyDate</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">VerifyTime</span><span class="p">)</span> <span class="n">s</span> <span class="n">VerifyTime</span><span class="o">=$</span><span class="n">zth</span><span class="p">(</span><span class="n">VerifyTime</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RequestDate</span><span class="o">=</span><span class="n">VerifyDate</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RequestTime</span><span class="o">=</span><span class="n">VerifyTime</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">WardDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">WardDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BedNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">BedNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Symptom</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">Diagnose</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">MobileNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">MobileNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PhoneNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">Telephone</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">EMail</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">EMail</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Height</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Height</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Weight</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Weight</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BloodPressure</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">BloodPressure</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ClinicalConditionsDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ClinicalConditionsDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">LMPDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">LMPDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">Preg</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">zcvt</span><span class="p">(</span><span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Pregnant</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span><span class="s2">&#34;U&#34;</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;TRUE&#34;</span> <span class="n">s</span> <span class="n">Preg</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Pregnant</span><span class="o">=</span><span class="n">Preg</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PregnantWeeks</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PregnantWeeks</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AboDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">AboDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RhDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">RhDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Address</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">PatientAddress</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PostCode</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PostCode</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">InfectFlag</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">InfectFlag</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">Infect</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">zcvt</span><span class="p">(</span><span class="n">InfectFlag</span><span class="p">,</span><span class="s2">&#34;U&#34;</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;TRUE&#34;</span> <span class="n">s</span> <span class="n">Infect</span><span class="o">=</span><span class="mi">1</span>             
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">InfectFlag</span><span class="o">=</span><span class="n">Infect</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">InfectAlert</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">InfectAlert</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">SpecialFlag</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">SpecialFlag</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">Special</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">zcvt</span><span class="p">(</span><span class="n">SpecialFlag</span><span class="p">,</span><span class="s2">&#34;U&#34;</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;TRUE&#34;</span> <span class="n">s</span> <span class="n">Special</span><span class="o">=</span><span class="mi">1</span> 
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecialFlag</span><span class="o">=</span><span class="n">Special</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">PregnantNum</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">PregnantNum</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ChildbirthNum</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ChildbirthNum</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="mi">20160823</span> <span class="n">yy</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReqNotes</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">Note</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReqNotes</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">OrderID</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BedNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">BedNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RequestNo</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">RequestNo</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">Urgent</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Urgent</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">UrgentFlag</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">zcvt</span><span class="p">(</span><span class="n">Urgent</span><span class="p">,</span><span class="s2">&#34;U&#34;</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;TRUE&#34;</span> <span class="n">s</span> <span class="n">UrgentFlag</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Urgent</span><span class="o">=</span><span class="n">UrgentFlag</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">L</span><span class="p">(</span><span class="n">ColDate</span><span class="p">)</span> <span class="n">s</span> <span class="n">ColDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">ColDate</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">ColTime</span><span class="p">),(</span><span class="n">ColTime</span><span class="p">[</span><span class="s2">&#34;:&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">ColTime</span><span class="o">=$</span><span class="n">zth</span><span class="p">(</span><span class="n">ColTime</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">ColDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">ColTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectUserDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">CollectUserDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AnatomicalSiteDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">AnatomicalSiteDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectPositon</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">CollectPositon</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">SpecimenDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTSpecimenI</span><span class="p">(</span><span class="s2">&#34;IndexCode&#34;</span><span class="p">,</span><span class="n">RecHospitalDR</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(SpecimenTypeCode),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenDR</span><span class="o">=</span><span class="n">SpecimenDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ContainerDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CollectNotes</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">H24UVolume</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">H24UTimePeriod</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">BodyTemp</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">Confidential</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryTime</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryUserDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;C&#34;</span><span class="p">)</span> <span class="n">d</span> <span class="o">///</span><span class="err">ÈõÜ‰∏≠Êé•Êî∂</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveTime</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveUserDR</span><span class="o">=</span><span class="n">UserDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">CarryUserDR</span><span class="p">),</span><span class="s1">&#39;$l(objVisitNumber.CarryUserDR) d</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryDate</span> <span class="o">=</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryTime</span> <span class="o">=</span> <span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">..</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">CarryUserDR</span> <span class="o">=</span> <span class="n">CarryUserDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveNotes</span><span class="o">=</span><span class="n">ReceiveNotes</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">SpecimenQualityDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">SpecimenQualityDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span><span class="p">)</span> <span class="n">d</span> <span class="o">///</span><span class="err">Ê†áÊú¨Ê†∏Êî∂</span> <span class="err">Â¶ÇÊûúÂ≠óÊÆµ‰∏∫Á©∫</span> 
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveTime</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveUserDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveUserDR</span><span class="o">=</span><span class="n">UserDR</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ReceiveHospitalDR</span><span class="o">=</span><span class="n">RecHospitalDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">InStorageTime</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">InStorageUserDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">OutStorageTime</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">OutStorageUserDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">OutStorageType</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="s1">&#39;=&#34;S&#34;) d ///ÊãíÊî∂‰øùÂ≠ò‰∏ç‰øùÂ≠òÊó∂Èó¥</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">AddDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">AddTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">AddUserDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddUserDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(AddDate) s AddDate=$tr($zd(+$h,3),&#34;-&#34;)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(AddTime) s AddTime=$p($h,&#34;,&#34;,2)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(AddUserDR) s AddUserDR=UserDR</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddDate</span><span class="o">=</span><span class="n">AddDate</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddTime</span><span class="o">=</span><span class="n">AddTime</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddUserDR</span><span class="o">=</span><span class="n">AddUserDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">AddType</span><span class="o">=</span><span class="s2">&#34;3&#34;</span>       <span class="o">///</span><span class="mi">1</span><span class="err">Êù°Á†Å</span><span class="p">,</span><span class="mi">2</span><span class="err">ÊâãÂ∑•</span><span class="p">,</span><span class="mi">3</span><span class="err">Á¨¨‰∏âÊñπ</span><span class="p">,</span><span class="mi">4</span><span class="err">ÂÖ∂ÂÆÉ</span><span class="p">(</span><span class="err">ÊãíÊî∂‰øùÂ≠ò</span><span class="p">)</span>                
</span></span><span class="line"><span class="cl">                <span class="p">;</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RequestNo</span><span class="o">=</span><span class="n">OrderID</span>
</span></span><span class="line"><span class="cl">             	<span class="n">i</span> <span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;A&#34;</span> <span class="n">D</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">ArriveDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveDate</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">ArriveTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveTime</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">ArriveUserDR</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveUserDR</span><span class="p">,</span><span class="o">$</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(ArriveDate) s ArriveDate=$tr($zd(+$h,3),&#34;-&#34;)</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(ArriveTime) s ArriveTime=$p($h,&#34;,&#34;,2)</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(ArriveUserDR) s ArriveUserDR=UserDR</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveWorkGroupDR</span><span class="o">=</span><span class="n">WorkGroupDR</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveDate</span><span class="o">=</span><span class="n">ArriveDate</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveTime</span><span class="o">=</span><span class="n">ArriveTime</span>
</span></span><span class="line"><span class="cl">				<span class="o">.</span><span class="n">s</span> <span class="n">objVisitNumber</span><span class="o">.</span><span class="n">ArriveUserDR</span><span class="o">=</span><span class="n">ArriveUserDR</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">sc</span><span class="o">=</span><span class="n">objVisitNumber</span><span class="o">.%</span><span class="n">Save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">;</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">VisitNumberDR</span><span class="o">=</span><span class="n">objVisitNumber</span><span class="o">.</span><span class="n">RowID</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">Else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^Ê†áÊú¨‰ø°ÊÅØ‰øùÂ≠òÂ§±Ë¥•:&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">GetErrorText</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">;</span><span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">RetValue</span><span class="s1">&#39;=0 q</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">err</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">IsReceived</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">f</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;RecTS&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">                    <span class="n">q</span><span class="p">:</span><span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">TestSetFee</span><span class="o">=+$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;RecTS&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">RowID</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">RowID</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumberTestSet).%OpenId(RowID)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumberTestSet).%New()</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">Recieved</span><span class="s1">&#39;=1  s IsReceived=0</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">VisitNumberDR</span><span class="o">=</span><span class="n">VisitNumberDR</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">TestSetDR</span><span class="o">=</span><span class="n">TestSetDR</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">Recieved</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(AssayNo),$l(WorkGroupMachineDR)   {</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">CommDirection</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTWorkGroupMachineD</span><span class="p">(</span><span class="n">WorkGroupMachineDR</span><span class="p">),</span><span class="mi">11</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="n">CommDirection</span><span class="o">=</span><span class="s2">&#34;UP&#34;</span> <span class="n">s</span> <span class="n">AssayNo</span><span class="o">=</span><span class="n">Labno</span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="n">CommDirection</span><span class="o">=</span><span class="s2">&#34;BI&#34;</span> <span class="n">s</span> <span class="n">AssayNo</span><span class="o">=</span><span class="n">Labno</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">WorkGroupMachineDR</span><span class="o">=</span><span class="n">WorkGroupMachineDR</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">TransmitDate</span><span class="o">=</span><span class="n">TransmitDate</span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="s1">&#39;$l(AssayNo) s AssayNo=EpisodeNo </span>
</span></span><span class="line"><span class="cl">                        <span class="n">i</span> <span class="s1">&#39;$l(AssayNo) s AssayNo=Labno</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">AssayNo</span><span class="o">=</span><span class="n">AssayNo</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">TestSetFee</span><span class="o">=</span><span class="n">TestSetFee</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">HISOrderID</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">Sequence</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">sc</span><span class="o">=</span><span class="n">objTestSets</span><span class="o">.%</span><span class="n">Save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">                        <span class="o">//</span><span class="err">Êõ¥Êñ∞‰∏ä‰º†ËÆ∞ÂΩï</span>
</span></span><span class="line"><span class="cl">                        <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="c1">##Class(MI.MachineUpload).Upload(Labno,TestSetDR,WorkGroupMachineDR)</span>
</span></span><span class="line"><span class="cl">                     <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Else</span> <span class="p">{</span><span class="n">s</span> <span class="n">err</span><span class="o">=$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">GetErrorText</span><span class="p">(</span><span class="n">sc</span><span class="p">)}</span>        
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;C&#34;</span><span class="p">,</span><span class="n">IsReceived</span><span class="o">=</span><span class="mi">1</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^Ê†áÊú¨Â∑≤Êé•Êî∂&#34;</span> <span class="n">q</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^Ê£ÄÈ™åÂåªÂò±‰øùÂ≠òÂ§±Ë¥•:&#34;</span><span class="n">_err</span> <span class="n">q</span>
</span></span><span class="line"><span class="cl">                <span class="o">///</span><span class="err">Êä•ÂëäÊ†∏Êî∂</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span><span class="p">){</span> 
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumberReport).%New()</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">VisitNumberDR</span><span class="o">=</span><span class="n">VisitNumberDR</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">TransmitDate</span><span class="o">=</span><span class="n">TransmitDate</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">WorkGroupMachineDR</span><span class="o">=</span><span class="n">WorkGroupMachineDR</span>   
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">OrderNo</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(AssayNo) s AssayNo=EpisodeNo </span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="s1">&#39;$l(AssayNo) s AssayNo=Labno</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AssayNo</span><span class="o">=</span><span class="n">AssayNo</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AccessionNo</span><span class="o">=</span><span class="s2">&#34;&#34;</span>   <span class="o">///</span><span class="err">ÁªÜËèåÂàÜÁ¶ªÂè∑</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">EpisodeNo</span><span class="o">=</span><span class="n">EpisodeNo</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AcceptDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AcceptTime</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">AcceptUserDR</span><span class="o">=</span><span class="n">UserDR</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">Status</span><span class="o">=</span><span class="mi">1</span>  <span class="o">//</span><span class="err">Êä•ÂëäÁä∂ÊÄÅ</span><span class="p">(</span><span class="mi">1</span><span class="err">ÁôªËÆ∞Ôºå</span><span class="mi">2</span><span class="err">ÂàùÂÆ°Ôºå</span><span class="mi">3</span><span class="err">ÂÆ°Ê†∏Ôºå</span><span class="mi">4</span><span class="err">Â§çÊü•Ôºå</span><span class="mi">5</span><span class="err">ÂèñÊ∂àÂÆ°Ê†∏Ôºå</span><span class="mi">6</span><span class="err">‰ΩúÂ∫üÔºå</span><span class="n">OÂÖ∂‰ªñ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">RackNo</span><span class="o">=</span><span class="n">RackNo</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="n">objVisitNumberReport</span><span class="o">.%</span><span class="n">Save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span> <span class="p">{</span><span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="mi">0</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Else</span> <span class="p">{</span><span class="n">s</span> <span class="n">err</span><span class="o">=</span><span class="s2">&#34;Ê†áÊú¨‰ø°ÊÅØÊ†∏Êî∂Â§±Ë¥•:&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">GetErrorText</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="n">Quit</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	                <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	                <span class="n">f</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="o">$</span><span class="n">zn</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="s2">&#34;RecTS&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">))</span> <span class="o">//</span><span class="err">Êú¨Ê¨°Ê†∏Êî∂ÂåªÂò±</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">q</span><span class="p">:</span><span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">s</span> <span class="n">RowID</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	                    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">RowID</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	                         <span class="n">s</span> <span class="n">objTestSets</span><span class="o">=</span><span class="c1">##class(dbo.RPVisitNumberTestSet).%OpenId(RowID)</span>
</span></span><span class="line"><span class="cl">	                         <span class="n">s</span> <span class="n">objTestSets</span><span class="o">.</span><span class="n">VisitNumberReportDR</span><span class="o">=</span><span class="n">objVisitNumberReport</span><span class="o">.</span><span class="n">RowID</span>
</span></span><span class="line"><span class="cl">	                         <span class="n">s</span> <span class="n">sc</span><span class="o">=</span><span class="n">objTestSets</span><span class="o">.%</span><span class="n">Save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		                     <span class="n">If</span> <span class="p">(</span><span class="s1">&#39;$SYSTEM.Status.IsOK(sc)) {</span>
</span></span><span class="line"><span class="cl">		                       <span class="n">s</span> <span class="n">err</span><span class="o">=$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">GetErrorText</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span> <span class="n">q</span> 
</span></span><span class="line"><span class="cl">		                     <span class="p">}</span>    
</span></span><span class="line"><span class="cl">	                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">	                    <span class="o">//</span><span class="err">ÊåâÂåªÂò±ÁîüÊàêÊä•ÂëäÈ°πÁõÆÁªìÊûú</span>
</span></span><span class="line"><span class="cl">						<span class="n">s</span> <span class="n">retVal</span><span class="o">=</span><span class="c1">##Class(LISSP.DHCRPVisitNumberReport).SaveReportTestCode(objVisitNumberReport.RowID,TestSetDR)</span>
</span></span><span class="line"><span class="cl">						<span class="n">i</span> <span class="n">retVal</span><span class="s1">&#39;=1 s err=retVal q </span>
</span></span><span class="line"><span class="cl">	                 <span class="p">}</span> 
</span></span><span class="line"><span class="cl">	                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^Ê£ÄÈ™åÂåªÂò±‰øùÂ≠òÂ§±Ë¥•:&#34;</span><span class="n">_err</span> <span class="n">q</span>
</span></span><span class="line"><span class="cl">                    <span class="o">//</span><span class="err">Êõ¥Êñ∞Â∑•‰ΩúÂ∞èÁªÑÊµÅÊ∞¥Âè∑</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">CurDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">WorkGroupMachineDR</span><span class="p">),</span><span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">EpisodeNo</span><span class="p">)</span> <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="c1">##Class(HIS.DHCCommon).SaveWorkGroupMachineEpis(WorkGroupMachineDR,CurDate,EpisodeNo)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">i</span> <span class="n">ret</span><span class="s1">&#39;=1,err=&#34;Êõ¥Êñ∞Â∑•‰ΩúÂ∞èÁªÑÊµÅÊ∞¥Âè∑Â§±Ë¥•:&#34;_ret Quit</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^&#34;</span><span class="n">_err</span> <span class="n">q</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="o">///</span><span class="err">ÊèíÂÖ•Ê†áÊú¨Ê†∏Êî∂Êìç‰ΩúËÆ∞ÂΩï</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="p">(</span><span class="n">OperateDate</span><span class="p">,</span><span class="n">OperateTime</span><span class="p">,</span><span class="n">OperateTypeCode</span><span class="p">,</span><span class="n">OperateNotes</span><span class="p">,</span><span class="n">RejectTypeDR</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">OperateNotes</span><span class="o">=</span><span class="n">ReceiveNotes</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;A&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">OperateTypeCode</span><span class="o">=</span><span class="mi">30</span>  <span class="o">//</span><span class="err">ÈÄÅËææ</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;S&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">OperateTypeCode</span><span class="o">=</span><span class="mi">31</span>  <span class="o">///</span><span class="err">‰øùÂ≠ò</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;C&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">OperateTypeCode</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">OperateNotes</span><span class="o">=</span><span class="n">OperIP</span>  <span class="o">///</span><span class="err">Êé•Êî∂</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="p">(</span><span class="n">RecFlag</span><span class="o">=</span><span class="s2">&#34;H&#34;</span><span class="p">)</span> <span class="n">s</span> <span class="n">OperateTypeCode</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">OperateNotes</span><span class="o">=</span><span class="n">OperIP</span>  <span class="o">///</span><span class="err">Ê†∏Êî∂</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="c1">##Class(HIS.DHCCommon).SaveRecord(VisitNumberDR,OperateDate, OperateTime, UserDR, OperateNotes, OperateTypeCode, WorkGroupMachineDR, RejectTypeDR,WorkGroupDR,OperIP)</span>
</span></span><span class="line"><span class="cl">                    
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">ret</span><span class="s1">&#39;=1  s RetValue=&#34;Ê†áÊú¨Êìç‰ΩúËÆ∞ÂΩï‰øùÂ≠òÂ§±Ë¥•:&#34;_ret q</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">Else</span> 
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Quit</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">If</span> <span class="o">$</span><span class="n">system</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsError</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span> <span class="n">TROLLBACK</span>  <span class="n">q</span> <span class="s2">&#34;-1^ÂèÇÊï∞ÈîôËØØÔºö&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">system</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsError</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">If</span> <span class="n">RetValue</span><span class="s1">&#39;=0 TROLLBACK  q RetValue</span>
</span></span><span class="line"><span class="cl">    <span class="n">TCOMMIT</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">UncheckInfo</span><span class="p">)</span> <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="n">RetValue_</span><span class="s2">&#34;UncheckInfo&#34;</span><span class="n">_UncheckInfo</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="p">;</span><span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">    <span class="n">Q</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">ErrorHandle</span>
</span></span><span class="line"><span class="cl">    <span class="n">TROLLBACK</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RetValue</span><span class="o">=</span><span class="s2">&#34;-1^ÈîôËØØ&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">ZERROR</span><span class="p">,</span><span class="s2">&#34;^&#34;</span><span class="p">,</span><span class="s2">&#34;--&#34;</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34;.ÈîôËØØ‰ª£Á†Å:&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">ECODE</span>
</span></span><span class="line"><span class="cl">    <span class="n">Quit</span> <span class="n">RetValue</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">GetTSDefWGroupMi</span><span class="p">(</span><span class="n">TestSetDR</span><span class="p">,</span> <span class="n">WorkGroupMachineDR</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">defWGMachineDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetD</span><span class="p">(</span><span class="n">TestSetDR</span><span class="p">),</span><span class="mi">13</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">defWGMachineDR</span><span class="p">),</span><span class="n">defWGMachineDR</span><span class="o">=</span><span class="n">WorkGroupMachineDR</span> <span class="n">s</span> <span class="n">RecTSDR</span><span class="o">=</span><span class="n">TestSetDR</span> <span class="n">q</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">WorkGroupMachineFlag</span><span class="o">=</span><span class="mi">100</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">tsWGMachineDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">f</span>  <span class="n">s</span> <span class="n">tsWGMachineDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetWorkGroupMachineI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">,</span><span class="n">tsWGMachineDR</span><span class="p">))</span> <span class="n">q</span><span class="p">:</span><span class="n">tsWGMachineDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="n">WorkGroupMachineDR</span><span class="o">=</span><span class="n">tsWGMachineDR</span> <span class="n">s</span> <span class="n">WorkGroupMachineFlag</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">defWGMachineDR</span><span class="o">=</span><span class="n">tsWGMachineDR</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="n">WorkGroupMachineFlag</span><span class="o">=</span><span class="mi">100</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">TSName</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetD</span><span class="p">(</span><span class="n">TestSetDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">),</span><span class="n">WorGPMIName</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">defWGMachineDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">WorGPMIName</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTWorkGroupMachineD</span><span class="p">(</span><span class="n">defWGMachineDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">WorkGroupMachineFlag</span><span class="o">=</span><span class="s2">&#34;-1^ËØ•Ê†áÊú¨‰∏∫:[ &#34;</span><span class="n">_WorGPMIName_</span><span class="s2">&#34; ]ÁöÑ[ &#34;</span><span class="n">_TSName_</span><span class="s2">&#34; ]Ê£ÄÈ™å,ËØ∑ÈÄÅÂà∞&#34;</span><span class="n">_WorGPMIName_</span><span class="s2">&#34;ÂÅöÁõ∏ÂÖ≥Ê£ÄÈ™å!&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span> <span class="n">WorkGroupMachineFlag</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">GetTSDefWGroupMiInfo</span><span class="p">(</span><span class="n">TestSetDR</span><span class="p">,</span> <span class="n">WorkGroupMachineDR</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">defWGMachineDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetD</span><span class="p">(</span><span class="n">TestSetDR</span><span class="p">),</span><span class="mi">13</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">defWGMachineDR</span><span class="p">),</span><span class="n">defWGMachineDR</span><span class="o">=</span><span class="n">WorkGroupMachineDR</span> <span class="n">s</span> <span class="n">RecTSDR</span><span class="o">=</span><span class="n">TestSetDR</span> <span class="n">q</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">WorkGroupMachineFlag</span><span class="o">=</span><span class="mi">100</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">tsWGMachineDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">f</span>  <span class="n">s</span> <span class="n">tsWGMachineDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetWorkGroupMachineI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">,</span><span class="n">tsWGMachineDR</span><span class="p">))</span> <span class="n">q</span><span class="p">:</span><span class="n">tsWGMachineDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="n">WorkGroupMachineDR</span><span class="o">=</span><span class="n">tsWGMachineDR</span> <span class="n">s</span> <span class="n">WorkGroupMachineFlag</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(defWGMachineDR) s defWGMachineDR=tsWGMachineDR		//YHR 20240408 Â¶ÇÊûúÊ≤°ÊúâÈªòËÆ§Â∑•‰ΩúÂ∞èÁªÑÔºåÂàôËÆæÁΩÆÂåªÂò±ÊâÄÂú®ÁöÑÂ∑•‰ΩúÂ∞èÁªÑ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="n">WorkGroupMachineFlag</span><span class="o">=</span><span class="mi">100</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">TSName</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetD</span><span class="p">(</span><span class="n">TestSetDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">),</span><span class="n">WorGPMIName</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">defWGMachineDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">WorGPMIName</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTWorkGroupMachineD</span><span class="p">(</span><span class="n">defWGMachineDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">WorkGroupMachineFlag</span><span class="o">=</span><span class="s2">&#34;„Äê&#34;</span><span class="n">_WorGPMIName_</span><span class="s2">&#34; „ÄëÁöÑ[ &#34;</span><span class="n">_TSName_</span><span class="s2">&#34; ]&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span> <span class="n">WorkGroupMachineFlag</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Creator</span><span class="err">Ôºö</span>        <span class="n">liuzf</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">CreateDate</span><span class="err">Ôºö</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">08</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Description</span><span class="err">Ôºö</span>    <span class="err">ÂèëÈÄÅÊé•Êî∂Ê†áÊú¨‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Table</span><span class="err">Ôºö</span>          <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="ne">Input</span><span class="err">Ôºö</span>          <span class="n">Labno</span><span class="p">:</span><span class="err">Ê£ÄÈ™åÂè∑</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Output</span><span class="err">Ôºö</span>     <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Return</span><span class="err">Ôºö</span>     <span class="err">ÈîôËØØ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Others</span><span class="err">Ôºö</span>     <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span>     <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).AcceptSample(&#34;**4868149*&#34;) //T1400472||R006||1</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">AcceptSample</span><span class="p">(</span><span class="n">Labno</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="n">Labno</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">Labno</span><span class="p">)</span>   <span class="o">//</span><span class="err">Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™Êä•Âëä</span><span class="n">ID</span><span class="p">,</span><span class="err">Âü∫Êú¨‰ø°ÊÅØ‰ª•Á¨¨‰∏Ä‰∏™Êä•Âëä‰∏∫ÂáÜ</span>
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="n">error</span><span class="o">=</span><span class="s2">&#34;Êä•ÂëäIDÈîôËØØ:&#34;</span><span class="n">_Labno</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">VisitNumberDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(VisitNumberDR) q error</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">VisitNumberData</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberD</span><span class="p">(</span><span class="n">VisitNumberDR</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">   <span class="n">b</span> <span class="p">;</span><span class="mi">0003</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">recdate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">66</span><span class="p">)</span>   <span class="p">;</span><span class="err">Êé•Êî∂Êó•Êúü</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">rectime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">67</span><span class="p">)</span>   <span class="p">;</span><span class="err">Êé•Êî∂Êó∂Èó¥</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">recdate</span><span class="p">)</span> <span class="n">s</span> <span class="n">recdate</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).FormatDate(recdate)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">rectime</span><span class="p">)</span> <span class="n">s</span> <span class="n">rectime</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).FormatTime(rectime)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">ReceiveUserDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">68</span><span class="p">),</span><span class="n">recusr</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">ReceiveUserDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">recusr</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">SYSUserD</span><span class="p">(</span><span class="n">ReceiveUserDR</span><span class="p">)),</span><span class="mi">2</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34;@&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">SYSUserD</span><span class="p">(</span><span class="n">ReceiveUserDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="n">peID</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>  <span class="p">;</span><span class="err">ÁôªËÆ∞Âè∑</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(peID) s peID=$lg(VisitNumberData,6)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">requestNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">48</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="n">S</span> <span class="n">xml</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">;</span><span class="n">S</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;Request&gt;&lt;Header&gt;&lt;SourceSystem&gt;&lt;/SourceSystem&gt;&lt;MessageID&gt;&lt;/MessageID&gt;&lt;/Header&gt;&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">;</span><span class="n">S</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;Body&gt;&lt;SpecimenReceiveRt&gt;&lt;OrderItemIDs&gt;&#34;</span>  
</span></span><span class="line"><span class="cl">   <span class="n">S</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;Request&gt;&lt;SourceSystem&gt;&lt;/SourceSystem&gt;&lt;MessageID&gt;&lt;/MessageID&gt;&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">S</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;SpecimenReceiveRt&gt;&lt;OrderItemIDs&gt;&#34;</span>     
</span></span><span class="line"><span class="cl">   <span class="n">S</span> <span class="n">orderID</span><span class="o">=</span><span class="n">requestNo</span>
</span></span><span class="line"><span class="cl">   <span class="n">b</span> <span class="p">;</span><span class="n">requestNo</span>
</span></span><span class="line"><span class="cl">   <span class="n">S</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;OrderItemID&gt;&#34;</span><span class="n">_orderID_</span><span class="s2">&#34;&lt;/OrderItemID&gt;&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">S</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;/OrderItemIDs&gt;&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">S</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;SpecimenID&gt;&#34;</span><span class="n">_Labno_</span><span class="s2">&#34;&lt;/SpecimenID&gt;&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">S</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;ExecUserCode&gt;&#34;</span><span class="n">_recusr_</span><span class="s2">&#34;&lt;/ExecUserCode&gt;&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">S</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;SpeciReceiveDate&gt;&#34;</span><span class="n">_recdate_</span><span class="s2">&#34;&lt;/SpeciReceiveDate&gt;&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">S</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;SpeciReceiveTime&gt;&#34;</span><span class="n">_rectime_</span><span class="s2">&#34;&lt;/SpeciReceiveTime&gt;&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;/SpecimenReceiveRt&gt;&lt;/Request&gt;&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">;</span><span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;/SpecimenReceiveRt&gt;&lt;/Body&gt;&lt;/Request&gt;&#34;</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="o">^</span><span class="n">TMPENSREPORT</span><span class="p">(</span><span class="s2">&#34;AC&#34;</span><span class="p">,</span><span class="n">Labno</span><span class="p">)</span><span class="o">=</span><span class="n">xml</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="p">;</span><span class="mi">003</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">$</span><span class="n">NameSpace</span><span class="o">=</span><span class="s2">&#34;DHC-APP&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">S</span> <span class="k">return</span><span class="o">=</span><span class="c1">##class(web.DHCENS.EnsHISService).DHCHisInterface(&#34;S00000044&#34;,xml)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">e</span><span class="p">(</span><span class="k">return</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span> <span class="n">s</span> <span class="k">return</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="k">return</span><span class="p">,</span><span class="s2">&#34;^&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">S</span> <span class="k">return</span><span class="o">=</span><span class="c1">##class(web.DHCENS.EnsHISService).DHCHisInterface(&#34;W00000009&#34;,xml)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">$</span><span class="n">NameSpace</span><span class="o">=</span><span class="s2">&#34;DHC-LISDATA&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">S</span> <span class="n">ws</span><span class="o">=</span><span class="c1">##Class(LIS.Service.ENS.WS.WebService).%New()</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">S</span> <span class="k">return</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">SendCheckUp</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Q</span> <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Creator</span><span class="err">Ôºö</span>        <span class="n">wwh</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">CreateDate</span><span class="err">Ôºö</span> <span class="mi">2014</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">17</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Description</span><span class="err">Ôºö</span>    <span class="err">ÂèëÈÄÅÊãíÊî∂Ê†áÊú¨‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Table</span><span class="err">Ôºö</span>          <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="ne">Input</span><span class="err">Ôºö</span>          <span class="n">reportIDs</span><span class="p">:</span><span class="err">Êä•Âëä</span><span class="n">ID</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Output</span><span class="err">Ôºö</span>     <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Return</span><span class="err">Ôºö</span>     <span class="err">ÈîôËØØ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Others</span><span class="err">Ôºö</span>     <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span>     <span class="c1">##Class(LIS.Service.ENS.Report).RejectSample(labno,rejUserID,rejDate,rejTime,rejReason)</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">RejectSample</span><span class="p">(</span><span class="n">Labno</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">,</span> <span class="n">rejUserID</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">,</span> <span class="n">rejDate</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">,</span> <span class="n">rejTime</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">,</span> <span class="n">rejReason</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="n">Labno</span><span class="o">=$</span><span class="n">G</span><span class="p">(</span><span class="n">Labno</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="n">error</span><span class="o">=</span><span class="s2">&#34;Ê£ÄÈ™åÂè∑‰∏∫Á©∫&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">VisitNumberDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(Labno),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(VisitNumberDR) q error</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">VisitNumberData</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberD</span><span class="p">(</span><span class="n">VisitNumberDR</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="n">peID</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>  <span class="p">;</span><span class="err">ÁôªËÆ∞Âè∑</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(peID) s peID=$lg(VisitNumberData,6)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="mi">20160818</span> <span class="n">yy</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">requestNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">48</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">     <span class="n">S</span> <span class="n">xml</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;Request&gt;&lt;Header&gt;&lt;SourceSystem&gt;&lt;/SourceSystem&gt;&lt;MessageID&gt;&lt;/MessageID&gt;&lt;/Header&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;Body&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;SpecimenRejectRt&gt;&#34;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;SpecimenID&gt;&#34;</span><span class="n">_Labno_</span><span class="s2">&#34;&lt;/SpecimenID&gt;&#34;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;OrderItemIDs&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">requestNo</span><span class="p">,</span><span class="s2">&#34;^&#34;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">orderID</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">requestNo</span><span class="p">,</span><span class="s2">&#34;^&#34;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;OrderItemID&gt;&#34;</span><span class="n">_orderID_</span><span class="s2">&#34;&lt;/OrderItemID&gt;&#34;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;RefuseReason&gt;&#34;</span><span class="n">_rejReason_</span><span class="s2">&#34;&lt;/RefuseReason&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;ExecUserCode&gt;&#34;</span><span class="n">_rejUserID_</span><span class="s2">&#34;&lt;/ExecUserCode&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;RefuseDate&gt;&#34;</span><span class="n">_rejDate_</span><span class="s2">&#34;&lt;/RefuseDate&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;RefuseTime&gt;&#34;</span><span class="n">_rejTime_</span><span class="s2">&#34;&lt;/RefuseTime&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;/SpecimenRejectRt&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;/Body&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">xml</span><span class="o">=</span><span class="n">xml_</span><span class="s2">&#34;&lt;/Request&gt;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="o">^</span><span class="n">TMPENSREPORT</span><span class="p">(</span><span class="s2">&#34;RE&#34;</span><span class="p">,</span><span class="n">labno</span><span class="p">)</span><span class="o">=</span><span class="n">xml</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">$</span><span class="n">NameSpace</span><span class="o">=</span><span class="s2">&#34;DHC-APP&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="k">return</span><span class="o">=</span><span class="c1">##class(web.DHCENS.EnsHISService).DHCHisInterface(&#34;S00000045&#34;,xml)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">e</span><span class="p">(</span><span class="k">return</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span> <span class="n">s</span> <span class="k">return</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="k">return</span><span class="p">,</span><span class="s2">&#34;^&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">S</span> <span class="n">ws</span><span class="o">=</span><span class="c1">##Class(LIS.Service.ENS.WS.WebService).%New()</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">S</span> <span class="k">return</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">SendRefuse</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">$</span><span class="n">NameSpace</span><span class="o">=</span><span class="s2">&#34;DHC-LISDATA&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Q</span> <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">d</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).PutReportResult(&#34;60&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">d</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).PutReportResult(&#34;206&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="err">Âõû‰º†‰ΩìÊ£ÄÊä•Âëä‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">PutReportResult</span><span class="p">(</span><span class="n">ReportDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">CurNamespace</span><span class="o">=$</span><span class="n">ZUTIL</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">WebNamespace</span><span class="o">=</span><span class="c1">##Class(OTH.SYSParameter).GetWebNamespace()</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="c1">##Class(LIS.Service.ENS.TransReport).GetReport(ReportDR,&#34;&#34;)</span>
</span></span><span class="line"><span class="cl">	<span class="n">b</span> <span class="p">;</span><span class="ne">Input</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(Input) q &#34;-1^Êú™Êü•ËØ¢Âà∞Ê†áÊú¨‰ø°ÊÅØÔºÅ&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">NEW</span> <span class="o">$</span><span class="n">NAMESPACE</span> 
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="o">$</span><span class="n">NAMESPACE</span><span class="o">=</span> <span class="n">WebNamespace</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">stream</span><span class="o">=</span><span class="c1">##class(%GlobalCharacterStream).%New()</span>
</span></span><span class="line"><span class="cl">	<span class="n">d</span> <span class="n">stream</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="ne">Input</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">Param</span><span class="o">=</span><span class="c1">##class(web.DHCENS.EnsHISService).DHCHisInterface(&#34;S00000004&#34;,stream)</span>
</span></span><span class="line"><span class="cl">	<span class="n">b</span> <span class="p">;</span><span class="n">Param</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="o">$</span><span class="n">NAMESPACE</span><span class="o">=</span> <span class="n">CurNamespace</span>
</span></span><span class="line"><span class="cl">	<span class="n">q</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Creator</span><span class="err">Ôºö</span>        <span class="n">liuzf</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">CreateDate</span><span class="err">Ôºö</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">27</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Description</span><span class="err">Ôºö</span>    <span class="err">ÂèëÈÄÅÊ†áÊú¨ÁªìÊûúÂà∞‰ΩìÊ£Ä</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Table</span><span class="err">Ôºö</span>          <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="ne">Input</span><span class="err">Ôºö</span>          <span class="err">Ê£ÄÈ™åÂè∑</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Output</span><span class="err">Ôºö</span>     <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Return</span><span class="err">Ôºö</span>     <span class="err">ÈîôËØØ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Others</span><span class="err">Ôºö</span>     <span class="err">Êó†</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(LIS.Service.ENS.TransReport).GetReport(&#34;206&#34;,&#34;&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">GetReport</span><span class="p">(</span><span class="n">ReportDR</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">error</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">ReportDR</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">ReportDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">Set</span> <span class="o">$</span><span class="n">ZTrap</span> <span class="o">=</span> <span class="s2">&#34;ErrorHandle&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">Âü∫Êú¨‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="s2">&#34;YY&#34;</span><span class="p">,</span><span class="s2">&#34;ReportDR&#34;</span><span class="p">)</span><span class="o">=</span><span class="n">ReportDR</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RetStr</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(ReportDR) q $$ReturnOut(&#34;Êó†Ê≠§Êä•Âëä&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(ReportDR) q $$ReturnOut(&#34;Êó†Ê≠§Êä•Âëä&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">ReportData</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportD</span><span class="p">(</span><span class="n">ReportDR</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">lg</span><span class="p">(</span><span class="n">ReportData</span><span class="p">,</span><span class="mi">22</span><span class="p">)</span><span class="s1">&#39;=3 q $$ReturnOut(&#34;Êä•ÂëäÊú™ÂÆ°Ê†∏&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">VisitNumberDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">ReportData</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(VisitNumberDR) q $$ReturnOut(&#34;Êó†Ê≠§Êä•Âëä&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">VisitNumberData</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberD</span><span class="p">(</span><span class="n">VisitNumberDR</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">LabNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">gName</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">sName</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">patname</span><span class="o">=</span><span class="n">gName_</span><span class="s2">&#34; &#34;</span><span class="n">_sName</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="n">gName</span><span class="o">=</span><span class="n">sName</span> <span class="n">s</span> <span class="n">patname</span><span class="o">=</span><span class="n">gName</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">spname</span><span class="o">=</span><span class="s2">&#34;&#34;</span>             <span class="p">;</span><span class="err">ÊÄßÂà´</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">SpeciesDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">SpeciesDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">spname</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTSpeciesD</span><span class="p">(</span><span class="n">SpeciesDR</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">patDOB</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="p">(</span><span class="n">patDOB</span><span class="o">&lt;</span><span class="mi">10000000</span><span class="p">)</span> <span class="n">s</span> <span class="n">patDOB</span><span class="o">=$</span><span class="n">zd</span><span class="p">(</span><span class="n">patDOB</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">patDOB</span><span class="p">)</span> <span class="n">s</span> <span class="n">patDOB</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).FormatDate(patDOB)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Age</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AgeUnitDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">19</span><span class="p">),</span><span class="n">AgeUnit</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AgeUnitDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">AgeUnit</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTAgeUnitD</span><span class="p">(</span><span class="n">AgeUnitDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">patage</span><span class="o">=</span><span class="n">Age_AgeUnit</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">SpecimenDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">56</span><span class="p">),</span><span class="n">specmen</span><span class="o">=</span><span class="s2">&#34;&#34;</span>   <span class="p">;</span><span class="err">Ê†áÊú¨Á±ªÂûã</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">SpecimenDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">specmen</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTSpecimenD</span><span class="p">(</span><span class="n">SpecimenDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">tsname</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="n">TSCode</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">f</span>  <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">))</span> <span class="n">q</span><span class="p">:</span><span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">tsname</span><span class="p">)</span> <span class="n">s</span> <span class="n">tsname</span><span class="o">=</span><span class="n">tsname_</span><span class="s2">&#34;+&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetD</span><span class="p">(</span><span class="n">TestSetDR</span><span class="p">),</span><span class="mi">3</span><span class="p">),</span><span class="n">TSCode</span><span class="o">=</span><span class="n">TSCode_</span><span class="s2">&#34;+&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetD</span><span class="p">(</span><span class="n">TestSetDR</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">e</span>  <span class="n">s</span> <span class="n">tsname</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetD</span><span class="p">(</span><span class="n">TestSetDR</span><span class="p">),</span><span class="mi">3</span><span class="p">),</span><span class="n">TSCode</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetD</span><span class="p">(</span><span class="n">TestSetDR</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">specmen</span><span class="p">,</span><span class="s2">&#34;(&#34;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="n">s</span> <span class="n">specmen</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">specmen</span><span class="p">,</span><span class="s2">&#34;(&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">patloc</span><span class="o">=</span><span class="s2">&#34;&#34;</span>                    <span class="p">;</span><span class="err">ÁßëÂÆ§</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">LocationDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">22</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">LocationDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">patloc</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTLocationD</span><span class="p">(</span><span class="n">LocationDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">Áî≥ËØ∑Êó•Êúü</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">requestdate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="p">(</span><span class="n">requestdate</span><span class="o">&lt;</span><span class="mi">10000000</span><span class="p">)</span> <span class="n">s</span> <span class="n">requestdate</span><span class="o">=$</span><span class="n">zd</span><span class="p">(</span><span class="n">requestdate</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">requestdate</span><span class="p">)</span> <span class="n">s</span> <span class="n">requestdate</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).FormatDate(requestdate)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="o">//</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="p">(</span><span class="n">recdate</span><span class="p">,</span><span class="n">rectime</span><span class="p">,</span><span class="n">recusr</span><span class="p">,</span><span class="n">entrydate</span><span class="p">,</span><span class="n">entrytime</span><span class="p">,</span><span class="n">entryusr</span><span class="p">,</span><span class="n">authdate</span><span class="p">,</span><span class="n">authtime</span><span class="p">,</span><span class="n">authusr</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">recdate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">66</span><span class="p">)</span>   <span class="p">;</span><span class="err">Êé•Êî∂Êó•Êúü</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">rectime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">67</span><span class="p">)</span>   <span class="p">;</span><span class="err">Êé•Êî∂Êó∂Èó¥</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">recdate</span><span class="p">)</span> <span class="n">s</span> <span class="n">recdate</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).FormatDate(recdate)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">rectime</span><span class="p">)</span> <span class="n">s</span> <span class="n">rectime</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).FormatTime(rectime)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">ReceiveUserDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">68</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">ReceiveUserDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">recusr</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">SYSUserD</span><span class="p">(</span><span class="n">ReceiveUserDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">entrydate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">ReportData</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>      <span class="p">;</span><span class="err">ÂàùÂÆ°Êó•Êúü</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">entrytime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">ReportData</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span>      <span class="p">;</span><span class="err">ÂàùÂÆ°Êó∂Èó¥</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">entrydate</span><span class="p">)</span> <span class="n">s</span> <span class="n">entrydate</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).FormatDate(entrydate)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">entrytime</span><span class="p">)</span> <span class="n">s</span> <span class="n">entrytime</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).FormatTime(entrytime)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">EntryUserDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">ReportData</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">EntryUserDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">entryusr</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">SYSUserD</span><span class="p">(</span><span class="n">EntryUserDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">authdate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">ReportData</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span>       <span class="p">;</span><span class="err">Ê†∏Êî∂Êó•Êúü</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">authtime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">ReportData</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>       <span class="p">;</span><span class="err">Ê†∏Êî∂Êó∂Èó¥</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">authdate</span><span class="p">)</span> <span class="n">s</span> <span class="n">authdate</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).FormatDate(authdate)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">authtime</span><span class="p">)</span> <span class="n">s</span> <span class="n">authtime</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).FormatTime(authtime)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AuthUserDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">ReportData</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AuthUserDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">authusr</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">SYSUserD</span><span class="p">(</span><span class="n">AuthUserDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">coldate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>   <span class="p">;</span><span class="err">ÈááÈõÜÊó•Êúü</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">coltime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">52</span><span class="p">)</span>   <span class="p">;</span><span class="err">ÈááÈõÜÊó∂Èó¥</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">coldate</span><span class="p">)</span> <span class="n">s</span> <span class="n">coldate</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).FormatDate(coldate)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">coltime</span><span class="p">)</span> <span class="n">s</span> <span class="n">coltime</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).FormatTime(coltime)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">CollDT</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">coldate</span><span class="p">)</span> <span class="n">s</span> <span class="n">CollDT</span><span class="o">=</span><span class="n">coldate_</span><span class="s2">&#34; &#34;</span><span class="n">_coltime</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="p">(</span><span class="n">recDT</span><span class="p">,</span><span class="n">entryDT</span><span class="p">,</span><span class="n">authDT</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">recdate</span><span class="p">)</span> <span class="n">s</span> <span class="n">recDT</span><span class="o">=</span><span class="n">recdate_</span><span class="s2">&#34; &#34;</span><span class="n">_rectime</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">entrydate</span><span class="p">)</span> <span class="n">s</span> <span class="n">entryDT</span><span class="o">=</span><span class="n">entrydate_</span><span class="s2">&#34; &#34;</span><span class="n">_entrytime</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">authdate</span><span class="p">)</span> <span class="n">s</span> <span class="n">authDT</span><span class="o">=</span><span class="n">authdate_</span><span class="s2">&#34; &#34;</span><span class="n">_authtime</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">debtor</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>  <span class="p">;</span><span class="err">ÁôªËÆ∞Âè∑</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">DoctorDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">23</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">docname</span><span class="o">=</span><span class="s2">&#34;&#34;</span>                    <span class="p">;</span><span class="err">ÂåªÁîü</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">DoctorDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">docname</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTDoctorD</span><span class="p">(</span><span class="n">DoctorDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">ËØäÊñ≠</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">patdiag</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">DiseaseDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">f</span>  <span class="n">s</span> <span class="n">DiseaseDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberDiagnoseI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="n">DiseaseDR</span><span class="p">))</span> <span class="n">q</span><span class="p">:</span><span class="n">DiseaseDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">patdiag</span><span class="p">)</span> <span class="n">s</span> <span class="n">patdiag</span><span class="o">=</span><span class="n">patdiag_</span><span class="s2">&#34;+&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTDiseaseD</span><span class="p">(</span><span class="n">DiseaseDR</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">e</span>  <span class="n">s</span> <span class="n">patdiag</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTDiseaseD</span><span class="p">(</span><span class="n">DiseaseDR</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">‰ª™Âô®</span><span class="p">,</span><span class="err">ÁóÖÂå∫</span><span class="p">,</span><span class="err">Â∫äÂè∑</span><span class="p">,</span><span class="err">ÊµÅÊ∞¥Âè∑</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Machine</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">s</span> <span class="n">MachineDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">ResultData</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">MachineDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">Machine</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTMIMachineParameterD</span><span class="p">(</span><span class="n">MachineDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">bed</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">27</span><span class="p">)</span>    <span class="p">;</span><span class="err">Â∫äÂè∑</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">WardName</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">WardDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">26</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">WardDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">WardName</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTWardD</span><span class="p">(</span><span class="n">WardDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">episode</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">ReportData</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">Ê£ÄÈ™åÁßë</span><span class="o">-</span><span class="err">Èó®ËØäÊ£ÄÈ™åÁªÑ</span>\<span class="n">Lab</span> <span class="n">Manager</span><span class="c1">#84322268</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Depart</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">WorkGroupMachineDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">ReportData</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">WorkGroupMachineDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">WorkGroupDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTWorkGroupMachineD</span><span class="p">(</span><span class="n">WorkGroupMachineDR</span><span class="p">)),</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">WorkGroupDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">DepartPhone</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTWorkGroupD</span><span class="p">(</span><span class="n">WorkGroupDR</span><span class="p">)),</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="mi">20141114</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AdmID</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AdmNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Notes</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">48</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">requestNo</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">48</span><span class="p">),</span><span class="s2">&#34;^&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">PDFFileDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportFileI</span><span class="p">(</span><span class="s2">&#34;IndexMater&#34;</span><span class="p">,</span><span class="n">ReportDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">)),</span><span class="n">PDFFile</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">PDFFileDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">PDFFile</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportFileD</span><span class="p">(</span><span class="n">PDFFileDR</span><span class="p">)),</span><span class="mi">6</span><span class="p">)</span>		<span class="o">//</span><span class="n">YHR</span> <span class="mi">20240409</span> <span class="err">Âõû‰º†</span><span class="n">PDFÈìæÊé•</span>
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="n">obj</span><span class="o">=</span><span class="c1">##Class(LIS.Service.ENS.Data.ReportMsg).%New()</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">OrdID</span><span class="o">=</span><span class="n">requestNo</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">LabNo</span><span class="o">=</span><span class="n">LabNo</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">ReportID</span><span class="o">=</span><span class="n">ReportDR</span> <span class="o">///</span><span class="err">Êä•Âëä</span><span class="n">ID</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">ReportUrl</span><span class="o">=</span><span class="s2">&#34;&#34;</span>      <span class="o">//</span><span class="err">Êä•ÂëäÂú∞ÂùÄ</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">RecUser</span><span class="o">=</span><span class="n">recusr</span>            <span class="o">//</span><span class="err">Êé•Êî∂ËÄÖ</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">RecUserCode</span><span class="o">=</span><span class="n">ReceiveUserDR</span> <span class="o">//</span><span class="err">Êé•Êî∂ËÄÖ‰ª£Á†Å</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">RecDate</span><span class="o">=</span><span class="n">recdate</span>       <span class="o">//</span><span class="err">Êé•Êî∂Êó•Êúü</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">RecTime</span><span class="o">=</span><span class="n">rectime</span>       <span class="o">//</span><span class="err">Êé•Êî∂Êó∂Èó¥</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">EntryUser</span><span class="o">=</span><span class="n">entryusr</span>    <span class="o">//</span><span class="err">ÂΩïÂÖ•ËÄÖ</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">EntryUserCode</span><span class="o">=</span><span class="n">EntryUserDR</span> <span class="o">//</span><span class="err">ÂΩïÂÖ•ËÄÖ‰ª£Á†Å</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">EntryDate</span><span class="o">=</span><span class="n">entrydate</span>   <span class="o">//</span><span class="err">ÂΩïÂÖ•Êó•Êúü</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">EntryTime</span><span class="o">=</span><span class="n">entrytime</span>   <span class="o">//</span><span class="err">ÂΩïÂÖ•Êó∂Èó¥</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">AuthUser</span><span class="o">=</span><span class="n">authusr</span>      <span class="o">//</span><span class="err">ÂÆ°Ê†∏ËÄÖ</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">AuthUserCode</span><span class="o">=</span><span class="n">AuthUserDR</span>   <span class="o">//</span><span class="err">ÂÆ°Ê†∏ËÄÖ‰ª£Á†Å</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">AuthDate</span><span class="o">=</span><span class="n">authdate</span> <span class="o">//</span><span class="err">ÂÆ°Ê†∏Êó•Êúü</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">AuthTime</span><span class="o">=</span><span class="n">authtime</span> <span class="o">//</span><span class="err">ÂÆ°Ê†∏Êó∂Èó¥</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">Notes</span><span class="o">=</span><span class="n">Notes</span>       <span class="o">//</span><span class="err">Êä•ÂëäÂ§áÊ≥®</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">ImageFile</span><span class="o">=</span><span class="s2">&#34;&#34;</span>      <span class="o">//</span><span class="err">ÂõæÂÉèÁöÑË∑ØÂæÑÔºàÂ§öÂπÖÂõæ‰ΩøÁî®@ÂàÜÂâ≤Ôºâ</span> 
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">MainWarnDesc</span><span class="o">=</span><span class="s2">&#34;&#34;</span>   <span class="o">//</span><span class="err">Âç±ÊÄ•ÂÄºËØ¥Êòé</span> 
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">obj</span><span class="o">.</span><span class="n">PDFFile</span><span class="o">=</span><span class="n">PDFFile</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">ÁªìÊûú</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">result</span> <span class="o">=</span> <span class="c1">##class(%ResultSet).%New(&#34;LIS.Service.ENS.Business.ReportResult:QryTestSetResult&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">sc</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">ReportDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">While</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">Next</span><span class="p">(</span><span class="o">.</span><span class="n">sc</span><span class="p">))</span> <span class="o">//</span> <span class="n">go</span> <span class="n">to</span> <span class="n">the</span> <span class="n">next</span> <span class="n">row</span> <span class="n">of</span> <span class="n">the</span> <span class="n">result</span> <span class="n">set</span>
</span></span><span class="line"><span class="cl">     <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span> <span class="o">//</span> <span class="n">check</span> <span class="k">if</span> <span class="n">this</span> <span class="n">succeeded</span> <span class="n">without</span> <span class="n">errors</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objRes</span><span class="o">=</span><span class="c1">##Class(LIS.Service.ENS.Data.ResultMsg).%New()</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objRes</span><span class="o">.</span><span class="n">LabNo</span><span class="o">=</span><span class="n">LabNo</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objRes</span><span class="o">.</span><span class="n">TestSetCode</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;TestSetCode&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objRes</span><span class="o">.</span><span class="n">TestCode</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;TestCode&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objRes</span><span class="o">.</span><span class="n">TestName</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;TestName&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objRes</span><span class="o">.</span><span class="n">TestEngName</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;TestSync&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objRes</span><span class="o">.</span><span class="n">Result</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;Result&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">ResFlag</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;ResFlag&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="s1">&#39;$l(ResFlag) s ResFlag=&#34;N&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objRes</span><span class="o">.</span><span class="n">ResultFlag</span><span class="o">=</span><span class="n">ResFlag</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objRes</span><span class="o">.</span><span class="n">Units</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;Unit&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">Ranges</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;Ranges&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="s1">&#39;$l(Ranges) s Ranges=&#34; &#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objRes</span><span class="o">.</span><span class="n">Ranges</span><span class="o">=</span><span class="n">Ranges</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">MICFlag</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;MICFlag&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span><span class="n">whf</span> <span class="n">add</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="mi">29</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="n">MICFlag</span><span class="o">=</span><span class="s2">&#34;Y&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objRes</span><span class="o">.</span><span class="n">MICFlag</span><span class="o">=</span><span class="s2">&#34;Y&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objRes</span><span class="o">.</span><span class="n">Result</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;OrganismCode&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">objRes</span><span class="o">.</span><span class="n">MICName</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;OrganismDesc&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">//</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">objRes</span><span class="o">.</span><span class="n">Sequence</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;Sequence&#34;</span><span class="p">)</span> <span class="o">//</span><span class="err">ÊòæÁ§∫È°∫Â∫è</span> <span class="mi">20141114</span> <span class="n">huhm</span>
</span></span><span class="line"><span class="cl">                <span class="o">///</span><span class="err">ÁªÜËèåÁªìÊûú</span><span class="n">ID</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span> <span class="n">SenResultId</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;SenResultId&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">SenResultId</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">s</span> <span class="n">sen</span><span class="o">=</span><span class="c1">##class(%ResultSet).%New(&#34;LIS.Service.ENS.Business.ReportResult:QryTestSetResultSen&#34;)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Set</span> <span class="n">st</span> <span class="o">=</span> <span class="n">sen</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">SenResultId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">While</span> <span class="p">(</span><span class="n">sen</span><span class="o">.</span><span class="n">Next</span><span class="p">(</span><span class="o">.</span><span class="n">st</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                       <span class="n">If</span> <span class="p">(</span><span class="o">$</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">IsOK</span><span class="p">(</span><span class="n">st</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">                       <span class="p">{</span>
</span></span><span class="line"><span class="cl">                           <span class="o">//</span><span class="n">WCode</span><span class="p">,</span><span class="n">AntCode</span><span class="p">,</span><span class="n">AntName</span><span class="p">,</span><span class="n">SenCode</span><span class="p">,</span><span class="n">SenName</span><span class="p">,</span><span class="n">SenMethod</span><span class="p">,</span><span class="n">SenValue</span>
</span></span><span class="line"><span class="cl">                           <span class="n">s</span> <span class="n">objSen</span><span class="o">=</span><span class="c1">##Class(LIS.Service.ENS.Data.OrgResultMsg).%New()</span>
</span></span><span class="line"><span class="cl">                           <span class="n">s</span> <span class="n">objSen</span><span class="o">.</span><span class="n">BugsCode</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;OrganismCode&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="n">s</span> <span class="n">objSen</span><span class="o">.</span><span class="n">AntiCode</span><span class="o">=</span><span class="n">sen</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;AntCode&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="n">s</span> <span class="n">objSen</span><span class="o">.</span><span class="n">AntiName</span><span class="o">=</span><span class="n">sen</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;AntName&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="n">s</span> <span class="n">objSen</span><span class="o">.</span><span class="n">Result</span><span class="o">=</span><span class="n">sen</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;SenName&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="n">s</span> <span class="n">objSen</span><span class="o">.</span><span class="n">KBRes</span><span class="o">=</span><span class="n">sen</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;SenMethod&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="n">s</span> <span class="n">objSen</span><span class="o">.</span><span class="n">MICRes</span><span class="o">=</span><span class="n">sen</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;SenValue&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="n">s</span> <span class="n">objSen</span><span class="o">.</span><span class="n">Order</span><span class="o">=</span><span class="n">sen</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="s2">&#34;Order&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="n">d</span> <span class="n">objRes</span><span class="o">.</span><span class="n">OrgResultMsgs</span><span class="o">.</span><span class="n">Insert</span><span class="p">(</span><span class="n">objSen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                          <span class="o">//</span>
</span></span><span class="line"><span class="cl">                       <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">d</span> <span class="n">obj</span><span class="o">.</span><span class="n">ResultMsgs</span><span class="o">.</span><span class="n">Insert</span><span class="p">(</span><span class="n">objRes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">d</span> <span class="n">obj</span><span class="o">.</span><span class="n">XMLExportToStream</span><span class="p">(</span><span class="o">.</span><span class="n">Input</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">Set</span> <span class="n">objStream</span><span class="o">=</span><span class="c1">##class(%GlobalCharacterStream).%New()</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">d</span> <span class="n">objStream</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="s2">&#34;&lt;ReportData&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">d</span> <span class="n">obj</span><span class="o">.</span><span class="n">XMLExportToString</span><span class="p">(</span><span class="o">.</span><span class="n">Input</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="n">retObj</span><span class="o">=</span><span class="c1">##Class(UtilsController.LIS.UtilsControllerHttpSoap12Endpoint).%New()</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="n">retObj</span><span class="o">.</span><span class="n">ReportMsg</span><span class="p">(</span><span class="ne">Input</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="s2">&#34;&lt;Request&gt;&lt;Header&gt;&lt;SourceSystem&gt;NFYY&lt;/SourceSystem&gt;&lt;MessageID&gt;ÂåªÈô¢‰ø°ÊÅØÂπ≥Âè∞&lt;/MessageID&gt;&lt;/Header&gt;&lt;Body&gt;&#34;</span><span class="n">_Input_</span><span class="s2">&#34;&lt;/Body&gt;&lt;/Request&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="s2">&#34;&lt;Response&gt;&#34;</span><span class="n">_Input_</span><span class="s2">&#34;&lt;/Response&gt;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">objStream</span><span class="o">=</span><span class="c1">##class(%GlobalCharacterStream).%New()</span>
</span></span><span class="line"><span class="cl">    <span class="n">d</span> <span class="n">objStream</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="ne">Input</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="s2">&#34;Au&#34;</span><span class="p">,</span><span class="n">LabNo</span><span class="p">)</span><span class="o">=</span><span class="ne">Input</span>      
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="o">$</span><span class="n">NameSpace</span><span class="o">=</span><span class="s2">&#34;DHC-APP&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="ne">Input</span><span class="o">=</span><span class="c1">##class(web.DHCENS.EnsHISService).DHCHisInterface(&#34;S00000046&#34;,objStream)</span>
</span></span><span class="line"><span class="cl">    <span class="p">;</span><span class="n">s</span> <span class="o">$</span><span class="n">NameSpace</span><span class="o">=</span><span class="s2">&#34;DHC-LISDATA&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="s2">&#34;AuReport&#34;</span><span class="p">,</span><span class="n">LabNo</span><span class="p">)</span><span class="o">=</span><span class="ne">Input</span>      
</span></span><span class="line"><span class="cl">    <span class="n">q</span> <span class="ne">Input</span> 
</span></span><span class="line"><span class="cl"><span class="n">ErrorHandle</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">err</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="s2">&#34;Êü•ËØ¢ÂºÇÂ∏∏.ÈîôËØØ&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">ZERROR</span><span class="p">,</span><span class="s2">&#34;^&#34;</span><span class="p">,</span><span class="s2">&#34;--&#34;</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34;.ÈîôËØØ‰ª£Á†Å:&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">ECODE</span><span class="p">,</span><span class="s2">&#34;&lt;&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Quit</span> <span class="o">$$</span><span class="n">ReturnOut</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ReturnOut</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">Set</span> <span class="n">objStream</span><span class="o">=</span><span class="c1">##class(%GlobalCharacterStream).%New()</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">d</span> <span class="n">objStream</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="s2">&#34;&lt;ReportData&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">d</span> <span class="n">objStream</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="s2">&#34;&lt;ReturnValue&gt;-1^&#34;</span><span class="n">_err_</span><span class="s2">&#34;&lt;/ReturnValue&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">Do</span> <span class="n">objStream</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="s2">&#34;&lt;/ReportData&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span> <span class="s2">&#34;-1^&#34;</span><span class="n">_err</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Creator</span><span class="err">Ôºö</span>      <span class="n">zlz</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">CreatDate</span><span class="err">Ôºö</span>    <span class="mi">2020122</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Description</span><span class="err">Ôºö</span>  <span class="err">ÈÄöËøáÊù°Á†ÅÂè∑ÂæóÂà∞Ê†áÊú¨‰ø°ÊÅØ</span>     
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="ne">Input</span><span class="err">Ôºö</span>        <span class="err">Â∑•‰ΩúÂ∞èÁªÑ</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Output</span><span class="err">Ôºö</span>       <span class="err">ÂåªÂò±‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">QryVisitNumberInfoByLabNo</span><span class="p">(</span><span class="n">LabNo</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">,</span> <span class="n">P5</span><span class="p">,</span> <span class="n">P6</span><span class="p">,</span> <span class="n">P7</span><span class="p">,</span> <span class="n">P8</span><span class="p">,</span> <span class="n">P9</span><span class="p">,</span> <span class="n">P10</span><span class="p">,</span> <span class="n">P11</span><span class="p">,</span> <span class="n">P12</span><span class="p">,</span> <span class="n">P13</span><span class="p">,</span> <span class="n">Sessions</span><span class="p">,</span> <span class="n">Output</span> <span class="n">RowCount</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="n">Query</span><span class="p">(</span><span class="n">ROWSPEC</span> <span class="o">=</span> <span class="s2">&#34;VisitNumberDR,RegNo,AdmissionTypeDR,AdmissionType,AdmNo,MedicalRecordNo,AdmDate,AdmTime,CertTypeDR,CertType,CertNo,IDNumber,PaymentTypeDR,PaymentType,SurName,GivenName,SpeciesDR,BirthDate,BirthTime,Age,AgeUnitDR,AgeUnit,EthnicityDR,Ethnicity,HospitalDR,Hospital,LocationDR,Location,DoctorDR,Doctor,RequestDate,RequestTime,WardDR,Ward,BedNo,Symptom,MobileNo,PhoneNo,EMail,Height,Weight,BloodPressure,ClinicalConditionsDR,LMPDate,Pregnant,PregnantWeeks,AboDR,Abo,RhDR,Rh,Address,PostCode,InfectFlag,InfectAlert,SpecialFlag,PregnantNum,ChildbirthNum,ReqNotes,RequestNo,Urgent,CollectDate,CollectTime,CollectUserDR,CollectUser,AnatomicalSiteDR,AnatomicalSite,CollectPositon,SpecimenDR,Specimen,ContainerDR,Container,CollectNotes,H24UVolume,H24UTimePeriod,BodyTemp,Confidential,CarryDate,CarryTime,CarryUserDR,CarryUser,ReceiveDate,ReceiveTime,ReceiveUserDR,ReceiveUser,SpecimenQualityDR,SpecimenQuality,ReceiveNotes,InStorageDate,InStorageTime,InStorageUserDR,InStorageUser,OutStorageDate,OutStorageTime,OutStorageUserDR,OutStorageUser,OutStorageType,ReceiveHospitalDR,ReceiveHospital,AddDate,AddTime,AddUserDR,AddUser,FeeSum,AddType,AgeDesc,ArriveDate,ArriveTime,ArriveUserDR,ArriveUser,RUDiseaseDR,RUDisease,ArriveWorkGroupDR,ArriveWorkGroup,ConcessionFlag,ICDs,IsPrintBar,LinkLabNo,TestSetCode,HISOrderID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">QueryÁöÑÊâßË°åÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">d</span> <span class="c1">##class(%ResultSet).RunQuery(&#34;LIS.Service.ENS.TransReport&#34;,&#34;QryVisitNumberInfoByLabNo&#34;,&#34;00000044&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">QryVisitNumberInfoByLabNoExecute</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">qHandle</span> <span class="n">As</span> <span class="o">%</span><span class="n">Binary</span><span class="p">,</span> <span class="n">LabNo</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">,</span> <span class="n">P5</span><span class="p">,</span> <span class="n">P6</span><span class="p">,</span> <span class="n">P7</span><span class="p">,</span> <span class="n">P8</span><span class="p">,</span> <span class="n">P9</span><span class="p">,</span> <span class="n">P10</span><span class="p">,</span> <span class="n">P11</span><span class="p">,</span> <span class="n">P12</span><span class="p">,</span> <span class="n">P13</span><span class="p">,</span> <span class="n">Sessions</span><span class="p">,</span> <span class="n">Output</span> <span class="n">RowCount</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="n">Status</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> 	<span class="n">Set</span> <span class="n">repid</span><span class="o">=$</span><span class="n">I</span><span class="p">(</span><span class="o">^</span><span class="n">CacheTemp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">If</span> <span class="o">$</span><span class="n">Get</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">Set</span> <span class="n">ind</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">LabNo</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">LabNo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">LabNoI</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).IndexData(LabNo)</span>
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="n">LabNoI</span><span class="p">))</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">VisitNumberDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="n">LabNoI</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">VisitNumberData</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberD</span><span class="p">(</span><span class="n">VisitNumberDR</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">RegNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AdmissionTypeDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AdmissionType</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(AdmissionTypeDR,&#34;dbo.BTAdmissionType&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AdmNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">MedicalRecordNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AdmDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AdmTime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">CertTypeDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">CertType</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(AdmissionTypeDR,&#34;dbo.BTCertType&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">CertNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">IDNumber</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">PaymentTypeDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">PaymentType</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(PaymentTypeDR,&#34;dbo.BTPaymentType&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">SurName</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">GivenName</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">SpeciesDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">BirthDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">BirthTime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Age</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AgeUnitDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AgeUnit</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(AgeUnitDR,&#34;dbo.BTAgeUnit&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">EthnicityDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Ethnicity</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(EthnicityDR,&#34;dbo.BTEthnicity&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">HospitalDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Hospital</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(HospitalDR,&#34;dbo.BTHospital&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">LocationDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">22</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Location</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(LocationDR,&#34;dbo.BTLocation&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">DoctorDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">23</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Doctor</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(DoctorDR,&#34;dbo.BTDoctor&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">RequestDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">RequestTime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">WardDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">26</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Ward</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(WardDR,&#34;dbo.BTWard&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">BedNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">27</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Symptom</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">MobileNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">29</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">PhoneNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">EMail</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Height</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Weight</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">33</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">BloodPressure</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">34</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ClinicalConditionsDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">35</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">LMPDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">36</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Pregnant</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">PregnantWeeks</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">38</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AboDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">39</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Abo</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(AboDR,&#34;dbo.BTABOBG&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">RhDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Rh</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(RhDR,&#34;dbo.BTRHBG&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Address</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">41</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">PostCode</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">42</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">InfectFlag</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">43</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">InfectAlert</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">44</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">SpecialFlag</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">45</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">PregnantNum</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">46</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ChildbirthNum</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">47</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ReqNotes</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">48</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">RequestNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">49</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Urgent</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">CollectDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">CollectTime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">52</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">CollectUserDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">53</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">CollectUser</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(CollectUserDR,&#34;dbo.SYSUser&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AnatomicalSiteDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">54</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AnatomicalSite</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(AnatomicalSiteDR,&#34;dbo.BTAnatomicalSite&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">CollectPositon</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">55</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">SpecimenDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">56</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Specimen</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(SpecimenDR,&#34;dbo.BTSpecimen&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ContainerDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">57</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="ne">Container</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(ContainerDR,&#34;dbo.BTContainer&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">CollectNotes</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">58</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">H24UVolume</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">59</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">H24UTimePeriod</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">BodyTemp</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">61</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Confidential</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">62</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">CarryDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">63</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">CarryTime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">CarryUserDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">65</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">CarryUser</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(CarryUserDR,&#34;dbo.SYSUser&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ReceiveDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">66</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ReceiveTime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">67</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ReceiveUserDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">68</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ReceiveUser</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(ReceiveUserDR,&#34;dbo.SYSUser&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">SpecimenQualityDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">69</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">SpecimenQuality</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(SpecimenQualityDR,&#34;dbo.BTSpecimenQuality&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ReceiveNotes</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">70</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">InStorageDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">71</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">InStorageTime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">72</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">InStorageUserDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">73</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">InStorageUser</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(InStorageUserDR,&#34;dbo.SYSUser&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">OutStorageDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">74</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">OutStorageTime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">75</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">OutStorageUserDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">76</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">OutStorageUser</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(OutStorageUserDR,&#34;dbo.SYSUser&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">OutStorageType</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">77</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ReceiveHospitalDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">78</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ReceiveHospital</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(ReceiveHospitalDR,&#34;dbo.BTHospital&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AddDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">79</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AddTime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">80</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AddUserDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">81</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AddUser</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(AddUserDR,&#34;dbo.SYSUser&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">FeeSum</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">82</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AddType</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">83</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">AgeDesc</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">84</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ArriveDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">85</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ArriveTime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">86</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ArriveUserDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">87</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ArriveUser</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(ArriveUserDR,&#34;dbo.SYSUser&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">RUDiseaseDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">88</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">RUDisease</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(RUDiseaseDR,&#34;dbo.BTRUDisease&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ArriveWorkGroupDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">89</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ArriveWorkGroup</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).GetParentColVal(ArriveWorkGroupDR,&#34;dbo.BTWorkGroup&#34;,3)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ConcessionFlag</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ICDs</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">91</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">IsPrintBar</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">92</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">LinkLabNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">VisitNumberData</span><span class="p">,</span><span class="mi">93</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">TestSetCode</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">HISOrderID</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">))</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">f</span>  <span class="n">s</span> <span class="n">TestSetDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">))</span> <span class="n">q</span><span class="p">:</span><span class="n">TestSetDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl">	<span class="o">...</span><span class="n">s</span> <span class="n">TestSetCodeOne</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTTestSetD</span><span class="p">(</span><span class="n">TestSetDR</span><span class="p">)),</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">...</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">TestSetCode</span><span class="p">)</span> <span class="n">s</span> <span class="n">TestSetCode</span><span class="o">=</span><span class="n">TestSetCode_</span><span class="s2">&#34;,&#34;</span><span class="n">_TestSetCodeOne</span>
</span></span><span class="line"><span class="cl">	<span class="o">...</span><span class="n">e</span>  <span class="n">s</span> <span class="n">TestSetCode</span><span class="o">=</span><span class="n">TestSetCodeOne</span>
</span></span><span class="line"><span class="cl">	<span class="o">...</span><span class="n">s</span> <span class="n">VisTSDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetI</span><span class="p">(</span><span class="s2">&#34;IndexMaster&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="n">TestSetDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="o">...</span><span class="n">s</span> <span class="n">HISOrderIDOne</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberTestSetD</span><span class="p">(</span><span class="n">VisTSDR</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">	<span class="o">...</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">HISOrderID</span><span class="p">)</span> <span class="n">s</span> <span class="n">HISOrderID</span><span class="o">=</span><span class="n">HISOrderID_</span><span class="s2">&#34;,&#34;</span><span class="n">_HISOrderIDOne</span>
</span></span><span class="line"><span class="cl">	<span class="o">...</span><span class="n">e</span>  <span class="n">s</span> <span class="n">HISOrderID</span><span class="o">=</span><span class="n">HISOrderIDOne</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">Data</span><span class="o">=$</span><span class="n">lb</span><span class="p">(</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="n">RegNo</span><span class="p">,</span><span class="n">AdmissionTypeDR</span><span class="p">,</span><span class="n">AdmissionType</span><span class="p">,</span><span class="n">AdmNo</span><span class="p">,</span><span class="n">MedicalRecordNo</span><span class="p">,</span><span class="n">AdmDate</span><span class="p">,</span><span class="n">AdmTime</span><span class="p">,</span><span class="n">CertTypeDR</span><span class="p">,</span><span class="n">CertType</span><span class="p">,</span><span class="n">CertNo</span><span class="p">,</span><span class="n">IDNumber</span><span class="p">,</span><span class="n">PaymentTypeDR</span><span class="p">,</span><span class="n">PaymentType</span><span class="p">,</span><span class="n">SurName</span><span class="p">,</span><span class="n">GivenName</span><span class="p">,</span><span class="n">SpeciesDR</span><span class="p">,</span><span class="n">BirthDate</span><span class="p">,</span><span class="n">BirthTime</span><span class="p">,</span><span class="n">Age</span><span class="p">,</span><span class="n">AgeUnitDR</span><span class="p">,</span><span class="n">AgeUnit</span><span class="p">,</span><span class="n">EthnicityDR</span><span class="p">,</span><span class="n">Ethnicity</span><span class="p">,</span><span class="n">HospitalDR</span><span class="p">,</span><span class="n">Hospital</span><span class="p">,</span><span class="n">LocationDR</span><span class="p">,</span><span class="n">Location</span><span class="p">,</span><span class="n">DoctorDR</span><span class="p">,</span><span class="n">Doctor</span><span class="p">,</span><span class="n">RequestDate</span><span class="p">,</span><span class="n">RequestTime</span><span class="p">,</span><span class="n">WardDR</span><span class="p">,</span><span class="n">Ward</span><span class="p">,</span><span class="n">BedNo</span><span class="p">,</span><span class="n">Symptom</span><span class="p">,</span><span class="n">MobileNo</span><span class="p">,</span><span class="n">PhoneNo</span><span class="p">,</span><span class="n">EMail</span><span class="p">,</span><span class="n">Height</span><span class="p">,</span><span class="n">Weight</span><span class="p">,</span><span class="n">BloodPressure</span><span class="p">,</span><span class="n">ClinicalConditionsDR</span><span class="p">,</span><span class="n">LMPDate</span><span class="p">,</span><span class="n">Pregnant</span><span class="p">,</span><span class="n">PregnantWeeks</span><span class="p">,</span><span class="n">AboDR</span><span class="p">,</span><span class="n">Abo</span><span class="p">,</span><span class="n">RhDR</span><span class="p">,</span><span class="n">Rh</span><span class="p">,</span><span class="n">Address</span><span class="p">,</span><span class="n">PostCode</span><span class="p">,</span><span class="n">InfectFlag</span><span class="p">,</span><span class="n">InfectAlert</span><span class="p">,</span><span class="n">SpecialFlag</span><span class="p">,</span><span class="n">PregnantNum</span><span class="p">,</span><span class="n">ChildbirthNum</span><span class="p">,</span><span class="n">ReqNotes</span><span class="p">,</span><span class="n">RequestNo</span><span class="p">,</span><span class="n">Urgent</span><span class="p">,</span><span class="n">CollectDate</span><span class="p">,</span><span class="n">CollectTime</span><span class="p">,</span><span class="n">CollectUserDR</span><span class="p">,</span><span class="n">CollectUser</span><span class="p">,</span><span class="n">AnatomicalSiteDR</span><span class="p">,</span><span class="n">AnatomicalSite</span><span class="p">,</span><span class="n">CollectPositon</span><span class="p">,</span><span class="n">SpecimenDR</span><span class="p">,</span><span class="n">Specimen</span><span class="p">,</span><span class="n">ContainerDR</span><span class="p">,</span><span class="ne">Container</span><span class="p">,</span><span class="n">CollectNotes</span><span class="p">,</span><span class="n">H24UVolume</span><span class="p">,</span><span class="n">H24UTimePeriod</span><span class="p">,</span><span class="n">BodyTemp</span><span class="p">,</span><span class="n">Confidential</span><span class="p">,</span><span class="n">CarryDate</span><span class="p">,</span><span class="n">CarryTime</span><span class="p">,</span><span class="n">CarryUserDR</span><span class="p">,</span><span class="n">CarryUser</span><span class="p">,</span><span class="n">ReceiveDate</span><span class="p">,</span><span class="n">ReceiveTime</span><span class="p">,</span><span class="n">ReceiveUserDR</span><span class="p">,</span><span class="n">ReceiveUser</span><span class="p">,</span><span class="n">SpecimenQualityDR</span><span class="p">,</span><span class="n">SpecimenQuality</span><span class="p">,</span><span class="n">ReceiveNotes</span><span class="p">,</span><span class="n">InStorageDate</span><span class="p">,</span><span class="n">InStorageTime</span><span class="p">,</span><span class="n">InStorageUserDR</span><span class="p">,</span><span class="n">InStorageUser</span><span class="p">,</span><span class="n">OutStorageDate</span><span class="p">,</span><span class="n">OutStorageTime</span><span class="p">,</span><span class="n">OutStorageUserDR</span><span class="p">,</span><span class="n">OutStorageUser</span><span class="p">,</span><span class="n">OutStorageType</span><span class="p">,</span><span class="n">ReceiveHospitalDR</span><span class="p">,</span><span class="n">ReceiveHospital</span><span class="p">,</span><span class="n">AddDate</span><span class="p">,</span><span class="n">AddTime</span><span class="p">,</span><span class="n">AddUserDR</span><span class="p">,</span><span class="n">AddUser</span><span class="p">,</span><span class="n">FeeSum</span><span class="p">,</span><span class="n">AddType</span><span class="p">,</span><span class="n">AgeDesc</span><span class="p">,</span><span class="n">ArriveDate</span><span class="p">,</span><span class="n">ArriveTime</span><span class="p">,</span><span class="n">ArriveUserDR</span><span class="p">,</span><span class="n">ArriveUser</span><span class="p">,</span><span class="n">RUDiseaseDR</span><span class="p">,</span><span class="n">RUDisease</span><span class="p">,</span><span class="n">ArriveWorkGroupDR</span><span class="p">,</span><span class="n">ArriveWorkGroup</span><span class="p">,</span><span class="n">ConcessionFlag</span><span class="p">,</span><span class="n">ICDs</span><span class="p">,</span><span class="n">IsPrintBar</span><span class="p">,</span><span class="n">LinkLabNo</span><span class="p">,</span><span class="n">TestSetCode</span><span class="p">,</span><span class="n">HISOrderID</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">d</span> <span class="n">OutPut</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"> 	<span class="n">Set</span> <span class="n">qHandle</span><span class="o">=$</span><span class="n">lb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">Quit</span> <span class="o">$$$</span><span class="n">OK</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="n">OutPut</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">ColFields</span><span class="o">=</span><span class="s2">&#34;VisitNumberDR,RegNo,AdmissionTypeDR,AdmissionType,AdmNo,MedicalRecordNo,AdmDate,AdmTime,CertTypeDR,CertType,CertNo,IDNumber,PaymentTypeDR,PaymentType,SurName,GivenName,SpeciesDR,BirthDate,BirthTime,Age,AgeUnitDR,AgeUnit,EthnicityDR,Ethnicity,HospitalDR,Hospital,LocationDR,Location,DoctorDR,Doctor,RequestDate,RequestTime,WardDR,Ward,BedNo,Symptom,MobileNo,PhoneNo,EMail,Height,Weight,BloodPressure,ClinicalConditionsDR,LMPDate,Pregnant,PregnantWeeks,AboDR,Abo,RhDR,Rh,Address,PostCode,InfectFlag,InfectAlert,SpecialFlag,PregnantNum,ChildbirthNum,ReqNotes,RequestNo,Urgent,CollectDate,CollectTime,CollectUserDR,CollectUser,AnatomicalSiteDR,AnatomicalSite,CollectPositon,SpecimenDR,Specimen,ContainerDR,Container,CollectNotes,H24UVolume,H24UTimePeriod,BodyTemp,Confidential,CarryDate,CarryTime,CarryUserDR,CarryUser,ReceiveDate,ReceiveTime,ReceiveUserDR,ReceiveUser,SpecimenQualityDR,SpecimenQuality,ReceiveNotes,InStorageDate,InStorageTime,InStorageUserDR,InStorageUser,OutStorageDate,OutStorageTime,OutStorageUserDR,OutStorageUser,OutStorageType,ReceiveHospitalDR,ReceiveHospital,AddDate,AddTime,AddUserDR,AddUser,FeeSum,AddType,AgeDesc,ArriveDate,ArriveTime,ArriveUserDR,ArriveUser,RUDiseaseDR,RUDisease,ArriveWorkGroupDR,ArriveWorkGroup,ConcessionFlag,ICDs,IsPrintBar,LinkLabNo&#34;</span>
</span></span><span class="line"><span class="cl"> 	<span class="n">Set</span> <span class="o">^</span><span class="n">CacheTemp</span><span class="p">(</span><span class="n">repid</span><span class="p">,</span><span class="n">ind</span><span class="p">)</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).TransListNull(Data,ColFields)</span>
</span></span><span class="line"><span class="cl"> 	<span class="n">Set</span> <span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="o">+</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="n">quit</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">QryVisitNumberInfoByLabNoClose</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">qHandle</span> <span class="n">As</span> <span class="o">%</span><span class="n">Binary</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="n">Status</span> <span class="p">[</span> <span class="n">PlaceAfter</span> <span class="o">=</span> <span class="n">QryVisitNumberInfoByLabNoExecute</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">Set</span> <span class="n">repid</span><span class="o">=$</span><span class="n">LIST</span><span class="p">(</span><span class="n">qHandle</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 	<span class="n">Kill</span> <span class="o">^</span><span class="n">CacheTemp</span><span class="p">(</span><span class="n">repid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">Quit</span> <span class="o">$$$</span><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">QryVisitNumberInfoByLabNoFetch</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">qHandle</span> <span class="n">As</span> <span class="o">%</span><span class="n">Binary</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">Row</span> <span class="n">As</span> <span class="o">%</span><span class="n">List</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">AtEnd</span> <span class="n">As</span> <span class="o">%</span><span class="n">Integer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="n">Status</span> <span class="p">[</span> <span class="n">PlaceAfter</span> <span class="o">=</span> <span class="n">QryVisitNumberInfoByLabNoExecute</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> 	<span class="n">Set</span> <span class="n">AtEnd</span><span class="o">=$</span><span class="n">LIST</span><span class="p">(</span><span class="n">qHandle</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 	<span class="n">Set</span> <span class="n">repid</span><span class="o">=$</span><span class="n">LIST</span><span class="p">(</span><span class="n">qHandle</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 	<span class="n">Set</span> <span class="n">ind</span><span class="o">=$</span><span class="n">LIST</span><span class="p">(</span><span class="n">qHandle</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 	<span class="n">Set</span> <span class="n">ind</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">CacheTemp</span><span class="p">(</span><span class="n">repid</span><span class="p">,</span><span class="n">ind</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"> 	<span class="n">If</span> <span class="n">ind</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="p">{</span>	
</span></span><span class="line"><span class="cl"> 		<span class="n">Set</span> <span class="n">AtEnd</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl"> 		<span class="n">Set</span> <span class="n">Row</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"> 	<span class="p">}</span>
</span></span><span class="line"><span class="cl"> 	<span class="n">Else</span>      <span class="p">{</span>	
</span></span><span class="line"><span class="cl"> 		<span class="n">Set</span> <span class="n">Row</span><span class="o">=^</span><span class="n">CacheTemp</span><span class="p">(</span><span class="n">repid</span><span class="p">,</span><span class="n">ind</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 	<span class="p">}</span>
</span></span><span class="line"><span class="cl"> 	<span class="o">//</span> <span class="n">Save</span> <span class="n">QHandle</span>
</span></span><span class="line"><span class="cl"> 	<span class="n">s</span> <span class="n">qHandle</span><span class="o">=$</span><span class="n">lb</span><span class="p">(</span><span class="n">AtEnd</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="n">ind</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">Quit</span> <span class="o">$$$</span><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="Âπ≥Âè∞ÁªÑÂõû‰º†ÁªìÊûúÊñπÊ≥ï">Âπ≥Âè∞ÁªÑÂõû‰º†ÁªìÊûúÊñπÊ≥ï
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/// HIS‰∫ßÂìÅÁªÑÂÜÖÈÉ®Áõ∏‰∫íË∞ÉÁî®ÁöÑÁªü‰∏ÄÂÖ•Âè£
</span></span><span class="line"><span class="cl">Class web.DHCENS.EnsHISService Extends (%RegisteredObject, %XML.Adaptor)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// CreatorÔºöWuXianPu
</span></span><span class="line"><span class="cl">/// CreatDateÔºö2012‚Äî03-06
</span></span><span class="line"><span class="cl">/// DescriptionÔºöÂπ≥Âè∞Êèê‰æõÁªôÂÖ∂‰ªñ‰∫ßÂìÅÁªÑË∞ÉÁî®Áªü‰∏ÄÂÖ•Âè£
</span></span><span class="line"><span class="cl">/// TableÔºöEns_Interface
</span></span><span class="line"><span class="cl">/// InputÔºöInput:ÊñπÊ≥ïÂèÇÊï∞,KeyName:‰∫ã‰ª∂ÂèÇÊï∞
</span></span><span class="line"><span class="cl">/// ReturnÔºö0^ÊàêÂäü  15559-2-001^15559||2
</span></span><span class="line"><span class="cl">/// OthersÔºöw ##class(web.DHCENS.EnsHISService).DHCHisInterface(&#34;SENDDOCORDITEMINFO&#34;,&#34;109||1&#34;)
</span></span><span class="line"><span class="cl">ClassMethod DHCHisInterface(KeyName As %String, Input...) As %GlobalCharacterStream
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  	s $zt=&#34;err&#34;
</span></span><span class="line"><span class="cl">	s n = $zu(41)
</span></span><span class="line"><span class="cl">	s method = $zu(41,n-2)	
</span></span><span class="line"><span class="cl">	s proc = ##class(%SYS.ProcessQuery).%OpenId($j)
</span></span><span class="line"><span class="cl">	s ip = proc.ClientIPAddress
</span></span><span class="line"><span class="cl">	s proc=&#34;&#34;
</span></span><span class="line"><span class="cl">	q:(&#34;&#34;=KeyName) &#34;-1^ÊñπÊ≥ï‰ª£Á†Å‰∏∫Á©∫!&#34;
</span></span><span class="line"><span class="cl">	s rowId=$o(^User.EnsInterfaceMethodI(&#34;MethodCode&#34;,&#34;classMethod&#34;,KeyName,&#34;&#34;))
</span></span><span class="line"><span class="cl">	s methodObj=##class(User.EnsInterfaceMethod).%OpenId(rowId)
</span></span><span class="line"><span class="cl">	if &#39;$isobject(methodObj){
</span></span><span class="line"><span class="cl">		q &#34;-1^ÊñπÊ≥ï‰∏çÂ≠òÂú®!&#34;
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	s methodStatus=methodObj.methodStatus
</span></span><span class="line"><span class="cl">	if (methodStatus=&#34;N&#34;) {
</span></span><span class="line"><span class="cl">		q &#34;-1^ÊñπÊ≥ïÊú™ÂêØÁî®!&#34;
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	s className=methodObj.methodClassName
</span></span><span class="line"><span class="cl">	s methodName=methodObj.methodName
</span></span><span class="line"><span class="cl">	s methodInput=methodObj.methodInput
</span></span><span class="line"><span class="cl">	s OutputType=$p($p(methodObj.methodOutput,$char(28),1),$char(2),1)
</span></span><span class="line"><span class="cl">	s OutputDesc=$p($p(methodObj.methodOutput,$char(28),1),$char(2),2)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	s tmpInput=&#34;&#34;,tmpSubInput=&#34;&#34;,perInput=&#34;&#34;,IntInputDesc=&#34;&#34;
</span></span><span class="line"><span class="cl">	f i=1:1:$g(Input,0){
</span></span><span class="line"><span class="cl">		s @(&#34;Input&#34;_i)=$g(Input(i),&#34;&lt;NULL&gt;&#34;)
</span></span><span class="line"><span class="cl">		s tInputType=$p($p(methodInput,$char(28),i),$char(2),1)
</span></span><span class="line"><span class="cl">		s tmpSubInput=$g(Input(i),&#34;&lt;NULL&gt;&#34;)
</span></span><span class="line"><span class="cl">		s tmpIntInputDesc=$p($p(methodInput,$char(28),i),$char(2),3)
</span></span><span class="line"><span class="cl">		if (IntInputDesc=&#34;&#34;){
</span></span><span class="line"><span class="cl">			s IntInputDesc=tmpIntInputDesc
</span></span><span class="line"><span class="cl">		}else{
</span></span><span class="line"><span class="cl">			s IntInputDesc=IntInputDesc_$char(2)_tmpIntInputDesc
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">		if (tInputType=&#34;%GlobalCharacterStream&#34;){
</span></span><span class="line"><span class="cl">			s tmpSubInput=tmpSubInput.Read()
</span></span><span class="line"><span class="cl">			s tsc=Input(i).Rewind()
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">		if (tmpInput=&#34;&#34;){
</span></span><span class="line"><span class="cl">			s tmpInput=&#34;Input&#34;_i
</span></span><span class="line"><span class="cl">			s perInput=tmpSubInput
</span></span><span class="line"><span class="cl">		}else{
</span></span><span class="line"><span class="cl">			s tmpInput=tmpInput_&#34;,&#34;_&#34;Input&#34;_i
</span></span><span class="line"><span class="cl">			s perInput=perInput_&#34;,&#34;_tmpSubInput
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	//ÂêØÁî®Êó•ÂøóËÆ∞ÂΩïÊ†áËØÜÂäüËÉΩ
</span></span><span class="line"><span class="cl">	s EnsInterfaceFlag=methodObj.EnsInterfaceFlag
</span></span><span class="line"><span class="cl">	if (EnsInterfaceFlag=&#34;N&#34;)
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		s exeStr=&#34;rtn=##class(&#34;_className_&#34;).&#34;_methodName_&#34;(&#34;_tmpInput_&#34;)&#34;
</span></span><span class="line"><span class="cl">		s @exeStr
</span></span><span class="line"><span class="cl">		s result=@&#34;rtn&#34;
</span></span><span class="line"><span class="cl">		q result	
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	s perStream=##class(%GlobalCharacterStream).%New()
</span></span><span class="line"><span class="cl">	d perStream.Write(perInput)
</span></span><span class="line"><span class="cl">	//Êé•Âè£Ë°®ÂÜôÊï∞ÊçÆ
</span></span><span class="line"><span class="cl">	s @&#34;KeyName&#34;=rowId
</span></span><span class="line"><span class="cl">	s @&#34;Method&#34;=method
</span></span><span class="line"><span class="cl">	s @&#34;Ip&#34;=ip
</span></span><span class="line"><span class="cl">	s @&#34;PerStream&#34;=perStream
</span></span><span class="line"><span class="cl">	s @&#34;IntInputDesc&#34;=IntInputDesc
</span></span><span class="line"><span class="cl">	s exeStr=&#34;ensRtn=##class(web.DHCENS.STBLL.UTIL.EnsInterface).InsertEnsInterface(KeyName,Method,Ip,PerStream,IntInputDesc)&#34;
</span></span><span class="line"><span class="cl">	s @exeStr
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	s resultStr=@&#34;ensRtn&#34;
</span></span><span class="line"><span class="cl">	if (className=&#34;web.DHCENS.STBLL.UTIL.EnsInterface&#34;)&amp;&amp;(methodName=&#34;InsertEnsInterface&#34;){
</span></span><span class="line"><span class="cl">		if OutputType=&#34;%GlobalCharacterStream&#34; {
</span></span><span class="line"><span class="cl">			set rtn=##class(web.DHCENS.STBLL.MANAGE.MergeInstance).SendMergeInfo(KeyName,perStream)
</span></span><span class="line"><span class="cl">			do resultStr.CopyFrom(rtn)
</span></span><span class="line"><span class="cl">			set sc=##class(web.DHCENS.STBLL.UTIL.EnsInterface).UpdateOutputResult($p(resultStr,&#34;^&#34;,2),&#34;Y&#34;,resultStr)
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">		else {
</span></span><span class="line"><span class="cl">			set stream=##class(%Stream.GlobalCharacter).%New()
</span></span><span class="line"><span class="cl">			d stream.Write(resultStr)
</span></span><span class="line"><span class="cl">			set rtn=##class(web.DHCENS.STBLL.MANAGE.MergeInstance).SendMergeInfo(KeyName,perStream)
</span></span><span class="line"><span class="cl">			d stream.Write(&#34;^&#34;)
</span></span><span class="line"><span class="cl">			do stream.CopyFrom(rtn)
</span></span><span class="line"><span class="cl">			set sc=##class(web.DHCENS.STBLL.UTIL.EnsInterface).UpdateOutputResult($p(resultStr,&#34;^&#34;,2),&#34;Y&#34;,stream)
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">		;d ##class(web.DHCENS.STBLL.MANAGE.MergeInstance).SendMergeInfo(KeyName,perStream)
</span></span><span class="line"><span class="cl">		q resultStr
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	s exeStr=&#34;rtn=##class(&#34;_className_&#34;).&#34;_methodName_&#34;(&#34;_tmpInput_&#34;)&#34;
</span></span><span class="line"><span class="cl">	s @exeStr
</span></span><span class="line"><span class="cl">	set result=@&#34;rtn&#34;
</span></span><span class="line"><span class="cl">	if OutputType=&#34;%GlobalCharacterStream&#34; {
</span></span><span class="line"><span class="cl">		set sc=##class(web.DHCENS.STBLL.UTIL.EnsInterface).UpdateOutputResult($p(resultStr,&#34;^&#34;,2),&#34;Y&#34;,result)
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	else {
</span></span><span class="line"><span class="cl">		set stream=##class(%GlobalCharacterStream).%New()
</span></span><span class="line"><span class="cl">		d stream.Write(result)
</span></span><span class="line"><span class="cl">		set sc=##class(web.DHCENS.STBLL.UTIL.EnsInterface).UpdateOutputResult($p(resultStr,&#34;^&#34;,2),&#34;Y&#34;,stream)
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	s methodObj=&#34;&#34;
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	q result
</span></span><span class="line"><span class="cl">err
</span></span><span class="line"><span class="cl">	//set resultStr=@&#34;ensRtn&#34;
</span></span><span class="line"><span class="cl">	//set stream=##class(%GlobalCharacterStream).%New()
</span></span><span class="line"><span class="cl">	//d stream.Write(&#34;-1^&#34;_$ze)
</span></span><span class="line"><span class="cl">	//set sc=##class(web.DHCENS.STBLL.UTIL.EnsInterface).UpdateOutputResult($p(resultStr,&#34;^&#34;,2),&#34;N&#34;,stream)
</span></span><span class="line"><span class="cl">	q &#34;-1^&#34;_$ze
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// -------------------------------------ÂåªÁîüÁ´ôË∞ÉÁî®ÔºàÂêåÊ≠•Ôºâ-----------------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// CreatorÔºöWuXianPu
</span></span><span class="line"><span class="cl">/// CreatDateÔºö2012‚Äî05-24
</span></span><span class="line"><span class="cl">/// DescriptionÔºöÂåªÁîüÁ´ôÂè´Âè∑
</span></span><span class="line"><span class="cl">/// TableÔºö
</span></span><span class="line"><span class="cl">/// InputÔºöÊ†áÂøó^È°∫Â∫èÂè∑^ÁôªËÆ∞Âè∑^ÂßìÂêç^Êó•Êúü^Êó∂Èó¥^ÁßëÂÆ§Rowid^ÁßëÂÆ§^ÂåªÁîüRowid^ÂåªÁîü^Áä∂ÊÄÅ^ËØäÂÆ§IP^Âè∑Âà´ÂêçÁß∞^ËØäÂÆ§ÂêçÁß∞
</span></span><span class="line"><span class="cl">/// ReturnÔºö0^ÊàêÂäü
</span></span><span class="line"><span class="cl">/// Others: w ##class(web.DHCENS.EnsHISService).SetAdmCallInfo(&#34;Y^5^377^ËæõÁª¥Èùí^2011-05-06^09:58:46AM^72^ÂøÉËÉ∏Â§ñÁßëÈó®ËØä^451^Áî∞ÂáØÂçé^Â§çËØä^‰∫åÂçÅ^ËÉ∏Â§ñÁßë‰∏ìÂÆ∂Âè∑(ÂÖ®Â§©)^‰∫åÂçÅ&#34;)
</span></span><span class="line"><span class="cl">ClassMethod SendAdmCallInfo(Input As %String) As %String
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	Quit &#34;0^ÊàêÂäü&#34;
</span></span><span class="line"><span class="cl">	q:Input=&#34;&#34; &#34;-1^ËæìÂÖ•‰ø°ÊÅØ‰∏çËÉΩ‰∏∫Á©∫&#34;
</span></span><span class="line"><span class="cl">	//set result=##class(web.DHCENS.BLL.Empi.Method.CallInfo).SetCallInfo(Input)
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// ÁªìÁÆóÂâç
</span></span><span class="line"><span class="cl">ClassMethod DHCHisOpChargeSend(Input As %String) As %String
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	Quit &#34;0^ÊàêÂäü&#34;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// CreatorÔºöWuXianPu
</span></span><span class="line"><span class="cl">/// CreatDateÔºö2012‚Äî05-10
</span></span><span class="line"><span class="cl">/// DescriptionÔºöËÆ°ÁÆóËØïÁÆ°Êï∞Èáè
</span></span><span class="line"><span class="cl">/// TableÔºö
</span></span><span class="line"><span class="cl">/// InputÔºöÂåªÂò±RowID^ÂåªÂò±RowID^ÂåªÂò±RowID^
</span></span><span class="line"><span class="cl">/// ReturnÔºö0^ÊàêÂäü,-1^Â§±Ë¥•
</span></span><span class="line"><span class="cl">/// OthersÔºöw ##class(web.DHCENS.EnsHISService).GetAmountOfTube(&#34;149||5^149||6&#34;)
</span></span><span class="line"><span class="cl">ClassMethod GetAmountOfTube(Input As %String, DeptCode As %String = &#34;&#34;) As %String
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	Quit &#34;0^ÊàêÂäü&#34;
</span></span><span class="line"><span class="cl">	set result=##class(web.DHCENS.STBLL.LIS.METHOD.AmountOfTube).AmountOfTube(Input,DeptCode)
</span></span><span class="line"><span class="cl">	Quit result
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// CreatorÔºöWuXianPu
</span></span><span class="line"><span class="cl">/// CreatDateÔºö2012‚Äî03-06
</span></span><span class="line"><span class="cl">/// DescriptionÔºöÊ†πÊçÆÂ§ÑÊñπÂè∑Êü•ËØ¢Â§ÑÊñπÁä∂ÊÄÅ(ÂêåÊ≠•Èó®ËØäÂèëËçØÊú∫) 
</span></span><span class="line"><span class="cl">/// TableÔºö
</span></span><span class="line"><span class="cl">/// InputÔºöÂ§ÑÊñπÂè∑
</span></span><span class="line"><span class="cl">/// ReturnÔºö
</span></span><span class="line"><span class="cl">/// OthersÔºöw ##class(web.DHCENS.EnsHISService).StartSendDrugInfo(&#34;34794&#34;)
</span></span><span class="line"><span class="cl">ClassMethod StartSendDrugInfo(Input As %String) As %String
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	Quit &#34;0^ÊàêÂäü&#34;
</span></span><span class="line"><span class="cl">	//q:Input=&#34;&#34; &#34;-1^ËæìÂÖ•‰ø°ÊÅØ‰∏çËÉΩ‰∏∫Á©∫&#34;
</span></span><span class="line"><span class="cl">	//set result=##class(web.DHCENS.BLL.Drug.Method.SelectPresStatus).SelectPresStatusByPresno(Input)
</span></span><span class="line"><span class="cl">	//q result
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// CreatorÔºöWuXianPu
</span></span><span class="line"><span class="cl">/// CreatDateÔºö2012‚Äî06-12
</span></span><span class="line"><span class="cl">/// DescriptionÔºöHISÂèëÈÄÅÂÆåÊàêÁóÖ‰∫∫ÂèëËçØ‰ø°ÊÅØ
</span></span><span class="line"><span class="cl">/// TableÔºö
</span></span><span class="line"><span class="cl">/// InputÔºö
</span></span><span class="line"><span class="cl">/// ReturnÔºö0^ÊàêÂäü
</span></span><span class="line"><span class="cl">/// OthersÔºöw ##class(web.DHCENS.EnsHISService).FinishSendDrugInfo(&#34;&#34;)
</span></span><span class="line"><span class="cl">ClassMethod FinishSendDrugInfo(Input As %String) As %String
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	Quit &#34;0^ÊàêÂäü&#34;
</span></span><span class="line"><span class="cl">	//set result=##class(web.DHCENS.BLL.Drug.Method.FinishPharmaceutist).FinishPharmaceutist(Input)
</span></span><span class="line"><span class="cl">	//q result
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// -------------------------------ËçØÊàøË∞ÉÁî®ÈÉ®ÂàÜ(ÂêåÊ≠•)--------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// CreatorÔºöWuXianPu
</span></span><span class="line"><span class="cl">/// CreatDateÔºö2012‚Äî03-06
</span></span><span class="line"><span class="cl">/// DescriptionÔºöÂèëÈÄÅHIS‰∏≠ËçØÂìÅÂåªÂò±‰ø°ÊÅØ(ÂêåÊ≠•‰ΩèÈô¢ÊëÜËçØÊú∫) 
</span></span><span class="line"><span class="cl">/// TableÔºöDHC_PhaCollected
</span></span><span class="line"><span class="cl">/// InputÔºö‰ΩèÈô¢ËçØÂìÅÂèëËçØË°®ROWID
</span></span><span class="line"><span class="cl">/// ReturnÔºö0^ÊàêÂäü
</span></span><span class="line"><span class="cl">/// OthersÔºöw ##class(web.DHCENS.EnsHISService).DispenseIPDrugInfo(&#34;34271&#34;)
</span></span><span class="line"><span class="cl">ClassMethod DispenseIPDrugInfo(Input As %String) As %String
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	Quit &#34;0^ÊàêÂäü&#34;
</span></span><span class="line"><span class="cl">	;q:Input=&#34;&#34; &#34;-1^ËæìÂÖ•‰ø°ÊÅØ‰∏çËÉΩ‰∏∫Á©∫&#34;
</span></span><span class="line"><span class="cl">	set result=##class(web.DHCENS.STBLL.DRUG.METHOD.IPDrugOrdInfo).DispenseIPDrugInfo(Input)
</span></span><span class="line"><span class="cl">	q result
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// ---------------------------------------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// CreatorÔºöWuXianPu
</span></span><span class="line"><span class="cl">/// CreatDateÔºö2012‚Äî11-10
</span></span><span class="line"><span class="cl">/// DescriptionÔºöÂåªÁîüÂÅúÂåªÂò±ÔºåÈÄöÁü•Á¨¨‰∏âÊñπÁ≥ªÁªüÊ≠§Áî≥ËØ∑Âçï‰ΩúÂ∫ü
</span></span><span class="line"><span class="cl">/// TableÔºö
</span></span><span class="line"><span class="cl">/// InputÔºö ÁóÖ‰∫∫RowID^ÂåªÂò±Âè∑^Ë°ÄÊ∂≤Á±ªÂûã‰ø°ÊÅØ^Êó•Êúü
</span></span><span class="line"><span class="cl">/// ReturnÔºö0^0‰∏çÈúÄË¶ÅÈááË°ÄÔºõ0^1ÈúÄË¶ÅÈááË°Ä
</span></span><span class="line"><span class="cl">/// Others: w ##class(web.DHCENS.EnsHISService).JudgeCollection(&#34;&#34;)
</span></span><span class="line"><span class="cl">ClassMethod JudgeCollectionBloodInfo(Input As %String) As %String
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	Quit &#34;0^ÊàêÂäü&#34;
</span></span><span class="line"><span class="cl">	//set result=##class(web.DHCENS.BLL.Blood.Method.JudgeCollection).JudgeCollection(Input)
</span></span><span class="line"><span class="cl">	//q result
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ClassMethod CreateEmergencyPageData(StartDate As %String, EndDate As %String) As %String
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	s:StartDate=&#34;&#34; StartDate=$zd(+$h,3)
</span></span><span class="line"><span class="cl">	s Year=$p(StartDate,&#34;-&#34;,1)
</span></span><span class="line"><span class="cl">	s Month=$p(StartDate,&#34;-&#34;,2)
</span></span><span class="line"><span class="cl">	s SDate=$zdh(Year_&#34;-&#34;_Month_&#34;-01&#34;,3)
</span></span><span class="line"><span class="cl">	s Mod4=Year#4
</span></span><span class="line"><span class="cl">	s Mod100=Year#100
</span></span><span class="line"><span class="cl">	if ((Month=&#34;04&#34;)||(Month=&#34;06&#34;)||(Month=&#34;09&#34;)||(Month=&#34;11&#34;)) 
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		set EMonth=Month_&#34;-30&#34;
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	elseif((Month=&#34;02&#34;)&amp;&amp;(Mod4=&#34;0&#34;)&amp;&amp;(Mod100&#39;=&#34;0&#34;))
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		set EMonth=Month_&#34;-29&#34;
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	elseif((Month=&#34;02&#34;)&amp;&amp;(Mod4=&#34;0&#34;)&amp;&amp;(Mod100=&#34;0&#34;))
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		set EMonth=Month_&#34;-28&#34;
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	else
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		set EMonth=Month_&#34;-31&#34;
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	s EDate=$zdh(Year_&#34;-&#34;_EMonth,3)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	k ^TmpDHCENS(&#34;EmergencyPageData&#34;)
</span></span><span class="line"><span class="cl">	f i=SDate:1:EDate
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		s PrtRowid=&#34;&#34; f  s PrtRowid=$o(^DHCINVPRT(0,&#34;Date&#34;,i,PrtRowid)) q:PrtRowid=&#34;&#34;  d
</span></span><span class="line"><span class="cl">		.s DHCBCIRowid=&#34;&#34; f  s DHCBCIRowid=$o(^DHCBCI(0,&#34;INV&#34;,PrtRowid,DHCBCIRowid)) q:DHCBCIRowid=&#34;&#34;  d
</span></span><span class="line"><span class="cl">		..s AdmDr=$p($g(^DHCBCI(DHCBCIRowid)),&#34;^&#34;,3)
</span></span><span class="line"><span class="cl">		..i AdmDr&#39;=&#34;&#34; d
</span></span><span class="line"><span class="cl">		...s ^TmpDHCENS(&#34;EmergencyPageData&#34;,$zd(+$h,3),AdmDr)=&#34;&#34;
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	;Ë∞ÉÁî®ÁîµÂ≠êÁóÖÂéÜÊñπÊ≥ïÂèñÂæóËß¶ÁäØÊù°ÁõÆÔºåÂÖ•ÂèÇÂ∞±ËØäÂè∑
</span></span><span class="line"><span class="cl">	f  {
</span></span><span class="line"><span class="cl">	s ID=$o(^TmpDHCENS(&#34;EmergencyPageData&#34;,$zd(+$h,3),ID)) q:ID=&#34;&#34;
</span></span><span class="line"><span class="cl">	s status=##Class(EPRservice.BIL.BIEPRLogs).GetOutFristPageStatus(ID)
</span></span><span class="line"><span class="cl">	i status=&#34;finished&#34;
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		set intnum=0,result=&#34;Items&#34;,AdmDate=&#34;&#34;
</span></span><span class="line"><span class="cl">		set AdmDate=&#34;&#34;
</span></span><span class="line"><span class="cl">		set status=&#34;&#34;
</span></span><span class="line"><span class="cl">		k rset
</span></span><span class="line"><span class="cl">		Set rset = ##class(%ResultSet).%New(&#34;EPRservice.BIL.BIQuality:GetResultDetailList&#34;)	
</span></span><span class="line"><span class="cl">		Set sc = rset.Execute(ID)
</span></span><span class="line"><span class="cl">		While(rset.Next()) 
</span></span><span class="line"><span class="cl">		{
</span></span><span class="line"><span class="cl">			s ItemRowId=rset.GetDataByName(&#34;ExamEntry&#34;)
</span></span><span class="line"><span class="cl">			s ItemDesc=rset.GetDataByName(&#34;EntryDesc&#34;)
</span></span><span class="line"><span class="cl">			s DocName=rset.GetDataByName(&#34;DocName&#34;)
</span></span><span class="line"><span class="cl">			s DocRowId=rset.GetDataByName(&#34;DocRowid&#34;)
</span></span><span class="line"><span class="cl">			s EntryScore=rset.GetDataByName(&#34;EntryScore&#34;)
</span></span><span class="line"><span class="cl">			s result=result_&#34;#&#34;_ItemRowId_&#34;:&#34;_ItemDesc
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">		s AdmDate=$p($g(^PAADM(ID)),&#34;^&#34;,6)
</span></span><span class="line"><span class="cl">		s OnLoadDate=Year_&#34;-&#34;_Month
</span></span><span class="line"><span class="cl">		;Ë∞ÉÊñπÊ≥ïÂèñÂæóË¥®ÊéßÂàÜÊï∞Âπ∂ËøõË°åÂà§Êñ≠ÔºåÂàÜÊï∞Â∞è‰∫é100ÁöÑÊúâÈóÆÈ¢ò
</span></span><span class="line"><span class="cl">		s flag=&#34;&#34;,ItemScore=&#34;&#34;
</span></span><span class="line"><span class="cl">		s ItemScore=##Class(EPRservice.BIL.BIQuality).GetResultScore(ID)
</span></span><span class="line"><span class="cl">		i ItemScore=100  d
</span></span><span class="line"><span class="cl">		.s flag=&#34;Y&#34;
</span></span><span class="line"><span class="cl">		e  d
</span></span><span class="line"><span class="cl">		.s flag=&#34;N&#34;
</span></span><span class="line"><span class="cl">		set retStr=..DHCHisInterface(&#34;SENDEMERGENCYADMFIRSTPAGEINFO&#34;,ID_&#34;^&#34;_flag_&#34;^&#34;_result_&#34;^&#34;_AdmDate_&#34;^&#34;_OnLoadDate)
</span></span><span class="line"><span class="cl">		set intnum=intnum+1
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	Quit intnum
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// creator:liyi
</span></span><span class="line"><span class="cl">/// creatdate:20121221
</span></span><span class="line"><span class="cl">/// description:ÂèñÂΩìÂ§©ÔºàÂ¶ÇÊûú‰ªªÂä°Âú®Êó©‰∏äÂáåÊô®ÔºåÂèñÂâç‰∏ÄÂ§©ÔºâÂÆåÊàêÁóÖÊ°àÂΩíÊ°£Êìç‰ΩúÁöÑÊâÄÊúâÁóÖÊ°àÁöÑadm,paamd_rowid
</span></span><span class="line"><span class="cl">/// input:argDateFrom argDateTo
</span></span><span class="line"><span class="cl">/// output:
</span></span><span class="line"><span class="cl">/// debug:w ##class(web.DHCENS.EnsHISService).GetRecordAdmList(&#34;2012-10-01&#34;,&#34;2013-01-14&#34;)
</span></span><span class="line"><span class="cl">/// debug:w ##class(web.DHCWMRInterface.ReceiptSrv).GetRecordAdmList(&#34;&#34;,&#34;&#34;)
</span></span><span class="line"><span class="cl">ClassMethod GetRecordAdmList(argDateFrom As %String, argDateTo As %String) As %String
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	//New (argDateFrom,argDateTo)
</span></span><span class="line"><span class="cl">	//Set return=&#34;&#34;
</span></span><span class="line"><span class="cl">	Set $ZT=&#34;GetRecordAdmListErr&#34;
</span></span><span class="line"><span class="cl">	Set:argDateFrom[&#34;/&#34; argDateFrom=$zdh(argDateFrom,4)
</span></span><span class="line"><span class="cl">	Set:argDateFrom[&#34;-&#34; argDateFrom=$zdh(argDateFrom,3)
</span></span><span class="line"><span class="cl">	Set:argDateFrom&#39;=&#34;&#34; argDateFrom=+argDateFrom
</span></span><span class="line"><span class="cl">	Set:argDateTo[&#34;/&#34; argDateTo=$zdh(argDateTo,4)
</span></span><span class="line"><span class="cl">	Set:argDateTo[&#34;-&#34; argDateTo=$zdh(argDateTo,3)
</span></span><span class="line"><span class="cl">	Set:argDateTo&#39;=&#34;&#34; argDateTo=+argDateTo
</span></span><span class="line"><span class="cl">	Set Count=0
</span></span><span class="line"><span class="cl">	//ÂèñÂΩìÂâçÁ≥ªÁªüÁöÑÂΩíÊ°£‰∏äÊû∂Êìç‰ΩúID
</span></span><span class="line"><span class="cl">	Set WorkItemId=&#34;&#34;
</span></span><span class="line"><span class="cl">	/*
</span></span><span class="line"><span class="cl">	For{
</span></span><span class="line"><span class="cl">		Set WorkItemId=$o(^DHCWMRWITM(WorkItemId))
</span></span><span class="line"><span class="cl">		Quit:WorkItemId=&#34;&#34;
</span></span><span class="line"><span class="cl">		Continue:$p($g(^DHCWMRWITM(WorkItemId)),&#34;^&#34;,3)=&#34;N&#34;
</span></span><span class="line"><span class="cl">		s:$p($g(^DHCWMRWITM(WorkItemId)),&#34;^&#34;,2)=&#34;ÁóÖÊ°àÁºñÁõÆ&#34; StatusDr=WorkItemId   //Ê†πÊçÆÂåªÈô¢ÂΩíÊ°£‰∏äÊû∂ÂÖ∑‰ΩìÁöÑÊèèËø∞Êù•Âà§Êñ≠
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">	*/
</span></span><span class="line"><span class="cl">	Set StatusDr=8    ;ÁóÖÊ°àÁºñÁõÆ
</span></span><span class="line"><span class="cl">	//Â¶ÇÊûú‰º†ÂÖ•ÂèÇÊï∞‰∏∫Á©∫ÔºåÂâç‰∏ÄÂ§©ÁöÑÂΩíÊ°£Êìç‰ΩúÁöÑÊâÄÊúâÁóÖÊ°à
</span></span><span class="line"><span class="cl">	if (argDateTo=&#34;&#34;)&amp;&amp;(argDateFrom=&#34;&#34;)
</span></span><span class="line"><span class="cl">		{
</span></span><span class="line"><span class="cl">			Set QueryDate=$p($h,&#34;,&#34;,1)
</span></span><span class="line"><span class="cl">			Set MainVolumeId=&#34;&#34;
</span></span><span class="line"><span class="cl">			For{
</span></span><span class="line"><span class="cl">				Set MainVolumeId=$o(^DHCWMRVOL(0,&#34;VSDateStatus&#34;,QueryDate,StatusDr,MainVolumeId))
</span></span><span class="line"><span class="cl">				Quit:MainVolumeId=&#34;&#34;
</span></span><span class="line"><span class="cl">				
</span></span><span class="line"><span class="cl">				Continue:$p($g(^DHCWMRVOL(MainVolumeId)),&#34;^&#34;,7)=&#34;N&#34;
</span></span><span class="line"><span class="cl">				Set PaadmDr=$p($g(^DHCWMRVOL(MainVolumeId)),&#34;^&#34;,2)
</span></span><span class="line"><span class="cl">				
</span></span><span class="line"><span class="cl">				//Set return=$lb(PaadmDr,return)
</span></span><span class="line"><span class="cl">				//Ê≠§Â§ÑË∞ÉÁî®Êèê‰æõÁöÑÊé•Âè£
</span></span><span class="line"><span class="cl">				do ##class(web.DHCENS.EnsHISService).DHCHisInterface(&#34;SENDINHOSPITALADMFIRSTPAGEINFO&#34;,PaadmDr) 
</span></span><span class="line"><span class="cl">				Set Count=Count+1
</span></span><span class="line"><span class="cl">				}
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">	//Â¶ÇÊûú‰∏§‰∏™‰º†ÂÖ•ÂèÇÊï∞‰∏ç‰∏∫Á©∫
</span></span><span class="line"><span class="cl">	if (argDateFrom&#39;=&#34;&#34;)&amp;&amp;(argDateTo&#39;=&#34;&#34;)
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		;Set QueryDate=argDateFrom
</span></span><span class="line"><span class="cl">		for QueryDate=argDateFrom:1:argDateTo {
</span></span><span class="line"><span class="cl">			Set MainVolumeId=&#34;&#34;
</span></span><span class="line"><span class="cl">			for{		
</span></span><span class="line"><span class="cl">				Set MainVolumeId=$o(^DHCWMRVOL(0,&#34;VSDateStatus&#34;,QueryDate,StatusDr,MainVolumeId))
</span></span><span class="line"><span class="cl">				Quit:MainVolumeId=&#34;&#34;
</span></span><span class="line"><span class="cl">				;w MainVolumeId,!
</span></span><span class="line"><span class="cl">				Continue:QueryDate&gt;argDateTo
</span></span><span class="line"><span class="cl">				Continue:$p($g(^DHCWMRVOL(MainVolumeId)),&#34;^&#34;,7)=&#34;N&#34;
</span></span><span class="line"><span class="cl">				Set PaadmDr=$p($g(^DHCWMRVOL(MainVolumeId)),&#34;^&#34;,2)
</span></span><span class="line"><span class="cl">				//Set return=$lb(PaadmDr,return)
</span></span><span class="line"><span class="cl">				//Ê≠§Â§ÑË∞ÉÁî®Êèê‰æõÁöÑÊé•Âè£
</span></span><span class="line"><span class="cl">				do ##class(web.DHCENS.EnsHISService).DHCHisInterface(&#34;SENDINHOSPITALADMFIRSTPAGEINFO&#34;,PaadmDr)
</span></span><span class="line"><span class="cl">				Set Count=Count+1
</span></span><span class="line"><span class="cl">			}
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	//Â¶ÇÊûúÂºÄÂßãÊó•Êúü‰∏∫‰∏ç‰∏∫Á©∫ÔºåÁªìÊùüÊó•Êúü‰∏∫Á©∫
</span></span><span class="line"><span class="cl">	if (argDateFrom&#39;=&#34;&#34;)&amp;&amp;(argDateTo=&#34;&#34;)
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		Set CurrDate=$p($h,&#34;,&#34;,1)
</span></span><span class="line"><span class="cl">		if (argDateFrom&lt;=CurrDate)
</span></span><span class="line"><span class="cl">			{
</span></span><span class="line"><span class="cl">				Set QueryDate=argDateFrom
</span></span><span class="line"><span class="cl">				Set MainVolumeId=&#34;&#34;
</span></span><span class="line"><span class="cl">				for{
</span></span><span class="line"><span class="cl">					Set MainVolumeId=$o(^DHCWMRVOL(0,&#34;VSDateStatus&#34;,QueryDate,StatusDr,MainVolumeId))
</span></span><span class="line"><span class="cl">					Quit:MainVolumeId=&#34;&#34;
</span></span><span class="line"><span class="cl">					Continue:QueryDate&gt;argDateFrom
</span></span><span class="line"><span class="cl">					Continue:$p($g(^DHCWMRVOL(MainVolumeId)),&#34;^&#34;,7)=&#34;N&#34;
</span></span><span class="line"><span class="cl">					Set PaadmDr=$p($g(^DHCWMRVOL(MainVolumeId)),&#34;^&#34;,2)
</span></span><span class="line"><span class="cl">					//Set return=$lb(PaadmDr,return)
</span></span><span class="line"><span class="cl">					//Ê≠§Â§ÑË∞ÉÁî®Êèê‰æõÁöÑÊé•Âè£
</span></span><span class="line"><span class="cl">					do ##class(web.DHCENS.EnsHISService).DHCHisInterface(&#34;SENDINHOSPITALADMFIRSTPAGEINFO&#34;,PaadmDr)
</span></span><span class="line"><span class="cl">					Set Count=Count+1
</span></span><span class="line"><span class="cl">				}
</span></span><span class="line"><span class="cl">			}
</span></span><span class="line"><span class="cl">	 }
</span></span><span class="line"><span class="cl">	Quit Count
</span></span><span class="line"><span class="cl">GetRecordAdmListErr
</span></span><span class="line"><span class="cl">     Quit -1
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="Âπ≥Âè∞ÁªÑËé∑ÂèñÊ†áÊú¨Áî≥ËØ∑Âçï‰ø°ÊÅØ">Âπ≥Âè∞ÁªÑËé∑ÂèñÊ†áÊú¨Áî≥ËØ∑Âçï‰ø°ÊÅØ
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Class web.DHCENS.STBLL.SOAP.HISSystemServieSoap Extends %SOAP.WebClient [ ProcedureBlock ]
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// This is the URL used to access the web service.
</span></span><span class="line"><span class="cl">Parameter LOCATION = &#34;https://10.49.1.109:1443/csp/hsb/DHC.Published.HISSystemServie.BS.HISSystemServie.cls&#34;;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// This is the namespace used by the Service
</span></span><span class="line"><span class="cl">Parameter NAMESPACE = &#34;http://www.dhcc.com.cn&#34;;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// Use xsi:type attribute for literal types.
</span></span><span class="line"><span class="cl">Parameter OUTPUTTYPEATTRIBUTE = 1;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// Determines handling of Security header.
</span></span><span class="line"><span class="cl">Parameter SECURITYIN = &#34;ALLOW&#34;;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// This is the name of the Service
</span></span><span class="line"><span class="cl">Parameter SERVICENAME = &#34;HISSystemServie&#34;;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// This is the SOAP version supported by the service.
</span></span><span class="line"><span class="cl">Parameter SOAPVERSION = 1.1;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Method HIPMessageServer(action As %String, message As %GlobalCharacterStream) As %GlobalCharacterStream [ Final, ProcedureBlock = 1, SoapBindingStyle = document, SoapBodyUse = literal, WebMethod ]
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl"> Quit ..WebMethod(&#34;HIPMessageServer&#34;).Invoke($this,&#34;http://www.dhcc.com.cn/DHC.Published.HISSystemServie.BS.HISSystemServie.HIPMessageServer&#34;,.action,.message)
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// 
</span></span><span class="line"><span class="cl">/// input1 MES0022    input2  **4860462*    ÈÄöËøáÊù°Á†ÅÂè∑Ëé∑ÂèñÊ£ÄÈ™åÁî≥ËØ∑Âçï‰ø°ÊÅØ
</span></span><span class="line"><span class="cl">/// input1 MES0024    input2  24041406012005    Ëé∑Âèñ‰ΩìÊ£ÄÂåªÂò±‰ø°ÊÅØÔºà‰ΩìÊ£ÄÔºâ
</span></span><span class="line"><span class="cl">ClassMethod HIPMessageServerS(input1 As %String, input2 As %GlobalCharacterStream) As %GlobalCharacterStream
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	Try
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		S HSBSOAP=##class(web.DHCENS.STBLL.SOAP.HISSystemServieSoap).%New()
</span></span><span class="line"><span class="cl">		s HSBSOAP.SSLConfiguration=&#34;SSLECP&#34;
</span></span><span class="line"><span class="cl">		s HSBSOAP.SSLCheckServerIdentity=&#34;0&#34;
</span></span><span class="line"><span class="cl">		s Rtnstream=HSBSOAP.HIPMessageServer(input1,input2)
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	Catch
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		s Rtnstream=##class(%GlobalCharacterStream).%New()
</span></span><span class="line"><span class="cl">		d Rtnstream.Write($ze)	
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	q Rtnstream
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// w ##class(web.DHCENS.STBLL.SOAP.HISSystemServieSoap).test().Read()
</span></span><span class="line"><span class="cl">ClassMethod test(input As %String) As %GlobalCharacterStream
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	s stream=##class(%GlobalCharacterStream).%New()
</span></span><span class="line"><span class="cl">	;d stream.Write(&#34;**4860462*&#34;)
</span></span><span class="line"><span class="cl">	d stream.Write(&#34;**8015327*&#34;)
</span></span><span class="line"><span class="cl">	// w ##class(web.DHCENS.STBLL.SOAP.HISSystemServieSoap).HIPMessageServerS(&#34;MES0026&#34;,stream)
</span></span><span class="line"><span class="cl">	s rtn=..HIPMessageServerS(&#34;MES0026&#34;,stream)
</span></span><span class="line"><span class="cl">	;b ;a101
</span></span><span class="line"><span class="cl">	Q rtn
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/// w ##class(web.DHCENS.STBLL.SOAP.HISSystemServieSoap).test1().Read()
</span></span><span class="line"><span class="cl">ClassMethod test1(input1 As %String, input2 As %String) As %GlobalCharacterStream
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	s stream=##class(%GlobalCharacterStream).%New()
</span></span><span class="line"><span class="cl">	;d stream.Write(&#34;**4860462*&#34;)
</span></span><span class="line"><span class="cl">	d stream.Write(input2)
</span></span><span class="line"><span class="cl">	// w ##class(web.DHCENS.STBLL.SOAP.HISSystemServieSoap).HIPMessageServerS(&#34;MES0022&#34;,stream)
</span></span><span class="line"><span class="cl">	s rtn=..HIPMessageServerS(input1,stream)
</span></span><span class="line"><span class="cl">	;b ;a101
</span></span><span class="line"><span class="cl">	Q rtn
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="Êü•ËØ¢Êú™Ê†∏Êî∂ÂåªÂò±">Êü•ËØ¢Êú™Ê†∏Êî∂ÂåªÂò±
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/// Êñ∞ÊñπÊ≥ïÔºåÊñπÊ≥ïËØ¥ÊòéÊ≠§ÊñπÊ≥ïÂåÖÂê´Êü•ËØ¢ÂΩìÂâç‰ª™Âô®ÁªìÊûú‰ª•ÂèäÂ∑≤ÂÖ≥ËÅîÁöÑÊä•ÂëäÁªìÊûú
</span></span><span class="line"><span class="cl">///  Ê≠§ÊñπÊ≥ïÂÖºÂÆπÂΩìÊó•ÂÖ®ÈÉ®‰ª™Âô®ÁªìÊûúÊü•ËØ¢
</span></span><span class="line"><span class="cl">/// /LabNo=L0002438&amp;WorkGroupMachineDR=1
</span></span><span class="line"><span class="cl">/// d ##Class(%ResultSet).RunQuery(&#34;LIS.WS.BLL.DHCRPVisitNumberReport&#34;,&#34;QryWorkListByLabno&#34;,&#34;00000000484&#34;,&#34;7&#34;,&#34;2020-04-27&#34;,&#34;&#34;,&#34;All&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;113^7^0^12^1&#34;)                                          
</span></span><span class="line"><span class="cl">/// d ##Class(%ResultSet).RunQuery(&#34;LIS.WS.BLL.DHCRPVisitNumberReport&#34;,&#34;QryWorkListByLabno&#34;,&#34;**4868149*&#34;,&#34;3&#34;,&#34;20240409&#34;,&#34;8&#34;,&#34;&#34;,&#34;1&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;8280^1^0^2^1&#34;)
</span></span><span class="line"><span class="cl">Query QryWorkListByLabno(fLabno, WorkGroupMachineDR, FTransmitDate, fEpisodeNo, TestSetQueryDR, IsUnCheckTS, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %Query(ROWSPEC = &#34;MixLabNo,VisitNumberDR,Status,StatusDesc,AssayNo,AssayNo1,EpisodeNo,Labno,RegNo,RecordNo,PatName,Urgent,TestSetDesc,TestSetFee,ContainerDR,SpecimenDR,SpecimenDesc,AdmType,ReportDR,ResultFlag,WorkGroupMachineDR,TransmitDate,AcceptDate,AcceptTime,AcceptDT,ColStyler,InfectFlag,InfectAlert,AddType,HosptialDR,LocationDR,LocationName,DoctorDR,WardDR,BedNo,SpeciesDR,Age,AgeUnitDR,VisNumTSDR,Printed,ReceiveDate,ReceiveTime,ReceiveDT,AuthDT,AuthUserDR,AuthUserName,Readed,AdmTypeDR,Species,PrintedUserName,SpecimenQualityDR,SpecimenQualityDesc,AgeUnit,SplitStatus,RackNo,WorkGroupMachineName,CollectedFlag,LocationTelephone,WardName,WardPhoneNo,NoCheckList,CheckTSList,ContainerDesc,ContainerColor,Doctor,RequestDT,Symptom,IDNumber,Address,MobileNo,CollectDate,CollectTime,CollectDT,CollectUser&#34;)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ClassMethod QryWorkListByLabnoExecute(ByRef qHandle As %Binary, fLabno, WorkGroupMachineDR, FTransmitDate, fEpisodeNo, TestSetQueryDR, IsUnCheckTS, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %Status
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	Set HospitalDR=$p(Sessions,&#34;^&#34;,5)
</span></span><span class="line"><span class="cl">	Set repid=$i(^CacheTemp)
</span></span><span class="line"><span class="cl"> 	Set ind=1
</span></span><span class="line"><span class="cl">    s FTransmitDate=$Tr(FTransmitDate,&#34;-&#34;),TestSetQueryDR=$g(TestSetQueryDR)
</span></span><span class="line"><span class="cl">    s IsUnCheckTS=$g(IsUnCheckTS)
</span></span><span class="line"><span class="cl">    i WorkGroupMachineDR=&#34;ALL&#34; s WorkGroupMachineDR=&#34;&#34;
</span></span><span class="line"><span class="cl">    i TestSetQueryDR=&#34;All&#34;  s TestSetQueryDR=&#34;&#34;
</span></span><span class="line"><span class="cl">    i fEpisodeNo=&#34;Ëá™Âä®ÂàÜÈÖç&#34; s fEpisodeNo=&#34;&#34;
</span></span><span class="line"><span class="cl">	k ^TMP($zn,$i,$j)
</span></span><span class="line"><span class="cl">	s ^YHR(&#34;QryWorkListByLabno&#34;)=$lb(fLabno, WorkGroupMachineDR, FTransmitDate, fEpisodeNo, TestSetQueryDR, IsUnCheckTS, P6, P7, P8, P9, P10, P11, P12, P13, Sessions)
</span></span><span class="line"><span class="cl">	s FindFlag=0
</span></span><span class="line"><span class="cl">    s CombineFlag=0
</span></span><span class="line"><span class="cl">	//Ê£ÄÈ™åÊü•ËØ¢ ‰∏çÂå∫ÂàÜÊó•Êúü
</span></span><span class="line"><span class="cl">	i $l(fLabno) 
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		s TestSetQueryGroupDR=&#34;&#34; //‰∏çÈôêÂà∂Êü•ËØ¢ÂåªÂò±ÁªÑ
</span></span><span class="line"><span class="cl">		s LabNoStr=fLabno
</span></span><span class="line"><span class="cl">		s LabNoIndex=0
</span></span><span class="line"><span class="cl">		s LabnoFlag=1
</span></span><span class="line"><span class="cl">		for {
</span></span><span class="line"><span class="cl">			s LabNoIndex = LabNoIndex+1
</span></span><span class="line"><span class="cl">			q:LabNoIndex&gt;$l(LabNoStr,&#34;^&#34;)
</span></span><span class="line"><span class="cl">			s fLabno = $p(LabNoStr,&#34;^&#34;,LabNoIndex)
</span></span><span class="line"><span class="cl">			s FindFlag = 1
</span></span><span class="line"><span class="cl">			s VisitNumberDR=&#34;&#34;
</span></span><span class="line"><span class="cl">			for {
</span></span><span class="line"><span class="cl">				s VisitNumberDR=$o(^dbo.RPVisitNumberI(&#34;IndexVisitNumber&#34;,##Class(LIS.Util.Common).IndexData(fLabno),VisitNumberDR))
</span></span><span class="line"><span class="cl">				q:VisitNumberDR=&#34;&#34;
</span></span><span class="line"><span class="cl">				s WorkGPMiDR=&#34;&#34;
</span></span><span class="line"><span class="cl">			    for{
</span></span><span class="line"><span class="cl">				    s WorkGPMiDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR, WorkGPMiDR)) 
</span></span><span class="line"><span class="cl">					q:WorkGPMiDR=&#34;&#34; 
</span></span><span class="line"><span class="cl">					s curWrokGoupDR=$lg(^dbo.BTWorkGroupMachineD(WorkGPMiDR),4)
</span></span><span class="line"><span class="cl">					;i $g(curWrokGoupDR)&#39;=&#34;&#34;,curWrokGoupDR&#39;=fWorkGroupDR continue
</span></span><span class="line"><span class="cl">					;i $l(WorkGroupMachineDR),WorkGroupMachineDR&#39;=WorkGPMiDR continue
</span></span><span class="line"><span class="cl">					s RptOrder=&#34;&#34;
</span></span><span class="line"><span class="cl">					for {
</span></span><span class="line"><span class="cl">						s RptOrder=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR, WorkGPMiDR,RptOrder)) 
</span></span><span class="line"><span class="cl">						q:RptOrder=&#34;&#34;
</span></span><span class="line"><span class="cl">						s ReportDR=&#34;&#34;
</span></span><span class="line"><span class="cl">						for {
</span></span><span class="line"><span class="cl">							s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR, WorkGPMiDR,RptOrder,ReportDR))
</span></span><span class="line"><span class="cl">							q:ReportDR=&#34;&#34;
</span></span><span class="line"><span class="cl">							d OupInfo
</span></span><span class="line"><span class="cl">						}
</span></span><span class="line"><span class="cl">					}
</span></span><span class="line"><span class="cl">				}
</span></span><span class="line"><span class="cl">			} 
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	k ^TMP($zn,$i,$j)
</span></span><span class="line"><span class="cl"> 	Set qHandle=$lb(0,repid,0)
</span></span><span class="line"><span class="cl">	Quit $$$OK
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">OupInfo
</span></span><span class="line"><span class="cl">#;	s RptOrder=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR, WorkGPMiDR,&#34;&#34;),-1) 
</span></span><span class="line"><span class="cl">#;	i &#39;$l(RptOrder) Quit  ///Âè™Êü•ËØ¢Êú¨Â∑•‰ΩúÁªÑÂåªÂò±
</span></span><span class="line"><span class="cl">#;	s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR, WorkGPMiDR,RptOrder,&#34;&#34;))
</span></span><span class="line"><span class="cl">    s ReportTestSetType=&#34;&#34;
</span></span><span class="line"><span class="cl">	s ReportData=$g(^dbo.RPVisitNumberReportD(ReportDR))
</span></span><span class="line"><span class="cl">	s SplitStatus=$lg(ReportData,44)
</span></span><span class="line"><span class="cl">    s RackNo=$lg(ReportData,45)
</span></span><span class="line"><span class="cl">	s TransmitDate=$lg(ReportData,3)
</span></span><span class="line"><span class="cl">	i $L(FTransmitDate),FTransmitDate&#39;=TransmitDate Q
</span></span><span class="line"><span class="cl">	s WorkGPMiDR=$lg(ReportData,4)       //ÂÖºÂÆπÂêàÂπ∂Êä•ÂëäËæìÂá∫
</span></span><span class="line"><span class="cl">	i $l(WorkGroupMachineDR),WorkGroupMachineDR&#39;=WorkGPMiDR q
</span></span><span class="line"><span class="cl">	s VisitNumberDR=$lg(ReportData,2) //ÂÖºÂÆπÂêàÂπ∂Êä•ÂëäËæìÂá∫
</span></span><span class="line"><span class="cl">	s WorkGroupDR=$LG($g(^dbo.BTWorkGroupMachineD(WorkGPMiDR)),4)
</span></span><span class="line"><span class="cl">	s WorkGroupMachineName=$lg($G(^dbo.BTWorkGroupMachineD(WorkGPMiDR)),3)
</span></span><span class="line"><span class="cl">	s TestSetDesc=&#34;&#34;,TestSetFee=0,CheckTSList=&#34;&#34;
</span></span><span class="line"><span class="cl">	s ReportTypeFlag = 1  ///0‰ª£Ë°®‰∏çÂåπÈÖçÊä•ÂëäÁ±ªÂûã
</span></span><span class="line"><span class="cl">	s TestSetDR=&#34;&#34; f  s TestSetDR=$o(^dbo.RPVisitNumberTestSetI(&#34;IndexMaster&#34;,VisitNumberDR,TestSetDR)) q:TestSetDR=&#34;&#34;  d
</span></span><span class="line"><span class="cl">	.s ReportType = $lg($g(^dbo.BTTestSetD(TestSetDR)),19)
</span></span><span class="line"><span class="cl">	.i &#39;$d(^dbo.RPVisitNumberTestSetI(&#34;IndexReportID&#34;,ReportDR,TestSetDR)) Q
</span></span><span class="line"><span class="cl">	.I $l(TestSetQueryDR),&#39;$d(^dbo.BTWorkGroupMachineRuleTSI(&#34;IndexMaster&#34;,TestSetQueryDR,TestSetDR)) Q
</span></span><span class="line"><span class="cl">	.s VisNumTSDR=$o(^dbo.RPVisitNumberTestSetI(&#34;IndexMaster&#34;,VisitNumberDR,TestSetDR,&#34;&#34;))
</span></span><span class="line"><span class="cl">	.i $lg($g(^dbo.RPVisitNumberTestSetD(VisNumTSDR)),4)&#39;=1 q
</span></span><span class="line"><span class="cl">	.s tWorkGroupMachineDR=$lg($g(^dbo.RPVisitNumberTestSetD(VisNumTSDR)),5)
</span></span><span class="line"><span class="cl">	.i WorkGPMiDR&#39;=tWorkGroupMachineDR q
</span></span><span class="line"><span class="cl">	.s TestSetFee=TestSetFee+$lg($g(^dbo.RPVisitNumberTestSetD(VisNumTSDR)),8)
</span></span><span class="line"><span class="cl">	.i $l(TestSetDesc) s TestSetDesc=TestSetDesc_&#34;+&#34;_$lg($g(^dbo.BTTestSetD(TestSetDR)),3)
</span></span><span class="line"><span class="cl">	.e  s TestSetDesc=$lg(^dbo.BTTestSetD(TestSetDR),3)
</span></span><span class="line"><span class="cl">	.s CheckTSList=CheckTSList_&#34;@&#34;_$lg($g(^dbo.BTTestSetD(TestSetDR)),3)_&#34;^&#34;_$lg($g(^dbo.RPVisitNumberTestSetD(VisNumTSDR)),8)
</span></span><span class="line"><span class="cl">	i $l(TestSetQueryDR),&#39;$l(TestSetDesc) q
</span></span><span class="line"><span class="cl">	//Âä†‰∏äÊâãÂ∑•ËÆ°Ë¥πÁöÑ‰ª∑Ê†º
</span></span><span class="line"><span class="cl">	S PriceManual=0
</span></span><span class="line"><span class="cl">	s OrdItem=&#34;&#34; f  s OrdItem=$o(^dbo.RPVisitNumberManualAccountI(&#34;IndexOrdItem&#34;,VisitNumberDR,OrdItem)) q:OrdItem=&#34;&#34;  d
</span></span><span class="line"><span class="cl">	.s OperateTypeDR=&#34;&#34; f  s OperateTypeDR=$o(^dbo.RPVisitNumberManualAccountI(&#34;IndexOrdItem&#34;,VisitNumberDR,OrdItem,OperateTypeDR)) q:OperateTypeDR=&#34;&#34;  d
</span></span><span class="line"><span class="cl">	..s VNMDR=&#34;&#34; f  s VNMDR=$o(^dbo.RPVisitNumberManualAccountI(&#34;IndexOrdItem&#34;,VisitNumberDR,OrdItem,OperateTypeDR,VNMDR)) q:VNMDR=&#34;&#34;  d
</span></span><span class="line"><span class="cl">	...s Quantity=$lg($g(^dbo.RPVisitNumberManualAccountD(VNMDR)),7)
</span></span><span class="line"><span class="cl">	...s MnualPrice=$lg($g(^dbo.RPVisitNumberManualAccountD(VNMDR)),8)
</span></span><span class="line"><span class="cl">	...s PriceManual=PriceManual+(Quantity*MnualPrice)
</span></span><span class="line"><span class="cl">	i PriceManual&gt;0 s TestSetFee=TestSetFee_&#34;+&#34;_PriceManual_&#34;=&#34;_(TestSetFee+PriceManual)
</span></span><span class="line"><span class="cl">	;i ReportTypeFlag=0 q
</span></span><span class="line"><span class="cl">	i &#39;$d(VisNumTSDR) d
</span></span><span class="line"><span class="cl">	.s VisNumTSDR = &#34;&#34;
</span></span><span class="line"><span class="cl">	s RPVisitNumberData=$g(^dbo.RPVisitNumberD(VisitNumberDR))
</span></span><span class="line"><span class="cl">	s OutStorageType = $lg(RPVisitNumberData,77)
</span></span><span class="line"><span class="cl">	s WGMdr=$lg(ReportData,4)
</span></span><span class="line"><span class="cl">	i OutStorageType=4 ,&#39;$d(^dbo.RPVisitNumberTestSetI(&#34;IndexWGMachineDR&#34;,VisitNumberDR,WGMdr)),SplitStatus&#39;=2 q  ///4Âà†Èô§,Ê†áÊú¨Â§ö‰∏™Êä•ÂëäÁöÑÊòæÁ§∫
</span></span><span class="line"><span class="cl">	s HosptialDR = $lg(RPVisitNumberData,21)
</span></span><span class="line"><span class="cl">	s LocationDR = $lg(RPVisitNumberData,22),LocationName=&#34;&#34;
</span></span><span class="line"><span class="cl">	s LocationTelephone=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(LocationDR)  d
</span></span><span class="line"><span class="cl">	.s LocationName = $lg($g(^dbo.BTLocationD(LocationDR)),3)
</span></span><span class="line"><span class="cl">	.s LocationTelephone= $lg($g(^dbo.BTLocationD(LocationDR)),8)
</span></span><span class="line"><span class="cl">	s DoctorDR = $lg(RPVisitNumberData,23),Doctor=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(DoctorDR) s Doctor=$lg($g(^dbo.BTDoctorD(DoctorDR)),3)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	//Áî≥ËØ∑Êó∂Èó¥
</span></span><span class="line"><span class="cl">	s RequestDate=$lg(RPVisitNumberData,24)
</span></span><span class="line"><span class="cl">	i $l(RequestDate) s RequestDate=$e(RequestDate,1,4)_&#34;-&#34;_$e(RequestDate,5,6)_&#34;-&#34;_$e(RequestDate,7,8)
</span></span><span class="line"><span class="cl">	s RequestTime=$lg(RPVisitNumberData,25)
</span></span><span class="line"><span class="cl">	i $l(RequestTime) s RequestTime=$zt(RequestTime,1)
</span></span><span class="line"><span class="cl">	s RequestDT=RequestDate_&#34; &#34;_RequestTime
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	s WardDR = $lg(RPVisitNumberData,26)
</span></span><span class="line"><span class="cl">	s WardName= &#34;&#34;
</span></span><span class="line"><span class="cl">	s WardPhoneNo=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(WardDR) d
</span></span><span class="line"><span class="cl">	.s WardName=$lg($g(^dbo.BTWardD(WardDR)),3)
</span></span><span class="line"><span class="cl">	.s WardPhoneNo=$lg($g(^dbo.BTWardD(WardDR)),8)
</span></span><span class="line"><span class="cl">	s BedNo = $lg(RPVisitNumberData,27)
</span></span><span class="line"><span class="cl">	s Symptom=$lg(RPVisitNumberData,28)
</span></span><span class="line"><span class="cl">	s SpeciesDR = $lg(RPVisitNumberData,15)
</span></span><span class="line"><span class="cl">	s MixLabNo= $lg(RPVisitNumberData,94)
</span></span><span class="line"><span class="cl">	s Species=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(SpeciesDR) s Species=$lg($g(^dbo.BTSpeciesD(SpeciesDR)),3)
</span></span><span class="line"><span class="cl">	s Age = $lg(RPVisitNumberData,18)
</span></span><span class="line"><span class="cl">	s AgeUnitDR = $lg(RPVisitNumberData,19)
</span></span><span class="line"><span class="cl">	s AgeUnit=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(AgeUnitDR) s AgeUnit=$LG($g(^dbo.BTAgeUnitD(AgeUnitDR)),3)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	//ÈááÈõÜ‰ø°ÊÅØ
</span></span><span class="line"><span class="cl">	s CollectDate=$lg(RPVisitNumberData,51)
</span></span><span class="line"><span class="cl">	i $l(CollectDate) s CollectDate=$e(CollectDate,1,4)_&#34;-&#34;_$e(CollectDate,5,6)_&#34;-&#34;_$e(CollectDate,7,8)
</span></span><span class="line"><span class="cl">	s CollectTime=$lg(RPVisitNumberData,52)
</span></span><span class="line"><span class="cl">	i $l(CollectTime) s CollectTime=$zt(CollectTime,1)
</span></span><span class="line"><span class="cl">	s CollectDT=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(CollectDate) s CollectDT=CollectDate_&#34; &#34;_CollectTime
</span></span><span class="line"><span class="cl">	s CollectUserDR=$lg(RPVisitNumberData,53),CollectUser=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(CollectUserDR) s CollectUser=$lg($g(^dbo.SYSUserD(CollectUserDR)),3)
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	s ReceiveDate=$lg(RPVisitNumberData,66)
</span></span><span class="line"><span class="cl">	i $l(ReceiveDate) s ReceiveDate=$e(ReceiveDate,1,4)_&#34;-&#34;_$e(ReceiveDate,5,6)_&#34;-&#34;_$e(ReceiveDate,7,8)
</span></span><span class="line"><span class="cl">	s ReceiveTime=$lg(RPVisitNumberData,67)
</span></span><span class="line"><span class="cl">	i $l(ReceiveTime) s ReceiveTime=$zt(ReceiveTime,1)
</span></span><span class="line"><span class="cl">	s ReceiveDT = &#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(ReceiveDate) s ReceiveDT=ReceiveDate_&#34; &#34;_ReceiveTime
</span></span><span class="line"><span class="cl">	s SpecimenDR=$lg(RPVisitNumberData,56),SpecimenDesc=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(SpecimenDR) s SpecimenDesc=$lg($g(^dbo.BTSpecimenD(SpecimenDR)),3)
</span></span><span class="line"><span class="cl">	s ContainerDR=$lg(RPVisitNumberData,57) ;ÁÆ°Âûã ContainerDR,ContainerDesc
</span></span><span class="line"><span class="cl">	s (ContainerDesc,ContainerColor)=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(ContainerDR) d
</span></span><span class="line"><span class="cl">	.s ContainerDesc=$lg($g(^dbo.BTContainerD(ContainerDR)),3) 
</span></span><span class="line"><span class="cl">	.s ContainerColor=$lg($g(^dbo.BTContainerD(ContainerDR)),6)
</span></span><span class="line"><span class="cl"> 	s SurName=$lg(RPVisitNumberData,13)
</span></span><span class="line"><span class="cl"> 	s GivenName=$lg(RPVisitNumberData,14)
</span></span><span class="line"><span class="cl">	i SurName=GivenName s PatName=SurName
</span></span><span class="line"><span class="cl">	e  s PatName=SurName_GivenName
</span></span><span class="line"><span class="cl">	s Labno=$lg(RPVisitNumberData,2)
</span></span><span class="line"><span class="cl">	s RegNo=$lg(RPVisitNumberData,3)
</span></span><span class="line"><span class="cl"> 	s ReportTestSetType=&#34;&#34; 
</span></span><span class="line"><span class="cl">	s RecordNo=$lg(RPVisitNumberData,6)
</span></span><span class="line"><span class="cl">	s Urgent=$lg(RPVisitNumberData,50)
</span></span><span class="line"><span class="cl">	s AdmTypeDR=$lg(RPVisitNumberData,4),AdmType=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(AdmTypeDR) s AdmType=$lg($g(^dbo.BTAdmissionTypeD(AdmTypeDR)),3)
</span></span><span class="line"><span class="cl">	s LocationDR=$lg(RPVisitNumberData,22),LocationName=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(LocationDR) s LocationName=$lg($g(^dbo.BTLocationD(LocationDR)),3)
</span></span><span class="line"><span class="cl">	i LocationName[&#34;-&#34;  s LocationName=$p(LocationName,&#34;-&#34;,2)
</span></span><span class="line"><span class="cl">	s EpisodeNo=$lg(ReportData,8)
</span></span><span class="line"><span class="cl">	i $l(fEpisodeNo),fEpisodeNo&#39;=EpisodeNo q
</span></span><span class="line"><span class="cl">	s AssayNo1=$lg(ReportData,6)
</span></span><span class="line"><span class="cl">	s Status=$lg(ReportData,22)
</span></span><span class="line"><span class="cl">	s Printed=$lg(ReportData,30)
</span></span><span class="line"><span class="cl">	s Readed=$lg(ReportData,31)
</span></span><span class="line"><span class="cl">	s SpecimenQualityDR=$lg(RPVisitNumberData,69)
</span></span><span class="line"><span class="cl">	s SpecimenQualityDesc=&#34;&#34;  
</span></span><span class="line"><span class="cl">	i $l(SpecimenQualityDR)  s SpecimenQualityDesc=$lg($g(^dbo.BTSpecimenQualityD(SpecimenQualityDR)),3)
</span></span><span class="line"><span class="cl">	i $d(^DHCLISReportPrint(ReportDR)) s Printed=1
</span></span><span class="line"><span class="cl">	//ÊâìÂç∞ËÄÖÊü•ËØ¢
</span></span><span class="line"><span class="cl">	i $d(^dbo.RPVisitNumberReportPrintI(&#34;IndexModuleID&#34;,ReportDR))&#39;=0 s Printed=1
</span></span><span class="line"><span class="cl">    s PrintedUserName=&#34;&#34;
</span></span><span class="line"><span class="cl">	i Printed=1 d
</span></span><span class="line"><span class="cl">	.s PrintDate  = $o(^dbo.RPVisitNumberReportPrintI(&#34;IndexMaster&#34;,ReportDR,0))
</span></span><span class="line"><span class="cl">	.i $l(PrintDate) s PrintTime = $o(^dbo.RPVisitNumberReportPrintI(&#34;IndexMaster&#34;,ReportDR,PrintDate,0))
</span></span><span class="line"><span class="cl">	.i $l(PrintDate) s ReportPrintDR = $o(^dbo.RPVisitNumberReportPrintI(&#34;IndexMaster&#34;,ReportDR,PrintDate,PrintTime,&#34;&#34;))
</span></span><span class="line"><span class="cl">	.i $l($g(ReportPrintDR)) d
</span></span><span class="line"><span class="cl">	..S PrintUserDR = $lg(^dbo.RPVisitNumberReportPrintD(ReportPrintDR),5)
</span></span><span class="line"><span class="cl">	..i $l(PrintUserDR) s PrintedUserName = $lg(^dbo.SYSUserD(PrintUserDR),3)
</span></span><span class="line"><span class="cl">	s StatusDesc=$s(Status=&#34;1&#34;:&#34;ÁôªËÆ∞&#34;,Status=&#34;2&#34;:&#34;ÂàùÂÆ°&#34;,Status=&#34;3&#34;:&#34;&lt;b&gt;ÂÆ°Ê†∏&lt;/b&gt;&#34;,Status=&#34;4&#34;:&#34;Â§çÊü•&#34;,Status=&#34;5&#34;:&#34;ÂèñÊ∂à&#34;,Status=&#34;6&#34;:&#34;‰ΩúÂ∫ü&#34;,Status=&#34;O&#34;:&#34;ÂÖ∂‰ªñ&#34;,Status=&#34;10&#34;:&#34;ÂüπÂÖª‰∏≠&#34;,Status=&#34;11&#34;:&#34;Èâ¥ÂÆö‰∏≠&#34;,Status=&#34;12&#34;:&#34;ËçØÊïè‰∏≠&#34;)
</span></span><span class="line"><span class="cl"> 	i Status=&#34;6&#34; Quit  ///Âà†Èô§ÂåªÂò±
</span></span><span class="line"><span class="cl"> 	s AcceptDate=$lg(ReportData,9),ColStyler=&#34;&#34;
</span></span><span class="line"><span class="cl"> 	i $l(AcceptDate) s AcceptDate=$e(AcceptDate,1,4)_&#34;-&#34;_$e(AcceptDate,5,6)_&#34;-&#34;_$e(AcceptDate,7,8)
</span></span><span class="line"><span class="cl"> 	s AcceptTime=$lg(ReportData,10)
</span></span><span class="line"><span class="cl"> 	i $l(AcceptTime) s AcceptTime=$zt(AcceptTime,1)
</span></span><span class="line"><span class="cl"> 	s AcceptDT = &#34;&#34;
</span></span><span class="line"><span class="cl"> 	i $l(AcceptDate) s AcceptDT=AcceptDate_&#34; &#34;_AcceptTime
</span></span><span class="line"><span class="cl">	s AuthDate = $lg(ReportData,19)
</span></span><span class="line"><span class="cl">	i $l(AuthDate) s AuthDate=$e(AuthDate,1,4)_&#34;-&#34;_$e(AuthDate,5,6)_&#34;-&#34;_$e(AuthDate,7,8)
</span></span><span class="line"><span class="cl">	s AuthTime = $lg(ReportData,20)
</span></span><span class="line"><span class="cl">	i $l(AuthTime) s AuthTime=$zt(AuthTime,1)
</span></span><span class="line"><span class="cl">	s AuthUserDR = $lg(ReportData,21)
</span></span><span class="line"><span class="cl">	s AuthUserName=&#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(AuthUserDR) s AuthUserName=$lg($g(^dbo.SYSUserD(AuthUserDR)),3)
</span></span><span class="line"><span class="cl">	s AuthDT = &#34;&#34;
</span></span><span class="line"><span class="cl">	i $l(AuthDate) s AuthDT=AuthDate_&#34; &#34;_AuthTime
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"> 	i Status=1,+$tr($zd($h,3),&#34;-&#34;)&gt;AcceptDate s ColStyler=&#34;color:red;&#34;
</span></span><span class="line"><span class="cl">	//ÊâìÂç∞Ê†áËÆ∞
</span></span><span class="line"><span class="cl">	i Status=3,Printed=1 s ColStyler=&#34;color:#cc3399;&#34;
</span></span><span class="line"><span class="cl">	s ResultFlag=&#34;N&#34;  //ÁªìÊûúÊ†áËÆ∞
</span></span><span class="line"><span class="cl">	///‰ª™Âô®ÁªìÊûúÊ†áËÆ∞
</span></span><span class="line"><span class="cl">	s TransmitDate=$lg(ReportData,3)
</span></span><span class="line"><span class="cl">	s tAssayNo=$lg(ReportData,6)
</span></span><span class="line"><span class="cl">	i $l(tAssayNo),$d(^dbo.RPMachineResultI(&#34;IndexMaster&#34;,WorkGPMiDR,TransmitDate,##Class(LIS.Util.Common).IndexData(tAssayNo))),Status=&#34;1&#34; s ResultFlag=&#34;Y&#34;
</span></span><span class="line"><span class="cl">	i $l(TransmitDate) s TransmitDate=$lg($g(^dbo.SYSUserD(TransmitDate)),3)
</span></span><span class="line"><span class="cl">	///ÊÑüÊüìÊ†áÂøó
</span></span><span class="line"><span class="cl">	s InfectFlag=$lg(RPVisitNumberData,43)
</span></span><span class="line"><span class="cl">	s InfectAlert=$lg(RPVisitNumberData,44)
</span></span><span class="line"><span class="cl"> 	s AddType=$lg(RPVisitNumberData,83)
</span></span><span class="line"><span class="cl"> 	i SplitStatus=&#34;2&#34; s TestSetDesc=&#34;&#34; //ÊãÜÂàÜÊä•Âëä‰∏çÊòæÁ§∫ÂåªÂò±
</span></span><span class="line"><span class="cl"> 	
</span></span><span class="line"><span class="cl"> 	//Ë∫´‰ªΩËØÅ
</span></span><span class="line"><span class="cl"> 	s IDNumber=$lg(RPVisitNumberData,11)
</span></span><span class="line"><span class="cl"> 	
</span></span><span class="line"><span class="cl"> 	//Âú∞ÂùÄ
</span></span><span class="line"><span class="cl"> 	s Address=$lg(RPVisitNumberData,41)
</span></span><span class="line"><span class="cl"> 	
</span></span><span class="line"><span class="cl"> 	//ËÅîÁ≥ªÁîµËØù
</span></span><span class="line"><span class="cl"> 	s MobileNo=$lg(RPVisitNumberData,29)
</span></span><span class="line"><span class="cl"> 	
</span></span><span class="line"><span class="cl"> 	//Êä•ÂëäÊòØÂê¶Êî∂Ëóè
</span></span><span class="line"><span class="cl"> 	s CollectedFlag=##class(LIS.WS.BLL.DHCCollectReport).isCollectedMTHD(ReportDR,RegNo) 
</span></span><span class="line"><span class="cl"> 	S NoCheckList=&#34;&#34;
</span></span><span class="line"><span class="cl">    i IsUnCheckTS=1 s NoCheckList=##Class(LISSP.DHCRPVisitNumber).GetUnCheckTSInfo(fLabno,&#34;&#34;,Sessions,&#34;1&#34;) //Êü•ËØ¢
</span></span><span class="line"><span class="cl">    i $e(fLabno)=&#34;*&#34;,$d(^LISTMPDATA(&#34;WHSYZ&#34;,Labno)) d		//YHR 20240409 Êé•Êî∂Ê†áÊú¨Êó∂Êü•ËØ¢ËÄÅÁ≥ªÁªüÊú™Ê†∏Êî∂ÂåªÂò±
</span></span><span class="line"><span class="cl"> 	.s AllTSList=&#34;&#34;
</span></span><span class="line"><span class="cl"> 	.s TestSetDR=&#34;&#34; f  s TestSetDR=$o(^LISTMPDATA(&#34;WHSYZ&#34;,fLabno,TestSetDR)) q:TestSetDR=&#34;&#34;  d
</span></span><span class="line"><span class="cl"> 	..s AllTSList=AllTSList_TestSetDR_&#34;@@&#34;
</span></span><span class="line"><span class="cl"> 	..b ;a103
</span></span><span class="line"><span class="cl"> 	.s NoCheckList=##Class(LISSP.DHCRPVisitNumber).GetUnCheckTSInfo(fLabno,AllTSList,Sessions,&#34;1&#34;) //Êü•ËØ¢
</span></span><span class="line"><span class="cl"> 	Set Data=$lb(MixLabNo,VisitNumberDR,Status,StatusDesc,tAssayNo,AssayNo1,EpisodeNo,Labno,RegNo,RecordNo,PatName,Urgent,TestSetDesc,TestSetFee,ContainerDR,SpecimenDR,SpecimenDesc,AdmType,ReportDR,ResultFlag,WorkGPMiDR,TransmitDate,AcceptDate,AcceptTime,AcceptDT,ColStyler,InfectFlag,InfectAlert,AddType,HosptialDR,LocationDR,LocationName,DoctorDR,WardDR,BedNo,SpeciesDR,Age,AgeUnitDR,VisNumTSDR,Printed,ReceiveDate,ReceiveTime,ReceiveDT,AuthDT,AuthUserDR,AuthUserName,Readed,AdmTypeDR,Species,PrintedUserName,SpecimenQualityDR,SpecimenQualityDesc,AgeUnit,SplitStatus,RackNo,WorkGroupMachineName,CollectedFlag,LocationTelephone,WardName,WardPhoneNo,NoCheckList,CheckTSList,ContainerDesc,ContainerColor,Doctor,RequestDT,Symptom,IDNumber,Address,MobileNo,CollectDate,CollectTime,CollectDT,CollectUser)
</span></span><span class="line"><span class="cl"> 	;set ColFields=&#34;MixLabNo,VisitNumberDR,Status,StatusDesc,tAssayNo,AssayNo1,EpisodeNo,Labno,RegNo,MedicalRecordNo,PatName,Urgent,TestSetDesc,TestSetFee,ContainerDR,SpecimenDR,SpecimenDesc,AdmType,ReportDR,ResultFlag,WorkGPMiDR,TransmitDate,AcceptDate,AcceptTime,AcceptDT,ColStyler,InfectFlag,InfectAlert,AddType,HosptialDR,LocationDR,LocationName,DoctorDR,WardDR,BedNo,SpeciesDR,Age,AgeUnitDR,VisNumTSDR,Printed,ReceiveDate,ReceiveTime,ReceiveDT,AuthDT,AuthUserDR,AuthUserName,Readed,AdmTypeDR,Species,PrintedUserName,SpecimenQualityDR,SpecimenQualityDesc,AgeUnit,SplitStatus,RackNo,WorkGroupMachineName,CollectedFlag,LocationTelephone,WardName,WardPhoneNo,NoCheckList,CheckTSList,ContainerDesc,ContainerColor,Doctor,RequestDT,Symptom,IDNumber,Address,MobileNo&#34;
</span></span><span class="line"><span class="cl"> 	Set ^CacheTemp(repid,ind)=Data
</span></span><span class="line"><span class="cl"> 	Set ind=ind+1
</span></span><span class="line"><span class="cl">	Quit
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ClassMethod QryWorkListByLabnoClose(ByRef qHandle As %Binary) As %Status [ PlaceAfter = QryWorkListByLabnoExecute ]
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	Set repid=$li(qHandle,2)
</span></span><span class="line"><span class="cl"> 	Kill ^CacheTemp(repid)
</span></span><span class="line"><span class="cl">	Quit $$$OK
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ClassMethod QryWorkListByLabnoFetch(ByRef qHandle As %Binary, ByRef Row As %List, ByRef AtEnd As %Integer = 0) As %Status [ PlaceAfter = QryWorkListByLabnoExecute ]
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	Set AtEnd=$li(qHandle,1)
</span></span><span class="line"><span class="cl"> 	Set repid=$li(qHandle,2)
</span></span><span class="line"><span class="cl"> 	Set ind=$li(qHandle,3)
</span></span><span class="line"><span class="cl"> 	
</span></span><span class="line"><span class="cl"> 	Set ind=$o(^CacheTemp(repid,ind))
</span></span><span class="line"><span class="cl"> 	If ind=&#34;&#34; {				
</span></span><span class="line"><span class="cl"> 		Set AtEnd=1
</span></span><span class="line"><span class="cl"> 		Set Row=&#34;&#34;
</span></span><span class="line"><span class="cl"> 	}
</span></span><span class="line"><span class="cl"> 	else      {			
</span></span><span class="line"><span class="cl"> 		Set Row=^CacheTemp(repid,ind)
</span></span><span class="line"><span class="cl"> 	}
</span></span><span class="line"><span class="cl"> 	Set qHandle=$lb(AtEnd,repid,ind)
</span></span><span class="line"><span class="cl">	Quit $$$OK
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="Ë°•ÂÖÖÂÜÖÂÆπ">Ë°•ÂÖÖÂÜÖÂÆπ
</h1><h2 id="jsonËØªÂèñËß£ÊûêÊñπÊ≥ï">jsonËØªÂèñËß£ÊûêÊñπÊ≥ï
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Set objItems=##class(LIS.Util.COM.JSONUtils).%New().FromJSON(Param)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="jsonÁºñÂÜôÊñπÊ≥ï">jsonÁºñÂÜôÊñπÊ≥ï
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">S Main={}
</span></span><span class="line"><span class="cl">    s Main.&#34;receivestatus&#34;=ResultCode
</span></span><span class="line"><span class="cl">    s Date=$h
</span></span><span class="line"><span class="cl">    s Main.&#34;receivedate&#34;=$tr($zd($p(Date,&#34;,&#34;,1),3),&#34;-&#34;,&#34;.&#34;)
</span></span><span class="line"><span class="cl">    s Main.&#34;receivetime&#34;=$tr($zd($p(Date,&#34;,&#34;,1),3),&#34;-&#34;,&#34;.&#34;)_&#34; &#34;_$zt($p(Date,&#34;,&#34;,2),1)
</span></span><span class="line"><span class="cl">    s Main.&#34;labno&#34;=Labno
</span></span><span class="line"><span class="cl">    set OutStr=Main.%ToJSON()
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="Â∞ÜÊï∞ÊçÆËΩ¨ÊàêÊµÅÊï∞ÊçÆ">Â∞ÜÊï∞ÊçÆËΩ¨ÊàêÊµÅÊï∞ÊçÆ
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">s stream=##class(%GlobalCharacterStream).%New()
</span></span><span class="line"><span class="cl">    d stream.Write(OutStr)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ÂàáÊç¢ÂëΩÂêçÁ©∫Èó¥ÊñπÊ≥ï">ÂàáÊç¢ÂëΩÂêçÁ©∫Èó¥ÊñπÊ≥ï
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">    s CurNamespace=$ZUTIL(5)
</span></span><span class="line"><span class="cl">	s WebNamespace=##Class(OTH.SYSParameter).GetWebNamespace()
</span></span><span class="line"><span class="cl">	NEW $NAMESPACE 
</span></span><span class="line"><span class="cl">	s $NAMESPACE= WebNamespace
</span></span><span class="line"><span class="cl">	s Input=##Class(LISAPP.LIS.BLL.DHCReceiveInterface).GetLabNoInfoSFHIS(Labno,&#34;&#34;,&#34;&#34;) 
</span></span><span class="line"><span class="cl">	s $NAMESPACE= CurNamespace
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="xmlËØªÂèñÊñπÊ≥ï">xmlËØªÂèñÊñπÊ≥ï
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">s obj= ##class(LIS.Util.COM.XML).FromXML(Input)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="xmlÁºñÂÜôÊñπÊ≥ï">xmlÁºñÂÜôÊñπÊ≥ï
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">	s RequestXML=##class(LIS.Util.COM.XML).New(&#34;Request&#34;)
</span></span><span class="line"><span class="cl">	s OrdersXML=##class(LIS.Util.COM.XML).New(&#34;Orders&#34;)
</span></span><span class="line"><span class="cl">	s objVisitNumber=##class(LIS.Util.COM.XML).New(&#34;OrderList&#34;)
</span></span><span class="line"><span class="cl">	s RequestXML.ResultCode=&#34;-1&#34;
</span></span><span class="line"><span class="cl">	s RequestXML.ResultContent=&#34;Êü•ËØ¢Ê†áÊú¨‰ø°ÊÅØÂ§±Ë¥•:HISÊù°Á†Å‰ø°ÊÅØ‰∏çÂ≠òÂú®ÔºÅ&#34; 		//YHR 20240410 ËÄÅÁ≥ªÁªüÊü•ËØ¢ËøîÂõû‰ø°ÊÅØ‰∏∫Á©∫Êó∂ËøîÂõû
</span></span><span class="line"><span class="cl">   	d OrdersXML.Insert(objVisitNumber)
</span></span><span class="line"><span class="cl">    d RequestXML.Insert(OrdersXML)
</span></span><span class="line"><span class="cl">	s RetValue=RequestXML.ToXMLStream()
</span></span><span class="line"><span class="cl">	}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="ÈôÑÂΩï">ÈôÑÂΩï
</h1><h2 id="Â≠óÊÆµÂØπÁÖß">Â≠óÊÆµÂØπÁÖß
</h2><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Â∫èÂè∑</th>
          <th>Â≠óÊÆµÂêçÁß∞</th>
          <th>Â≠óÊÆµËØ¥Êòé</th>
          <th>ÊòØÂê¶ÂøÖÂ°´</th>
          <th>Â§áÊ≥®</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td></td>
          <td>ResultCode</td>
          <td>ËøîÂõû‰ª£Á†Å</td>
          <td></td>
          <td>0ÔºöÊàêÂäüÔºåÈùû0:Â§±Ë¥•</td>
      </tr>
      <tr>
          <td></td>
          <td>ResultContent</td>
          <td>Â§±Ë¥•ÂéüÂõ†</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td></td>
          <td>Orders</td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td></td>
          <td>OrderList</td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>1</td>
          <td>LabNo</td>
          <td>Ê†áÊú¨Êù°Á†ÅÂè∑</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>2</td>
          <td>ArcimCode</td>
          <td>ÂåªÂò±‰ª£Á†Å</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>3</td>
          <td>ArcimDesc</td>
          <td>ÂåªÂò±ÂêçÁß∞</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>4</td>
          <td>OrderQty</td>
          <td>ÂåªÂò±Êï∞Èáè</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>5</td>
          <td>BillCode</td>
          <td>Ë¥¶ÂçïÁä∂ÊÄÅ‰ª£Á†Å</td>
          <td>Âê¶</td>
          <td>P:ËÆ°Ë¥πÔºåÈùûPÔºöÊú™ËÆ°Ë¥π„ÄÇ‰ªÖÂØπÈó®ËØäÊàñÊÄ•ËØäÊ†áÊú¨ÊúâÊïà„ÄÇ</td>
      </tr>
      <tr>
          <td>6</td>
          <td>SpecimenTypeCode</td>
          <td>Ê†áÊú¨Á±ªÂûã‰ª£Á†Å</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>7</td>
          <td>SpecimenTypeDesc</td>
          <td>Ê†áÊú¨Á±ªÂûãÂêçÁß∞</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>8</td>
          <td>SpVolume</td>
          <td>Ê†áÊú¨ÈááÈõÜÈáè</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>9</td>
          <td>ColInfo</td>
          <td>Ê†áÊú¨ÈááÈõÜËØ¥Êòé</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>10</td>
          <td>ColDate</td>
          <td>Ê†áÊú¨ÈááÈõÜÊó•Êúü</td>
          <td>Âê¶</td>
          <td>Ê†ºÂºè:YYYY-MM-DD,Â¶ÇÔºö2018-05-12</td>
      </tr>
      <tr>
          <td>11</td>
          <td>ColTime</td>
          <td>Ê†áÊú¨ÈááÈõÜÊó∂Èó¥</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>12</td>
          <td>SpecUserCode</td>
          <td>Ê†áÊú¨ÈááÈõÜÁî®Êà∑‰ª£Á†Å</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>13</td>
          <td>Container</td>
          <td>Ê†áÊú¨ÈááÈõÜÂÆπÂô®‰ª£Á†Å</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>14</td>
          <td>GTSeq</td>
          <td>Á≥ñËÄêÈáèÂ∫èÂè∑</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>15</td>
          <td>SpecFlag</td>
          <td>ÁâπÊÆäÊ†áÂøó</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>16</td>
          <td>VerifyDate</td>
          <td>ÂåªÂò±Áî≥ËØ∑Êó•Êúü</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>17</td>
          <td>VerifyTime</td>
          <td>ÂåªÂò±Áî≥ËØ∑Êó∂Èó¥</td>
          <td></td>
          <td></td>
      </tr>
      <tr>
          <td>18</td>
          <td>AppDeptCode</td>
          <td>Áî≥ËØ∑ÁßëÂÆ§‰ª£Á†Å</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>19</td>
          <td>AppDeptDesc</td>
          <td>Áî≥ËØ∑ÁßëÂÆ§ÂêçÁß∞</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>20</td>
          <td>RecDeptCode</td>
          <td>Êé•Êî∂ÁßëÂÆ§‰ª£Á†Å</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>21</td>
          <td>RecDeptDesc</td>
          <td>Êé•Êî∂ÁßëÂÆ§ÂêçÁß∞</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>22</td>
          <td>TSPrice</td>
          <td>ÂåªÂò±Ë¥πÁî®</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>23</td>
          <td>OrderStatus</td>
          <td>ÂåªÂò±Áä∂ÊÄÅ</td>
          <td>ÊòØ</td>
          <td>E ÊâßË°åV ÂÆ°Ê†∏D ÂÅúÊ≠¢</td>
      </tr>
      <tr>
          <td>24</td>
          <td>DocCode</td>
          <td>Áî≥ËØ∑ÂåªÁîü‰ª£Á†Å</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>25</td>
          <td>DocDesc</td>
          <td>Áî≥ËØ∑ÂåªÁîüÂßìÂêç</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>26</td>
          <td>RepLoct</td>
          <td>ÂèñÊä•ÂëäÂú∞ÁÇπ</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>27</td>
          <td>RepDate</td>
          <td>ÂèñÊä•ÂëäÊó•Êúü</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>28</td>
          <td>RepTime</td>
          <td>ÂèñÊä•ÂëäÊó∂Èó¥</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>29</td>
          <td>Note</td>
          <td>ÂåªÂò±Áî≥ËØ∑ËØ¥Êòé</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>30</td>
          <td>AdmNo</td>
          <td>Â∞±ËØäÂè∑</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>31</td>
          <td>AdmDate</td>
          <td>Â∞±ËØäÊó•Êúü</td>
          <td>Âê¶</td>
          <td>Ê†ºÂºè:YYYY-MM-DD,Â¶ÇÔºö2018-05-12</td>
      </tr>
      <tr>
          <td>32</td>
          <td>AdmTime</td>
          <td>Â∞±ËØäÊó∂Èó¥</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>33</td>
          <td>AdmTypeCode</td>
          <td>Â∞±ËØäÁ±ªÂûã‰ª£Á†Å</td>
          <td>ÊòØ</td>
          <td>I‰ΩèÈô¢,OÈó®ËØä,H‰ΩìÊ£Ä,EÊÄ•ËØä,NÊñ∞ÁîüÂÑø,RÁßëÁ†î,PËçØÁêÜ,GÂÖ∂‰ªñ</td>
      </tr>
      <tr>
          <td>34</td>
          <td>AdmTypeDesc</td>
          <td>Â∞±ËØäÁ±ªÂûãÂêçÁß∞</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>35</td>
          <td>FeeType</td>
          <td>Ë¥πÁî®Á±ªÂûã</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>36</td>
          <td>PatientWard</td>
          <td>ÁóÖÊàø</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>37</td>
          <td>BedNo</td>
          <td>Â∫äÂè∑</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>38</td>
          <td>Diagnose</td>
          <td>ËØäÊñ≠</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>39</td>
          <td>RegisterNo</td>
          <td>ÁôªËÆ∞Âè∑/ÁóÖ‰∫∫ID</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>40</td>
          <td>PatientName</td>
          <td>ÂßìÂêç</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>41</td>
          <td>SexCode</td>
          <td>ÊÄßÂà´‰ª£Á†Å</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>42</td>
          <td>SexDesc</td>
          <td>ÊÄßÂà´ÂêçÁß∞</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>43</td>
          <td>DOB</td>
          <td>Âá∫ÁîüÊó•Êúü</td>
          <td>ÊòØ</td>
          <td>Ê†ºÂºè:YYYY-MM-DD,Â¶ÇÔºö2018-05-12</td>
      </tr>
      <tr>
          <td>44</td>
          <td>Age</td>
          <td>Âπ¥ÈæÑ</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>45</td>
          <td>AgeUnit</td>
          <td>Âπ¥ÈæÑÊèèËø∞</td>
          <td>ÊòØ</td>
          <td></td>
      </tr>
      <tr>
          <td>46</td>
          <td>DocumentID</td>
          <td>ÁóÖÊ°àÂè∑</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>47</td>
          <td>PatientAddress</td>
          <td>Âú∞ÂùÄ</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>48</td>
          <td>IdentityCardNo</td>
          <td>Â∞±ËØäÂç°Âè∑</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>49</td>
          <td>Telephone</td>
          <td>ËÅîÁ≥ªÁîµËØù</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>50</td>
          <td>SpecUserCode</td>
          <td>ÈááÈõÜ‰∫∫‰ª£Á†Å</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>51</td>
          <td>SpecUserName</td>
          <td>ÈááÈõÜ‰∫∫ÂêçÁß∞</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>52</td>
          <td>StartDate</td>
          <td>Ë¶ÅÊ±ÇÊâßË°åÊó•Êúü</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>53</td>
          <td>StartTime</td>
          <td>Ë¶ÅÊ±ÇÊâßË°åÊó∂Èó¥</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>54</td>
          <td>SendFlag</td>
          <td>Ê†áËØÜ</td>
          <td>Âê¶</td>
          <td>NW:Áî≥ËØ∑ÔºåCA:ÂèñÊ∂à</td>
      </tr>
      <tr>
          <td>55</td>
          <td>SpecRemark</td>
          <td>ÈááÈõÜËØ¥ÊòéÂ§áÊ≥®</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>56</td>
          <td>CarryDate</td>
          <td>ËøêÈÄÅÊó•Êúü</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>57</td>
          <td>CarryTime</td>
          <td>ËøêÈÄÅÊó∂Èó¥</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>58</td>
          <td>CarryUserDR</td>
          <td>ËøêÈÄÅ‰∫∫‰ª£Á†Å</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>59</td>
          <td>CarryUserName</td>
          <td>ËøêÈÄÅ‰∫∫ÂêçÁß∞</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
      <tr>
          <td>60</td>
          <td>CarryNote</td>
          <td>ËøêÈÄÅËØ¥Êòé</td>
          <td>Âê¶</td>
          <td></td>
      </tr>
  </tbody>
</table></div>
<p>‚Äç</p>

</section>


    <footer class="article-footer">
    <section>
        È°µÈù¢ÊµèËßàÈáè<span id="busuanzi_value_page_pv">Loading</span>
    </section>
</footer>


    
</article>

<div class="post-password">
	
</div>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Áõ∏ÂÖ≥ÊñáÁ´†</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/%E5%8A%9F%E8%83%BD%E5%AF%B9%E5%BA%94%E8%B7%AF%E5%BE%8420250112235959/">
        
        
            <div class="article-image">
                <img src="/p/%E5%8A%9F%E8%83%BD%E5%AF%B9%E5%BA%94%E8%B7%AF%E5%BE%8420250112235959/assets/image-20230327182228977-20241227020427-8nbvjef.6a6051a6958320f2da150a73fe7b91cb_hu_dc5ed5b29094b093.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post ÂäüËÉΩÂØπÂ∫îË∑ØÂæÑ"
                        data-key="ÂäüËÉΩÂØπÂ∫îË∑ØÂæÑ20250112235959" 
                        data-hash="md5-amBRppWDIPLaFQpz/nuRyw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">ÂäüËÉΩÂØπÂ∫îË∑ØÂæÑ</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo"],"lang":"zh-CN","locale":{"admin":"Admin","placeholder":null},"requiredMeta":["name","email","url"],"serverURL":"https://waline.717170.xyz"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2024 - 
        
        2025 muziyang
    </section>
    
    <section class="powerby">
        
            ÁΩëÁ´ôÊÄªËÆøÂÆ¢Êï∞Ôºö<span id='busuanzi_value_site_uv'>Loading</span><br/>ÁΩëÁ´ôÊÄªËÆøÈóÆÈáèÔºö<span id='busuanzi_value_site_pv'>Loading</span> <br/>
        ‰ΩøÁî® <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> ÊûÑÂª∫ <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>


<script defer src="https://cn.vercount.one/js"></script>

    </body>
</html>
