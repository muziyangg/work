<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="接口说明 仪器厂商 迪尔\n仪器型号 DL96A\n通讯方式 双向 仪器类型 微生物 医院名称 程序名称 MI.MIFDL96A 终端服务器地址 终端服务器端口号 仪器上接口标示和接口类型 接口类型：通过监听连接仪器 连接方式：数据库类型为mysql 仪器接口说明 先通过^LISTMPWSW获取细菌，抗生素，专家规则数据，通过细菌通道为索引组装保存数据 保存细菌数据后未生成对应的报告和鉴定树导致专家规则无法保存，调用 try{d ##class(IDP.WS.BLL.DHCIDPResult).GetReportIDPTreeJSONStream(ReportDR, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;)}catch{}方法生成鉴定树，随后进行保存专家规则 通过sql插入标本信息达成双向 串口盒子配置 波特率： 9600 数据位：8 停止位： 1 校验位： N 数据格式 项目通道号 修改记录 序号 日期 操作人 说明 1 2025-01-25 18:32:16\n杨浩然 仪器接口程序 监听配置 1 /// [{&#34;MachID&#34;:&#34;#RowID&#34;,&#34;Type&#34;:&#34;DataBase&#34;,&#34;UpTime&#34;:&#34;3000&#34;,&#34;Address&#34;:&#34;DSN=DL96A&#34;,&#34;UpCDF&#34;:&#34;&#34;,&#34;UpREF&#34;:&#34;&#34;,&#34;DealProcess&#34;:&#34;MI.MIFDL96A&#34;,&#34;Para&#34;:&#34;SELECT * FROM lis_result WHERE DATE(UpdateDate) = CURDATE()#ID#&#34;,&#34;PreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;,&#34;UPPreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;}] 接口程序 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 /// [{&#34;MachID&#34;:&#34;#RowID&#34;,&#34;Type&#34;:&#34;DataBase&#34;,&#34;UpTime&#34;:&#34;3000&#34;,&#34;Address&#34;:&#34;DSN=DL96A&#34;,&#34;UpCDF&#34;:&#34;&#34;,&#34;UpREF&#34;:&#34;&#34;,&#34;DealProcess&#34;:&#34;MI.MIFDL96A&#34;,&#34;Para&#34;:&#34;SELECT * FROM lis_result WHERE DATE(UpdateDate) = CURDATE()#ID#&#34;,&#34;PreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;,&#34;UPPreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;}] Class MI.MIFDL96A Extends %RegisteredObject { /// D ##class(MI.MIFDL96E02).fileMTHD(&#34;22&#34;,&#34;4185~33122416~~~□肺炎链球菌(S.pneumoniae)□G+球菌□□[spn]□(优势菌2)~~~~~A;PEN;;＝8;耐药;;B;CLI;;≥8;耐药;;A;SXT;;≥8/152;耐药;;B;CRO;;＝1;敏感;;A;ERY;;≥16;耐药;;B;VA;;≤1;敏感;;B;LEV;;＝2;敏感;;B;TET;;＝32;耐药;;B;MRP;;≤0.25;敏感;;C;CXM;;≥4;耐药;;C;RIF;;≤0.5;敏感;;C;AMC;;≤1.0/0.5;敏感;;C;LNZ;;≤2;敏感;;~~~~~对左氧氟沙星敏感的菌株可预报其对吉米沙星和莫西沙星敏感。[13][10]对四环素敏感的菌株对多西环素和米诺环素也敏感。[13][10]利福平不单独用于抗菌治疗。[13][10]红霉素可预报阿奇霉素、克拉霉素和地红霉素的敏感和耐药性。[13][10]~~~~普通细菌培养+药敏~2020-12-25□8:33:23~2020-12-27□8:33:23~1~&#34;,&#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;) /// d ##class(MI.MIFDL96AN).fileMTHD(&#34;56&#34;,$g(^YHR(&#34;WSWQC&#34;))) ClassMethod fileMTHD(mi, record, epis, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %String { s mi=$g(mi) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34; i &#39;$l(record) q &#34;&#34; s ItemDeli=$c(92) //项目分隔符92 s ResultDeli=$c(44) //结果分隔符44 s AntDeli=&#34;]&#34; //抗生素分隔符] s SenDeli=&#34;[&#34; //药敏结果分隔符[ d Trace^MI.MIF000(mi,record,&#34;record&lt;--M&#34;) /// 54724~52772~~~~□肺炎链球菌(S.pneumoniae)□G+球菌□□[spn]□(弱势菌)~~~~~A;PEN;;≥32;耐药;;B;CLI;;≥8;耐药;;A;SXT;;≥8/152;耐药;;B;CRO;;＝1;敏感;;A;ERY;;≥16;耐药;;B;VA;;≤1;敏感;;B;LEV;;＝2;敏感;;B;TET;;＝32;耐药;;B;MRP;;≤0.25;敏感;;C;CXM;;≥4;耐药;;C;RIF;;≤0.5;敏感;;C;AMC;;＝2/1;敏感;;C;LNZ;;≤2;敏感;;~~~~~对左氧氟沙星敏感的菌株可预报其对吉米沙星和莫西沙星敏感。[13][10]红霉素可预报阿奇霉素、克拉霉素和地红霉素的敏感和耐药性。[13][10]利福平不单独用于抗菌治疗。[13][10]对四环素敏感的菌株对多西环素和米诺环素也敏感。[13][10]~~~普通细菌培养+药敏~2019/12/10□8:41:15~2019/12/13□8:41:15~0~1~ /// &#34;35~182~25010700606~I-180,2N10155711,*□|I-179,2E10532605,*□|~I-180,2N10155711,*□|I-179,2E10532605,*□|~~□,I-180,2N10155711,铜绿假单胞菌(Pseudomonas□aeruginosa),pae,-,0,□|□,I-179,2E10532605,肺炎克雷伯菌(Klebsiella□pneumoniae),kpn,-,0,□|~~I-180,2N10155711,DL-120□NE2,pae,FEP,&lt;=2μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-180,2N10155711,DL-120□NE2,pae,CAZ,&lt;=2μg/mL,A,S,≤8&amp;16&amp;≥32,Y|I-180,2N10155711,DL-120□NE2,pae,GEN,&lt;=2μg/mL,A,S,≤4&amp;8&amp;≥16,Y|I-180,2N10155711,DL-120□NE2,pae,TOB,&lt;=1μg/mL,A,S,≤4&amp;8&amp;≥16,Y|I-180,2N10155711,DL-120□NE2,pae,AMK,&lt;=4μg/mL,INV,□,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,PIP,&lt;=4μg/mL,O,S,≤16&amp;32&amp;≥64,Y|I-180,2N10155711,DL-120□NE2,pae,IPM,&lt;=1μg/mL,B,S,≤2&amp;4&amp;≥8,Y|I-180,2N10155711,DL-120□NE2,pae,TZP,&lt;=4/4μg/mL,A,S,≤16/4&amp;32/4&amp;≥64/4,Y|I-180,2N10155711,DL-120□NE2,pae,MEM,&lt;=1μg/mL,B,S,≤2&amp;4&amp;≥8,Y|I-180,2N10155711,DL-120□NE2,pae,SAM,&gt;=64/32μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,CSL,&lt;=8/4μg/mL,O,S,≤16/8&amp;32/16&amp;≥64/32,Y|I-180,2N10155711,DL-120□NE2,pae,ATM,=4μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-180,2N10155711,DL-120□NE2,pae,LVX,&lt;=1μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-180,2N10155711,DL-120□NE2,pae,TCC,=16/2μg/mL,O,S,≤16/2&amp;32/2-64/2&amp;≥128/2,Y|I-180,2N10155711,DL-120□NE2,pae,SXT,&lt;=1/19μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,NOR,&lt;=4μg/mL,INV,□,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,MNO,&gt;=32μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,TGC,=16μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,CIP,&lt;=0.5μg/mL,B,S,≤0.5&amp;1&amp;≥2,Y|I-180,2N10155711,DL-120□NE2,pae,POL,=1μg/mL,O,I,□&amp;≤2&amp;≥4,Y|I-180,2N10155711,DL-120□NE2,pae,DOX,&gt;=16μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,CHL,&gt;=32μg/mL,INV,R,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,AMP,&gt;=32μg/mL,A,R,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,GEN,&lt;=1μg/mL,A,S,≤4&amp;8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,SAM,&lt;=8/4μg/mL,B,S,≤8/4&amp;16/8&amp;≥32/16,Y|I-179,2E10532605,DL-120□E2,kpn,TZP,&lt;=4/4μg/mL,B,S,≤16/4&amp;32/4-64/4&amp;≥128/4,Y|I-179,2E10532605,DL-120□E2,kpn,CSL,&lt;=8/4μg/mL,O,S,≤16/8&amp;32/16&amp;≥64/32,Y|I-179,2E10532605,DL-120□E2,kpn,CCV,&lt;=1/4μg/mL,INV,□,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,CTC,&lt;=1/4μg/mL,INV,□,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,CZO,=8μg/mL,A,R,≤2&amp;4&amp;≥8,Y|I-179,2E10532605,DL-120□E2,kpn,FEP,&lt;=0.12μg/mL,B,S,≤2&amp;4-8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,FOX,&lt;=8μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,CXM(Iv),&lt;=4μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,CXM(Oral),&lt;=4μg/mL,B,S,≤4&amp;8-16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,LVX,&lt;=0.12μg/mL,B,S,≤0.5&amp;1&amp;≥2,Y|I-179,2E10532605,DL-120□E2,kpn,SXT,&lt;=0.5/9.5μg/mL,B,S,≤2/38&amp;□&amp;≥4/76,Y|I-179,2E10532605,DL-120□E2,kpn,CTX,&lt;=0.12μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,IPM,&lt;=0.25μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,CAZ,&lt;=0.5μg/mL,C,S,≤4&amp;8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,CHL,&lt;=8μg/mL,C,S,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,MEM,&lt;=0.06μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,AMK,&lt;=4μg/mL,B,S,≤16&amp;32&amp;≥64,Y|I-179,2E10532605,DL-120□E2,kpn,NIT,&lt;=16μg/mL,INV,□,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,ETP,&lt;=0.015μg/mL,B,S,≤0.5&amp;1&amp;≥2,Y|I-179,2E10532605,DL-120□E2,kpn,MNO,&lt;=1μg/mL,O,S,≤4&amp;8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,TGC,&lt;=0.25μg/mL,INV,S,≤1&amp;2&amp;&gt;2,Y|I-179,2E10532605,DL-120□E2,kpn,POL,&lt;=1μg/mL,O,I,□&amp;≤2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,AZM,&lt;=8μg/mL,INV,R,□&amp;□&amp;□,Y|~I-180,2N10155711,□|I-179,2E10532605,□|~I-180,2N10155711*多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*长期使用各种抗生素治疗，铜绿假单胞菌会变得耐药。初期敏感的菌株在治疗3-4天内变为耐药，因此，测试重复分离株是必要的。*哌拉西林（单药或联合他唑巴坦）的折点基于哌拉西林（单药或联合他唑巴坦）至少3g□q6h给药方案。*亚胺培南的折点基于1g□q8h或500mg□q6h的给药方案。*左氧氟沙星的折点基于750mg□qd的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*长期使用各种抗生素治疗，铜绿假单胞菌会变得耐药。初期敏感的菌株在治疗3-4天内变为耐药，因此，测试重复分离株是必要的。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。*多黏菌素B应给予负荷剂量和最大推荐剂量。*头孢吡肟的折点基于1g□q8h或2g□q12h的给药方案。*头孢他啶的折点基于1g□q6h或2g□q8h的给药方案。*环丙沙星的折点基于静脉注射400mg□q8h给药方案。*氨曲南的折点基于1g□q6h或2g□q8h的给药方案。*替卡西林/克拉维酸的折点基于至少3g□□q6h给药方案。*此报告采用的折点标准来源为CLSIM100□2024，其中头孢哌酮/舒巴坦为CHINET技术要求□2022，妥布霉素、庆大霉素为CLSIM100□2022。|I-179,2E10532605*仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。*亚胺培南的折点基于500mg□q6h或1g□q8h的给药方案。*多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*氨苄西林的结果可用于预报阿莫西林的敏感性。*厄他培南的折点基于1g□qd的给药方案。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。*头孢西丁的折点基于至少8g□qd的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*头孢呋辛（注射）的折点基于1.5g□q8h的给药方案。*环丙沙星折点基于静脉注射400mg□q12h或口服500mg□q12h给药方案。*多黏菌素B应给予负荷剂量和最大推荐剂量。*头孢噻肟的折点基于1g□q8h的给药方案。*治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g□q8h的给药方案。*头孢吡肟的敏感折点基于1g□q12h的给药方案。*此报告采用的折点标准来源为CLSIM100□2024，其中哌拉西林/他唑巴坦为CLSIM100□2021，头孢哌酮/舒巴坦为CHINET技术要求□2022，替加环素为EUCAST□2018，阿米卡星、庆大霉素为CLSIM100□2022。|~~~~~I-180,2N10155711,2025-01-12□15:55:48|I-179,2E10532605,2025-01-12□16:00:48|~~~1~2025-01-12□16:25:01~□~□,I-180,2N10155711,铜绿假单胞菌(Pseudomonas□aeruginosa),pae,G-杆菌,0,□|□,I-179,2E10532605,肺炎克雷伯菌(Klebsiella□pneumoniae),kpn,G-杆菌,0,□|~I-180,2N10155711,□|I-179,2E10532605,□|~I-180,2N10155711*[SAM&amp;TGC&amp;MNO&amp;SXT&amp;CHL&amp;DOX]*[]*[]|I-179,2E10532605*[AMP&amp;AZM]*[]*[]|~~~~&#34; s (sample,epis,surname,rec,res,fresult,date,time,QC,xBugs,AntLIST,expertRules)=&#34;&#34; k ^LISTMPWSW /// 获取流水号 s epis=$tr($p(record,&#34;~&#34;,3),&#34; &#34;) q:&#39;$l(epis) &#34;&#34; s curDate=$zd($h,8) /// 获取细菌 s xBugsData=$p(record,&#34;~&#34;,7) f i=1:1:$l(xBugsData,&#34;|&#34;) d .s xBugsDatai=$p(xBugsData,&#34;|&#34;,i) .i &#39;$l(xBugsDatai) q .s xBugs=$p(xBugsDatai,&#34;,&#34;,5) .i xBugs=&#34;&#34; q .s code=i .s ^LISTMPWSW(&#34;xBugs&#34;,xBugs)=code .s ^LISTMPWSW(&#34;xBugsNum&#34;,code)=xBugs /// 获取药敏 s antStrData=$p(record,&#34;~&#34;,9) f i=1:1:$l(antStrData,&#34;|&#34;) d .s antStrDatai=$p(antStrData,&#34;|&#34;,i) .i &#39;$l(antStrDatai) q .s xBugs=$p(antStrDatai,&#34;,&#34;,4) .i &#39;$l(xBugs) q .s ^LISTMPWSW(&#34;antStr&#34;,xBugs,i)=antStrDatai /// 获取专家规则 s expertRulesData=$p(record,&#34;~&#34;,11) f i=1:1:$l(expertRulesData,&#34;|&#34;) d .s expertRulesDatai=$p(expertRulesData,&#34;|&#34;,i) .i &#39;$l(expertRulesDatai) q .s xBugs=$g(^LISTMPWSW(&#34;xBugsNum&#34;,i)) .i &#39;$l(xBugs) q .s expertRules=$p(expertRulesDatai,&#34;*&#34;,2,*) .s ^LISTMPWSW(&#34;expertRules&#34;,xBugs)=expertRules s xBugs=&#34;&#34; f s xBugs=$o(^LISTMPWSW(&#34;xBugs&#34;,xBugs)) q:xBugs=&#34;&#34; d .s code=$g(^LISTMPWSW(&#34;xBugs&#34;,xBugs)) .s (AntLIST,fresult,date,time,QC)=&#34;&#34; .s antStr=&#34;&#34; f s antStr=$o(^LISTMPWSW(&#34;antStr&#34;,xBugs,antStr)) q:antStr=&#34;&#34; d ..s antList=$g(^LISTMPWSW(&#34;antStr&#34;,xBugs,antStr)) ..s AntGroup=$p(antList,&#34;,&#34;,7) //抗生素分组 ..s xANT=$tr($p(antList,&#34;,&#34;,5),&#34; &#34;) q:xANT=&#34;&#34; //抗生素 ..s xMIC=$replace($p(antList,&#34;,&#34;,6),&#34;μg/mL&#34;,&#34;&#34;) //MIC ..s xRES=$tr($p(antList,&#34;,&#34;,8),&#34; &#34;) //耐药 ..s AntLIST=AntLIST_xANT_AntDeli_xRES_AntDeli_xMIC_AntDeli_AntDeli_AntGroup_SenDeli .d Trace^MI.MIF000(mi,AntLIST,&#34;AntLIST&lt;--M&#34;) .i $l(xBugs),$l(epis),$l(AntLIST) d ..s fresult=xBugs_ItemDeli_AntLIST_ItemDeli_code_ResultDeli .d Trace^MI.MIF000(mi,epis_&#34;$$&#34;_fresult,&#34;fresult&lt;--M&#34;) .i $l(fresult) d ..d Save^MI.MIF000(mi,epis,code_ItemDeli_xBugs_ItemDeli_ItemDeli_ItemDeli_ResultDeli,date,time,QC) ..d SaveAnt^MI.MIF000(mi,epis,fresult,date,time,QC) .s expertRules=$g(^LISTMPWSW(&#34;expertRules&#34;,xBugs)) .s ret=..SaveZJGZ(epis, mi, code, expertRules) .d Trace^MI.MIF000(mi,ret,&#34;专家规则保存ret&#34;) k ^LISTMPWSW q &#34;&#34; } ClassMethod GerTestCodeDR(mi, code) { s mi=$g(mi),code=$g(code) s ret=&#34;&#34; i &#39;$l(mi) q ret i &#39;$l(code) q ret i $d(^dbo.BTMIMachineTestCodeI(&#34;IndexResultChannel&#34;,mi,code)) d .s BTMIMachineTestCodeDR=$o(^dbo.BTMIMachineTestCodeI(&#34;IndexResultChannel&#34;,mi,code,&#34;&#34;)) .s TestCodeDR=$lg($g(^dbo.BTMIMachineTestCodeD(BTMIMachineTestCodeDR)),3) .s ret=TestCodeDR q ret } /// w ##class(MI.MIFDL96A2).SaveZJGZ(&#34;6633&#34;,&#34;40&#34;,1,&#34;多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*头孢噻肟的折点基于1g□q8h的给药方案。*亚胺培南的折点基于500mg□q6h或1g□q8h的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*头孢唑啉的结果可预报非复杂性的泌尿系统感染的大肠埃希菌对口服头孢拉定、头孢地尼、头孢克罗、头孢丙烯、头孢泊肟、头孢呋辛的敏感性。*头孢西丁的折点基于至少8g□qd的给药方案。*仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。*氨苄西林的结果可用于预报阿莫西林的敏感性。*环丙沙星折点基于静脉注射400mg□q12h或口服500mg□q12h给药方案。*头孢吡肟的敏感折点基于1g□q12h的给药方案。*头孢呋辛（注射）的折点基于1.5g□q8h的给药方案。*治疗非复杂泌尿道感染的头孢唑林折点是基于1g□q12h的给药方案。*治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g□q8h的给药方案。*多黏菌素B应给予负荷剂量和最大推荐剂量。*厄他培南的折点基于1g□qd的给药方案。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。&#34;) /// w ##class(MI.MIFDL96A).SaveZJGZ(&#34;24120600395&#34;,&#34;56&#34;,1,&#34;QNR-ECO：喹诺酮类耐药的大肠埃希菌。*MDR：多重耐药菌株。*产ESBL株：产超广谱β-内酰胺酶菌株。*CTX-CRO-R-ECO：头孢噻肟或头孢曲松耐药的大肠埃希菌。*头孢呋辛（注射）的折点基于1.5g□q8h的给药方案。*仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。*厄他培南的折点基于1g□qd的给药方案。*治疗非复杂泌尿道感染的头孢唑林折点是基于1g□q12h的给药方案。*多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*头孢唑啉的结果可预报非复杂性的泌尿系统感染的大肠埃希菌对口服头孢拉定、头孢地尼、头孢克罗、头孢丙烯、头孢泊肟、头孢呋辛的敏感性。*头孢西丁的折点基于至少8g□qd的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*环丙沙星折点基于静脉注射400mg□q12h或口服500mg□q12h给药方案。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。*头孢噻肟的折点基于1g□q8h的给药方案。*亚胺培南的折点基于500mg□q6h或1g□q8h的给药方案。*氨苄西林的结果可用于预报阿莫西林的敏感性。*治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g□q8h的给药方案。*多黏菌素B应给予负荷剂量和最大推荐剂量。*此报告采用的折点标准来源为CLSIM100□2024，其中替加环素为EUCAST□2018，头孢哌酮/舒巴坦为CHINET技术要求□2022，哌拉西林/他唑巴坦为CLSIM100□2021，阿米卡星、庆大霉素为CLSIM100□2022。&#34;) /// w ##class(MI.MIFDL96A).SaveZJGZ(&#34;WX250104003&#34;,&#34;56&#34;,1,&#34;1、MDR：多重耐药菌株。 2、QNR-ECO：喹诺酮类耐药的大肠埃希菌。 3、产ESBL株：产超广谱β-内酰胺酶菌株。 4、CTX-CRO-R-ECO：头孢噻肟或头孢曲松耐药的大肠埃希菌。 5、治疗非复杂泌尿道感染的头孢唑林折点是基于1g q12h的给药方案。 6、仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。 7、亚胺培南的折点基于500mg q6h或1g q8h的给药方案。 8、多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。 9、氨苄西林的结果可用于预报阿莫西林的敏感性。 10、头孢唑啉的结果可预报非复杂性的泌尿系统感染的大肠埃希菌对口服头孢拉定、头孢地尼、头孢克罗、头孢丙烯、头孢泊肟、头孢呋辛的敏感性。 11、厄他培南的折点基于1g qd的给药方案。 12、对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。 13、头孢西丁的折点基于至少8g qd的给药方案。 14、美罗培南的折点基于1g q8h的给药方案。 15、头孢呋辛（注射）的折点基于1.5g q8h的给药方案。 16、环丙沙星折点基于静脉注射400mg q12h或口服500mg q12h给药方案。 17、多黏菌素B应给予负荷剂量和最大推荐剂量。 18、头孢噻肟的折点基于1g q8h的给药方案。 19、治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g q8h的给药方案。 20、此报告采用的折点标准来源为CLSIM100 2024，其中哌拉西林/他唑巴坦为CLSIM100 2021，头孢哌酮/舒巴坦为CHINET技术要求 2022，替加环素为EUCAST 2018，阿米卡星、庆大霉素为CLSIM100 2022。&#34;) ClassMethod SaveZJGZ(epis, mi, code, ExpertRules) { s epis=$g(epis),mi=$g(mi),ExpertRules=$g(ExpertRules) s episData=$$GetEpisByLabno(mi,epis) s epis=$p(episData,&#34;^&#34;,1) s WGM=$p(episData,&#34;^&#34;,2) s ReportDR=$p(episData,&#34;^&#34;,3) s TestCodeDR=..GerTestCodeDR(mi,code) i $l(ReportDR) d .s IDPResultDR=$o(^dbo.IDPResultI(&#34;IndexIDPElement&#34;,ReportDR,2,&#34;&#34;)) .i &#39;$d(^dbo.RPVisitNumberTestSetI(&#34;IndexReportID&#34;,ReportDR)) q .i &#39;$l(TestCodeDR) q .try{d ##class(IDP.WS.BLL.DHCIDPResult).GetReportIDPTreeJSONStream(ReportDR, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;)}catch{} i &#39;$l(mi) q 0 i &#39;$l(epis) d Trace^MI.MIF000(mi,&#34;流水号不能为空&#34;,&#34;保存检测结论返回&#34;) q 0 //报告可能核收到微生物培养的四个小组 s sc=0 s transmitDate=&#34;&#34; f s transmitDate=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNo&#34;,WGM,&#34;&#34;_epis,transmitDate)) q:transmitDate=&#34;&#34; d .s ReportDR=&#34;&#34; f s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNo&#34;,WGM,&#34;&#34;_epis,transmitDate,ReportDR)) q:ReportDR=&#34;&#34; d ..//IndexReportItem On (VisitNumberReportDR, TestCodeDR) ..i &#39;$d(^dbo.RPVisitNumberReportResultI(&#34;IndexReportItem&#34;,ReportDR,TestCodeDR)) q ..s ResultDR=$o(^dbo.RPVisitNumberReportResultI(&#34;IndexReportItem&#34;,ReportDR,TestCodeDR,&#34;&#34;)) ..s objRep=##Class(dbo.RPVisitNumberReportResult).%OpenId(ResultDR) ..s EXPRlues=objRep.ExpertRule ..i EXPRlues=ExpertRules q //专家规则不再变化，不存 ..s objRep.ExpertRule=ExpertRules ..s sc=objRep.%Save() ..i (&#39;$SYSTEM.Status.IsOK(sc)) d Trace^MI.MIF000(mi,&#34;保存检测结论失败&#34;,&#34;保存检测结论失败返回&#34;) q ..d Trace^MI.MIF000(mi,ExpertRules,&#34;保存检测结论成功返回&#34;) q sc GetEpisByLabno(mi,Epis) //通过检验号获取流水号 ;Index IndexVisitNumber On VisitNumber [ SqlName = Index_VisitNumber, Type = index, Unique ]; ;Index IndexReportID On (VisitNumberDR, WorkGroupMachineDR, OrderNo) [ SqlName = Index_ReportID, Type = index, Unique ]; s ret=&#34;&#34;,mi=$g(mi),Epis=$g(Epis),ReportDR=&#34;&#34; i &#39;$l(mi) q Epis i &#39;$l(Epis) q Epis s WGMachineID=$lg($g(^dbo.BTMIMachineParameterD(mi)),6) i $d(^dbo.RPVisitNumberI(&#34;IndexVisitNumber&#34;,Epis)) d .s VisitnumberDR=$o(^dbo.RPVisitNumberI(&#34;IndexVisitNumber&#34;,Epis,&#34;&#34;)) .i $d(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitnumberDR)) d ..s WGMachineID=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitnumberDR,&#34;&#34;)) .i $d(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitnumberDR,WGMachineID,1)) d ..s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitnumberDR,WGMachineID,1,&#34;&#34;),-1) ..s ret=$lg($g(^dbo.RPVisitNumberReportD(ReportDR)),8) i $l(ret) q ret_&#34;^&#34;_WGMachineID_&#34;^&#34;_ReportDR i &#39;$d(^dbo.RPVisitNumberReportI(&#34;IndexMicNoNew&#34;,Epis)) q ret_&#34;^&#34;_WGMachineID_&#34;^&#34;_ReportDR s WGMachineID=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNoNew&#34;,Epis,&#34;&#34;)) s TransmitDate=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNoNew&#34;,Epis,WGMachineID,&#34;&#34;)) s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNoNew&#34;,Epis,WGMachineID,TransmitDate,&#34;&#34;)) s ret=Epis q ret_&#34;^&#34;_WGMachineID_&#34;^&#34;_ReportDR } /// D ##class(MI.MIFLISMonitorTest)SaveImageMTHD(&#34;7&#34;,&#34;9999&#34;, &#34;&#34;,&#34;175&#34;) /// mi:仪器 /// epis：流水号，如果是监听图片模式该位置放图片名称，自己在保存前提取流水 /// ImageClass:图片类别，如果是监听图片模式该位置放图片名称，自己在保存前提取图片类型 /// FileName:保存在文件服务的相对路径，默认不动 /// FullName:文件全路径，如果是监听图片模式该位置放图片全路径名称，满足有的图片名称无法得到流水和图片类别的情况 ClassMethod SaveImageMTHD(mi, epis, ImageClass, FileName, FullName, SaveImageRetName, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %String { //通过OtherPara配置取图的在这里通过epis和ImageClass的图片名字提取出流水号和图片类别 s mi=$g(mi) s epis=$g(epis) s ImageClass=$g(ImageClass) s FileName=$g(FileName) s FullName=$g(FullName) s SaveImageRetName=$g(SaveImageRetName) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34; d ##Class(MI.Common.MIFBase).Trace(mi,epis_&#34;:&#34;_ImageClass_&#34;:&#34;_FileName,&#34;H&lt;--M&#34;) s (ReceiveDate, ImageOrder, Caption, DisplayRatio, Height, Width, Sequence)=&#34;&#34; //加上当前时间，防止浏览器缓存 s FileName=FileName_&#34;?&#34;_$p($h,&#34;,&#34;,2) //OtherPara用^分隔第四位指定SaveImageRetName的话在这里改FileName为新名称。同时让方法返回新图片名字 s NewFileName=&#34;&#34; i SaveImageRetName=&#34;SaveImageRetName&#34; d .//图片新名字 .;s NewFileName=epis_&#34;-&#34;_ImageClass_&#34;-&#34; .//路径新名字 .s NewPathName=&#34;&#34; .s SPLen=$l(FileName,&#34;/&#34;) .f ii=1:1:SPLen d ..i ii&lt;SPLen d ...s NewPathName=NewPathName_$p(FileName,&#34;/&#34;,ii)_&#34;/&#34; ..i ii=SPLen d ...s NewFileName=NewFileName_$p(FileName,&#34;/&#34;,ii) .s NewPathName=NewPathName_NewFileName .s FileName=NewPathName //最后返回NewFileName s ret=##Class(MI.Common.MachineResult).SaveImage(ReceiveDate, epis, ImageClass, ImageOrder, FileName, mi, Caption, DisplayRatio, Height, Width, Sequence) //返回值控制图片名称模式 i SaveImageRetName=&#34;SaveImageRetName&#34; d .s ret=NewFileName q ret } /// 返回给监听当前上传文件路径名称，默认不要动 /// w ##class(MI.MIFLISMonitorTest).GetFtpMTHD(&#34;7&#34;) /// mi:仪器 ClassMethod GetFtpMTHD(mi, P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %String { //文件服务模式必须改的地方，老的FTP模式这么改了也没问题，所以建议都这样 s mi=$g(mi) q ##Class(MI.Common.MIFBase).GetMiFtpPath(mi) } /// Creator： 查询患者信息，监听配置上传前处理类后会定时调用这个query查询数据进行上传操作 /// CreatDate： 20140919 /// Description:： /// Table： /// Input： mi：仪器主键 /// Output： 仪器信息 /// Return： 仪器信息 /// Others： Query QryLabInfo(mi As %String, P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %Query(ROWSPEC = &#34;labno,labnoInfo,patInfo&#34;) { } /// Query的执行方法 /// d ##class(%ResultSet).RunQuery(&#34;MI.MIFDL96A&#34;,&#34;QryLabInfo&#34;,&#34;56&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;) ClassMethod QryLabInfoExecute(ByRef qHandle As %Binary, mi As %String, P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %Status { Set repid=$i(^CacheTemp) Set ind=1 s mi=$g(mi),flag=$g(flag) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34; s LabnoList=&#34;&#34; //控制输出Excel //s Data=##class(MI.Common.MIFBase).DemoMOutFileInfo(&#34;D:\\\\OUT\\\\上传.xls&#34;,&#34;张三[0][1]男[0][1]28岁[0][1]&#34;_$h,&#34;900001&#34;,&#34;1&#34;) //d OutputRow //Set qHandle=$lb(0,repid,0) //Quit $$$OK //控制输出Excel //查最近8天 s AddDate=$zd($p($h,&#34;,&#34;,1)-8,8) f s AddDate=$o(^dbo.RPMachineUploadI(&#34;IndexSendStatus&#34;,mi,##Class(LIS.Util.Common).IndexData(&#34;C&#34;),AddDate)) q:AddDate=&#34;&#34; d .s AddTime=&#34;&#34; f s AddTime=$o(^dbo.RPMachineUploadI(&#34;IndexSendStatus&#34;,mi,##Class(LIS.Util.Common).IndexData(&#34;C&#34;),AddDate,AddTime)) q:AddTime=&#34;&#34; d ..//20秒以内的先不上传，防止没接收完 ..i (AddDate=$zd($h,8)),(($p($h,&#34;,&#34;,2)-AddTime)&lt;20) q ..s MiUploadDR=$o(^dbo.RPMachineUploadI(&#34;IndexSendStatus&#34;,mi,##Class(LIS.Util.Common).IndexData(&#34;C&#34;),AddDate,AddTime,&#34;&#34;)) ..s labno=$lg(^dbo.RPMachineUploadD(MiUploadDR),3) ..i &#39;$l(labno) q ..//得到通道号 ..s chl=$lg($g(^dbo.RPMachineUploadD(MiUploadDR)),7) ..//测试类型0：文本，1：数据库 ..s TestType=&#34;1&#34; ..i TestType=&#34;0&#34; d ...//文本双向上传开始****************************************************** ...//控制输出文本的内容 ...s txtInfo=labno_&#34;^&#34;_chl ...s Data=##class(MI.Common.MIFBase).DemoMOutFileInfo($zd($h,8)_labno_&#34;.order&#34;,txtInfo,labno,&#34;&#34;) ...d OutputRow ...s labno=labnoOld_&#34;^&#34;_$zd($h,8)_labno_&#34;.ok&#34; ...s Data=##class(MI.Common.MIFBase).DemoMOutFileInfo($zd($h,8)_labno_&#34;.ok&#34;,txtInfo,labno,&#34;&#34;) ...d OutputRow ...//文本双向上传结束****************************************************** ..i TestType=&#34;1&#34; d ...//数据库双向上传开始****************************************************** ...//控制执行sql ...//Insert into liscontroller.lis_application (SPEC_NUM,BTBarcode,ASTBarcode,PATIENT_ID,MSPosition,PatientNo,FULL_NAME,FIRST_NAME,LAST_NAME,Birth,AGE,SEX,Purpose,WARD,Specimen,BedNo,Diagnosis,SpRequest,Medication,SuspectedBact,Doctor,AdviceNo,ApplyDate,SendDate,Collector,SPEC_DATE,CollectPosition,IdResult,Updated,UpdateDate,CARSS_ReadDate,StainType,StructVersion) values ...//(&#39;9999&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;199732&#39;,&#39;NULL&#39;,&#39; &#39;,&#39;测试&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#39;,&#39;85y&#39;,&#39;f&#39;,&#39;普通细菌培养+药敏&#39;,&#39;三病室&#39;,&#39;痰&#39;,&#39;3&#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39;刘云&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;2024/6/28 9:17&#39;,&#39;谢艳红&#39;,&#39;2024/6/29 11:17&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;0&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;) ...// Insert into liscontroller.lis_application (SPEC_NUM,BTBarcode,ASTBarcode,PATIENT_ID,MSPosition,PatientNo,FULL_NAME,FIRST_NAME,LAST_NAME,Birth,AGE,SEX,Purpose,WARD,Specimen,BedNo,Diagnosis,SpRequest,Medication,SuspectedBact,Doctor,AdviceNo,ApplyDate,SendDate,Collector,SPEC_DATE,CollectPosition,IdResult,Updated,UpdateDate,CARSS_ReadDate,StainType,StructVersion) values ...//(&#39;25010700606&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;202500044&#39;,&#39;NULL&#39;,&#39; &#39;,&#39;潘攀&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#39;,&#39;1y&#39;,&#39;m&#39;,&#39;普通细菌培养+药敏&#39;,&#39;儿科&#39;,&#39;痰液&#39;,&#39;17&#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39;姚美清&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;2025-01-08 11:52:47&#39;,&#39;彭娜&#39;,&#39;2025-01-08 11:52:47&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;0&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;) ...s SqlStr=&#34;Insert into liscontroller.lis_application (SPEC_NUM,BTBarcode,ASTBarcode,PATIENT_ID,MSPosition,PatientNo,FULL_NAME,FIRST_NAME,LAST_NAME,Birth,AGE,SEX,Purpose,WARD,Specimen,BedNo,Diagnosis,SpRequest,Medication,SuspectedBact,Doctor,AdviceNo,ApplyDate,SendDate,Collector,SPEC_DATE,CollectPosition,IdResult,Updated,UpdateDate,CARSS_ReadDate,StainType,StructVersion) values &#34; ...s PatInfo=..GetPatInfo(mi, labno) ...d Trace^MI.MIF000(mi,PatInfo,&#34;PatInfo&#34;) ...//2024-07-01 16:47:48,Mejer600-4,2406290091,,,mnwk-泌尿外科,刘乐,唐云,0000628089,周田香,2,住院,33,43,,2406290091,2024-06-29 11:15,,,,,肾积水伴肾输尿管结石,,,,2024-06-29 06:48,, ...s EPIS=$p(PatInfo,&#34;,&#34;,31) //鉴定号 ...s DTTime=$p(PatInfo,&#34;,&#34;,32) //核收时间 ...s Name=$p(PatInfo,&#34;,&#34;,10) //姓名 ...s Sex=$p(PatInfo,&#34;,&#34;,11) //性别 ...i Sex=&#34;1&#34; s Sex=&#34;m&#34; ...i Sex=&#34;2&#34; s Sex=&#34;f&#34; ...s Age=$p(PatInfo,&#34;,&#34;,14) //年龄 ...s MediNo=$p(PatInfo,&#34;,&#34;,29) //病案号 ...s Location=$p(PatInfo,&#34;,&#34;,6) //科室 ...i Location[&#34;-&#34; s Location=$p(Location,&#34;-&#34;,2) //jzwkszwk-脊柱外科 ...s Speciman=$p(PatInfo,&#34;,&#34;,30) //标本类型 ...s BedNo=$p(PatInfo,&#34;,&#34;,13) //床号 ...s Doctor=$p(PatInfo,&#34;,&#34;,7) //医生 ...s CollectUser=$p(PatInfo,&#34;,&#34;,8) //采集者 ...//s DTTime=$tr($zd($h,3),&#34;-&#34;,&#34;/&#34;)_&#34; &#34;_$zt($p($h,&#34;,&#34;,2),1) //2024/6/28 9:17 $p($zt($h,1),&#34;:&#34;,1,*-1) ...s ValueStr=&#34;(&#39;&#34;_EPIS_&#34;&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#34;_MediNo_&#34;&#39;,&#39;NULL&#39;,&#39; &#39;,&#39;&#34;_Name_&#34;&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#39;,&#39;&#34;_Age_&#34;&#39;,&#39;&#34;_Sex_&#34;&#39;,&#39;普通细菌培养+药敏&#39;,&#39;&#34;_Location_&#34;&#39;,&#39;&#34;_Speciman_&#34;&#39;,&#39;&#34;_BedNo_&#34;&#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39;&#34;_Doctor_&#34;&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;&#34;_DTTime_&#34;&#39;,&#39;&#34;_CollectUser_&#34;&#39;,&#39;&#34;_DTTime_&#34;&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;0&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;)&#34; ...s SqlStr=SqlStr_ValueStr ...d Trace^MI.MIF000(mi,SqlStr,&#34;SqlStr&#34;) ...s ^DL96(&#34;Send&#34;,+$h,labno)=1 //上传标识置为1 ...//多条命令组装多个SQL语句输出.SQL包含$StoredProcedure就当存储过程执行 ...s Data=##class(MI.Common.MIFBase).DemoMOutDBInfo(&#34;DSN=DL96A&#34;,SqlStr,labno) ...d OutputRow ..//数据库双向上传结束****************************************************** Set qHandle=$lb(0,repid,0) Quit $$$OK OutputRow Set ColFields=&#34;labno,labnoInfo,patInfo&#34; Set ^CacheTemp(repid,ind)=##Class(LIS.Util.Common).TransListNull(Data,ColFields) Set ind=ind+1 quit } ClassMethod QryLabInfoClose(ByRef qHandle As %Binary) As %Status [ PlaceAfter = QryLabInfoExecute ] { Set repid=$LIST(qHandle,2) Kill ^CacheTemp(repid) Quit $$$OK } ClassMethod QryLabInfoFetch(ByRef qHandle As %Binary, ByRef Row As %List, ByRef AtEnd As %Integer = 0) As %Status [ PlaceAfter = QryLabInfoExecute ] { Set AtEnd=$LIST(qHandle,1) Set repid=$LIST(qHandle,2) Set ind=$LIST(qHandle,3) Set ind=$o(^CacheTemp(repid,ind)) If ind=&#34;&#34; { Set AtEnd=1 Set Row=&#34;&#34; } Else { Set Row=^CacheTemp(repid,ind) } s qHandle=$lb(AtEnd,repid,ind) Quit $$$OK } /// w ##Class(MI.MIFLISMonitorTest).GetLabnoInfo(6,1001367) ClassMethod GetLabnoInfo(mi, labno) As %String { s mi=$g(mi),labno=$g(labno) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34; //获取项目通道号 d ScanOne^MI.MIF000(mi,labno) s tcx=&#34;&#34; s chl=&#34;&#34; f s chl=$o(^TMP(&#34;MIFTESTCODE&#34;,$j,mi,labno,chl)) q:chl=&#34;&#34; d .s tcx=tcx_chl_&#34;+&#34; s tcx=$e(tcx,1,$l(tcx)-1) k ^TMP(&#34;MIFTESTCODE&#34;,$j,mi,labno) i $l(tcx) s tcx=labno_&#34;,&#34;_tcx_&#34;|&#34; q tcx } /// w ##Class(MI.MIFDL96A2).GetEPIS(&#34;56&#34;,&#34;9000000324&#34;) ClassMethod GetEPIS(mi, labno) As %String { //IndexReportID On (VisitNumberDR, WorkGroupMachineDR, OrderNo) s labno = $g(labno),mi=$g(mi) i $l(labno)=0 q &#34;&#34; s EPIS=&#34;&#34; s VisitNumberDR = $o(^dbo.RPVisitNumberI(&#34;IndexVisitNumber&#34;,##Class(LIS.Util.Common).IndexData(labno),&#34;&#34;)) i &#39;$l(VisitNumberDR) q &#34;&#34; s WGMDR=$lg($g(^dbo.BTMIMachineParameterD(mi)),6) i $l(WGMDR),&#39;$d(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR,WGMDR)) d .s WGMDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR,&#34;&#34;)) i &#39;$l(WGMDR) q &#34;&#34; s OrderNo=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR,WGMDR,&#34;&#34;)) s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR,WGMDR,OrderNo,&#34;&#34;)) s EPIS=$lg($g(^dbo.RPVisitNumberReportD(ReportDR)),8) s AcceptDate=$lg($g(^dbo.RPVisitNumberReportD(ReportDR)),9) s AcceptDate=$e(AcceptDate,1,4)_&#34;-&#34;_$e(AcceptDate,5,6)_&#34;-&#34;_$e(AcceptDate,7,8) s AcceptTime=$lg($g(^dbo.RPVisitNumberReportD(ReportDR)),10) S AcceptDT=AcceptDate_&#34; &#34;_$zt(AcceptTime,1) q EPIS_&#34;^&#34;_AcceptDT } /// w ##Class(MI.MIFDL96A2).GetPatInfo(&#34;40&#34;,&#34;L0116440&#34;) ClassMethod GetPatInfo(mi, labno) As %String { s labno = $g(labno),mi=$g(mi) i $l(labno)=0 q &#34;&#34; s VisitNumberDR = $o(^dbo.RPVisitNumberI(&#34;IndexVisitNumber&#34;,##Class(LIS.Util.Common).IndexData(labno),&#34;&#34;)) i &#39;$l(VisitNumberDR) q &#34;&#34; //标本信息 s TransmitDate=$tr($zd($h,3),&#34;-&#34;) s RPVisitNumberData=$g(^dbo.RPVisitNumberD(VisitNumberDR)) // IndexEpisodeNo On (TransmitDate, WorkGroupMachineDR, EpisodeNo) s MedicalRecordNo=&#34;&#34;,SpecimenDR=&#34;&#34;,Specimen=&#34;&#34;,EPIS=&#34;&#34; s MedicalRecordNo=$lg(RPVisitNumberData,6) //病案号 s SpecimenDR=$lg(RPVisitNumberData,56) //标本类型 s EPIS=..GetEPIS(mi, labno) //鉴定号 s AcceptDT=$p(EPIS,&#34;^&#34;,2) s EPIS=$p(EPIS,&#34;^&#34;,1) i $l(SpecimenDR) s Specimen=$lg($g(^dbo.BTSpecimenD(SpecimenDR)),3) s LocationDR=$lg(RPVisitNumberData,22),Location=&#34;&#34; i $l(LocationDR) s Location=$lg($g(^dbo.BTLocationD(LocationDR)),3) i Location[&#34;ICU&#34; s Location=&#34;重症监护室&#34; s DoctorDR=$lg(RPVisitNumberData,23),Doctor=&#34;&#34; i $l(DoctorDR) s Doctor=$lg($g(^dbo.BTDoctorD(DoctorDR)),3) s ReceiveDate=$lg(RPVisitNumberData,66) s ReceiveTime=$lg(RPVisitNumberData,67) s ReceiveUserDR=$lg(RPVisitNumberData,68),ReceiveUser=&#34;&#34; i $l(ReceiveUserDR) s ReceiveUser=$lg($g(^dbo.SYSUserD(ReceiveUserDR)),3) s RegNo=$lg(RPVisitNumberData,3) s SurName=$lg(RPVisitNumberData,13) s GivenName=$lg(RPVisitNumberData,14) i SurName=GivenName s PatName=SurName e s PatName=SurName_GivenName s SpeciesDR=$lg(RPVisitNumberData,15),Species=&#34;&#34; i $l(SpeciesDR) s Species=$lg($g(^dbo.BTSpeciesD(SpeciesDR)),3) s AdmTypeDR=$lg(RPVisitNumberData,4),AdmType=&#34;&#34; i $l(AdmTypeDR) s AdmType=$lg($g(^dbo.BTAdmissionTypeD(AdmTypeDR)),3) s BedNo=$lg(RPVisitNumberData,27) s Age=$lg(RPVisitNumberData,18) s AgeUnitDR=$lg(RPVisitNumberData,19),AgeUnit=&#34;&#34; i AgeUnitDR=1 s AgeUnit=&#34;y&#34; i AgeUnitDR=2 s AgeUnit=&#34;m&#34; i AgeUnitDR=3 s AgeUnit=&#34;d&#34; i AgeUnitDR=4 s AgeUnit=&#34;h&#34; //i $l(AgeUnitDR) s AgeUnit=$lg($g(^dbo.BTAgeUnitD(AgeUnitDR)),3) S Age=Age_AgeUnit s CollectDate=$lg(RPVisitNumberData,51) s CollectTime=$lg(RPVisitNumberData,52) s Diagnose=$tr($lg(RPVisitNumberData,28),&#34;,&#34;,&#34;，&#34;) s Sampleda=$zd($p($h,&#34;,&#34;,1),3)_&#34; &#34;_$zt($p($h,&#34;,&#34;,2)) s Instrument = &#34;XN&#34; i $l(mi) s Instrument=$lg(^dbo.BTMIMachineParameterD(mi),22) s Sampleno=labno //检测号 s Sampletype=&#34;&#34; s Feetype=&#34;&#34; ;费别 s Srcdepno=Location ;送检科室 s Srcdocno=Doctor ;送检医生 s Userno=ReceiveUser ;检验医生(录入者) s Patno=RegNo ;登记号 &#34;&#34; s BarCode=&#34;&#34; s Patna=PatName ;病人姓名 s Sex=1 ;性别 i Species=&#34;男&#34; s Sex=&#34;1&#34; ;1:男 ，2 女 i Species =&#34;女&#34; s Sex=&#34;2&#34; s Pattype=AdmType ;病人类型 s Bedno = BedNo ;床号 s Patage=Age ;年龄 s Ageunit=&#34;&#34; ;年龄单位 s Reqno=labno ;申请号 = 检验号 s Reqda=&#34;&#34; i $l(ReceiveDate) s Reqda=$e(ReceiveDate,1,4)_&#34;-&#34;_$e(ReceiveDate,5,6)_&#34;-&#34;_$e(ReceiveDate,7,8)_&#34; &#34;_$zt(ReceiveTime,2) ;送检日期 = 接收时间 s Reportda=&#34;&#34; ;报告日期 = 初审(保存结果)时间 s Printflag=&#34;&#34; ;打印标志 s Resultflag=&#34;&#34; ;结果标志 s Errflag=&#34;&#34; ;错误标志 s Diagnose = Diagnose ;诊断 s Description=&#34;&#34; ;备注 s Reserve=&#34;&#34; ;保留字段 s Patnamn=&#34;&#34; ;姓名拼音码 i $l(CollectDate) s Getda=$e(CollectDate,1,4)_&#34;-&#34;_$e(CollectDate,5,6)_&#34;-&#34;_$e(CollectDate,7,8)_&#34; &#34;_$zt(CollectTime,2) e s Getda=Reqda ;接收时间/采样日期 s Wardno=&#34;&#34; ;病区 s RetString=&#34;&#34; s RetString=Sampleda_&#34;,&#34;_Instrument_&#34;,&#34;_Sampleno_&#34;,&#34;_Sampletype_&#34;,&#34;_Feetype_&#34;,&#34;_Srcdepno_&#34;,&#34;_Srcdocno_&#34;,&#34;_Userno_&#34;,&#34; s RetString=RetString_Patno_&#34;,&#34;_Patna_&#34;,&#34;_Sex_&#34;,&#34;_Pattype_&#34;,&#34;_Bedno_&#34;,&#34;_Patage_&#34;,&#34;_Ageunit_&#34;,&#34;_Reqno_&#34;,&#34;_Reqda_&#34;,&#34; s RetString=RetString_Reportda_&#34;,&#34;_Printflag_&#34;,&#34;_Resultflag_&#34;,&#34;_Errflag_&#34;,&#34;_Diagnose_&#34;,&#34;_Description_&#34;,&#34;_Reserve_&#34;,&#34; s RetString=RetString_Patnamn_&#34;,&#34;_Getda_&#34;,&#34;_Wardno_&#34;,&#34;_BarCode_&#34;,&#34;_MedicalRecordNo_&#34;,&#34;_Specimen_&#34;,&#34;_EPIS_&#34;,&#34;_AcceptDT q RetString } /// 监听做上传操作后调用改方法设置标本上传表状态 ClassMethod SaveSDFMTHD(mi, labno, epis, filename, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %String { s mi=$g(mi),labno=$g(labno),epis = $g(epis),filename=$g(filename) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q s ret=##Class(MI.MachineUpload).SetSendFlag(mi,labno,&#34;S&#34;,filename) q } } ">
<title>迪尔DL96A</title>

<link rel='canonical' href='https://work.717170.xyz/p/%E8%BF%AA%E5%B0%94dl96a-f10a9fd1ed/'>

<link rel="stylesheet" href="/scss/style.min.03a781d9157f24b812ddd138de5660e9264f58b2adb326fa7d814bcd56b0e29c.css"><meta property='og:title' content="迪尔DL96A">
<meta property='og:description' content="接口说明 仪器厂商 迪尔\n仪器型号 DL96A\n通讯方式 双向 仪器类型 微生物 医院名称 程序名称 MI.MIFDL96A 终端服务器地址 终端服务器端口号 仪器上接口标示和接口类型 接口类型：通过监听连接仪器 连接方式：数据库类型为mysql 仪器接口说明 先通过^LISTMPWSW获取细菌，抗生素，专家规则数据，通过细菌通道为索引组装保存数据 保存细菌数据后未生成对应的报告和鉴定树导致专家规则无法保存，调用 try{d ##class(IDP.WS.BLL.DHCIDPResult).GetReportIDPTreeJSONStream(ReportDR, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;)}catch{}方法生成鉴定树，随后进行保存专家规则 通过sql插入标本信息达成双向 串口盒子配置 波特率： 9600 数据位：8 停止位： 1 校验位： N 数据格式 项目通道号 修改记录 序号 日期 操作人 说明 1 2025-01-25 18:32:16\n杨浩然 仪器接口程序 监听配置 1 /// [{&#34;MachID&#34;:&#34;#RowID&#34;,&#34;Type&#34;:&#34;DataBase&#34;,&#34;UpTime&#34;:&#34;3000&#34;,&#34;Address&#34;:&#34;DSN=DL96A&#34;,&#34;UpCDF&#34;:&#34;&#34;,&#34;UpREF&#34;:&#34;&#34;,&#34;DealProcess&#34;:&#34;MI.MIFDL96A&#34;,&#34;Para&#34;:&#34;SELECT * FROM lis_result WHERE DATE(UpdateDate) = CURDATE()#ID#&#34;,&#34;PreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;,&#34;UPPreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;}] 接口程序 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 /// [{&#34;MachID&#34;:&#34;#RowID&#34;,&#34;Type&#34;:&#34;DataBase&#34;,&#34;UpTime&#34;:&#34;3000&#34;,&#34;Address&#34;:&#34;DSN=DL96A&#34;,&#34;UpCDF&#34;:&#34;&#34;,&#34;UpREF&#34;:&#34;&#34;,&#34;DealProcess&#34;:&#34;MI.MIFDL96A&#34;,&#34;Para&#34;:&#34;SELECT * FROM lis_result WHERE DATE(UpdateDate) = CURDATE()#ID#&#34;,&#34;PreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;,&#34;UPPreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;}] Class MI.MIFDL96A Extends %RegisteredObject { /// D ##class(MI.MIFDL96E02).fileMTHD(&#34;22&#34;,&#34;4185~33122416~~~□肺炎链球菌(S.pneumoniae)□G+球菌□□[spn]□(优势菌2)~~~~~A;PEN;;＝8;耐药;;B;CLI;;≥8;耐药;;A;SXT;;≥8/152;耐药;;B;CRO;;＝1;敏感;;A;ERY;;≥16;耐药;;B;VA;;≤1;敏感;;B;LEV;;＝2;敏感;;B;TET;;＝32;耐药;;B;MRP;;≤0.25;敏感;;C;CXM;;≥4;耐药;;C;RIF;;≤0.5;敏感;;C;AMC;;≤1.0/0.5;敏感;;C;LNZ;;≤2;敏感;;~~~~~对左氧氟沙星敏感的菌株可预报其对吉米沙星和莫西沙星敏感。[13][10]对四环素敏感的菌株对多西环素和米诺环素也敏感。[13][10]利福平不单独用于抗菌治疗。[13][10]红霉素可预报阿奇霉素、克拉霉素和地红霉素的敏感和耐药性。[13][10]~~~~普通细菌培养+药敏~2020-12-25□8:33:23~2020-12-27□8:33:23~1~&#34;,&#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;) /// d ##class(MI.MIFDL96AN).fileMTHD(&#34;56&#34;,$g(^YHR(&#34;WSWQC&#34;))) ClassMethod fileMTHD(mi, record, epis, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %String { s mi=$g(mi) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34; i &#39;$l(record) q &#34;&#34; s ItemDeli=$c(92) //项目分隔符92 s ResultDeli=$c(44) //结果分隔符44 s AntDeli=&#34;]&#34; //抗生素分隔符] s SenDeli=&#34;[&#34; //药敏结果分隔符[ d Trace^MI.MIF000(mi,record,&#34;record&lt;--M&#34;) /// 54724~52772~~~~□肺炎链球菌(S.pneumoniae)□G+球菌□□[spn]□(弱势菌)~~~~~A;PEN;;≥32;耐药;;B;CLI;;≥8;耐药;;A;SXT;;≥8/152;耐药;;B;CRO;;＝1;敏感;;A;ERY;;≥16;耐药;;B;VA;;≤1;敏感;;B;LEV;;＝2;敏感;;B;TET;;＝32;耐药;;B;MRP;;≤0.25;敏感;;C;CXM;;≥4;耐药;;C;RIF;;≤0.5;敏感;;C;AMC;;＝2/1;敏感;;C;LNZ;;≤2;敏感;;~~~~~对左氧氟沙星敏感的菌株可预报其对吉米沙星和莫西沙星敏感。[13][10]红霉素可预报阿奇霉素、克拉霉素和地红霉素的敏感和耐药性。[13][10]利福平不单独用于抗菌治疗。[13][10]对四环素敏感的菌株对多西环素和米诺环素也敏感。[13][10]~~~普通细菌培养+药敏~2019/12/10□8:41:15~2019/12/13□8:41:15~0~1~ /// &#34;35~182~25010700606~I-180,2N10155711,*□|I-179,2E10532605,*□|~I-180,2N10155711,*□|I-179,2E10532605,*□|~~□,I-180,2N10155711,铜绿假单胞菌(Pseudomonas□aeruginosa),pae,-,0,□|□,I-179,2E10532605,肺炎克雷伯菌(Klebsiella□pneumoniae),kpn,-,0,□|~~I-180,2N10155711,DL-120□NE2,pae,FEP,&lt;=2μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-180,2N10155711,DL-120□NE2,pae,CAZ,&lt;=2μg/mL,A,S,≤8&amp;16&amp;≥32,Y|I-180,2N10155711,DL-120□NE2,pae,GEN,&lt;=2μg/mL,A,S,≤4&amp;8&amp;≥16,Y|I-180,2N10155711,DL-120□NE2,pae,TOB,&lt;=1μg/mL,A,S,≤4&amp;8&amp;≥16,Y|I-180,2N10155711,DL-120□NE2,pae,AMK,&lt;=4μg/mL,INV,□,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,PIP,&lt;=4μg/mL,O,S,≤16&amp;32&amp;≥64,Y|I-180,2N10155711,DL-120□NE2,pae,IPM,&lt;=1μg/mL,B,S,≤2&amp;4&amp;≥8,Y|I-180,2N10155711,DL-120□NE2,pae,TZP,&lt;=4/4μg/mL,A,S,≤16/4&amp;32/4&amp;≥64/4,Y|I-180,2N10155711,DL-120□NE2,pae,MEM,&lt;=1μg/mL,B,S,≤2&amp;4&amp;≥8,Y|I-180,2N10155711,DL-120□NE2,pae,SAM,&gt;=64/32μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,CSL,&lt;=8/4μg/mL,O,S,≤16/8&amp;32/16&amp;≥64/32,Y|I-180,2N10155711,DL-120□NE2,pae,ATM,=4μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-180,2N10155711,DL-120□NE2,pae,LVX,&lt;=1μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-180,2N10155711,DL-120□NE2,pae,TCC,=16/2μg/mL,O,S,≤16/2&amp;32/2-64/2&amp;≥128/2,Y|I-180,2N10155711,DL-120□NE2,pae,SXT,&lt;=1/19μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,NOR,&lt;=4μg/mL,INV,□,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,MNO,&gt;=32μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,TGC,=16μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,CIP,&lt;=0.5μg/mL,B,S,≤0.5&amp;1&amp;≥2,Y|I-180,2N10155711,DL-120□NE2,pae,POL,=1μg/mL,O,I,□&amp;≤2&amp;≥4,Y|I-180,2N10155711,DL-120□NE2,pae,DOX,&gt;=16μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,CHL,&gt;=32μg/mL,INV,R,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,AMP,&gt;=32μg/mL,A,R,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,GEN,&lt;=1μg/mL,A,S,≤4&amp;8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,SAM,&lt;=8/4μg/mL,B,S,≤8/4&amp;16/8&amp;≥32/16,Y|I-179,2E10532605,DL-120□E2,kpn,TZP,&lt;=4/4μg/mL,B,S,≤16/4&amp;32/4-64/4&amp;≥128/4,Y|I-179,2E10532605,DL-120□E2,kpn,CSL,&lt;=8/4μg/mL,O,S,≤16/8&amp;32/16&amp;≥64/32,Y|I-179,2E10532605,DL-120□E2,kpn,CCV,&lt;=1/4μg/mL,INV,□,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,CTC,&lt;=1/4μg/mL,INV,□,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,CZO,=8μg/mL,A,R,≤2&amp;4&amp;≥8,Y|I-179,2E10532605,DL-120□E2,kpn,FEP,&lt;=0.12μg/mL,B,S,≤2&amp;4-8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,FOX,&lt;=8μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,CXM(Iv),&lt;=4μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,CXM(Oral),&lt;=4μg/mL,B,S,≤4&amp;8-16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,LVX,&lt;=0.12μg/mL,B,S,≤0.5&amp;1&amp;≥2,Y|I-179,2E10532605,DL-120□E2,kpn,SXT,&lt;=0.5/9.5μg/mL,B,S,≤2/38&amp;□&amp;≥4/76,Y|I-179,2E10532605,DL-120□E2,kpn,CTX,&lt;=0.12μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,IPM,&lt;=0.25μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,CAZ,&lt;=0.5μg/mL,C,S,≤4&amp;8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,CHL,&lt;=8μg/mL,C,S,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,MEM,&lt;=0.06μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,AMK,&lt;=4μg/mL,B,S,≤16&amp;32&amp;≥64,Y|I-179,2E10532605,DL-120□E2,kpn,NIT,&lt;=16μg/mL,INV,□,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,ETP,&lt;=0.015μg/mL,B,S,≤0.5&amp;1&amp;≥2,Y|I-179,2E10532605,DL-120□E2,kpn,MNO,&lt;=1μg/mL,O,S,≤4&amp;8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,TGC,&lt;=0.25μg/mL,INV,S,≤1&amp;2&amp;&gt;2,Y|I-179,2E10532605,DL-120□E2,kpn,POL,&lt;=1μg/mL,O,I,□&amp;≤2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,AZM,&lt;=8μg/mL,INV,R,□&amp;□&amp;□,Y|~I-180,2N10155711,□|I-179,2E10532605,□|~I-180,2N10155711*多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*长期使用各种抗生素治疗，铜绿假单胞菌会变得耐药。初期敏感的菌株在治疗3-4天内变为耐药，因此，测试重复分离株是必要的。*哌拉西林（单药或联合他唑巴坦）的折点基于哌拉西林（单药或联合他唑巴坦）至少3g□q6h给药方案。*亚胺培南的折点基于1g□q8h或500mg□q6h的给药方案。*左氧氟沙星的折点基于750mg□qd的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*长期使用各种抗生素治疗，铜绿假单胞菌会变得耐药。初期敏感的菌株在治疗3-4天内变为耐药，因此，测试重复分离株是必要的。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。*多黏菌素B应给予负荷剂量和最大推荐剂量。*头孢吡肟的折点基于1g□q8h或2g□q12h的给药方案。*头孢他啶的折点基于1g□q6h或2g□q8h的给药方案。*环丙沙星的折点基于静脉注射400mg□q8h给药方案。*氨曲南的折点基于1g□q6h或2g□q8h的给药方案。*替卡西林/克拉维酸的折点基于至少3g□□q6h给药方案。*此报告采用的折点标准来源为CLSIM100□2024，其中头孢哌酮/舒巴坦为CHINET技术要求□2022，妥布霉素、庆大霉素为CLSIM100□2022。|I-179,2E10532605*仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。*亚胺培南的折点基于500mg□q6h或1g□q8h的给药方案。*多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*氨苄西林的结果可用于预报阿莫西林的敏感性。*厄他培南的折点基于1g□qd的给药方案。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。*头孢西丁的折点基于至少8g□qd的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*头孢呋辛（注射）的折点基于1.5g□q8h的给药方案。*环丙沙星折点基于静脉注射400mg□q12h或口服500mg□q12h给药方案。*多黏菌素B应给予负荷剂量和最大推荐剂量。*头孢噻肟的折点基于1g□q8h的给药方案。*治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g□q8h的给药方案。*头孢吡肟的敏感折点基于1g□q12h的给药方案。*此报告采用的折点标准来源为CLSIM100□2024，其中哌拉西林/他唑巴坦为CLSIM100□2021，头孢哌酮/舒巴坦为CHINET技术要求□2022，替加环素为EUCAST□2018，阿米卡星、庆大霉素为CLSIM100□2022。|~~~~~I-180,2N10155711,2025-01-12□15:55:48|I-179,2E10532605,2025-01-12□16:00:48|~~~1~2025-01-12□16:25:01~□~□,I-180,2N10155711,铜绿假单胞菌(Pseudomonas□aeruginosa),pae,G-杆菌,0,□|□,I-179,2E10532605,肺炎克雷伯菌(Klebsiella□pneumoniae),kpn,G-杆菌,0,□|~I-180,2N10155711,□|I-179,2E10532605,□|~I-180,2N10155711*[SAM&amp;TGC&amp;MNO&amp;SXT&amp;CHL&amp;DOX]*[]*[]|I-179,2E10532605*[AMP&amp;AZM]*[]*[]|~~~~&#34; s (sample,epis,surname,rec,res,fresult,date,time,QC,xBugs,AntLIST,expertRules)=&#34;&#34; k ^LISTMPWSW /// 获取流水号 s epis=$tr($p(record,&#34;~&#34;,3),&#34; &#34;) q:&#39;$l(epis) &#34;&#34; s curDate=$zd($h,8) /// 获取细菌 s xBugsData=$p(record,&#34;~&#34;,7) f i=1:1:$l(xBugsData,&#34;|&#34;) d .s xBugsDatai=$p(xBugsData,&#34;|&#34;,i) .i &#39;$l(xBugsDatai) q .s xBugs=$p(xBugsDatai,&#34;,&#34;,5) .i xBugs=&#34;&#34; q .s code=i .s ^LISTMPWSW(&#34;xBugs&#34;,xBugs)=code .s ^LISTMPWSW(&#34;xBugsNum&#34;,code)=xBugs /// 获取药敏 s antStrData=$p(record,&#34;~&#34;,9) f i=1:1:$l(antStrData,&#34;|&#34;) d .s antStrDatai=$p(antStrData,&#34;|&#34;,i) .i &#39;$l(antStrDatai) q .s xBugs=$p(antStrDatai,&#34;,&#34;,4) .i &#39;$l(xBugs) q .s ^LISTMPWSW(&#34;antStr&#34;,xBugs,i)=antStrDatai /// 获取专家规则 s expertRulesData=$p(record,&#34;~&#34;,11) f i=1:1:$l(expertRulesData,&#34;|&#34;) d .s expertRulesDatai=$p(expertRulesData,&#34;|&#34;,i) .i &#39;$l(expertRulesDatai) q .s xBugs=$g(^LISTMPWSW(&#34;xBugsNum&#34;,i)) .i &#39;$l(xBugs) q .s expertRules=$p(expertRulesDatai,&#34;*&#34;,2,*) .s ^LISTMPWSW(&#34;expertRules&#34;,xBugs)=expertRules s xBugs=&#34;&#34; f s xBugs=$o(^LISTMPWSW(&#34;xBugs&#34;,xBugs)) q:xBugs=&#34;&#34; d .s code=$g(^LISTMPWSW(&#34;xBugs&#34;,xBugs)) .s (AntLIST,fresult,date,time,QC)=&#34;&#34; .s antStr=&#34;&#34; f s antStr=$o(^LISTMPWSW(&#34;antStr&#34;,xBugs,antStr)) q:antStr=&#34;&#34; d ..s antList=$g(^LISTMPWSW(&#34;antStr&#34;,xBugs,antStr)) ..s AntGroup=$p(antList,&#34;,&#34;,7) //抗生素分组 ..s xANT=$tr($p(antList,&#34;,&#34;,5),&#34; &#34;) q:xANT=&#34;&#34; //抗生素 ..s xMIC=$replace($p(antList,&#34;,&#34;,6),&#34;μg/mL&#34;,&#34;&#34;) //MIC ..s xRES=$tr($p(antList,&#34;,&#34;,8),&#34; &#34;) //耐药 ..s AntLIST=AntLIST_xANT_AntDeli_xRES_AntDeli_xMIC_AntDeli_AntDeli_AntGroup_SenDeli .d Trace^MI.MIF000(mi,AntLIST,&#34;AntLIST&lt;--M&#34;) .i $l(xBugs),$l(epis),$l(AntLIST) d ..s fresult=xBugs_ItemDeli_AntLIST_ItemDeli_code_ResultDeli .d Trace^MI.MIF000(mi,epis_&#34;$$&#34;_fresult,&#34;fresult&lt;--M&#34;) .i $l(fresult) d ..d Save^MI.MIF000(mi,epis,code_ItemDeli_xBugs_ItemDeli_ItemDeli_ItemDeli_ResultDeli,date,time,QC) ..d SaveAnt^MI.MIF000(mi,epis,fresult,date,time,QC) .s expertRules=$g(^LISTMPWSW(&#34;expertRules&#34;,xBugs)) .s ret=..SaveZJGZ(epis, mi, code, expertRules) .d Trace^MI.MIF000(mi,ret,&#34;专家规则保存ret&#34;) k ^LISTMPWSW q &#34;&#34; } ClassMethod GerTestCodeDR(mi, code) { s mi=$g(mi),code=$g(code) s ret=&#34;&#34; i &#39;$l(mi) q ret i &#39;$l(code) q ret i $d(^dbo.BTMIMachineTestCodeI(&#34;IndexResultChannel&#34;,mi,code)) d .s BTMIMachineTestCodeDR=$o(^dbo.BTMIMachineTestCodeI(&#34;IndexResultChannel&#34;,mi,code,&#34;&#34;)) .s TestCodeDR=$lg($g(^dbo.BTMIMachineTestCodeD(BTMIMachineTestCodeDR)),3) .s ret=TestCodeDR q ret } /// w ##class(MI.MIFDL96A2).SaveZJGZ(&#34;6633&#34;,&#34;40&#34;,1,&#34;多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*头孢噻肟的折点基于1g□q8h的给药方案。*亚胺培南的折点基于500mg□q6h或1g□q8h的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*头孢唑啉的结果可预报非复杂性的泌尿系统感染的大肠埃希菌对口服头孢拉定、头孢地尼、头孢克罗、头孢丙烯、头孢泊肟、头孢呋辛的敏感性。*头孢西丁的折点基于至少8g□qd的给药方案。*仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。*氨苄西林的结果可用于预报阿莫西林的敏感性。*环丙沙星折点基于静脉注射400mg□q12h或口服500mg□q12h给药方案。*头孢吡肟的敏感折点基于1g□q12h的给药方案。*头孢呋辛（注射）的折点基于1.5g□q8h的给药方案。*治疗非复杂泌尿道感染的头孢唑林折点是基于1g□q12h的给药方案。*治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g□q8h的给药方案。*多黏菌素B应给予负荷剂量和最大推荐剂量。*厄他培南的折点基于1g□qd的给药方案。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。&#34;) /// w ##class(MI.MIFDL96A).SaveZJGZ(&#34;24120600395&#34;,&#34;56&#34;,1,&#34;QNR-ECO：喹诺酮类耐药的大肠埃希菌。*MDR：多重耐药菌株。*产ESBL株：产超广谱β-内酰胺酶菌株。*CTX-CRO-R-ECO：头孢噻肟或头孢曲松耐药的大肠埃希菌。*头孢呋辛（注射）的折点基于1.5g□q8h的给药方案。*仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。*厄他培南的折点基于1g□qd的给药方案。*治疗非复杂泌尿道感染的头孢唑林折点是基于1g□q12h的给药方案。*多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*头孢唑啉的结果可预报非复杂性的泌尿系统感染的大肠埃希菌对口服头孢拉定、头孢地尼、头孢克罗、头孢丙烯、头孢泊肟、头孢呋辛的敏感性。*头孢西丁的折点基于至少8g□qd的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*环丙沙星折点基于静脉注射400mg□q12h或口服500mg□q12h给药方案。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。*头孢噻肟的折点基于1g□q8h的给药方案。*亚胺培南的折点基于500mg□q6h或1g□q8h的给药方案。*氨苄西林的结果可用于预报阿莫西林的敏感性。*治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g□q8h的给药方案。*多黏菌素B应给予负荷剂量和最大推荐剂量。*此报告采用的折点标准来源为CLSIM100□2024，其中替加环素为EUCAST□2018，头孢哌酮/舒巴坦为CHINET技术要求□2022，哌拉西林/他唑巴坦为CLSIM100□2021，阿米卡星、庆大霉素为CLSIM100□2022。&#34;) /// w ##class(MI.MIFDL96A).SaveZJGZ(&#34;WX250104003&#34;,&#34;56&#34;,1,&#34;1、MDR：多重耐药菌株。 2、QNR-ECO：喹诺酮类耐药的大肠埃希菌。 3、产ESBL株：产超广谱β-内酰胺酶菌株。 4、CTX-CRO-R-ECO：头孢噻肟或头孢曲松耐药的大肠埃希菌。 5、治疗非复杂泌尿道感染的头孢唑林折点是基于1g q12h的给药方案。 6、仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。 7、亚胺培南的折点基于500mg q6h或1g q8h的给药方案。 8、多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。 9、氨苄西林的结果可用于预报阿莫西林的敏感性。 10、头孢唑啉的结果可预报非复杂性的泌尿系统感染的大肠埃希菌对口服头孢拉定、头孢地尼、头孢克罗、头孢丙烯、头孢泊肟、头孢呋辛的敏感性。 11、厄他培南的折点基于1g qd的给药方案。 12、对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。 13、头孢西丁的折点基于至少8g qd的给药方案。 14、美罗培南的折点基于1g q8h的给药方案。 15、头孢呋辛（注射）的折点基于1.5g q8h的给药方案。 16、环丙沙星折点基于静脉注射400mg q12h或口服500mg q12h给药方案。 17、多黏菌素B应给予负荷剂量和最大推荐剂量。 18、头孢噻肟的折点基于1g q8h的给药方案。 19、治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g q8h的给药方案。 20、此报告采用的折点标准来源为CLSIM100 2024，其中哌拉西林/他唑巴坦为CLSIM100 2021，头孢哌酮/舒巴坦为CHINET技术要求 2022，替加环素为EUCAST 2018，阿米卡星、庆大霉素为CLSIM100 2022。&#34;) ClassMethod SaveZJGZ(epis, mi, code, ExpertRules) { s epis=$g(epis),mi=$g(mi),ExpertRules=$g(ExpertRules) s episData=$$GetEpisByLabno(mi,epis) s epis=$p(episData,&#34;^&#34;,1) s WGM=$p(episData,&#34;^&#34;,2) s ReportDR=$p(episData,&#34;^&#34;,3) s TestCodeDR=..GerTestCodeDR(mi,code) i $l(ReportDR) d .s IDPResultDR=$o(^dbo.IDPResultI(&#34;IndexIDPElement&#34;,ReportDR,2,&#34;&#34;)) .i &#39;$d(^dbo.RPVisitNumberTestSetI(&#34;IndexReportID&#34;,ReportDR)) q .i &#39;$l(TestCodeDR) q .try{d ##class(IDP.WS.BLL.DHCIDPResult).GetReportIDPTreeJSONStream(ReportDR, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;)}catch{} i &#39;$l(mi) q 0 i &#39;$l(epis) d Trace^MI.MIF000(mi,&#34;流水号不能为空&#34;,&#34;保存检测结论返回&#34;) q 0 //报告可能核收到微生物培养的四个小组 s sc=0 s transmitDate=&#34;&#34; f s transmitDate=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNo&#34;,WGM,&#34;&#34;_epis,transmitDate)) q:transmitDate=&#34;&#34; d .s ReportDR=&#34;&#34; f s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNo&#34;,WGM,&#34;&#34;_epis,transmitDate,ReportDR)) q:ReportDR=&#34;&#34; d ..//IndexReportItem On (VisitNumberReportDR, TestCodeDR) ..i &#39;$d(^dbo.RPVisitNumberReportResultI(&#34;IndexReportItem&#34;,ReportDR,TestCodeDR)) q ..s ResultDR=$o(^dbo.RPVisitNumberReportResultI(&#34;IndexReportItem&#34;,ReportDR,TestCodeDR,&#34;&#34;)) ..s objRep=##Class(dbo.RPVisitNumberReportResult).%OpenId(ResultDR) ..s EXPRlues=objRep.ExpertRule ..i EXPRlues=ExpertRules q //专家规则不再变化，不存 ..s objRep.ExpertRule=ExpertRules ..s sc=objRep.%Save() ..i (&#39;$SYSTEM.Status.IsOK(sc)) d Trace^MI.MIF000(mi,&#34;保存检测结论失败&#34;,&#34;保存检测结论失败返回&#34;) q ..d Trace^MI.MIF000(mi,ExpertRules,&#34;保存检测结论成功返回&#34;) q sc GetEpisByLabno(mi,Epis) //通过检验号获取流水号 ;Index IndexVisitNumber On VisitNumber [ SqlName = Index_VisitNumber, Type = index, Unique ]; ;Index IndexReportID On (VisitNumberDR, WorkGroupMachineDR, OrderNo) [ SqlName = Index_ReportID, Type = index, Unique ]; s ret=&#34;&#34;,mi=$g(mi),Epis=$g(Epis),ReportDR=&#34;&#34; i &#39;$l(mi) q Epis i &#39;$l(Epis) q Epis s WGMachineID=$lg($g(^dbo.BTMIMachineParameterD(mi)),6) i $d(^dbo.RPVisitNumberI(&#34;IndexVisitNumber&#34;,Epis)) d .s VisitnumberDR=$o(^dbo.RPVisitNumberI(&#34;IndexVisitNumber&#34;,Epis,&#34;&#34;)) .i $d(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitnumberDR)) d ..s WGMachineID=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitnumberDR,&#34;&#34;)) .i $d(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitnumberDR,WGMachineID,1)) d ..s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitnumberDR,WGMachineID,1,&#34;&#34;),-1) ..s ret=$lg($g(^dbo.RPVisitNumberReportD(ReportDR)),8) i $l(ret) q ret_&#34;^&#34;_WGMachineID_&#34;^&#34;_ReportDR i &#39;$d(^dbo.RPVisitNumberReportI(&#34;IndexMicNoNew&#34;,Epis)) q ret_&#34;^&#34;_WGMachineID_&#34;^&#34;_ReportDR s WGMachineID=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNoNew&#34;,Epis,&#34;&#34;)) s TransmitDate=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNoNew&#34;,Epis,WGMachineID,&#34;&#34;)) s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNoNew&#34;,Epis,WGMachineID,TransmitDate,&#34;&#34;)) s ret=Epis q ret_&#34;^&#34;_WGMachineID_&#34;^&#34;_ReportDR } /// D ##class(MI.MIFLISMonitorTest)SaveImageMTHD(&#34;7&#34;,&#34;9999&#34;, &#34;&#34;,&#34;175&#34;) /// mi:仪器 /// epis：流水号，如果是监听图片模式该位置放图片名称，自己在保存前提取流水 /// ImageClass:图片类别，如果是监听图片模式该位置放图片名称，自己在保存前提取图片类型 /// FileName:保存在文件服务的相对路径，默认不动 /// FullName:文件全路径，如果是监听图片模式该位置放图片全路径名称，满足有的图片名称无法得到流水和图片类别的情况 ClassMethod SaveImageMTHD(mi, epis, ImageClass, FileName, FullName, SaveImageRetName, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %String { //通过OtherPara配置取图的在这里通过epis和ImageClass的图片名字提取出流水号和图片类别 s mi=$g(mi) s epis=$g(epis) s ImageClass=$g(ImageClass) s FileName=$g(FileName) s FullName=$g(FullName) s SaveImageRetName=$g(SaveImageRetName) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34; d ##Class(MI.Common.MIFBase).Trace(mi,epis_&#34;:&#34;_ImageClass_&#34;:&#34;_FileName,&#34;H&lt;--M&#34;) s (ReceiveDate, ImageOrder, Caption, DisplayRatio, Height, Width, Sequence)=&#34;&#34; //加上当前时间，防止浏览器缓存 s FileName=FileName_&#34;?&#34;_$p($h,&#34;,&#34;,2) //OtherPara用^分隔第四位指定SaveImageRetName的话在这里改FileName为新名称。同时让方法返回新图片名字 s NewFileName=&#34;&#34; i SaveImageRetName=&#34;SaveImageRetName&#34; d .//图片新名字 .;s NewFileName=epis_&#34;-&#34;_ImageClass_&#34;-&#34; .//路径新名字 .s NewPathName=&#34;&#34; .s SPLen=$l(FileName,&#34;/&#34;) .f ii=1:1:SPLen d ..i ii&lt;SPLen d ...s NewPathName=NewPathName_$p(FileName,&#34;/&#34;,ii)_&#34;/&#34; ..i ii=SPLen d ...s NewFileName=NewFileName_$p(FileName,&#34;/&#34;,ii) .s NewPathName=NewPathName_NewFileName .s FileName=NewPathName //最后返回NewFileName s ret=##Class(MI.Common.MachineResult).SaveImage(ReceiveDate, epis, ImageClass, ImageOrder, FileName, mi, Caption, DisplayRatio, Height, Width, Sequence) //返回值控制图片名称模式 i SaveImageRetName=&#34;SaveImageRetName&#34; d .s ret=NewFileName q ret } /// 返回给监听当前上传文件路径名称，默认不要动 /// w ##class(MI.MIFLISMonitorTest).GetFtpMTHD(&#34;7&#34;) /// mi:仪器 ClassMethod GetFtpMTHD(mi, P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %String { //文件服务模式必须改的地方，老的FTP模式这么改了也没问题，所以建议都这样 s mi=$g(mi) q ##Class(MI.Common.MIFBase).GetMiFtpPath(mi) } /// Creator： 查询患者信息，监听配置上传前处理类后会定时调用这个query查询数据进行上传操作 /// CreatDate： 20140919 /// Description:： /// Table： /// Input： mi：仪器主键 /// Output： 仪器信息 /// Return： 仪器信息 /// Others： Query QryLabInfo(mi As %String, P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %Query(ROWSPEC = &#34;labno,labnoInfo,patInfo&#34;) { } /// Query的执行方法 /// d ##class(%ResultSet).RunQuery(&#34;MI.MIFDL96A&#34;,&#34;QryLabInfo&#34;,&#34;56&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;) ClassMethod QryLabInfoExecute(ByRef qHandle As %Binary, mi As %String, P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %Status { Set repid=$i(^CacheTemp) Set ind=1 s mi=$g(mi),flag=$g(flag) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34; s LabnoList=&#34;&#34; //控制输出Excel //s Data=##class(MI.Common.MIFBase).DemoMOutFileInfo(&#34;D:\\\\OUT\\\\上传.xls&#34;,&#34;张三[0][1]男[0][1]28岁[0][1]&#34;_$h,&#34;900001&#34;,&#34;1&#34;) //d OutputRow //Set qHandle=$lb(0,repid,0) //Quit $$$OK //控制输出Excel //查最近8天 s AddDate=$zd($p($h,&#34;,&#34;,1)-8,8) f s AddDate=$o(^dbo.RPMachineUploadI(&#34;IndexSendStatus&#34;,mi,##Class(LIS.Util.Common).IndexData(&#34;C&#34;),AddDate)) q:AddDate=&#34;&#34; d .s AddTime=&#34;&#34; f s AddTime=$o(^dbo.RPMachineUploadI(&#34;IndexSendStatus&#34;,mi,##Class(LIS.Util.Common).IndexData(&#34;C&#34;),AddDate,AddTime)) q:AddTime=&#34;&#34; d ..//20秒以内的先不上传，防止没接收完 ..i (AddDate=$zd($h,8)),(($p($h,&#34;,&#34;,2)-AddTime)&lt;20) q ..s MiUploadDR=$o(^dbo.RPMachineUploadI(&#34;IndexSendStatus&#34;,mi,##Class(LIS.Util.Common).IndexData(&#34;C&#34;),AddDate,AddTime,&#34;&#34;)) ..s labno=$lg(^dbo.RPMachineUploadD(MiUploadDR),3) ..i &#39;$l(labno) q ..//得到通道号 ..s chl=$lg($g(^dbo.RPMachineUploadD(MiUploadDR)),7) ..//测试类型0：文本，1：数据库 ..s TestType=&#34;1&#34; ..i TestType=&#34;0&#34; d ...//文本双向上传开始****************************************************** ...//控制输出文本的内容 ...s txtInfo=labno_&#34;^&#34;_chl ...s Data=##class(MI.Common.MIFBase).DemoMOutFileInfo($zd($h,8)_labno_&#34;.order&#34;,txtInfo,labno,&#34;&#34;) ...d OutputRow ...s labno=labnoOld_&#34;^&#34;_$zd($h,8)_labno_&#34;.ok&#34; ...s Data=##class(MI.Common.MIFBase).DemoMOutFileInfo($zd($h,8)_labno_&#34;.ok&#34;,txtInfo,labno,&#34;&#34;) ...d OutputRow ...//文本双向上传结束****************************************************** ..i TestType=&#34;1&#34; d ...//数据库双向上传开始****************************************************** ...//控制执行sql ...//Insert into liscontroller.lis_application (SPEC_NUM,BTBarcode,ASTBarcode,PATIENT_ID,MSPosition,PatientNo,FULL_NAME,FIRST_NAME,LAST_NAME,Birth,AGE,SEX,Purpose,WARD,Specimen,BedNo,Diagnosis,SpRequest,Medication,SuspectedBact,Doctor,AdviceNo,ApplyDate,SendDate,Collector,SPEC_DATE,CollectPosition,IdResult,Updated,UpdateDate,CARSS_ReadDate,StainType,StructVersion) values ...//(&#39;9999&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;199732&#39;,&#39;NULL&#39;,&#39; &#39;,&#39;测试&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#39;,&#39;85y&#39;,&#39;f&#39;,&#39;普通细菌培养+药敏&#39;,&#39;三病室&#39;,&#39;痰&#39;,&#39;3&#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39;刘云&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;2024/6/28 9:17&#39;,&#39;谢艳红&#39;,&#39;2024/6/29 11:17&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;0&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;) ...// Insert into liscontroller.lis_application (SPEC_NUM,BTBarcode,ASTBarcode,PATIENT_ID,MSPosition,PatientNo,FULL_NAME,FIRST_NAME,LAST_NAME,Birth,AGE,SEX,Purpose,WARD,Specimen,BedNo,Diagnosis,SpRequest,Medication,SuspectedBact,Doctor,AdviceNo,ApplyDate,SendDate,Collector,SPEC_DATE,CollectPosition,IdResult,Updated,UpdateDate,CARSS_ReadDate,StainType,StructVersion) values ...//(&#39;25010700606&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;202500044&#39;,&#39;NULL&#39;,&#39; &#39;,&#39;潘攀&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#39;,&#39;1y&#39;,&#39;m&#39;,&#39;普通细菌培养+药敏&#39;,&#39;儿科&#39;,&#39;痰液&#39;,&#39;17&#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39;姚美清&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;2025-01-08 11:52:47&#39;,&#39;彭娜&#39;,&#39;2025-01-08 11:52:47&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;0&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;) ...s SqlStr=&#34;Insert into liscontroller.lis_application (SPEC_NUM,BTBarcode,ASTBarcode,PATIENT_ID,MSPosition,PatientNo,FULL_NAME,FIRST_NAME,LAST_NAME,Birth,AGE,SEX,Purpose,WARD,Specimen,BedNo,Diagnosis,SpRequest,Medication,SuspectedBact,Doctor,AdviceNo,ApplyDate,SendDate,Collector,SPEC_DATE,CollectPosition,IdResult,Updated,UpdateDate,CARSS_ReadDate,StainType,StructVersion) values &#34; ...s PatInfo=..GetPatInfo(mi, labno) ...d Trace^MI.MIF000(mi,PatInfo,&#34;PatInfo&#34;) ...//2024-07-01 16:47:48,Mejer600-4,2406290091,,,mnwk-泌尿外科,刘乐,唐云,0000628089,周田香,2,住院,33,43,,2406290091,2024-06-29 11:15,,,,,肾积水伴肾输尿管结石,,,,2024-06-29 06:48,, ...s EPIS=$p(PatInfo,&#34;,&#34;,31) //鉴定号 ...s DTTime=$p(PatInfo,&#34;,&#34;,32) //核收时间 ...s Name=$p(PatInfo,&#34;,&#34;,10) //姓名 ...s Sex=$p(PatInfo,&#34;,&#34;,11) //性别 ...i Sex=&#34;1&#34; s Sex=&#34;m&#34; ...i Sex=&#34;2&#34; s Sex=&#34;f&#34; ...s Age=$p(PatInfo,&#34;,&#34;,14) //年龄 ...s MediNo=$p(PatInfo,&#34;,&#34;,29) //病案号 ...s Location=$p(PatInfo,&#34;,&#34;,6) //科室 ...i Location[&#34;-&#34; s Location=$p(Location,&#34;-&#34;,2) //jzwkszwk-脊柱外科 ...s Speciman=$p(PatInfo,&#34;,&#34;,30) //标本类型 ...s BedNo=$p(PatInfo,&#34;,&#34;,13) //床号 ...s Doctor=$p(PatInfo,&#34;,&#34;,7) //医生 ...s CollectUser=$p(PatInfo,&#34;,&#34;,8) //采集者 ...//s DTTime=$tr($zd($h,3),&#34;-&#34;,&#34;/&#34;)_&#34; &#34;_$zt($p($h,&#34;,&#34;,2),1) //2024/6/28 9:17 $p($zt($h,1),&#34;:&#34;,1,*-1) ...s ValueStr=&#34;(&#39;&#34;_EPIS_&#34;&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#34;_MediNo_&#34;&#39;,&#39;NULL&#39;,&#39; &#39;,&#39;&#34;_Name_&#34;&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#39;,&#39;&#34;_Age_&#34;&#39;,&#39;&#34;_Sex_&#34;&#39;,&#39;普通细菌培养+药敏&#39;,&#39;&#34;_Location_&#34;&#39;,&#39;&#34;_Speciman_&#34;&#39;,&#39;&#34;_BedNo_&#34;&#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39;&#34;_Doctor_&#34;&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;&#34;_DTTime_&#34;&#39;,&#39;&#34;_CollectUser_&#34;&#39;,&#39;&#34;_DTTime_&#34;&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;0&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;)&#34; ...s SqlStr=SqlStr_ValueStr ...d Trace^MI.MIF000(mi,SqlStr,&#34;SqlStr&#34;) ...s ^DL96(&#34;Send&#34;,+$h,labno)=1 //上传标识置为1 ...//多条命令组装多个SQL语句输出.SQL包含$StoredProcedure就当存储过程执行 ...s Data=##class(MI.Common.MIFBase).DemoMOutDBInfo(&#34;DSN=DL96A&#34;,SqlStr,labno) ...d OutputRow ..//数据库双向上传结束****************************************************** Set qHandle=$lb(0,repid,0) Quit $$$OK OutputRow Set ColFields=&#34;labno,labnoInfo,patInfo&#34; Set ^CacheTemp(repid,ind)=##Class(LIS.Util.Common).TransListNull(Data,ColFields) Set ind=ind+1 quit } ClassMethod QryLabInfoClose(ByRef qHandle As %Binary) As %Status [ PlaceAfter = QryLabInfoExecute ] { Set repid=$LIST(qHandle,2) Kill ^CacheTemp(repid) Quit $$$OK } ClassMethod QryLabInfoFetch(ByRef qHandle As %Binary, ByRef Row As %List, ByRef AtEnd As %Integer = 0) As %Status [ PlaceAfter = QryLabInfoExecute ] { Set AtEnd=$LIST(qHandle,1) Set repid=$LIST(qHandle,2) Set ind=$LIST(qHandle,3) Set ind=$o(^CacheTemp(repid,ind)) If ind=&#34;&#34; { Set AtEnd=1 Set Row=&#34;&#34; } Else { Set Row=^CacheTemp(repid,ind) } s qHandle=$lb(AtEnd,repid,ind) Quit $$$OK } /// w ##Class(MI.MIFLISMonitorTest).GetLabnoInfo(6,1001367) ClassMethod GetLabnoInfo(mi, labno) As %String { s mi=$g(mi),labno=$g(labno) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34; //获取项目通道号 d ScanOne^MI.MIF000(mi,labno) s tcx=&#34;&#34; s chl=&#34;&#34; f s chl=$o(^TMP(&#34;MIFTESTCODE&#34;,$j,mi,labno,chl)) q:chl=&#34;&#34; d .s tcx=tcx_chl_&#34;+&#34; s tcx=$e(tcx,1,$l(tcx)-1) k ^TMP(&#34;MIFTESTCODE&#34;,$j,mi,labno) i $l(tcx) s tcx=labno_&#34;,&#34;_tcx_&#34;|&#34; q tcx } /// w ##Class(MI.MIFDL96A2).GetEPIS(&#34;56&#34;,&#34;9000000324&#34;) ClassMethod GetEPIS(mi, labno) As %String { //IndexReportID On (VisitNumberDR, WorkGroupMachineDR, OrderNo) s labno = $g(labno),mi=$g(mi) i $l(labno)=0 q &#34;&#34; s EPIS=&#34;&#34; s VisitNumberDR = $o(^dbo.RPVisitNumberI(&#34;IndexVisitNumber&#34;,##Class(LIS.Util.Common).IndexData(labno),&#34;&#34;)) i &#39;$l(VisitNumberDR) q &#34;&#34; s WGMDR=$lg($g(^dbo.BTMIMachineParameterD(mi)),6) i $l(WGMDR),&#39;$d(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR,WGMDR)) d .s WGMDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR,&#34;&#34;)) i &#39;$l(WGMDR) q &#34;&#34; s OrderNo=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR,WGMDR,&#34;&#34;)) s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR,WGMDR,OrderNo,&#34;&#34;)) s EPIS=$lg($g(^dbo.RPVisitNumberReportD(ReportDR)),8) s AcceptDate=$lg($g(^dbo.RPVisitNumberReportD(ReportDR)),9) s AcceptDate=$e(AcceptDate,1,4)_&#34;-&#34;_$e(AcceptDate,5,6)_&#34;-&#34;_$e(AcceptDate,7,8) s AcceptTime=$lg($g(^dbo.RPVisitNumberReportD(ReportDR)),10) S AcceptDT=AcceptDate_&#34; &#34;_$zt(AcceptTime,1) q EPIS_&#34;^&#34;_AcceptDT } /// w ##Class(MI.MIFDL96A2).GetPatInfo(&#34;40&#34;,&#34;L0116440&#34;) ClassMethod GetPatInfo(mi, labno) As %String { s labno = $g(labno),mi=$g(mi) i $l(labno)=0 q &#34;&#34; s VisitNumberDR = $o(^dbo.RPVisitNumberI(&#34;IndexVisitNumber&#34;,##Class(LIS.Util.Common).IndexData(labno),&#34;&#34;)) i &#39;$l(VisitNumberDR) q &#34;&#34; //标本信息 s TransmitDate=$tr($zd($h,3),&#34;-&#34;) s RPVisitNumberData=$g(^dbo.RPVisitNumberD(VisitNumberDR)) // IndexEpisodeNo On (TransmitDate, WorkGroupMachineDR, EpisodeNo) s MedicalRecordNo=&#34;&#34;,SpecimenDR=&#34;&#34;,Specimen=&#34;&#34;,EPIS=&#34;&#34; s MedicalRecordNo=$lg(RPVisitNumberData,6) //病案号 s SpecimenDR=$lg(RPVisitNumberData,56) //标本类型 s EPIS=..GetEPIS(mi, labno) //鉴定号 s AcceptDT=$p(EPIS,&#34;^&#34;,2) s EPIS=$p(EPIS,&#34;^&#34;,1) i $l(SpecimenDR) s Specimen=$lg($g(^dbo.BTSpecimenD(SpecimenDR)),3) s LocationDR=$lg(RPVisitNumberData,22),Location=&#34;&#34; i $l(LocationDR) s Location=$lg($g(^dbo.BTLocationD(LocationDR)),3) i Location[&#34;ICU&#34; s Location=&#34;重症监护室&#34; s DoctorDR=$lg(RPVisitNumberData,23),Doctor=&#34;&#34; i $l(DoctorDR) s Doctor=$lg($g(^dbo.BTDoctorD(DoctorDR)),3) s ReceiveDate=$lg(RPVisitNumberData,66) s ReceiveTime=$lg(RPVisitNumberData,67) s ReceiveUserDR=$lg(RPVisitNumberData,68),ReceiveUser=&#34;&#34; i $l(ReceiveUserDR) s ReceiveUser=$lg($g(^dbo.SYSUserD(ReceiveUserDR)),3) s RegNo=$lg(RPVisitNumberData,3) s SurName=$lg(RPVisitNumberData,13) s GivenName=$lg(RPVisitNumberData,14) i SurName=GivenName s PatName=SurName e s PatName=SurName_GivenName s SpeciesDR=$lg(RPVisitNumberData,15),Species=&#34;&#34; i $l(SpeciesDR) s Species=$lg($g(^dbo.BTSpeciesD(SpeciesDR)),3) s AdmTypeDR=$lg(RPVisitNumberData,4),AdmType=&#34;&#34; i $l(AdmTypeDR) s AdmType=$lg($g(^dbo.BTAdmissionTypeD(AdmTypeDR)),3) s BedNo=$lg(RPVisitNumberData,27) s Age=$lg(RPVisitNumberData,18) s AgeUnitDR=$lg(RPVisitNumberData,19),AgeUnit=&#34;&#34; i AgeUnitDR=1 s AgeUnit=&#34;y&#34; i AgeUnitDR=2 s AgeUnit=&#34;m&#34; i AgeUnitDR=3 s AgeUnit=&#34;d&#34; i AgeUnitDR=4 s AgeUnit=&#34;h&#34; //i $l(AgeUnitDR) s AgeUnit=$lg($g(^dbo.BTAgeUnitD(AgeUnitDR)),3) S Age=Age_AgeUnit s CollectDate=$lg(RPVisitNumberData,51) s CollectTime=$lg(RPVisitNumberData,52) s Diagnose=$tr($lg(RPVisitNumberData,28),&#34;,&#34;,&#34;，&#34;) s Sampleda=$zd($p($h,&#34;,&#34;,1),3)_&#34; &#34;_$zt($p($h,&#34;,&#34;,2)) s Instrument = &#34;XN&#34; i $l(mi) s Instrument=$lg(^dbo.BTMIMachineParameterD(mi),22) s Sampleno=labno //检测号 s Sampletype=&#34;&#34; s Feetype=&#34;&#34; ;费别 s Srcdepno=Location ;送检科室 s Srcdocno=Doctor ;送检医生 s Userno=ReceiveUser ;检验医生(录入者) s Patno=RegNo ;登记号 &#34;&#34; s BarCode=&#34;&#34; s Patna=PatName ;病人姓名 s Sex=1 ;性别 i Species=&#34;男&#34; s Sex=&#34;1&#34; ;1:男 ，2 女 i Species =&#34;女&#34; s Sex=&#34;2&#34; s Pattype=AdmType ;病人类型 s Bedno = BedNo ;床号 s Patage=Age ;年龄 s Ageunit=&#34;&#34; ;年龄单位 s Reqno=labno ;申请号 = 检验号 s Reqda=&#34;&#34; i $l(ReceiveDate) s Reqda=$e(ReceiveDate,1,4)_&#34;-&#34;_$e(ReceiveDate,5,6)_&#34;-&#34;_$e(ReceiveDate,7,8)_&#34; &#34;_$zt(ReceiveTime,2) ;送检日期 = 接收时间 s Reportda=&#34;&#34; ;报告日期 = 初审(保存结果)时间 s Printflag=&#34;&#34; ;打印标志 s Resultflag=&#34;&#34; ;结果标志 s Errflag=&#34;&#34; ;错误标志 s Diagnose = Diagnose ;诊断 s Description=&#34;&#34; ;备注 s Reserve=&#34;&#34; ;保留字段 s Patnamn=&#34;&#34; ;姓名拼音码 i $l(CollectDate) s Getda=$e(CollectDate,1,4)_&#34;-&#34;_$e(CollectDate,5,6)_&#34;-&#34;_$e(CollectDate,7,8)_&#34; &#34;_$zt(CollectTime,2) e s Getda=Reqda ;接收时间/采样日期 s Wardno=&#34;&#34; ;病区 s RetString=&#34;&#34; s RetString=Sampleda_&#34;,&#34;_Instrument_&#34;,&#34;_Sampleno_&#34;,&#34;_Sampletype_&#34;,&#34;_Feetype_&#34;,&#34;_Srcdepno_&#34;,&#34;_Srcdocno_&#34;,&#34;_Userno_&#34;,&#34; s RetString=RetString_Patno_&#34;,&#34;_Patna_&#34;,&#34;_Sex_&#34;,&#34;_Pattype_&#34;,&#34;_Bedno_&#34;,&#34;_Patage_&#34;,&#34;_Ageunit_&#34;,&#34;_Reqno_&#34;,&#34;_Reqda_&#34;,&#34; s RetString=RetString_Reportda_&#34;,&#34;_Printflag_&#34;,&#34;_Resultflag_&#34;,&#34;_Errflag_&#34;,&#34;_Diagnose_&#34;,&#34;_Description_&#34;,&#34;_Reserve_&#34;,&#34; s RetString=RetString_Patnamn_&#34;,&#34;_Getda_&#34;,&#34;_Wardno_&#34;,&#34;_BarCode_&#34;,&#34;_MedicalRecordNo_&#34;,&#34;_Specimen_&#34;,&#34;_EPIS_&#34;,&#34;_AcceptDT q RetString } /// 监听做上传操作后调用改方法设置标本上传表状态 ClassMethod SaveSDFMTHD(mi, labno, epis, filename, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %String { s mi=$g(mi),labno=$g(labno),epis = $g(epis),filename=$g(filename) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q s ret=##Class(MI.MachineUpload).SetSendFlag(mi,labno,&#34;S&#34;,filename) q } } ">
<meta property='og:url' content='https://work.717170.xyz/p/%E8%BF%AA%E5%B0%94dl96a-f10a9fd1ed/'>
<meta property='og:site_name' content='木子洋'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='迪尔仪器' /><meta property='article:published_time' content='2025-09-03T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-09-03T23:20:57&#43;00:00'/><meta property='og:image' content='https://work.717170.xyz/img/title.jpg' />
<meta name="twitter:title" content="迪尔DL96A">
<meta name="twitter:description" content="接口说明 仪器厂商 迪尔\n仪器型号 DL96A\n通讯方式 双向 仪器类型 微生物 医院名称 程序名称 MI.MIFDL96A 终端服务器地址 终端服务器端口号 仪器上接口标示和接口类型 接口类型：通过监听连接仪器 连接方式：数据库类型为mysql 仪器接口说明 先通过^LISTMPWSW获取细菌，抗生素，专家规则数据，通过细菌通道为索引组装保存数据 保存细菌数据后未生成对应的报告和鉴定树导致专家规则无法保存，调用 try{d ##class(IDP.WS.BLL.DHCIDPResult).GetReportIDPTreeJSONStream(ReportDR, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;)}catch{}方法生成鉴定树，随后进行保存专家规则 通过sql插入标本信息达成双向 串口盒子配置 波特率： 9600 数据位：8 停止位： 1 校验位： N 数据格式 项目通道号 修改记录 序号 日期 操作人 说明 1 2025-01-25 18:32:16\n杨浩然 仪器接口程序 监听配置 1 /// [{&#34;MachID&#34;:&#34;#RowID&#34;,&#34;Type&#34;:&#34;DataBase&#34;,&#34;UpTime&#34;:&#34;3000&#34;,&#34;Address&#34;:&#34;DSN=DL96A&#34;,&#34;UpCDF&#34;:&#34;&#34;,&#34;UpREF&#34;:&#34;&#34;,&#34;DealProcess&#34;:&#34;MI.MIFDL96A&#34;,&#34;Para&#34;:&#34;SELECT * FROM lis_result WHERE DATE(UpdateDate) = CURDATE()#ID#&#34;,&#34;PreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;,&#34;UPPreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;}] 接口程序 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 /// [{&#34;MachID&#34;:&#34;#RowID&#34;,&#34;Type&#34;:&#34;DataBase&#34;,&#34;UpTime&#34;:&#34;3000&#34;,&#34;Address&#34;:&#34;DSN=DL96A&#34;,&#34;UpCDF&#34;:&#34;&#34;,&#34;UpREF&#34;:&#34;&#34;,&#34;DealProcess&#34;:&#34;MI.MIFDL96A&#34;,&#34;Para&#34;:&#34;SELECT * FROM lis_result WHERE DATE(UpdateDate) = CURDATE()#ID#&#34;,&#34;PreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;,&#34;UPPreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;}] Class MI.MIFDL96A Extends %RegisteredObject { /// D ##class(MI.MIFDL96E02).fileMTHD(&#34;22&#34;,&#34;4185~33122416~~~□肺炎链球菌(S.pneumoniae)□G+球菌□□[spn]□(优势菌2)~~~~~A;PEN;;＝8;耐药;;B;CLI;;≥8;耐药;;A;SXT;;≥8/152;耐药;;B;CRO;;＝1;敏感;;A;ERY;;≥16;耐药;;B;VA;;≤1;敏感;;B;LEV;;＝2;敏感;;B;TET;;＝32;耐药;;B;MRP;;≤0.25;敏感;;C;CXM;;≥4;耐药;;C;RIF;;≤0.5;敏感;;C;AMC;;≤1.0/0.5;敏感;;C;LNZ;;≤2;敏感;;~~~~~对左氧氟沙星敏感的菌株可预报其对吉米沙星和莫西沙星敏感。[13][10]对四环素敏感的菌株对多西环素和米诺环素也敏感。[13][10]利福平不单独用于抗菌治疗。[13][10]红霉素可预报阿奇霉素、克拉霉素和地红霉素的敏感和耐药性。[13][10]~~~~普通细菌培养+药敏~2020-12-25□8:33:23~2020-12-27□8:33:23~1~&#34;,&#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;) /// d ##class(MI.MIFDL96AN).fileMTHD(&#34;56&#34;,$g(^YHR(&#34;WSWQC&#34;))) ClassMethod fileMTHD(mi, record, epis, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %String { s mi=$g(mi) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34; i &#39;$l(record) q &#34;&#34; s ItemDeli=$c(92) //项目分隔符92 s ResultDeli=$c(44) //结果分隔符44 s AntDeli=&#34;]&#34; //抗生素分隔符] s SenDeli=&#34;[&#34; //药敏结果分隔符[ d Trace^MI.MIF000(mi,record,&#34;record&lt;--M&#34;) /// 54724~52772~~~~□肺炎链球菌(S.pneumoniae)□G+球菌□□[spn]□(弱势菌)~~~~~A;PEN;;≥32;耐药;;B;CLI;;≥8;耐药;;A;SXT;;≥8/152;耐药;;B;CRO;;＝1;敏感;;A;ERY;;≥16;耐药;;B;VA;;≤1;敏感;;B;LEV;;＝2;敏感;;B;TET;;＝32;耐药;;B;MRP;;≤0.25;敏感;;C;CXM;;≥4;耐药;;C;RIF;;≤0.5;敏感;;C;AMC;;＝2/1;敏感;;C;LNZ;;≤2;敏感;;~~~~~对左氧氟沙星敏感的菌株可预报其对吉米沙星和莫西沙星敏感。[13][10]红霉素可预报阿奇霉素、克拉霉素和地红霉素的敏感和耐药性。[13][10]利福平不单独用于抗菌治疗。[13][10]对四环素敏感的菌株对多西环素和米诺环素也敏感。[13][10]~~~普通细菌培养+药敏~2019/12/10□8:41:15~2019/12/13□8:41:15~0~1~ /// &#34;35~182~25010700606~I-180,2N10155711,*□|I-179,2E10532605,*□|~I-180,2N10155711,*□|I-179,2E10532605,*□|~~□,I-180,2N10155711,铜绿假单胞菌(Pseudomonas□aeruginosa),pae,-,0,□|□,I-179,2E10532605,肺炎克雷伯菌(Klebsiella□pneumoniae),kpn,-,0,□|~~I-180,2N10155711,DL-120□NE2,pae,FEP,&lt;=2μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-180,2N10155711,DL-120□NE2,pae,CAZ,&lt;=2μg/mL,A,S,≤8&amp;16&amp;≥32,Y|I-180,2N10155711,DL-120□NE2,pae,GEN,&lt;=2μg/mL,A,S,≤4&amp;8&amp;≥16,Y|I-180,2N10155711,DL-120□NE2,pae,TOB,&lt;=1μg/mL,A,S,≤4&amp;8&amp;≥16,Y|I-180,2N10155711,DL-120□NE2,pae,AMK,&lt;=4μg/mL,INV,□,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,PIP,&lt;=4μg/mL,O,S,≤16&amp;32&amp;≥64,Y|I-180,2N10155711,DL-120□NE2,pae,IPM,&lt;=1μg/mL,B,S,≤2&amp;4&amp;≥8,Y|I-180,2N10155711,DL-120□NE2,pae,TZP,&lt;=4/4μg/mL,A,S,≤16/4&amp;32/4&amp;≥64/4,Y|I-180,2N10155711,DL-120□NE2,pae,MEM,&lt;=1μg/mL,B,S,≤2&amp;4&amp;≥8,Y|I-180,2N10155711,DL-120□NE2,pae,SAM,&gt;=64/32μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,CSL,&lt;=8/4μg/mL,O,S,≤16/8&amp;32/16&amp;≥64/32,Y|I-180,2N10155711,DL-120□NE2,pae,ATM,=4μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-180,2N10155711,DL-120□NE2,pae,LVX,&lt;=1μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-180,2N10155711,DL-120□NE2,pae,TCC,=16/2μg/mL,O,S,≤16/2&amp;32/2-64/2&amp;≥128/2,Y|I-180,2N10155711,DL-120□NE2,pae,SXT,&lt;=1/19μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,NOR,&lt;=4μg/mL,INV,□,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,MNO,&gt;=32μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,TGC,=16μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,CIP,&lt;=0.5μg/mL,B,S,≤0.5&amp;1&amp;≥2,Y|I-180,2N10155711,DL-120□NE2,pae,POL,=1μg/mL,O,I,□&amp;≤2&amp;≥4,Y|I-180,2N10155711,DL-120□NE2,pae,DOX,&gt;=16μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,CHL,&gt;=32μg/mL,INV,R,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,AMP,&gt;=32μg/mL,A,R,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,GEN,&lt;=1μg/mL,A,S,≤4&amp;8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,SAM,&lt;=8/4μg/mL,B,S,≤8/4&amp;16/8&amp;≥32/16,Y|I-179,2E10532605,DL-120□E2,kpn,TZP,&lt;=4/4μg/mL,B,S,≤16/4&amp;32/4-64/4&amp;≥128/4,Y|I-179,2E10532605,DL-120□E2,kpn,CSL,&lt;=8/4μg/mL,O,S,≤16/8&amp;32/16&amp;≥64/32,Y|I-179,2E10532605,DL-120□E2,kpn,CCV,&lt;=1/4μg/mL,INV,□,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,CTC,&lt;=1/4μg/mL,INV,□,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,CZO,=8μg/mL,A,R,≤2&amp;4&amp;≥8,Y|I-179,2E10532605,DL-120□E2,kpn,FEP,&lt;=0.12μg/mL,B,S,≤2&amp;4-8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,FOX,&lt;=8μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,CXM(Iv),&lt;=4μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,CXM(Oral),&lt;=4μg/mL,B,S,≤4&amp;8-16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,LVX,&lt;=0.12μg/mL,B,S,≤0.5&amp;1&amp;≥2,Y|I-179,2E10532605,DL-120□E2,kpn,SXT,&lt;=0.5/9.5μg/mL,B,S,≤2/38&amp;□&amp;≥4/76,Y|I-179,2E10532605,DL-120□E2,kpn,CTX,&lt;=0.12μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,IPM,&lt;=0.25μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,CAZ,&lt;=0.5μg/mL,C,S,≤4&amp;8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,CHL,&lt;=8μg/mL,C,S,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,MEM,&lt;=0.06μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,AMK,&lt;=4μg/mL,B,S,≤16&amp;32&amp;≥64,Y|I-179,2E10532605,DL-120□E2,kpn,NIT,&lt;=16μg/mL,INV,□,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,ETP,&lt;=0.015μg/mL,B,S,≤0.5&amp;1&amp;≥2,Y|I-179,2E10532605,DL-120□E2,kpn,MNO,&lt;=1μg/mL,O,S,≤4&amp;8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,TGC,&lt;=0.25μg/mL,INV,S,≤1&amp;2&amp;&gt;2,Y|I-179,2E10532605,DL-120□E2,kpn,POL,&lt;=1μg/mL,O,I,□&amp;≤2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,AZM,&lt;=8μg/mL,INV,R,□&amp;□&amp;□,Y|~I-180,2N10155711,□|I-179,2E10532605,□|~I-180,2N10155711*多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*长期使用各种抗生素治疗，铜绿假单胞菌会变得耐药。初期敏感的菌株在治疗3-4天内变为耐药，因此，测试重复分离株是必要的。*哌拉西林（单药或联合他唑巴坦）的折点基于哌拉西林（单药或联合他唑巴坦）至少3g□q6h给药方案。*亚胺培南的折点基于1g□q8h或500mg□q6h的给药方案。*左氧氟沙星的折点基于750mg□qd的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*长期使用各种抗生素治疗，铜绿假单胞菌会变得耐药。初期敏感的菌株在治疗3-4天内变为耐药，因此，测试重复分离株是必要的。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。*多黏菌素B应给予负荷剂量和最大推荐剂量。*头孢吡肟的折点基于1g□q8h或2g□q12h的给药方案。*头孢他啶的折点基于1g□q6h或2g□q8h的给药方案。*环丙沙星的折点基于静脉注射400mg□q8h给药方案。*氨曲南的折点基于1g□q6h或2g□q8h的给药方案。*替卡西林/克拉维酸的折点基于至少3g□□q6h给药方案。*此报告采用的折点标准来源为CLSIM100□2024，其中头孢哌酮/舒巴坦为CHINET技术要求□2022，妥布霉素、庆大霉素为CLSIM100□2022。|I-179,2E10532605*仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。*亚胺培南的折点基于500mg□q6h或1g□q8h的给药方案。*多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*氨苄西林的结果可用于预报阿莫西林的敏感性。*厄他培南的折点基于1g□qd的给药方案。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。*头孢西丁的折点基于至少8g□qd的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*头孢呋辛（注射）的折点基于1.5g□q8h的给药方案。*环丙沙星折点基于静脉注射400mg□q12h或口服500mg□q12h给药方案。*多黏菌素B应给予负荷剂量和最大推荐剂量。*头孢噻肟的折点基于1g□q8h的给药方案。*治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g□q8h的给药方案。*头孢吡肟的敏感折点基于1g□q12h的给药方案。*此报告采用的折点标准来源为CLSIM100□2024，其中哌拉西林/他唑巴坦为CLSIM100□2021，头孢哌酮/舒巴坦为CHINET技术要求□2022，替加环素为EUCAST□2018，阿米卡星、庆大霉素为CLSIM100□2022。|~~~~~I-180,2N10155711,2025-01-12□15:55:48|I-179,2E10532605,2025-01-12□16:00:48|~~~1~2025-01-12□16:25:01~□~□,I-180,2N10155711,铜绿假单胞菌(Pseudomonas□aeruginosa),pae,G-杆菌,0,□|□,I-179,2E10532605,肺炎克雷伯菌(Klebsiella□pneumoniae),kpn,G-杆菌,0,□|~I-180,2N10155711,□|I-179,2E10532605,□|~I-180,2N10155711*[SAM&amp;TGC&amp;MNO&amp;SXT&amp;CHL&amp;DOX]*[]*[]|I-179,2E10532605*[AMP&amp;AZM]*[]*[]|~~~~&#34; s (sample,epis,surname,rec,res,fresult,date,time,QC,xBugs,AntLIST,expertRules)=&#34;&#34; k ^LISTMPWSW /// 获取流水号 s epis=$tr($p(record,&#34;~&#34;,3),&#34; &#34;) q:&#39;$l(epis) &#34;&#34; s curDate=$zd($h,8) /// 获取细菌 s xBugsData=$p(record,&#34;~&#34;,7) f i=1:1:$l(xBugsData,&#34;|&#34;) d .s xBugsDatai=$p(xBugsData,&#34;|&#34;,i) .i &#39;$l(xBugsDatai) q .s xBugs=$p(xBugsDatai,&#34;,&#34;,5) .i xBugs=&#34;&#34; q .s code=i .s ^LISTMPWSW(&#34;xBugs&#34;,xBugs)=code .s ^LISTMPWSW(&#34;xBugsNum&#34;,code)=xBugs /// 获取药敏 s antStrData=$p(record,&#34;~&#34;,9) f i=1:1:$l(antStrData,&#34;|&#34;) d .s antStrDatai=$p(antStrData,&#34;|&#34;,i) .i &#39;$l(antStrDatai) q .s xBugs=$p(antStrDatai,&#34;,&#34;,4) .i &#39;$l(xBugs) q .s ^LISTMPWSW(&#34;antStr&#34;,xBugs,i)=antStrDatai /// 获取专家规则 s expertRulesData=$p(record,&#34;~&#34;,11) f i=1:1:$l(expertRulesData,&#34;|&#34;) d .s expertRulesDatai=$p(expertRulesData,&#34;|&#34;,i) .i &#39;$l(expertRulesDatai) q .s xBugs=$g(^LISTMPWSW(&#34;xBugsNum&#34;,i)) .i &#39;$l(xBugs) q .s expertRules=$p(expertRulesDatai,&#34;*&#34;,2,*) .s ^LISTMPWSW(&#34;expertRules&#34;,xBugs)=expertRules s xBugs=&#34;&#34; f s xBugs=$o(^LISTMPWSW(&#34;xBugs&#34;,xBugs)) q:xBugs=&#34;&#34; d .s code=$g(^LISTMPWSW(&#34;xBugs&#34;,xBugs)) .s (AntLIST,fresult,date,time,QC)=&#34;&#34; .s antStr=&#34;&#34; f s antStr=$o(^LISTMPWSW(&#34;antStr&#34;,xBugs,antStr)) q:antStr=&#34;&#34; d ..s antList=$g(^LISTMPWSW(&#34;antStr&#34;,xBugs,antStr)) ..s AntGroup=$p(antList,&#34;,&#34;,7) //抗生素分组 ..s xANT=$tr($p(antList,&#34;,&#34;,5),&#34; &#34;) q:xANT=&#34;&#34; //抗生素 ..s xMIC=$replace($p(antList,&#34;,&#34;,6),&#34;μg/mL&#34;,&#34;&#34;) //MIC ..s xRES=$tr($p(antList,&#34;,&#34;,8),&#34; &#34;) //耐药 ..s AntLIST=AntLIST_xANT_AntDeli_xRES_AntDeli_xMIC_AntDeli_AntDeli_AntGroup_SenDeli .d Trace^MI.MIF000(mi,AntLIST,&#34;AntLIST&lt;--M&#34;) .i $l(xBugs),$l(epis),$l(AntLIST) d ..s fresult=xBugs_ItemDeli_AntLIST_ItemDeli_code_ResultDeli .d Trace^MI.MIF000(mi,epis_&#34;$$&#34;_fresult,&#34;fresult&lt;--M&#34;) .i $l(fresult) d ..d Save^MI.MIF000(mi,epis,code_ItemDeli_xBugs_ItemDeli_ItemDeli_ItemDeli_ResultDeli,date,time,QC) ..d SaveAnt^MI.MIF000(mi,epis,fresult,date,time,QC) .s expertRules=$g(^LISTMPWSW(&#34;expertRules&#34;,xBugs)) .s ret=..SaveZJGZ(epis, mi, code, expertRules) .d Trace^MI.MIF000(mi,ret,&#34;专家规则保存ret&#34;) k ^LISTMPWSW q &#34;&#34; } ClassMethod GerTestCodeDR(mi, code) { s mi=$g(mi),code=$g(code) s ret=&#34;&#34; i &#39;$l(mi) q ret i &#39;$l(code) q ret i $d(^dbo.BTMIMachineTestCodeI(&#34;IndexResultChannel&#34;,mi,code)) d .s BTMIMachineTestCodeDR=$o(^dbo.BTMIMachineTestCodeI(&#34;IndexResultChannel&#34;,mi,code,&#34;&#34;)) .s TestCodeDR=$lg($g(^dbo.BTMIMachineTestCodeD(BTMIMachineTestCodeDR)),3) .s ret=TestCodeDR q ret } /// w ##class(MI.MIFDL96A2).SaveZJGZ(&#34;6633&#34;,&#34;40&#34;,1,&#34;多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*头孢噻肟的折点基于1g□q8h的给药方案。*亚胺培南的折点基于500mg□q6h或1g□q8h的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*头孢唑啉的结果可预报非复杂性的泌尿系统感染的大肠埃希菌对口服头孢拉定、头孢地尼、头孢克罗、头孢丙烯、头孢泊肟、头孢呋辛的敏感性。*头孢西丁的折点基于至少8g□qd的给药方案。*仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。*氨苄西林的结果可用于预报阿莫西林的敏感性。*环丙沙星折点基于静脉注射400mg□q12h或口服500mg□q12h给药方案。*头孢吡肟的敏感折点基于1g□q12h的给药方案。*头孢呋辛（注射）的折点基于1.5g□q8h的给药方案。*治疗非复杂泌尿道感染的头孢唑林折点是基于1g□q12h的给药方案。*治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g□q8h的给药方案。*多黏菌素B应给予负荷剂量和最大推荐剂量。*厄他培南的折点基于1g□qd的给药方案。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。&#34;) /// w ##class(MI.MIFDL96A).SaveZJGZ(&#34;24120600395&#34;,&#34;56&#34;,1,&#34;QNR-ECO：喹诺酮类耐药的大肠埃希菌。*MDR：多重耐药菌株。*产ESBL株：产超广谱β-内酰胺酶菌株。*CTX-CRO-R-ECO：头孢噻肟或头孢曲松耐药的大肠埃希菌。*头孢呋辛（注射）的折点基于1.5g□q8h的给药方案。*仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。*厄他培南的折点基于1g□qd的给药方案。*治疗非复杂泌尿道感染的头孢唑林折点是基于1g□q12h的给药方案。*多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*头孢唑啉的结果可预报非复杂性的泌尿系统感染的大肠埃希菌对口服头孢拉定、头孢地尼、头孢克罗、头孢丙烯、头孢泊肟、头孢呋辛的敏感性。*头孢西丁的折点基于至少8g□qd的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*环丙沙星折点基于静脉注射400mg□q12h或口服500mg□q12h给药方案。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。*头孢噻肟的折点基于1g□q8h的给药方案。*亚胺培南的折点基于500mg□q6h或1g□q8h的给药方案。*氨苄西林的结果可用于预报阿莫西林的敏感性。*治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g□q8h的给药方案。*多黏菌素B应给予负荷剂量和最大推荐剂量。*此报告采用的折点标准来源为CLSIM100□2024，其中替加环素为EUCAST□2018，头孢哌酮/舒巴坦为CHINET技术要求□2022，哌拉西林/他唑巴坦为CLSIM100□2021，阿米卡星、庆大霉素为CLSIM100□2022。&#34;) /// w ##class(MI.MIFDL96A).SaveZJGZ(&#34;WX250104003&#34;,&#34;56&#34;,1,&#34;1、MDR：多重耐药菌株。 2、QNR-ECO：喹诺酮类耐药的大肠埃希菌。 3、产ESBL株：产超广谱β-内酰胺酶菌株。 4、CTX-CRO-R-ECO：头孢噻肟或头孢曲松耐药的大肠埃希菌。 5、治疗非复杂泌尿道感染的头孢唑林折点是基于1g q12h的给药方案。 6、仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。 7、亚胺培南的折点基于500mg q6h或1g q8h的给药方案。 8、多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。 9、氨苄西林的结果可用于预报阿莫西林的敏感性。 10、头孢唑啉的结果可预报非复杂性的泌尿系统感染的大肠埃希菌对口服头孢拉定、头孢地尼、头孢克罗、头孢丙烯、头孢泊肟、头孢呋辛的敏感性。 11、厄他培南的折点基于1g qd的给药方案。 12、对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。 13、头孢西丁的折点基于至少8g qd的给药方案。 14、美罗培南的折点基于1g q8h的给药方案。 15、头孢呋辛（注射）的折点基于1.5g q8h的给药方案。 16、环丙沙星折点基于静脉注射400mg q12h或口服500mg q12h给药方案。 17、多黏菌素B应给予负荷剂量和最大推荐剂量。 18、头孢噻肟的折点基于1g q8h的给药方案。 19、治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g q8h的给药方案。 20、此报告采用的折点标准来源为CLSIM100 2024，其中哌拉西林/他唑巴坦为CLSIM100 2021，头孢哌酮/舒巴坦为CHINET技术要求 2022，替加环素为EUCAST 2018，阿米卡星、庆大霉素为CLSIM100 2022。&#34;) ClassMethod SaveZJGZ(epis, mi, code, ExpertRules) { s epis=$g(epis),mi=$g(mi),ExpertRules=$g(ExpertRules) s episData=$$GetEpisByLabno(mi,epis) s epis=$p(episData,&#34;^&#34;,1) s WGM=$p(episData,&#34;^&#34;,2) s ReportDR=$p(episData,&#34;^&#34;,3) s TestCodeDR=..GerTestCodeDR(mi,code) i $l(ReportDR) d .s IDPResultDR=$o(^dbo.IDPResultI(&#34;IndexIDPElement&#34;,ReportDR,2,&#34;&#34;)) .i &#39;$d(^dbo.RPVisitNumberTestSetI(&#34;IndexReportID&#34;,ReportDR)) q .i &#39;$l(TestCodeDR) q .try{d ##class(IDP.WS.BLL.DHCIDPResult).GetReportIDPTreeJSONStream(ReportDR, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;)}catch{} i &#39;$l(mi) q 0 i &#39;$l(epis) d Trace^MI.MIF000(mi,&#34;流水号不能为空&#34;,&#34;保存检测结论返回&#34;) q 0 //报告可能核收到微生物培养的四个小组 s sc=0 s transmitDate=&#34;&#34; f s transmitDate=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNo&#34;,WGM,&#34;&#34;_epis,transmitDate)) q:transmitDate=&#34;&#34; d .s ReportDR=&#34;&#34; f s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNo&#34;,WGM,&#34;&#34;_epis,transmitDate,ReportDR)) q:ReportDR=&#34;&#34; d ..//IndexReportItem On (VisitNumberReportDR, TestCodeDR) ..i &#39;$d(^dbo.RPVisitNumberReportResultI(&#34;IndexReportItem&#34;,ReportDR,TestCodeDR)) q ..s ResultDR=$o(^dbo.RPVisitNumberReportResultI(&#34;IndexReportItem&#34;,ReportDR,TestCodeDR,&#34;&#34;)) ..s objRep=##Class(dbo.RPVisitNumberReportResult).%OpenId(ResultDR) ..s EXPRlues=objRep.ExpertRule ..i EXPRlues=ExpertRules q //专家规则不再变化，不存 ..s objRep.ExpertRule=ExpertRules ..s sc=objRep.%Save() ..i (&#39;$SYSTEM.Status.IsOK(sc)) d Trace^MI.MIF000(mi,&#34;保存检测结论失败&#34;,&#34;保存检测结论失败返回&#34;) q ..d Trace^MI.MIF000(mi,ExpertRules,&#34;保存检测结论成功返回&#34;) q sc GetEpisByLabno(mi,Epis) //通过检验号获取流水号 ;Index IndexVisitNumber On VisitNumber [ SqlName = Index_VisitNumber, Type = index, Unique ]; ;Index IndexReportID On (VisitNumberDR, WorkGroupMachineDR, OrderNo) [ SqlName = Index_ReportID, Type = index, Unique ]; s ret=&#34;&#34;,mi=$g(mi),Epis=$g(Epis),ReportDR=&#34;&#34; i &#39;$l(mi) q Epis i &#39;$l(Epis) q Epis s WGMachineID=$lg($g(^dbo.BTMIMachineParameterD(mi)),6) i $d(^dbo.RPVisitNumberI(&#34;IndexVisitNumber&#34;,Epis)) d .s VisitnumberDR=$o(^dbo.RPVisitNumberI(&#34;IndexVisitNumber&#34;,Epis,&#34;&#34;)) .i $d(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitnumberDR)) d ..s WGMachineID=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitnumberDR,&#34;&#34;)) .i $d(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitnumberDR,WGMachineID,1)) d ..s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitnumberDR,WGMachineID,1,&#34;&#34;),-1) ..s ret=$lg($g(^dbo.RPVisitNumberReportD(ReportDR)),8) i $l(ret) q ret_&#34;^&#34;_WGMachineID_&#34;^&#34;_ReportDR i &#39;$d(^dbo.RPVisitNumberReportI(&#34;IndexMicNoNew&#34;,Epis)) q ret_&#34;^&#34;_WGMachineID_&#34;^&#34;_ReportDR s WGMachineID=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNoNew&#34;,Epis,&#34;&#34;)) s TransmitDate=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNoNew&#34;,Epis,WGMachineID,&#34;&#34;)) s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexMicNoNew&#34;,Epis,WGMachineID,TransmitDate,&#34;&#34;)) s ret=Epis q ret_&#34;^&#34;_WGMachineID_&#34;^&#34;_ReportDR } /// D ##class(MI.MIFLISMonitorTest)SaveImageMTHD(&#34;7&#34;,&#34;9999&#34;, &#34;&#34;,&#34;175&#34;) /// mi:仪器 /// epis：流水号，如果是监听图片模式该位置放图片名称，自己在保存前提取流水 /// ImageClass:图片类别，如果是监听图片模式该位置放图片名称，自己在保存前提取图片类型 /// FileName:保存在文件服务的相对路径，默认不动 /// FullName:文件全路径，如果是监听图片模式该位置放图片全路径名称，满足有的图片名称无法得到流水和图片类别的情况 ClassMethod SaveImageMTHD(mi, epis, ImageClass, FileName, FullName, SaveImageRetName, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %String { //通过OtherPara配置取图的在这里通过epis和ImageClass的图片名字提取出流水号和图片类别 s mi=$g(mi) s epis=$g(epis) s ImageClass=$g(ImageClass) s FileName=$g(FileName) s FullName=$g(FullName) s SaveImageRetName=$g(SaveImageRetName) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34; d ##Class(MI.Common.MIFBase).Trace(mi,epis_&#34;:&#34;_ImageClass_&#34;:&#34;_FileName,&#34;H&lt;--M&#34;) s (ReceiveDate, ImageOrder, Caption, DisplayRatio, Height, Width, Sequence)=&#34;&#34; //加上当前时间，防止浏览器缓存 s FileName=FileName_&#34;?&#34;_$p($h,&#34;,&#34;,2) //OtherPara用^分隔第四位指定SaveImageRetName的话在这里改FileName为新名称。同时让方法返回新图片名字 s NewFileName=&#34;&#34; i SaveImageRetName=&#34;SaveImageRetName&#34; d .//图片新名字 .;s NewFileName=epis_&#34;-&#34;_ImageClass_&#34;-&#34; .//路径新名字 .s NewPathName=&#34;&#34; .s SPLen=$l(FileName,&#34;/&#34;) .f ii=1:1:SPLen d ..i ii&lt;SPLen d ...s NewPathName=NewPathName_$p(FileName,&#34;/&#34;,ii)_&#34;/&#34; ..i ii=SPLen d ...s NewFileName=NewFileName_$p(FileName,&#34;/&#34;,ii) .s NewPathName=NewPathName_NewFileName .s FileName=NewPathName //最后返回NewFileName s ret=##Class(MI.Common.MachineResult).SaveImage(ReceiveDate, epis, ImageClass, ImageOrder, FileName, mi, Caption, DisplayRatio, Height, Width, Sequence) //返回值控制图片名称模式 i SaveImageRetName=&#34;SaveImageRetName&#34; d .s ret=NewFileName q ret } /// 返回给监听当前上传文件路径名称，默认不要动 /// w ##class(MI.MIFLISMonitorTest).GetFtpMTHD(&#34;7&#34;) /// mi:仪器 ClassMethod GetFtpMTHD(mi, P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %String { //文件服务模式必须改的地方，老的FTP模式这么改了也没问题，所以建议都这样 s mi=$g(mi) q ##Class(MI.Common.MIFBase).GetMiFtpPath(mi) } /// Creator： 查询患者信息，监听配置上传前处理类后会定时调用这个query查询数据进行上传操作 /// CreatDate： 20140919 /// Description:： /// Table： /// Input： mi：仪器主键 /// Output： 仪器信息 /// Return： 仪器信息 /// Others： Query QryLabInfo(mi As %String, P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %Query(ROWSPEC = &#34;labno,labnoInfo,patInfo&#34;) { } /// Query的执行方法 /// d ##class(%ResultSet).RunQuery(&#34;MI.MIFDL96A&#34;,&#34;QryLabInfo&#34;,&#34;56&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;) ClassMethod QryLabInfoExecute(ByRef qHandle As %Binary, mi As %String, P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %Status { Set repid=$i(^CacheTemp) Set ind=1 s mi=$g(mi),flag=$g(flag) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34; s LabnoList=&#34;&#34; //控制输出Excel //s Data=##class(MI.Common.MIFBase).DemoMOutFileInfo(&#34;D:\\\\OUT\\\\上传.xls&#34;,&#34;张三[0][1]男[0][1]28岁[0][1]&#34;_$h,&#34;900001&#34;,&#34;1&#34;) //d OutputRow //Set qHandle=$lb(0,repid,0) //Quit $$$OK //控制输出Excel //查最近8天 s AddDate=$zd($p($h,&#34;,&#34;,1)-8,8) f s AddDate=$o(^dbo.RPMachineUploadI(&#34;IndexSendStatus&#34;,mi,##Class(LIS.Util.Common).IndexData(&#34;C&#34;),AddDate)) q:AddDate=&#34;&#34; d .s AddTime=&#34;&#34; f s AddTime=$o(^dbo.RPMachineUploadI(&#34;IndexSendStatus&#34;,mi,##Class(LIS.Util.Common).IndexData(&#34;C&#34;),AddDate,AddTime)) q:AddTime=&#34;&#34; d ..//20秒以内的先不上传，防止没接收完 ..i (AddDate=$zd($h,8)),(($p($h,&#34;,&#34;,2)-AddTime)&lt;20) q ..s MiUploadDR=$o(^dbo.RPMachineUploadI(&#34;IndexSendStatus&#34;,mi,##Class(LIS.Util.Common).IndexData(&#34;C&#34;),AddDate,AddTime,&#34;&#34;)) ..s labno=$lg(^dbo.RPMachineUploadD(MiUploadDR),3) ..i &#39;$l(labno) q ..//得到通道号 ..s chl=$lg($g(^dbo.RPMachineUploadD(MiUploadDR)),7) ..//测试类型0：文本，1：数据库 ..s TestType=&#34;1&#34; ..i TestType=&#34;0&#34; d ...//文本双向上传开始****************************************************** ...//控制输出文本的内容 ...s txtInfo=labno_&#34;^&#34;_chl ...s Data=##class(MI.Common.MIFBase).DemoMOutFileInfo($zd($h,8)_labno_&#34;.order&#34;,txtInfo,labno,&#34;&#34;) ...d OutputRow ...s labno=labnoOld_&#34;^&#34;_$zd($h,8)_labno_&#34;.ok&#34; ...s Data=##class(MI.Common.MIFBase).DemoMOutFileInfo($zd($h,8)_labno_&#34;.ok&#34;,txtInfo,labno,&#34;&#34;) ...d OutputRow ...//文本双向上传结束****************************************************** ..i TestType=&#34;1&#34; d ...//数据库双向上传开始****************************************************** ...//控制执行sql ...//Insert into liscontroller.lis_application (SPEC_NUM,BTBarcode,ASTBarcode,PATIENT_ID,MSPosition,PatientNo,FULL_NAME,FIRST_NAME,LAST_NAME,Birth,AGE,SEX,Purpose,WARD,Specimen,BedNo,Diagnosis,SpRequest,Medication,SuspectedBact,Doctor,AdviceNo,ApplyDate,SendDate,Collector,SPEC_DATE,CollectPosition,IdResult,Updated,UpdateDate,CARSS_ReadDate,StainType,StructVersion) values ...//(&#39;9999&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;199732&#39;,&#39;NULL&#39;,&#39; &#39;,&#39;测试&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#39;,&#39;85y&#39;,&#39;f&#39;,&#39;普通细菌培养+药敏&#39;,&#39;三病室&#39;,&#39;痰&#39;,&#39;3&#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39;刘云&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;2024/6/28 9:17&#39;,&#39;谢艳红&#39;,&#39;2024/6/29 11:17&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;0&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;) ...// Insert into liscontroller.lis_application (SPEC_NUM,BTBarcode,ASTBarcode,PATIENT_ID,MSPosition,PatientNo,FULL_NAME,FIRST_NAME,LAST_NAME,Birth,AGE,SEX,Purpose,WARD,Specimen,BedNo,Diagnosis,SpRequest,Medication,SuspectedBact,Doctor,AdviceNo,ApplyDate,SendDate,Collector,SPEC_DATE,CollectPosition,IdResult,Updated,UpdateDate,CARSS_ReadDate,StainType,StructVersion) values ...//(&#39;25010700606&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;202500044&#39;,&#39;NULL&#39;,&#39; &#39;,&#39;潘攀&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#39;,&#39;1y&#39;,&#39;m&#39;,&#39;普通细菌培养+药敏&#39;,&#39;儿科&#39;,&#39;痰液&#39;,&#39;17&#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39;姚美清&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;2025-01-08 11:52:47&#39;,&#39;彭娜&#39;,&#39;2025-01-08 11:52:47&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;0&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;) ...s SqlStr=&#34;Insert into liscontroller.lis_application (SPEC_NUM,BTBarcode,ASTBarcode,PATIENT_ID,MSPosition,PatientNo,FULL_NAME,FIRST_NAME,LAST_NAME,Birth,AGE,SEX,Purpose,WARD,Specimen,BedNo,Diagnosis,SpRequest,Medication,SuspectedBact,Doctor,AdviceNo,ApplyDate,SendDate,Collector,SPEC_DATE,CollectPosition,IdResult,Updated,UpdateDate,CARSS_ReadDate,StainType,StructVersion) values &#34; ...s PatInfo=..GetPatInfo(mi, labno) ...d Trace^MI.MIF000(mi,PatInfo,&#34;PatInfo&#34;) ...//2024-07-01 16:47:48,Mejer600-4,2406290091,,,mnwk-泌尿外科,刘乐,唐云,0000628089,周田香,2,住院,33,43,,2406290091,2024-06-29 11:15,,,,,肾积水伴肾输尿管结石,,,,2024-06-29 06:48,, ...s EPIS=$p(PatInfo,&#34;,&#34;,31) //鉴定号 ...s DTTime=$p(PatInfo,&#34;,&#34;,32) //核收时间 ...s Name=$p(PatInfo,&#34;,&#34;,10) //姓名 ...s Sex=$p(PatInfo,&#34;,&#34;,11) //性别 ...i Sex=&#34;1&#34; s Sex=&#34;m&#34; ...i Sex=&#34;2&#34; s Sex=&#34;f&#34; ...s Age=$p(PatInfo,&#34;,&#34;,14) //年龄 ...s MediNo=$p(PatInfo,&#34;,&#34;,29) //病案号 ...s Location=$p(PatInfo,&#34;,&#34;,6) //科室 ...i Location[&#34;-&#34; s Location=$p(Location,&#34;-&#34;,2) //jzwkszwk-脊柱外科 ...s Speciman=$p(PatInfo,&#34;,&#34;,30) //标本类型 ...s BedNo=$p(PatInfo,&#34;,&#34;,13) //床号 ...s Doctor=$p(PatInfo,&#34;,&#34;,7) //医生 ...s CollectUser=$p(PatInfo,&#34;,&#34;,8) //采集者 ...//s DTTime=$tr($zd($h,3),&#34;-&#34;,&#34;/&#34;)_&#34; &#34;_$zt($p($h,&#34;,&#34;,2),1) //2024/6/28 9:17 $p($zt($h,1),&#34;:&#34;,1,*-1) ...s ValueStr=&#34;(&#39;&#34;_EPIS_&#34;&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#34;_MediNo_&#34;&#39;,&#39;NULL&#39;,&#39; &#39;,&#39;&#34;_Name_&#34;&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#39;,&#39;&#34;_Age_&#34;&#39;,&#39;&#34;_Sex_&#34;&#39;,&#39;普通细菌培养+药敏&#39;,&#39;&#34;_Location_&#34;&#39;,&#39;&#34;_Speciman_&#34;&#39;,&#39;&#34;_BedNo_&#34;&#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39;&#34;_Doctor_&#34;&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;&#34;_DTTime_&#34;&#39;,&#39;&#34;_CollectUser_&#34;&#39;,&#39;&#34;_DTTime_&#34;&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;0&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;)&#34; ...s SqlStr=SqlStr_ValueStr ...d Trace^MI.MIF000(mi,SqlStr,&#34;SqlStr&#34;) ...s ^DL96(&#34;Send&#34;,+$h,labno)=1 //上传标识置为1 ...//多条命令组装多个SQL语句输出.SQL包含$StoredProcedure就当存储过程执行 ...s Data=##class(MI.Common.MIFBase).DemoMOutDBInfo(&#34;DSN=DL96A&#34;,SqlStr,labno) ...d OutputRow ..//数据库双向上传结束****************************************************** Set qHandle=$lb(0,repid,0) Quit $$$OK OutputRow Set ColFields=&#34;labno,labnoInfo,patInfo&#34; Set ^CacheTemp(repid,ind)=##Class(LIS.Util.Common).TransListNull(Data,ColFields) Set ind=ind+1 quit } ClassMethod QryLabInfoClose(ByRef qHandle As %Binary) As %Status [ PlaceAfter = QryLabInfoExecute ] { Set repid=$LIST(qHandle,2) Kill ^CacheTemp(repid) Quit $$$OK } ClassMethod QryLabInfoFetch(ByRef qHandle As %Binary, ByRef Row As %List, ByRef AtEnd As %Integer = 0) As %Status [ PlaceAfter = QryLabInfoExecute ] { Set AtEnd=$LIST(qHandle,1) Set repid=$LIST(qHandle,2) Set ind=$LIST(qHandle,3) Set ind=$o(^CacheTemp(repid,ind)) If ind=&#34;&#34; { Set AtEnd=1 Set Row=&#34;&#34; } Else { Set Row=^CacheTemp(repid,ind) } s qHandle=$lb(AtEnd,repid,ind) Quit $$$OK } /// w ##Class(MI.MIFLISMonitorTest).GetLabnoInfo(6,1001367) ClassMethod GetLabnoInfo(mi, labno) As %String { s mi=$g(mi),labno=$g(labno) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34; //获取项目通道号 d ScanOne^MI.MIF000(mi,labno) s tcx=&#34;&#34; s chl=&#34;&#34; f s chl=$o(^TMP(&#34;MIFTESTCODE&#34;,$j,mi,labno,chl)) q:chl=&#34;&#34; d .s tcx=tcx_chl_&#34;+&#34; s tcx=$e(tcx,1,$l(tcx)-1) k ^TMP(&#34;MIFTESTCODE&#34;,$j,mi,labno) i $l(tcx) s tcx=labno_&#34;,&#34;_tcx_&#34;|&#34; q tcx } /// w ##Class(MI.MIFDL96A2).GetEPIS(&#34;56&#34;,&#34;9000000324&#34;) ClassMethod GetEPIS(mi, labno) As %String { //IndexReportID On (VisitNumberDR, WorkGroupMachineDR, OrderNo) s labno = $g(labno),mi=$g(mi) i $l(labno)=0 q &#34;&#34; s EPIS=&#34;&#34; s VisitNumberDR = $o(^dbo.RPVisitNumberI(&#34;IndexVisitNumber&#34;,##Class(LIS.Util.Common).IndexData(labno),&#34;&#34;)) i &#39;$l(VisitNumberDR) q &#34;&#34; s WGMDR=$lg($g(^dbo.BTMIMachineParameterD(mi)),6) i $l(WGMDR),&#39;$d(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR,WGMDR)) d .s WGMDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR,&#34;&#34;)) i &#39;$l(WGMDR) q &#34;&#34; s OrderNo=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR,WGMDR,&#34;&#34;)) s ReportDR=$o(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR,WGMDR,OrderNo,&#34;&#34;)) s EPIS=$lg($g(^dbo.RPVisitNumberReportD(ReportDR)),8) s AcceptDate=$lg($g(^dbo.RPVisitNumberReportD(ReportDR)),9) s AcceptDate=$e(AcceptDate,1,4)_&#34;-&#34;_$e(AcceptDate,5,6)_&#34;-&#34;_$e(AcceptDate,7,8) s AcceptTime=$lg($g(^dbo.RPVisitNumberReportD(ReportDR)),10) S AcceptDT=AcceptDate_&#34; &#34;_$zt(AcceptTime,1) q EPIS_&#34;^&#34;_AcceptDT } /// w ##Class(MI.MIFDL96A2).GetPatInfo(&#34;40&#34;,&#34;L0116440&#34;) ClassMethod GetPatInfo(mi, labno) As %String { s labno = $g(labno),mi=$g(mi) i $l(labno)=0 q &#34;&#34; s VisitNumberDR = $o(^dbo.RPVisitNumberI(&#34;IndexVisitNumber&#34;,##Class(LIS.Util.Common).IndexData(labno),&#34;&#34;)) i &#39;$l(VisitNumberDR) q &#34;&#34; //标本信息 s TransmitDate=$tr($zd($h,3),&#34;-&#34;) s RPVisitNumberData=$g(^dbo.RPVisitNumberD(VisitNumberDR)) // IndexEpisodeNo On (TransmitDate, WorkGroupMachineDR, EpisodeNo) s MedicalRecordNo=&#34;&#34;,SpecimenDR=&#34;&#34;,Specimen=&#34;&#34;,EPIS=&#34;&#34; s MedicalRecordNo=$lg(RPVisitNumberData,6) //病案号 s SpecimenDR=$lg(RPVisitNumberData,56) //标本类型 s EPIS=..GetEPIS(mi, labno) //鉴定号 s AcceptDT=$p(EPIS,&#34;^&#34;,2) s EPIS=$p(EPIS,&#34;^&#34;,1) i $l(SpecimenDR) s Specimen=$lg($g(^dbo.BTSpecimenD(SpecimenDR)),3) s LocationDR=$lg(RPVisitNumberData,22),Location=&#34;&#34; i $l(LocationDR) s Location=$lg($g(^dbo.BTLocationD(LocationDR)),3) i Location[&#34;ICU&#34; s Location=&#34;重症监护室&#34; s DoctorDR=$lg(RPVisitNumberData,23),Doctor=&#34;&#34; i $l(DoctorDR) s Doctor=$lg($g(^dbo.BTDoctorD(DoctorDR)),3) s ReceiveDate=$lg(RPVisitNumberData,66) s ReceiveTime=$lg(RPVisitNumberData,67) s ReceiveUserDR=$lg(RPVisitNumberData,68),ReceiveUser=&#34;&#34; i $l(ReceiveUserDR) s ReceiveUser=$lg($g(^dbo.SYSUserD(ReceiveUserDR)),3) s RegNo=$lg(RPVisitNumberData,3) s SurName=$lg(RPVisitNumberData,13) s GivenName=$lg(RPVisitNumberData,14) i SurName=GivenName s PatName=SurName e s PatName=SurName_GivenName s SpeciesDR=$lg(RPVisitNumberData,15),Species=&#34;&#34; i $l(SpeciesDR) s Species=$lg($g(^dbo.BTSpeciesD(SpeciesDR)),3) s AdmTypeDR=$lg(RPVisitNumberData,4),AdmType=&#34;&#34; i $l(AdmTypeDR) s AdmType=$lg($g(^dbo.BTAdmissionTypeD(AdmTypeDR)),3) s BedNo=$lg(RPVisitNumberData,27) s Age=$lg(RPVisitNumberData,18) s AgeUnitDR=$lg(RPVisitNumberData,19),AgeUnit=&#34;&#34; i AgeUnitDR=1 s AgeUnit=&#34;y&#34; i AgeUnitDR=2 s AgeUnit=&#34;m&#34; i AgeUnitDR=3 s AgeUnit=&#34;d&#34; i AgeUnitDR=4 s AgeUnit=&#34;h&#34; //i $l(AgeUnitDR) s AgeUnit=$lg($g(^dbo.BTAgeUnitD(AgeUnitDR)),3) S Age=Age_AgeUnit s CollectDate=$lg(RPVisitNumberData,51) s CollectTime=$lg(RPVisitNumberData,52) s Diagnose=$tr($lg(RPVisitNumberData,28),&#34;,&#34;,&#34;，&#34;) s Sampleda=$zd($p($h,&#34;,&#34;,1),3)_&#34; &#34;_$zt($p($h,&#34;,&#34;,2)) s Instrument = &#34;XN&#34; i $l(mi) s Instrument=$lg(^dbo.BTMIMachineParameterD(mi),22) s Sampleno=labno //检测号 s Sampletype=&#34;&#34; s Feetype=&#34;&#34; ;费别 s Srcdepno=Location ;送检科室 s Srcdocno=Doctor ;送检医生 s Userno=ReceiveUser ;检验医生(录入者) s Patno=RegNo ;登记号 &#34;&#34; s BarCode=&#34;&#34; s Patna=PatName ;病人姓名 s Sex=1 ;性别 i Species=&#34;男&#34; s Sex=&#34;1&#34; ;1:男 ，2 女 i Species =&#34;女&#34; s Sex=&#34;2&#34; s Pattype=AdmType ;病人类型 s Bedno = BedNo ;床号 s Patage=Age ;年龄 s Ageunit=&#34;&#34; ;年龄单位 s Reqno=labno ;申请号 = 检验号 s Reqda=&#34;&#34; i $l(ReceiveDate) s Reqda=$e(ReceiveDate,1,4)_&#34;-&#34;_$e(ReceiveDate,5,6)_&#34;-&#34;_$e(ReceiveDate,7,8)_&#34; &#34;_$zt(ReceiveTime,2) ;送检日期 = 接收时间 s Reportda=&#34;&#34; ;报告日期 = 初审(保存结果)时间 s Printflag=&#34;&#34; ;打印标志 s Resultflag=&#34;&#34; ;结果标志 s Errflag=&#34;&#34; ;错误标志 s Diagnose = Diagnose ;诊断 s Description=&#34;&#34; ;备注 s Reserve=&#34;&#34; ;保留字段 s Patnamn=&#34;&#34; ;姓名拼音码 i $l(CollectDate) s Getda=$e(CollectDate,1,4)_&#34;-&#34;_$e(CollectDate,5,6)_&#34;-&#34;_$e(CollectDate,7,8)_&#34; &#34;_$zt(CollectTime,2) e s Getda=Reqda ;接收时间/采样日期 s Wardno=&#34;&#34; ;病区 s RetString=&#34;&#34; s RetString=Sampleda_&#34;,&#34;_Instrument_&#34;,&#34;_Sampleno_&#34;,&#34;_Sampletype_&#34;,&#34;_Feetype_&#34;,&#34;_Srcdepno_&#34;,&#34;_Srcdocno_&#34;,&#34;_Userno_&#34;,&#34; s RetString=RetString_Patno_&#34;,&#34;_Patna_&#34;,&#34;_Sex_&#34;,&#34;_Pattype_&#34;,&#34;_Bedno_&#34;,&#34;_Patage_&#34;,&#34;_Ageunit_&#34;,&#34;_Reqno_&#34;,&#34;_Reqda_&#34;,&#34; s RetString=RetString_Reportda_&#34;,&#34;_Printflag_&#34;,&#34;_Resultflag_&#34;,&#34;_Errflag_&#34;,&#34;_Diagnose_&#34;,&#34;_Description_&#34;,&#34;_Reserve_&#34;,&#34; s RetString=RetString_Patnamn_&#34;,&#34;_Getda_&#34;,&#34;_Wardno_&#34;,&#34;_BarCode_&#34;,&#34;_MedicalRecordNo_&#34;,&#34;_Specimen_&#34;,&#34;_EPIS_&#34;,&#34;_AcceptDT q RetString } /// 监听做上传操作后调用改方法设置标本上传表状态 ClassMethod SaveSDFMTHD(mi, labno, epis, filename, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, Sessions, Output RowCount As %String) As %String { s mi=$g(mi),labno=$g(labno),epis = $g(epis),filename=$g(filename) i &#39;$d(^dbo.BTMIMachineParameterD(mi)) q s ret=##Class(MI.MachineUpload).SetSendFlag(mi,labno,&#34;S&#34;,filename) q } } "><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://work.717170.xyz/img/title.jpg' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/touxiang_hu_3261c9b36eb249a9.jpg" width="300"
                            height="285" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🍥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">木子洋</a></h1>
            <h2 class="site-description">To be or not to be.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/muziyangg'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://gitee.com/muziyangg'
                        target="_blank"
                        title="Gitee"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1756364241553" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1459" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M739.76 462H484.2a22.22 22.22 0 0 0-22.2 22.21v55.56A22.24 22.24 0 0 0 484.19 562h155.57A22.22 22.22 0 0 1 662 584.22v11.11A66.67 66.67 0 0 1 595.31 662H384.19A22.22 22.22 0 0 1 362 639.79V428.68A66.67 66.67 0 0 1 428.64 362h311.07a22.21 22.21 0 0 0 22.22-22.2v-55.56A22.22 22.22 0 0 0 739.79 262h-311.1A166.67 166.67 0 0 0 262 428.68v311.1A22.22 22.22 0 0 0 284.22 762H612a150 150 0 0 0 150-150V484.23A22.23 22.23 0 0 0 739.77 462z m0 0" fill="#231815" p-id="1460"></path></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>首页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/link/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>友链</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                <div class="widget search-widget">
    <div class="search-box">
        <form class="search-form widget">
            <p>
                <input type="text" class="search-input" placeholder="搜索本页内容..." />
                <button type="button" title="搜索" class="search-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </p>
        </form>
        <div class="search-results" style="display: none !important;"></div>
        <div class="search-stats"></div>
    </div>
    
    <div class="search-navigation">
        <button class="nav-button" id="prev-match" aria-label="上一个匹配项">
            <img src="/icons/up.svg" alt="上一个匹配项" width="16" height="16">
        </button>
        <span id="match-counter"></span>
        <button class="nav-button" id="next-match" aria-label="下一个匹配项">
            <img src="/icons/down.svg" alt="下一个匹配项" width="16" height="16">
        </button>
    </div>
</div>

<style>
 
.search-widget {
    margin-bottom: 20px;
}

.search-box {
    position: relative;
}

.search-form {
    position: relative;
    --button-size: 80px;
    margin-bottom: 1rem;
}

.search-form.widget {
    --button-size: 60px;
}

.search-form.widget input {
    padding: 15px 20px;
    height: auto;
}

.search-form p {
    position: relative;
    margin: 0;
    display: flex;
    flex-direction: column;
}

.search-input {
    padding: 15px 20px;
    border-radius: 12px;
    background-color: var(--card-background);
    box-shadow: var(--shadow-l1);
    color: var(--card-text-color-main);
    width: 100%;
    border: 1px solid var(--card-border-color);
    -webkit-appearance: none;
    transition: box-shadow 0.3s ease, border-color 0.3s ease;
    font-size: 1.5rem !important;
    min-height: 48px;
}

.search-input::placeholder {
    font-size: 1.5rem;
    color: var(--card-text-color-tertiary);
    opacity: 1;
}

.search-input:focus {
    outline: 0;
    box-shadow: var(--shadow-l2);
    border-color: var(--primary-color);
}

.search-button {
    position: absolute;
    right: 0;
    top: 24px;
    height: 48px;
    width: var(--button-size);
    cursor: pointer;
    background-color: transparent;
    border: 0;
    padding: 0 10px;
}

.search-button:focus svg {
    stroke-width: 2;
    color: var(--accent-color);
}

.search-button svg {
    color: var(--card-text-color-secondary);
    stroke-width: 1.33;
    transition: all 0.3s ease;
    width: 20px;
    height: 20px;
}

.search-stats {
    margin-top: 8px;
    font-size: 14px;
    color: var(--card-text-color-tertiary);
}

.search-navigation {
    display: none;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
    padding: 8px;
    background: var(--card-background-secondary);
    border-radius: var(--card-border-radius);
}

.nav-button {
    padding: 5px 10px;
    background: #2c559c;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
}

.nav-button:hover {
    background: #1e3d76;
}

.nav-button:disabled {
    background: var(--card-text-color-tertiary);
    cursor: not-allowed;
}

.nav-button img {
    filter: invert(70%);
    transition: all 0.2s ease;
}

.nav-button:hover img {
    opacity: 0.9;
}

.nav-button:disabled img {
    filter: invert(40%);
}

#match-counter {
    font-size: 14px;
    color: var(--card-text-color-tertiary);
}

.search-highlight {
    background-color: #ffeb3b;
    padding: 0 2px;
    border-radius: 3px;
    transition: background-color 0.2s ease;
}

.search-highlight.current {
    background-color: #ff9800;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.querySelector('.search-widget .search-input');
    const searchResults = document.querySelector('.search-widget .search-results');
    const searchStats = document.querySelector('.search-widget .search-stats');
    const searchNav = document.querySelector('.search-widget .search-navigation');
    const prevButton = document.querySelector('.search-widget #prev-match');
    const nextButton = document.querySelector('.search-widget #next-match');
    const matchCounter = document.querySelector('.search-widget #match-counter');
    const searchForm = document.querySelector('.search-form');
    const searchButton = document.querySelector('.search-button');
    
    let currentMatches = [];
    let currentMatchIndex = -1;
    let searchDebounceTimer = null;
    const DEBOUNCE_DELAY = 1000;
    
    
    searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
    });
    
    
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.trim();
        clearTimeout(searchDebounceTimer);
        searchDebounceTimer = setTimeout(() => {
            handleSearchInput(searchTerm);
        }, DEBOUNCE_DELAY);
    });
    
    
    searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault(); 
            const searchTerm = this.value.trim();
            
            
            clearTimeout(searchDebounceTimer);
            
            
            if (currentMatches.length > 0) {
                currentMatchIndex = (currentMatchIndex + 1) % currentMatches.length;
                navigateToMatch();
            } 
            
            else if (searchTerm.length >= 1) {
                handleSearchInput(searchTerm);
            }
        }
    });
    
    
    searchButton.addEventListener('click', function() {
        clearTimeout(searchDebounceTimer);
        const searchTerm = searchInput.value.trim();
        handleSearchInput(searchTerm);
    });
    
    
    function handleSearchInput(term) {
        if (term.length < 1) {
            resetSearch();
            return;
        }
        performSearch(term);
    }
    
    
    function resetSearch() {
        searchResults.style.display = 'none';
        searchNav.style.display = 'none';
        clearHighlights();
        currentMatches = [];
        currentMatchIndex = -1;
        searchStats.textContent = '';
    }
    
    
    function performSearch(term) {
        clearHighlights();
        currentMatches = [];
        currentMatchIndex = -1;
        
        const articleContent = document.querySelector('.article-content');
        if (!articleContent) return;
        
        const textNodes = getTextNodes(articleContent);
        
        textNodes.forEach(node => {
            const text = node.textContent;
            const regex = new RegExp(term, 'gi');
            let match;
            
            while ((match = regex.exec(text)) !== null) {
                if (match.index >= 0 && match.index + match[0].length <= text.length) {
                    currentMatches.push({
                        node: node,
                        offset: match.index,
                        length: match[0].length,
                        text: match[0]
                    });
                }
                if (match.index === regex.lastIndex) {
                    regex.lastIndex++;
                }
            }
        });
        
        displaySearchResults(term);
        highlightMatches();
        updateNavigation();
        
        
        if (currentMatches.length > 0) {
            currentMatchIndex = 0;
            navigateToMatch();
        }
    }
    
    
    function getTextNodes(element) {
        const textNodes = [];
        const walker = document.createTreeWalker(
            element, 
            NodeFilter.SHOW_TEXT, 
            {
                acceptNode: function(node) {
                    if (node.parentNode.classList.contains('search-highlight') ||
                        node.parentNode.tagName === 'CODE' || 
                        node.parentNode.tagName === 'PRE') {
                        return NodeFilter.FILTER_REJECT;
                    }
                    if (node.textContent.trim().length === 0) {
                        return NodeFilter.FILTER_REJECT;
                    }
                    return NodeFilter.FILTER_ACCEPT;
                }
            }
        );
        
        let node;
        while ((node = walker.nextNode())) {
            textNodes.push(node);
        }
        
        return textNodes;
    }
    
    
    function displaySearchResults(term) {
        if (currentMatches.length === 0) {
            searchStats.textContent = `未找到"${term}"的匹配结果`;
            searchNav.style.display = 'none';
            return;
        }
        
        searchStats.textContent = `找到${currentMatches.length}个"${term}"的匹配结果`;
        searchNav.style.display = 'flex';
    }
    
    
    function highlightMatches() {
        currentMatches.forEach(match => {
            try {
                const node = match.node;
                const textLength = node.textContent.length;
                
                if (match.offset < 0 || match.offset >= textLength) {
                    console.warn('无效的匹配偏移量', match);
                    return;
                }
                
                const endOffset = Math.min(match.offset + match.length, textLength);
                
                const range = document.createRange();
                range.setStart(node, match.offset);
                range.setEnd(node, endOffset);
                
                const highlight = document.createElement('span');
                highlight.className = 'search-highlight';
                range.surroundContents(highlight);
            } catch (e) {
                console.error('高亮匹配项失败:', e, match);
            }
        });
    }
    
    
    function clearHighlights() {
        const highlights = document.querySelectorAll('.search-highlight');
        highlights.forEach(highlight => {
            const parent = highlight.parentNode;
            const textNode = document.createTextNode(highlight.textContent);
            parent.replaceChild(textNode, highlight);
            parent.normalize();
        });
    }
    
    
    function updateNavigation() {
        matchCounter.textContent = currentMatches.length > 0 ? 
            `${currentMatchIndex + 1} / ${currentMatches.length}` : 
            '无匹配结果';
        
        prevButton.disabled = currentMatches.length === 0;
        nextButton.disabled = currentMatches.length === 0;
    }
    
    
    nextButton.addEventListener('click', function() {
        if (currentMatches.length === 0) return;
        currentMatchIndex = (currentMatchIndex + 1) % currentMatches.length;
        navigateToMatch();
    });
    
    
    prevButton.addEventListener('click', function() {
        if (currentMatches.length === 0) return;
        currentMatchIndex = (currentMatchIndex - 1 + currentMatches.length) % currentMatches.length;
        navigateToMatch();
    });
    
    
    function navigateToMatch() {
        if (currentMatchIndex < 0 || currentMatchIndex >= currentMatches.length) return;
        
        const highlights = document.querySelectorAll('.search-highlight');
        if (highlights.length > 0 && currentMatchIndex < highlights.length) {
            highlights.forEach(h => h.classList.remove('current'));
            highlights[currentMatchIndex].classList.add('current');
            highlights[currentMatchIndex].scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
        }
        
        updateNavigation();
    }
    
    
    searchNav.style.display = 'none';
});
</script>
    
            
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li>
      <ol>
        <li><a href="#接口说明">接口说明</a></li>
      </ol>
    </li>
    <li><a href="#仪器上接口标示和接口类型"><strong>仪器上接口标示和接口类型</strong></a></li>
    <li><a href="#仪器接口说明">仪器接口说明</a></li>
    <li><a href="#串口盒子配置">串口盒子配置</a></li>
    <li><a href="#数据格式"><strong>数据格式</strong></a></li>
    <li><a href="#项目通道号"><strong>项目通道号</strong></a></li>
    <li><a href="#修改记录">修改记录</a></li>
    <li><a href="#仪器接口程序">仪器接口程序</a>
      <ol>
        <li><a href="#监听配置">监听配置</a></li>
        <li><a href="#接口程序">接口程序</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/%E8%BF%AA%E5%B0%94dl96a-f10a9fd1ed/">
                
                    <img src="/img/title.jpg" loading="lazy" alt="Featured image of post 迪尔DL96A" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/2.%E4%BB%AA%E5%99%A8%E6%8E%A5%E5%8F%A3%E8%AE%B0%E5%BD%95/" >
                2.仪器接口记录
            </a>
        
            <a href="/categories/%E7%BB%BC%E5%90%88%E6%8E%A5%E5%8F%A3%E7%A8%8B%E5%BA%8F/" >
                综合接口程序
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E8%BF%AA%E5%B0%94dl96a-f10a9fd1ed/">迪尔DL96A</a>
        </h2>
    
        
    </div>

        
        <footer class="article-time">
            
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                    <time class="article-time--published">2025-09-03</time>
                </div>
            

            
            
                        最后更新于
                        <time class="article-time--updated" datetime="2025-09-03 23:20:57 &#43;0000 UTC" title="2025-09-03 23:20:57 &#43;0000 UTC">
                            2025-09-03 23:20:57
                        </time>
			
			
			
				<div>
					<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



					<time class="article-words">
						12980字
					</time>
				</div>
			
			

            
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                    <time class="article-time--reading">
                        阅读时长: 26 分钟
                    </time>
                </div>
            
        </footer>
    


    
</div>
</header>



    <section class="article-content">
    
    
    <h3 id="接口说明">接口说明
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">仪器厂商</th>
          <th style="text-align: left">迪尔<br /></th>
          <th style="text-align: left">仪器型号</th>
          <th style="text-align: left">DL96A<br /></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">通讯方式</td>
          <td style="text-align: left">双向</td>
          <td style="text-align: left">仪器类型</td>
          <td style="text-align: left">微生物</td>
      </tr>
      <tr>
          <td style="text-align: left">医院名称</td>
          <td style="text-align: left"><br /></td>
          <td style="text-align: left">程序名称</td>
          <td style="text-align: left">MI.MIFDL96A</td>
      </tr>
      <tr>
          <td style="text-align: left">终端服务器地址</td>
          <td style="text-align: left"></td>
          <td style="text-align: left">终端服务器端口号</td>
          <td></td>
      </tr>
  </tbody>
</table></div>
<h2 id="仪器上接口标示和接口类型"><strong>仪器上接口标示和接口类型</strong>
</h2><ol>
<li>接口类型：通过监听连接仪器</li>
<li>连接方式：数据库类型为mysql</li>
</ol>
<h2 id="仪器接口说明">仪器接口说明
</h2><ul>
<li>先通过<code>^LISTMPWSW</code>获取细菌，抗生素，专家规则数据，通过细菌通道为索引组装保存数据</li>
<li>保存细菌数据后未生成对应的报告和鉴定树导致专家规则无法保存，调用 <code>try{d ##class(IDP.WS.BLL.DHCIDPResult).GetReportIDPTreeJSONStream(ReportDR, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;)}catch{}</code>方法生成鉴定树，随后进行保存专家规则</li>
<li>通过sql插入标本信息达成双向</li>
</ul>
<h2 id="串口盒子配置">串口盒子配置
</h2><ul>
<li><strong>波特率：</strong> 9600</li>
<li><strong>数据位：8</strong></li>
<li><strong>停止位：</strong> 1</li>
<li><strong>校验位：</strong> N</li>
</ul>
<h2 id="数据格式"><strong>数据格式</strong>
</h2><h2 id="项目通道号"><strong>项目通道号</strong>
</h2><h2 id="修改记录">修改记录
</h2><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>序号</th>
          <th>日期</th>
          <th>操作人</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2025-01-25 18:32:16<br /></td>
          <td>杨浩然</td>
          <td><br /></td>
      </tr>
  </tbody>
</table></div>
<h2 id="仪器接口程序">仪器接口程序
</h2><h3 id="监听配置">监听配置
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/// [{&#34;MachID&#34;:&#34;#RowID&#34;,&#34;Type&#34;:&#34;DataBase&#34;,&#34;UpTime&#34;:&#34;3000&#34;,&#34;Address&#34;:&#34;DSN=DL96A&#34;,&#34;UpCDF&#34;:&#34;&#34;,&#34;UpREF&#34;:&#34;&#34;,&#34;DealProcess&#34;:&#34;MI.MIFDL96A&#34;,&#34;Para&#34;:&#34;SELECT * FROM lis_result  WHERE DATE(UpdateDate) = CURDATE()#ID#&#34;,&#34;PreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;,&#34;UPPreDealClass&#34;:&#34;PreDeal.DealDemoM,PreDeal&#34;}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="接口程序">接口程序
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">///</span> <span class="p">[{</span><span class="s2">&#34;MachID&#34;</span><span class="p">:</span><span class="s2">&#34;#RowID&#34;</span><span class="p">,</span><span class="s2">&#34;Type&#34;</span><span class="p">:</span><span class="s2">&#34;DataBase&#34;</span><span class="p">,</span><span class="s2">&#34;UpTime&#34;</span><span class="p">:</span><span class="s2">&#34;3000&#34;</span><span class="p">,</span><span class="s2">&#34;Address&#34;</span><span class="p">:</span><span class="s2">&#34;DSN=DL96A&#34;</span><span class="p">,</span><span class="s2">&#34;UpCDF&#34;</span><span class="p">:</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="s2">&#34;UpREF&#34;</span><span class="p">:</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="s2">&#34;DealProcess&#34;</span><span class="p">:</span><span class="s2">&#34;MI.MIFDL96A&#34;</span><span class="p">,</span><span class="s2">&#34;Para&#34;</span><span class="p">:</span><span class="s2">&#34;SELECT * FROM lis_result  WHERE DATE(UpdateDate) = CURDATE()#ID#&#34;</span><span class="p">,</span><span class="s2">&#34;PreDealClass&#34;</span><span class="p">:</span><span class="s2">&#34;PreDeal.DealDemoM,PreDeal&#34;</span><span class="p">,</span><span class="s2">&#34;UPPreDealClass&#34;</span><span class="p">:</span><span class="s2">&#34;PreDeal.DealDemoM,PreDeal&#34;</span><span class="p">}]</span>
</span></span><span class="line"><span class="cl"><span class="n">Class</span> <span class="n">MI</span><span class="o">.</span><span class="n">MIFDL96A</span> <span class="n">Extends</span> <span class="o">%</span><span class="n">RegisteredObject</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">D</span> <span class="c1">##class(MI.MIFDL96E02).fileMTHD(&#34;22&#34;,&#34;4185~33122416~~~□肺炎链球菌(S.pneumoniae)□G+球菌□□[spn]□(优势菌2)~~~~~A;PEN;;＝8;耐药;;B;CLI;;≥8;耐药;;A;SXT;;≥8/152;耐药;;B;CRO;;＝1;敏感;;A;ERY;;≥16;耐药;;B;VA;;≤1;敏感;;B;LEV;;＝2;敏感;;B;TET;;＝32;耐药;;B;MRP;;≤0.25;敏感;;C;CXM;;≥4;耐药;;C;RIF;;≤0.5;敏感;;C;AMC;;≤1.0/0.5;敏感;;C;LNZ;;≤2;敏感;;~~~~~对左氧氟沙星敏感的菌株可预报其对吉米沙星和莫西沙星敏感。[13][10]对四环素敏感的菌株对多西环素和米诺环素也敏感。[13][10]利福平不单独用于抗菌治疗。[13][10]红霉素可预报阿奇霉素、克拉霉素和地红霉素的敏感和耐药性。[13][10]~~~~普通细菌培养+药敏~2020-12-25□8:33:23~2020-12-27□8:33:23~1~&#34;,&#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">d</span> <span class="c1">##class(MI.MIFDL96AN).fileMTHD(&#34;56&#34;,$g(^YHR(&#34;WSWQC&#34;)))</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">fileMTHD</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">epis</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">,</span> <span class="n">P5</span><span class="p">,</span> <span class="n">P6</span><span class="p">,</span> <span class="n">P7</span><span class="p">,</span> <span class="n">P8</span><span class="p">,</span> <span class="n">P9</span><span class="p">,</span> <span class="n">P10</span><span class="p">,</span> <span class="n">P11</span><span class="p">,</span> <span class="n">P12</span><span class="p">,</span> <span class="n">P13</span><span class="p">,</span> <span class="n">Sessions</span><span class="p">,</span> <span class="n">Output</span> <span class="n">RowCount</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">mi</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(record) q &#34;&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">ItemDeli</span><span class="o">=$</span><span class="n">c</span><span class="p">(</span><span class="mi">92</span><span class="p">)</span> <span class="o">//</span><span class="err">项目分隔符</span><span class="mi">92</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">ResultDeli</span><span class="o">=$</span><span class="n">c</span><span class="p">(</span><span class="mi">44</span><span class="p">)</span> <span class="o">//</span><span class="err">结果分隔符</span><span class="mi">44</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">AntDeli</span><span class="o">=</span><span class="s2">&#34;]&#34;</span> <span class="o">//</span><span class="err">抗生素分隔符</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">SenDeli</span><span class="o">=</span><span class="s2">&#34;[&#34;</span> <span class="o">//</span><span class="err">药敏结果分隔符</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">d</span> <span class="n">Trace</span><span class="o">^</span><span class="n">MI</span><span class="o">.</span><span class="n">MIF000</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">record</span><span class="p">,</span><span class="s2">&#34;record&lt;--M&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">///</span> <span class="mi">54724</span><span class="o">~</span><span class="mi">52772</span><span class="o">~~~~</span><span class="err">□肺炎链球菌</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">pneumoniae</span><span class="p">)</span><span class="err">□</span><span class="n">G</span><span class="o">+</span><span class="err">球菌□□</span><span class="p">[</span><span class="n">spn</span><span class="p">]</span><span class="err">□</span><span class="p">(</span><span class="err">弱势菌</span><span class="p">)</span><span class="o">~~~~~</span><span class="n">A</span><span class="p">;</span><span class="n">PEN</span><span class="p">;;</span><span class="err">≥</span><span class="mi">32</span><span class="p">;</span><span class="err">耐药</span><span class="p">;;</span><span class="n">B</span><span class="p">;</span><span class="n">CLI</span><span class="p">;;</span><span class="err">≥</span><span class="mi">8</span><span class="p">;</span><span class="err">耐药</span><span class="p">;;</span><span class="n">A</span><span class="p">;</span><span class="n">SXT</span><span class="p">;;</span><span class="err">≥</span><span class="mi">8</span><span class="o">/</span><span class="mi">152</span><span class="p">;</span><span class="err">耐药</span><span class="p">;;</span><span class="n">B</span><span class="p">;</span><span class="n">CRO</span><span class="p">;;</span><span class="err">＝</span><span class="mi">1</span><span class="p">;</span><span class="err">敏感</span><span class="p">;;</span><span class="n">A</span><span class="p">;</span><span class="n">ERY</span><span class="p">;;</span><span class="err">≥</span><span class="mi">16</span><span class="p">;</span><span class="err">耐药</span><span class="p">;;</span><span class="n">B</span><span class="p">;</span><span class="n">VA</span><span class="p">;;</span><span class="err">≤</span><span class="mi">1</span><span class="p">;</span><span class="err">敏感</span><span class="p">;;</span><span class="n">B</span><span class="p">;</span><span class="n">LEV</span><span class="p">;;</span><span class="err">＝</span><span class="mi">2</span><span class="p">;</span><span class="err">敏感</span><span class="p">;;</span><span class="n">B</span><span class="p">;</span><span class="n">TET</span><span class="p">;;</span><span class="err">＝</span><span class="mi">32</span><span class="p">;</span><span class="err">耐药</span><span class="p">;;</span><span class="n">B</span><span class="p">;</span><span class="n">MRP</span><span class="p">;;</span><span class="err">≤</span><span class="mf">0.25</span><span class="p">;</span><span class="err">敏感</span><span class="p">;;</span><span class="n">C</span><span class="p">;</span><span class="n">CXM</span><span class="p">;;</span><span class="err">≥</span><span class="mi">4</span><span class="p">;</span><span class="err">耐药</span><span class="p">;;</span><span class="n">C</span><span class="p">;</span><span class="n">RIF</span><span class="p">;;</span><span class="err">≤</span><span class="mf">0.5</span><span class="p">;</span><span class="err">敏感</span><span class="p">;;</span><span class="n">C</span><span class="p">;</span><span class="n">AMC</span><span class="p">;;</span><span class="err">＝</span><span class="mi">2</span><span class="o">/</span><span class="mi">1</span><span class="p">;</span><span class="err">敏感</span><span class="p">;;</span><span class="n">C</span><span class="p">;</span><span class="n">LNZ</span><span class="p">;;</span><span class="err">≤</span><span class="mi">2</span><span class="p">;</span><span class="err">敏感</span><span class="p">;;</span><span class="o">~~~~~</span><span class="err">对左氧氟沙星敏感的菌株可预报其对吉米沙星和莫西沙星敏感。</span><span class="p">[</span><span class="mi">13</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span><span class="err">红霉素可预报阿奇霉素、克拉霉素和地红霉素的敏感和耐药性。</span><span class="p">[</span><span class="mi">13</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span><span class="err">利福平不单独用于抗菌治疗。</span><span class="p">[</span><span class="mi">13</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span><span class="err">对四环素敏感的菌株对多西环素和米诺环素也敏感。</span><span class="p">[</span><span class="mi">13</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span><span class="o">~~~</span><span class="err">普通细菌培养</span><span class="o">+</span><span class="err">药敏</span><span class="o">~</span><span class="mi">2019</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">10</span><span class="err">□</span><span class="mi">8</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">15</span><span class="o">~</span><span class="mi">2019</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">13</span><span class="err">□</span><span class="mi">8</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">15</span><span class="o">~</span><span class="mi">0</span><span class="o">~</span><span class="mi">1</span><span class="o">~</span>
</span></span><span class="line"><span class="cl">    <span class="o">///</span> <span class="s2">&#34;35~182~25010700606~I-180,2N10155711,*□|I-179,2E10532605,*□|~I-180,2N10155711,*□|I-179,2E10532605,*□|~~□,I-180,2N10155711,铜绿假单胞菌(Pseudomonas□aeruginosa),pae,-,0,□|□,I-179,2E10532605,肺炎克雷伯菌(Klebsiella□pneumoniae),kpn,-,0,□|~~I-180,2N10155711,DL-120□NE2,pae,FEP,&lt;=2μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-180,2N10155711,DL-120□NE2,pae,CAZ,&lt;=2μg/mL,A,S,≤8&amp;16&amp;≥32,Y|I-180,2N10155711,DL-120□NE2,pae,GEN,&lt;=2μg/mL,A,S,≤4&amp;8&amp;≥16,Y|I-180,2N10155711,DL-120□NE2,pae,TOB,&lt;=1μg/mL,A,S,≤4&amp;8&amp;≥16,Y|I-180,2N10155711,DL-120□NE2,pae,AMK,&lt;=4μg/mL,INV,□,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,PIP,&lt;=4μg/mL,O,S,≤16&amp;32&amp;≥64,Y|I-180,2N10155711,DL-120□NE2,pae,IPM,&lt;=1μg/mL,B,S,≤2&amp;4&amp;≥8,Y|I-180,2N10155711,DL-120□NE2,pae,TZP,&lt;=4/4μg/mL,A,S,≤16/4&amp;32/4&amp;≥64/4,Y|I-180,2N10155711,DL-120□NE2,pae,MEM,&lt;=1μg/mL,B,S,≤2&amp;4&amp;≥8,Y|I-180,2N10155711,DL-120□NE2,pae,SAM,&gt;=64/32μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,CSL,&lt;=8/4μg/mL,O,S,≤16/8&amp;32/16&amp;≥64/32,Y|I-180,2N10155711,DL-120□NE2,pae,ATM,=4μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-180,2N10155711,DL-120□NE2,pae,LVX,&lt;=1μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-180,2N10155711,DL-120□NE2,pae,TCC,=16/2μg/mL,O,S,≤16/2&amp;32/2-64/2&amp;≥128/2,Y|I-180,2N10155711,DL-120□NE2,pae,SXT,&lt;=1/19μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,NOR,&lt;=4μg/mL,INV,□,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,MNO,&gt;=32μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,TGC,=16μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,CIP,&lt;=0.5μg/mL,B,S,≤0.5&amp;1&amp;≥2,Y|I-180,2N10155711,DL-120□NE2,pae,POL,=1μg/mL,O,I,□&amp;≤2&amp;≥4,Y|I-180,2N10155711,DL-120□NE2,pae,DOX,&gt;=16μg/mL,INV,R,□&amp;□&amp;□,Y|I-180,2N10155711,DL-120□NE2,pae,CHL,&gt;=32μg/mL,INV,R,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,AMP,&gt;=32μg/mL,A,R,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,GEN,&lt;=1μg/mL,A,S,≤4&amp;8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,SAM,&lt;=8/4μg/mL,B,S,≤8/4&amp;16/8&amp;≥32/16,Y|I-179,2E10532605,DL-120□E2,kpn,TZP,&lt;=4/4μg/mL,B,S,≤16/4&amp;32/4-64/4&amp;≥128/4,Y|I-179,2E10532605,DL-120□E2,kpn,CSL,&lt;=8/4μg/mL,O,S,≤16/8&amp;32/16&amp;≥64/32,Y|I-179,2E10532605,DL-120□E2,kpn,CCV,&lt;=1/4μg/mL,INV,□,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,CTC,&lt;=1/4μg/mL,INV,□,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,CZO,=8μg/mL,A,R,≤2&amp;4&amp;≥8,Y|I-179,2E10532605,DL-120□E2,kpn,FEP,&lt;=0.12μg/mL,B,S,≤2&amp;4-8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,FOX,&lt;=8μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,CXM(Iv),&lt;=4μg/mL,B,S,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,CXM(Oral),&lt;=4μg/mL,B,S,≤4&amp;8-16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,LVX,&lt;=0.12μg/mL,B,S,≤0.5&amp;1&amp;≥2,Y|I-179,2E10532605,DL-120□E2,kpn,SXT,&lt;=0.5/9.5μg/mL,B,S,≤2/38&amp;□&amp;≥4/76,Y|I-179,2E10532605,DL-120□E2,kpn,CTX,&lt;=0.12μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,IPM,&lt;=0.25μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,CAZ,&lt;=0.5μg/mL,C,S,≤4&amp;8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,CHL,&lt;=8μg/mL,C,S,≤8&amp;16&amp;≥32,Y|I-179,2E10532605,DL-120□E2,kpn,MEM,&lt;=0.06μg/mL,B,S,≤1&amp;2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,AMK,&lt;=4μg/mL,B,S,≤16&amp;32&amp;≥64,Y|I-179,2E10532605,DL-120□E2,kpn,NIT,&lt;=16μg/mL,INV,□,□&amp;□&amp;□,Y|I-179,2E10532605,DL-120□E2,kpn,ETP,&lt;=0.015μg/mL,B,S,≤0.5&amp;1&amp;≥2,Y|I-179,2E10532605,DL-120□E2,kpn,MNO,&lt;=1μg/mL,O,S,≤4&amp;8&amp;≥16,Y|I-179,2E10532605,DL-120□E2,kpn,TGC,&lt;=0.25μg/mL,INV,S,≤1&amp;2&amp;&gt;2,Y|I-179,2E10532605,DL-120□E2,kpn,POL,&lt;=1μg/mL,O,I,□&amp;≤2&amp;≥4,Y|I-179,2E10532605,DL-120□E2,kpn,AZM,&lt;=8μg/mL,INV,R,□&amp;□&amp;□,Y|~I-180,2N10155711,□|I-179,2E10532605,□|~I-180,2N10155711*多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*长期使用各种抗生素治疗，铜绿假单胞菌会变得耐药。初期敏感的菌株在治疗3-4天内变为耐药，因此，测试重复分离株是必要的。*哌拉西林（单药或联合他唑巴坦）的折点基于哌拉西林（单药或联合他唑巴坦）至少3g□q6h给药方案。*亚胺培南的折点基于1g□q8h或500mg□q6h的给药方案。*左氧氟沙星的折点基于750mg□qd的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*长期使用各种抗生素治疗，铜绿假单胞菌会变得耐药。初期敏感的菌株在治疗3-4天内变为耐药，因此，测试重复分离株是必要的。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。*多黏菌素B应给予负荷剂量和最大推荐剂量。*头孢吡肟的折点基于1g□q8h或2g□q12h的给药方案。*头孢他啶的折点基于1g□q6h或2g□q8h的给药方案。*环丙沙星的折点基于静脉注射400mg□q8h给药方案。*氨曲南的折点基于1g□q6h或2g□q8h的给药方案。*替卡西林/克拉维酸的折点基于至少3g□□q6h给药方案。*此报告采用的折点标准来源为CLSIM100□2024，其中头孢哌酮/舒巴坦为CHINET技术要求□2022，妥布霉素、庆大霉素为CLSIM100□2022。|I-179,2E10532605*仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。*亚胺培南的折点基于500mg□q6h或1g□q8h的给药方案。*多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*氨苄西林的结果可用于预报阿莫西林的敏感性。*厄他培南的折点基于1g□qd的给药方案。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。*头孢西丁的折点基于至少8g□qd的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*头孢呋辛（注射）的折点基于1.5g□q8h的给药方案。*环丙沙星折点基于静脉注射400mg□q12h或口服500mg□q12h给药方案。*多黏菌素B应给予负荷剂量和最大推荐剂量。*头孢噻肟的折点基于1g□q8h的给药方案。*治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g□q8h的给药方案。*头孢吡肟的敏感折点基于1g□q12h的给药方案。*此报告采用的折点标准来源为CLSIM100□2024，其中哌拉西林/他唑巴坦为CLSIM100□2021，头孢哌酮/舒巴坦为CHINET技术要求□2022，替加环素为EUCAST□2018，阿米卡星、庆大霉素为CLSIM100□2022。|~~~~~I-180,2N10155711,2025-01-12□15:55:48|I-179,2E10532605,2025-01-12□16:00:48|~~~1~2025-01-12□16:25:01~□~□,I-180,2N10155711,铜绿假单胞菌(Pseudomonas□aeruginosa),pae,G-杆菌,0,□|□,I-179,2E10532605,肺炎克雷伯菌(Klebsiella□pneumoniae),kpn,G-杆菌,0,□|~I-180,2N10155711,□|I-179,2E10532605,□|~I-180,2N10155711*[SAM&amp;TGC&amp;MNO&amp;SXT&amp;CHL&amp;DOX]*[]*[]|I-179,2E10532605*[AMP&amp;AZM]*[]*[]|~~~~&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="p">(</span><span class="n">sample</span><span class="p">,</span><span class="n">epis</span><span class="p">,</span><span class="n">surname</span><span class="p">,</span><span class="n">rec</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">fresult</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">QC</span><span class="p">,</span><span class="n">xBugs</span><span class="p">,</span><span class="n">AntLIST</span><span class="p">,</span><span class="n">expertRules</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="n">k</span> <span class="o">^</span><span class="n">LISTMPWSW</span> 
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="o">///</span> <span class="err">获取流水号</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">epis</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="n">record</span><span class="p">,</span><span class="s2">&#34;~&#34;</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span><span class="p">:</span><span class="s1">&#39;$l(epis) &#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">curDate</span><span class="o">=$</span><span class="n">zd</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">///</span> <span class="err">获取细菌</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">xBugsData</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">record</span><span class="p">,</span><span class="s2">&#34;~&#34;</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">xBugsData</span><span class="p">,</span><span class="s2">&#34;|&#34;</span><span class="p">)</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">xBugsDatai</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">xBugsData</span><span class="p">,</span><span class="s2">&#34;|&#34;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(xBugsDatai) q</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">xBugs</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">xBugsDatai</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="n">xBugs</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">q</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">code</span><span class="o">=</span><span class="n">i</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="o">^</span><span class="n">LISTMPWSW</span><span class="p">(</span><span class="s2">&#34;xBugs&#34;</span><span class="p">,</span><span class="n">xBugs</span><span class="p">)</span><span class="o">=</span><span class="n">code</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="o">^</span><span class="n">LISTMPWSW</span><span class="p">(</span><span class="s2">&#34;xBugsNum&#34;</span><span class="p">,</span><span class="n">code</span><span class="p">)</span><span class="o">=</span><span class="n">xBugs</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="o">///</span> <span class="err">获取药敏</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">antStrData</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">record</span><span class="p">,</span><span class="s2">&#34;~&#34;</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">antStrData</span><span class="p">,</span><span class="s2">&#34;|&#34;</span><span class="p">)</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">antStrDatai</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">antStrData</span><span class="p">,</span><span class="s2">&#34;|&#34;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(antStrDatai) q</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">xBugs</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">antStrDatai</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(xBugs) q</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="o">^</span><span class="n">LISTMPWSW</span><span class="p">(</span><span class="s2">&#34;antStr&#34;</span><span class="p">,</span><span class="n">xBugs</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">antStrDatai</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="o">///</span> <span class="err">获取专家规则</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">expertRulesData</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">record</span><span class="p">,</span><span class="s2">&#34;~&#34;</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">expertRulesData</span><span class="p">,</span><span class="s2">&#34;|&#34;</span><span class="p">)</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">expertRulesDatai</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">expertRulesData</span><span class="p">,</span><span class="s2">&#34;|&#34;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(expertRulesDatai) q</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">xBugs</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">LISTMPWSW</span><span class="p">(</span><span class="s2">&#34;xBugsNum&#34;</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(xBugs) q</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">expertRules</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">expertRulesDatai</span><span class="p">,</span><span class="s2">&#34;*&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="o">^</span><span class="n">LISTMPWSW</span><span class="p">(</span><span class="s2">&#34;expertRules&#34;</span><span class="p">,</span><span class="n">xBugs</span><span class="p">)</span><span class="o">=</span><span class="n">expertRules</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">xBugs</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">f</span>  <span class="n">s</span> <span class="n">xBugs</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">LISTMPWSW</span><span class="p">(</span><span class="s2">&#34;xBugs&#34;</span><span class="p">,</span><span class="n">xBugs</span><span class="p">))</span> <span class="n">q</span><span class="p">:</span><span class="n">xBugs</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">code</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">LISTMPWSW</span><span class="p">(</span><span class="s2">&#34;xBugs&#34;</span><span class="p">,</span><span class="n">xBugs</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="p">(</span><span class="n">AntLIST</span><span class="p">,</span><span class="n">fresult</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">QC</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">antStr</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">f</span>  <span class="n">s</span> <span class="n">antStr</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">LISTMPWSW</span><span class="p">(</span><span class="s2">&#34;antStr&#34;</span><span class="p">,</span><span class="n">xBugs</span><span class="p">,</span><span class="n">antStr</span><span class="p">))</span> <span class="n">q</span><span class="p">:</span><span class="n">antStr</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">s</span> <span class="n">antList</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">LISTMPWSW</span><span class="p">(</span><span class="s2">&#34;antStr&#34;</span><span class="p">,</span><span class="n">xBugs</span><span class="p">,</span><span class="n">antStr</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">s</span> <span class="n">AntGroup</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">antList</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>  						<span class="o">//</span><span class="err">抗生素分组</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">s</span> <span class="n">xANT</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="n">antList</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="s2">&#34; &#34;</span><span class="p">)</span> <span class="n">q</span><span class="p">:</span><span class="n">xANT</span><span class="o">=</span><span class="s2">&#34;&#34;</span> 		<span class="o">//</span><span class="err">抗生素</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">s</span> <span class="n">xMIC</span><span class="o">=$</span><span class="n">replace</span><span class="p">(</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="n">antList</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="s2">&#34;μg/mL&#34;</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">)</span> 			<span class="o">//</span><span class="n">MIC</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">s</span> <span class="n">xRES</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="n">antList</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="s2">&#34; &#34;</span><span class="p">)</span> 					<span class="o">//</span><span class="err">耐药</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">s</span> <span class="n">AntLIST</span><span class="o">=</span><span class="n">AntLIST_xANT_AntDeli_xRES_AntDeli_xMIC_AntDeli_AntDeli_AntGroup_SenDeli</span> 
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">d</span> <span class="n">Trace</span><span class="o">^</span><span class="n">MI</span><span class="o">.</span><span class="n">MIF000</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">AntLIST</span><span class="p">,</span><span class="s2">&#34;AntLIST&lt;--M&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">xBugs</span><span class="p">),</span><span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">epis</span><span class="p">),</span><span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AntLIST</span><span class="p">)</span> <span class="n">d</span> 
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">s</span> <span class="n">fresult</span><span class="o">=</span><span class="n">xBugs_ItemDeli_AntLIST_ItemDeli_code_ResultDeli</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">d</span> <span class="n">Trace</span><span class="o">^</span><span class="n">MI</span><span class="o">.</span><span class="n">MIF000</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">epis_</span><span class="s2">&#34;$$&#34;</span><span class="n">_fresult</span><span class="p">,</span><span class="s2">&#34;fresult&lt;--M&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">fresult</span><span class="p">)</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">d</span> <span class="n">Save</span><span class="o">^</span><span class="n">MI</span><span class="o">.</span><span class="n">MIF000</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">epis</span><span class="p">,</span><span class="n">code_ItemDeli_xBugs_ItemDeli_ItemDeli_ItemDeli_ResultDeli</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">QC</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">d</span> <span class="n">SaveAnt</span><span class="o">^</span><span class="n">MI</span><span class="o">.</span><span class="n">MIF000</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">epis</span><span class="p">,</span><span class="n">fresult</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">QC</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">expertRules</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">LISTMPWSW</span><span class="p">(</span><span class="s2">&#34;expertRules&#34;</span><span class="p">,</span><span class="n">xBugs</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">ret</span><span class="o">=..</span><span class="n">SaveZJGZ</span><span class="p">(</span><span class="n">epis</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">expertRules</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">d</span> <span class="n">Trace</span><span class="o">^</span><span class="n">MI</span><span class="o">.</span><span class="n">MIF000</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">ret</span><span class="p">,</span><span class="s2">&#34;专家规则保存ret&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">k</span> <span class="o">^</span><span class="n">LISTMPWSW</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="n">q</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">GerTestCodeDR</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">mi</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">mi</span><span class="p">),</span><span class="n">code</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="s1">&#39;$l(mi) q ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="s1">&#39;$l(code) q ret</span>
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTMIMachineTestCodeI</span><span class="p">(</span><span class="s2">&#34;IndexResultChannel&#34;</span><span class="p">,</span><span class="n">mi</span><span class="p">,</span><span class="n">code</span><span class="p">))</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">BTMIMachineTestCodeDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTMIMachineTestCodeI</span><span class="p">(</span><span class="s2">&#34;IndexResultChannel&#34;</span><span class="p">,</span><span class="n">mi</span><span class="p">,</span><span class="n">code</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">TestCodeDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTMIMachineTestCodeD</span><span class="p">(</span><span class="n">BTMIMachineTestCodeDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="n">TestCodeDR</span>
</span></span><span class="line"><span class="cl">	<span class="n">q</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##class(MI.MIFDL96A2).SaveZJGZ(&#34;6633&#34;,&#34;40&#34;,1,&#34;多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*头孢噻肟的折点基于1g□q8h的给药方案。*亚胺培南的折点基于500mg□q6h或1g□q8h的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*头孢唑啉的结果可预报非复杂性的泌尿系统感染的大肠埃希菌对口服头孢拉定、头孢地尼、头孢克罗、头孢丙烯、头孢泊肟、头孢呋辛的敏感性。*头孢西丁的折点基于至少8g□qd的给药方案。*仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。*氨苄西林的结果可用于预报阿莫西林的敏感性。*环丙沙星折点基于静脉注射400mg□q12h或口服500mg□q12h给药方案。*头孢吡肟的敏感折点基于1g□q12h的给药方案。*头孢呋辛（注射）的折点基于1.5g□q8h的给药方案。*治疗非复杂泌尿道感染的头孢唑林折点是基于1g□q12h的给药方案。*治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g□q8h的给药方案。*多黏菌素B应给予负荷剂量和最大推荐剂量。*厄他培南的折点基于1g□qd的给药方案。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##class(MI.MIFDL96A).SaveZJGZ(&#34;24120600395&#34;,&#34;56&#34;,1,&#34;QNR-ECO：喹诺酮类耐药的大肠埃希菌。*MDR：多重耐药菌株。*产ESBL株：产超广谱β-内酰胺酶菌株。*CTX-CRO-R-ECO：头孢噻肟或头孢曲松耐药的大肠埃希菌。*头孢呋辛（注射）的折点基于1.5g□q8h的给药方案。*仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。*厄他培南的折点基于1g□qd的给药方案。*治疗非复杂泌尿道感染的头孢唑林折点是基于1g□q12h的给药方案。*多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。*头孢唑啉的结果可预报非复杂性的泌尿系统感染的大肠埃希菌对口服头孢拉定、头孢地尼、头孢克罗、头孢丙烯、头孢泊肟、头孢呋辛的敏感性。*头孢西丁的折点基于至少8g□qd的给药方案。*美罗培南的折点基于1g□q8h的给药方案。*环丙沙星折点基于静脉注射400mg□q12h或口服500mg□q12h给药方案。*对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。*头孢噻肟的折点基于1g□q8h的给药方案。*亚胺培南的折点基于500mg□q6h或1g□q8h的给药方案。*氨苄西林的结果可用于预报阿莫西林的敏感性。*治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g□q8h的给药方案。*多黏菌素B应给予负荷剂量和最大推荐剂量。*此报告采用的折点标准来源为CLSIM100□2024，其中替加环素为EUCAST□2018，头孢哌酮/舒巴坦为CHINET技术要求□2022，哌拉西林/他唑巴坦为CLSIM100□2021，阿米卡星、庆大霉素为CLSIM100□2022。&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##class(MI.MIFDL96A).SaveZJGZ(&#34;WX250104003&#34;,&#34;56&#34;,1,&#34;1、MDR：多重耐药菌株。 2、QNR-ECO：喹诺酮类耐药的大肠埃希菌。 3、产ESBL株：产超广谱β-内酰胺酶菌株。 4、CTX-CRO-R-ECO：头孢噻肟或头孢曲松耐药的大肠埃希菌。 5、治疗非复杂泌尿道感染的头孢唑林折点是基于1g q12h的给药方案。 6、仅肠沙门菌伤寒血清型和志贺菌属具有阿奇霉素的临床推荐折点。 7、亚胺培南的折点基于500mg q6h或1g q8h的给药方案。 8、多黏菌素B应与一种或多种活性抗生素联合使用，建议咨询感染诊治专家。 9、氨苄西林的结果可用于预报阿莫西林的敏感性。 10、头孢唑啉的结果可预报非复杂性的泌尿系统感染的大肠埃希菌对口服头孢拉定、头孢地尼、头孢克罗、头孢丙烯、头孢泊肟、头孢呋辛的敏感性。 11、厄他培南的折点基于1g qd的给药方案。 12、对于肺炎即使黏菌素或多黏菌素B全身给药，亦很可能无效。 13、头孢西丁的折点基于至少8g qd的给药方案。 14、美罗培南的折点基于1g q8h的给药方案。 15、头孢呋辛（注射）的折点基于1.5g q8h的给药方案。 16、环丙沙星折点基于静脉注射400mg q12h或口服500mg q12h给药方案。 17、多黏菌素B应给予负荷剂量和最大推荐剂量。 18、头孢噻肟的折点基于1g q8h的给药方案。 19、治疗非复杂泌尿道以外感染的头孢唑林折点是基于2g q8h的给药方案。 20、此报告采用的折点标准来源为CLSIM100 2024，其中哌拉西林/他唑巴坦为CLSIM100 2021，头孢哌酮/舒巴坦为CHINET技术要求 2022，替加环素为EUCAST 2018，阿米卡星、庆大霉素为CLSIM100 2022。&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">SaveZJGZ</span><span class="p">(</span><span class="n">epis</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">ExpertRules</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">epis</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">epis</span><span class="p">),</span><span class="n">mi</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">mi</span><span class="p">),</span><span class="n">ExpertRules</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">ExpertRules</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">episData</span><span class="o">=$$</span><span class="n">GetEpisByLabno</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">epis</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">epis</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">episData</span><span class="p">,</span><span class="s2">&#34;^&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">WGM</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">episData</span><span class="p">,</span><span class="s2">&#34;^&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">ReportDR</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">episData</span><span class="p">,</span><span class="s2">&#34;^&#34;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">TestCodeDR</span><span class="o">=..</span><span class="n">GerTestCodeDR</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">ReportDR</span><span class="p">)</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">IDPResultDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">IDPResultI</span><span class="p">(</span><span class="s2">&#34;IndexIDPElement&#34;</span><span class="p">,</span><span class="n">ReportDR</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$d(^dbo.RPVisitNumberTestSetI(&#34;IndexReportID&#34;,ReportDR)) q</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">i</span> <span class="s1">&#39;$l(TestCodeDR) q</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">try</span><span class="p">{</span><span class="n">d</span> <span class="c1">##class(IDP.WS.BLL.DHCIDPResult).GetReportIDPTreeJSONStream(ReportDR, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;)}catch{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="s1">&#39;$l(mi) q 0</span>
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="s1">&#39;$l(epis) d Trace^MI.MIF000(mi,&#34;流水号不能为空&#34;,&#34;保存检测结论返回&#34;)  q 0</span>
</span></span><span class="line"><span class="cl">	<span class="o">//</span><span class="err">报告可能核收到微生物培养的四个小组</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">sc</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">transmitDate</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">f</span>  <span class="n">s</span> <span class="n">transmitDate</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexMicNo&#34;</span><span class="p">,</span><span class="n">WGM</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="n">_epis</span><span class="p">,</span><span class="n">transmitDate</span><span class="p">))</span> <span class="n">q</span><span class="p">:</span><span class="n">transmitDate</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">ReportDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">f</span>  <span class="n">s</span> <span class="n">ReportDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexMicNo&#34;</span><span class="p">,</span><span class="n">WGM</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="n">_epis</span><span class="p">,</span><span class="n">transmitDate</span><span class="p">,</span><span class="n">ReportDR</span><span class="p">))</span> <span class="n">q</span><span class="p">:</span><span class="n">ReportDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="n">d</span> 
</span></span><span class="line"><span class="cl">	<span class="o">..//</span><span class="n">IndexReportItem</span> <span class="n">On</span> <span class="p">(</span><span class="n">VisitNumberReportDR</span><span class="p">,</span> <span class="n">TestCodeDR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">i</span> <span class="s1">&#39;$d(^dbo.RPVisitNumberReportResultI(&#34;IndexReportItem&#34;,ReportDR,TestCodeDR)) q</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">s</span> <span class="n">ResultDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportResultI</span><span class="p">(</span><span class="s2">&#34;IndexReportItem&#34;</span><span class="p">,</span><span class="n">ReportDR</span><span class="p">,</span><span class="n">TestCodeDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">s</span> <span class="n">objRep</span><span class="o">=</span><span class="c1">##Class(dbo.RPVisitNumberReportResult).%OpenId(ResultDR)</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">s</span> <span class="n">EXPRlues</span><span class="o">=</span><span class="n">objRep</span><span class="o">.</span><span class="n">ExpertRule</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">i</span> <span class="n">EXPRlues</span><span class="o">=</span><span class="n">ExpertRules</span> <span class="n">q</span>  <span class="o">//</span><span class="err">专家规则不再变化，不存</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">s</span> <span class="n">objRep</span><span class="o">.</span><span class="n">ExpertRule</span><span class="o">=</span><span class="n">ExpertRules</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">s</span> <span class="n">sc</span><span class="o">=</span><span class="n">objRep</span><span class="o">.%</span><span class="n">Save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">i</span> <span class="p">(</span><span class="s1">&#39;$SYSTEM.Status.IsOK(sc)) d Trace^MI.MIF000(mi,&#34;保存检测结论失败&#34;,&#34;保存检测结论失败返回&#34;) q</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">d</span> <span class="n">Trace</span><span class="o">^</span><span class="n">MI</span><span class="o">.</span><span class="n">MIF000</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">ExpertRules</span><span class="p">,</span><span class="s2">&#34;保存检测结论成功返回&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">q</span> <span class="n">sc</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">GetEpisByLabno</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">Epis</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">//</span><span class="err">通过检验号获取流水号</span>
</span></span><span class="line"><span class="cl">	<span class="p">;</span><span class="n">Index</span> <span class="n">IndexVisitNumber</span> <span class="n">On</span> <span class="n">VisitNumber</span> <span class="p">[</span> <span class="n">SqlName</span> <span class="o">=</span> <span class="n">Index_VisitNumber</span><span class="p">,</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span> <span class="n">Unique</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="p">;</span><span class="n">Index</span> <span class="n">IndexReportID</span> <span class="n">On</span> <span class="p">(</span><span class="n">VisitNumberDR</span><span class="p">,</span> <span class="n">WorkGroupMachineDR</span><span class="p">,</span> <span class="n">OrderNo</span><span class="p">)</span> <span class="p">[</span> <span class="n">SqlName</span> <span class="o">=</span> <span class="n">Index_ReportID</span><span class="p">,</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">index</span><span class="p">,</span> <span class="n">Unique</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="n">mi</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">mi</span><span class="p">),</span><span class="n">Epis</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">Epis</span><span class="p">),</span><span class="n">ReportDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="s1">&#39;$l(mi) q Epis</span>
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="s1">&#39;$l(Epis) q Epis</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">WGMachineID</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTMIMachineParameterD</span><span class="p">(</span><span class="n">mi</span><span class="p">)),</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="n">Epis</span><span class="p">))</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">s</span> <span class="n">VisitnumberDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="n">Epis</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexReportID&#34;</span><span class="p">,</span><span class="n">VisitnumberDR</span><span class="p">))</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">s</span> <span class="n">WGMachineID</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexReportID&#34;</span><span class="p">,</span><span class="n">VisitnumberDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="o">.</span><span class="n">i</span> <span class="o">$</span><span class="n">d</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexReportID&#34;</span><span class="p">,</span><span class="n">VisitnumberDR</span><span class="p">,</span><span class="n">WGMachineID</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">s</span> <span class="n">ReportDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexReportID&#34;</span><span class="p">,</span><span class="n">VisitnumberDR</span><span class="p">,</span><span class="n">WGMachineID</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">s</span> <span class="n">ret</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportD</span><span class="p">(</span><span class="n">ReportDR</span><span class="p">)),</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="n">q</span> <span class="n">ret_</span><span class="s2">&#34;^&#34;</span><span class="n">_WGMachineID_</span><span class="s2">&#34;^&#34;</span><span class="n">_ReportDR</span>
</span></span><span class="line"><span class="cl">	<span class="n">i</span> <span class="s1">&#39;$d(^dbo.RPVisitNumberReportI(&#34;IndexMicNoNew&#34;,Epis)) q ret_&#34;^&#34;_WGMachineID_&#34;^&#34;_ReportDR</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">WGMachineID</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexMicNoNew&#34;</span><span class="p">,</span><span class="n">Epis</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">TransmitDate</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexMicNoNew&#34;</span><span class="p">,</span><span class="n">Epis</span><span class="p">,</span><span class="n">WGMachineID</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">ReportDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexMicNoNew&#34;</span><span class="p">,</span><span class="n">Epis</span><span class="p">,</span><span class="n">WGMachineID</span><span class="p">,</span><span class="n">TransmitDate</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="n">Epis</span>
</span></span><span class="line"><span class="cl">	<span class="n">q</span> <span class="n">ret_</span><span class="s2">&#34;^&#34;</span><span class="n">_WGMachineID_</span><span class="s2">&#34;^&#34;</span><span class="n">_ReportDR</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">D</span> <span class="c1">##class(MI.MIFLISMonitorTest)SaveImageMTHD(&#34;7&#34;,&#34;9999&#34;, &#34;&#34;,&#34;175&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">mi</span><span class="p">:</span><span class="err">仪器</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">epis</span><span class="err">：流水号，如果是监听图片模式该位置放图片名称，自己在保存前提取流水</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">ImageClass</span><span class="p">:</span><span class="err">图片类别，如果是监听图片模式该位置放图片名称，自己在保存前提取图片类型</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">FileName</span><span class="p">:</span><span class="err">保存在文件服务的相对路径，默认不动</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">FullName</span><span class="p">:</span><span class="err">文件全路径，如果是监听图片模式该位置放图片全路径名称，满足有的图片名称无法得到流水和图片类别的情况</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">SaveImageMTHD</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">epis</span><span class="p">,</span> <span class="n">ImageClass</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">FullName</span><span class="p">,</span> <span class="n">SaveImageRetName</span><span class="p">,</span> <span class="n">P6</span><span class="p">,</span> <span class="n">P7</span><span class="p">,</span> <span class="n">P8</span><span class="p">,</span> <span class="n">P9</span><span class="p">,</span> <span class="n">P10</span><span class="p">,</span> <span class="n">P11</span><span class="p">,</span> <span class="n">P12</span><span class="p">,</span> <span class="n">P13</span><span class="p">,</span> <span class="n">Sessions</span><span class="p">,</span> <span class="n">Output</span> <span class="n">RowCount</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="o">//</span><span class="err">通过</span><span class="n">OtherPara配置取图的在这里通过epis和ImageClass的图片名字提取出流水号和图片类别</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">mi</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">epis</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">epis</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">ImageClass</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">ImageClass</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">FileName</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">FileName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">FullName</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">FullName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">SaveImageRetName</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">SaveImageRetName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">d</span> <span class="c1">##Class(MI.Common.MIFBase).Trace(mi,epis_&#34;:&#34;_ImageClass_&#34;:&#34;_FileName,&#34;H&lt;--M&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="p">(</span><span class="n">ReceiveDate</span><span class="p">,</span> <span class="n">ImageOrder</span><span class="p">,</span> <span class="n">Caption</span><span class="p">,</span> <span class="n">DisplayRatio</span><span class="p">,</span> <span class="n">Height</span><span class="p">,</span> <span class="n">Width</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">加上当前时间，防止浏览器缓存</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">FileName</span><span class="o">=</span><span class="n">FileName_</span><span class="s2">&#34;?&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">OtherPara用</span><span class="o">^</span><span class="err">分隔第四位指定</span><span class="n">SaveImageRetName的话在这里改FileName为新名称</span><span class="err">。同时让方法返回新图片名字</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">NewFileName</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="n">SaveImageRetName</span><span class="o">=</span><span class="s2">&#34;SaveImageRetName&#34;</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.//</span><span class="err">图片新名字</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="p">;</span><span class="n">s</span> <span class="n">NewFileName</span><span class="o">=</span><span class="n">epis_</span><span class="s2">&#34;-&#34;</span><span class="n">_ImageClass_</span><span class="s2">&#34;-&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">.//</span><span class="err">路径新名字</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">NewPathName</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">SPLen</span><span class="o">=$</span><span class="n">l</span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">f</span> <span class="n">ii</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="n">SPLen</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">i</span> <span class="n">ii</span><span class="o">&lt;</span><span class="n">SPLen</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">NewPathName</span><span class="o">=</span><span class="n">NewPathName_</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="s2">&#34;/&#34;</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34;/&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">i</span> <span class="n">ii</span><span class="o">=</span><span class="n">SPLen</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">NewFileName</span><span class="o">=</span><span class="n">NewFileName_</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="s2">&#34;/&#34;</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">NewPathName</span><span class="o">=</span><span class="n">NewPathName_NewFileName</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">FileName</span><span class="o">=</span><span class="n">NewPathName</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">最后返回</span><span class="n">NewFileName</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="c1">##Class(MI.Common.MachineResult).SaveImage(ReceiveDate, epis, ImageClass, ImageOrder, FileName, mi, Caption, DisplayRatio, Height, Width, Sequence)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">返回值控制图片名称模式</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="n">SaveImageRetName</span><span class="o">=</span><span class="s2">&#34;SaveImageRetName&#34;</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="n">NewFileName</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="err">返回给监听当前上传文件路径名称，默认不要动</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##class(MI.MIFLISMonitorTest).GetFtpMTHD(&#34;7&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">mi</span><span class="p">:</span><span class="err">仪器</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">GetFtpMTHD</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">,</span> <span class="n">P5</span><span class="p">,</span> <span class="n">P6</span><span class="p">,</span> <span class="n">P7</span><span class="p">,</span> <span class="n">P8</span><span class="p">,</span> <span class="n">P9</span><span class="p">,</span> <span class="n">P10</span><span class="p">,</span> <span class="n">P11</span><span class="p">,</span> <span class="n">P12</span><span class="p">,</span> <span class="n">P13</span><span class="p">,</span> <span class="n">Sessions</span><span class="p">,</span> <span class="n">Output</span> <span class="n">RowCount</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="o">//</span><span class="err">文件服务模式必须改的地方，老的</span><span class="n">FTP模式这么改了也没问题</span><span class="err">，所以建议都这样</span>
</span></span><span class="line"><span class="cl">	<span class="n">s</span> <span class="n">mi</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">q</span> <span class="c1">##Class(MI.Common.MIFBase).GetMiFtpPath(mi)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Creator</span><span class="err">：</span>      <span class="err">查询患者信息，监听配置上传前处理类后会定时调用这个</span><span class="n">query查询数据进行上传操作</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">CreatDate</span><span class="err">：</span>    <span class="mi">20140919</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Description</span><span class="p">:</span><span class="err">：</span> 
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Table</span><span class="err">：</span>  
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="ne">Input</span><span class="err">：</span>        <span class="n">mi</span><span class="err">：仪器主键</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Output</span><span class="err">：</span>       <span class="err">仪器信息</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Return</span><span class="err">：</span>       <span class="err">仪器信息</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Others</span><span class="err">：</span>   
</span></span><span class="line"><span class="cl"><span class="n">Query</span> <span class="n">QryLabInfo</span><span class="p">(</span><span class="n">mi</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">,</span> <span class="n">P5</span><span class="p">,</span> <span class="n">P6</span><span class="p">,</span> <span class="n">P7</span><span class="p">,</span> <span class="n">P8</span><span class="p">,</span> <span class="n">P9</span><span class="p">,</span> <span class="n">P10</span><span class="p">,</span> <span class="n">P11</span><span class="p">,</span> <span class="n">P12</span><span class="p">,</span> <span class="n">P13</span><span class="p">,</span> <span class="n">Sessions</span><span class="p">,</span> <span class="n">Output</span> <span class="n">RowCount</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="n">Query</span><span class="p">(</span><span class="n">ROWSPEC</span> <span class="o">=</span> <span class="s2">&#34;labno,labnoInfo,patInfo&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">Query的执行方法</span>
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">d</span> <span class="c1">##class(%ResultSet).RunQuery(&#34;MI.MIFDL96A&#34;,&#34;QryLabInfo&#34;,&#34;56&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">QryLabInfoExecute</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">qHandle</span> <span class="n">As</span> <span class="o">%</span><span class="n">Binary</span><span class="p">,</span> <span class="n">mi</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">P4</span><span class="p">,</span> <span class="n">P5</span><span class="p">,</span> <span class="n">P6</span><span class="p">,</span> <span class="n">P7</span><span class="p">,</span> <span class="n">P8</span><span class="p">,</span> <span class="n">P9</span><span class="p">,</span> <span class="n">P10</span><span class="p">,</span> <span class="n">P11</span><span class="p">,</span> <span class="n">P12</span><span class="p">,</span> <span class="n">P13</span><span class="p">,</span> <span class="n">Sessions</span><span class="p">,</span> <span class="n">Output</span> <span class="n">RowCount</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="n">Status</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">repid</span><span class="o">=$</span><span class="n">i</span><span class="p">(</span><span class="o">^</span><span class="n">CacheTemp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">ind</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">mi</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">mi</span><span class="p">),</span><span class="n">flag</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">LabnoList</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">控制输出</span><span class="n">Excel</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">s</span> <span class="n">Data</span><span class="o">=</span><span class="c1">##class(MI.Common.MIFBase).DemoMOutFileInfo(&#34;D:\\OUT\\上传.xls&#34;,&#34;张三[0][1]男[0][1]28岁[0][1]&#34;_$h,&#34;900001&#34;,&#34;1&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">d</span> <span class="n">OutputRow</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">Set</span> <span class="n">qHandle</span><span class="o">=$</span><span class="n">lb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">Quit</span> <span class="o">$$$</span><span class="n">OK</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">控制输出</span><span class="n">Excel</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">查最近</span><span class="mi">8</span><span class="err">天</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AddDate</span><span class="o">=$</span><span class="n">zd</span><span class="p">(</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span> <span class="n">f</span>  <span class="n">s</span> <span class="n">AddDate</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPMachineUploadI</span><span class="p">(</span><span class="s2">&#34;IndexSendStatus&#34;</span><span class="p">,</span><span class="n">mi</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(&#34;C&#34;),AddDate)) q:AddDate=&#34;&#34;  d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">AddTime</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">f</span>  <span class="n">s</span> <span class="n">AddTime</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPMachineUploadI</span><span class="p">(</span><span class="s2">&#34;IndexSendStatus&#34;</span><span class="p">,</span><span class="n">mi</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(&#34;C&#34;),AddDate,AddTime)) q:AddTime=&#34;&#34;  d</span>
</span></span><span class="line"><span class="cl">    <span class="o">..//</span><span class="mi">20</span><span class="err">秒以内的先不上传，防止没接收完</span>
</span></span><span class="line"><span class="cl">	<span class="o">..</span><span class="n">i</span> <span class="p">(</span><span class="n">AddDate</span><span class="o">=$</span><span class="n">zd</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="mi">8</span><span class="p">)),((</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">AddTime</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">20</span><span class="p">)</span> <span class="n">q</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">s</span> <span class="n">MiUploadDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPMachineUploadI</span><span class="p">(</span><span class="s2">&#34;IndexSendStatus&#34;</span><span class="p">,</span><span class="n">mi</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(&#34;C&#34;),AddDate,AddTime,&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">s</span> <span class="n">labno</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPMachineUploadD</span><span class="p">(</span><span class="n">MiUploadDR</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">i</span> <span class="s1">&#39;$l(labno) q</span>
</span></span><span class="line"><span class="cl">    <span class="o">..//</span><span class="err">得到通道号</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">s</span> <span class="n">chl</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPMachineUploadD</span><span class="p">(</span><span class="n">MiUploadDR</span><span class="p">)),</span><span class="mi">7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">..//</span><span class="err">测试类型</span><span class="mi">0</span><span class="err">：文本，</span><span class="mi">1</span><span class="err">：数据库</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">s</span> <span class="n">TestType</span><span class="o">=</span><span class="s2">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">i</span> <span class="n">TestType</span><span class="o">=</span><span class="s2">&#34;0&#34;</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">...//</span><span class="err">文本双向上传开始</span><span class="o">******************************************************</span>
</span></span><span class="line"><span class="cl">    <span class="o">...//</span><span class="err">控制输出文本的内容</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">txtInfo</span><span class="o">=</span><span class="n">labno_</span><span class="s2">&#34;^&#34;</span><span class="n">_chl</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">Data</span><span class="o">=</span><span class="c1">##class(MI.Common.MIFBase).DemoMOutFileInfo($zd($h,8)_labno_&#34;.order&#34;,txtInfo,labno,&#34;&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">d</span> <span class="n">OutputRow</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">labno</span><span class="o">=</span><span class="n">labnoOld_</span><span class="s2">&#34;^&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="n">_labno_</span><span class="s2">&#34;.ok&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">Data</span><span class="o">=</span><span class="c1">##class(MI.Common.MIFBase).DemoMOutFileInfo($zd($h,8)_labno_&#34;.ok&#34;,txtInfo,labno,&#34;&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">d</span> <span class="n">OutputRow</span>
</span></span><span class="line"><span class="cl">    <span class="o">...//</span><span class="err">文本双向上传结束</span><span class="o">******************************************************</span>
</span></span><span class="line"><span class="cl">    <span class="o">..</span><span class="n">i</span> <span class="n">TestType</span><span class="o">=</span><span class="s2">&#34;1&#34;</span> <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">...//</span><span class="err">数据库双向上传开始</span><span class="o">******************************************************</span>
</span></span><span class="line"><span class="cl">    <span class="o">...//</span><span class="err">控制执行</span><span class="n">sql</span>
</span></span><span class="line"><span class="cl">    <span class="o">...//</span><span class="n">Insert</span> <span class="n">into</span> <span class="n">liscontroller</span><span class="o">.</span><span class="n">lis_application</span> <span class="p">(</span><span class="n">SPEC_NUM</span><span class="p">,</span><span class="n">BTBarcode</span><span class="p">,</span><span class="n">ASTBarcode</span><span class="p">,</span><span class="n">PATIENT_ID</span><span class="p">,</span><span class="n">MSPosition</span><span class="p">,</span><span class="n">PatientNo</span><span class="p">,</span><span class="n">FULL_NAME</span><span class="p">,</span><span class="n">FIRST_NAME</span><span class="p">,</span><span class="n">LAST_NAME</span><span class="p">,</span><span class="n">Birth</span><span class="p">,</span><span class="n">AGE</span><span class="p">,</span><span class="n">SEX</span><span class="p">,</span><span class="n">Purpose</span><span class="p">,</span><span class="n">WARD</span><span class="p">,</span><span class="n">Specimen</span><span class="p">,</span><span class="n">BedNo</span><span class="p">,</span><span class="n">Diagnosis</span><span class="p">,</span><span class="n">SpRequest</span><span class="p">,</span><span class="n">Medication</span><span class="p">,</span><span class="n">SuspectedBact</span><span class="p">,</span><span class="n">Doctor</span><span class="p">,</span><span class="n">AdviceNo</span><span class="p">,</span><span class="n">ApplyDate</span><span class="p">,</span><span class="n">SendDate</span><span class="p">,</span><span class="n">Collector</span><span class="p">,</span><span class="n">SPEC_DATE</span><span class="p">,</span><span class="n">CollectPosition</span><span class="p">,</span><span class="n">IdResult</span><span class="p">,</span><span class="n">Updated</span><span class="p">,</span><span class="n">UpdateDate</span><span class="p">,</span><span class="n">CARSS_ReadDate</span><span class="p">,</span><span class="n">StainType</span><span class="p">,</span><span class="n">StructVersion</span><span class="p">)</span> <span class="n">values</span> 
</span></span><span class="line"><span class="cl">    <span class="o">...//</span><span class="p">(</span><span class="s1">&#39;9999&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;199732&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;测试&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;85y&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;普通细菌培养+药敏&#39;</span><span class="p">,</span><span class="s1">&#39;三病室&#39;</span><span class="p">,</span><span class="s1">&#39;痰&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;刘云&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;2024/6/28 9:17&#39;</span><span class="p">,</span><span class="s1">&#39;谢艳红&#39;</span><span class="p">,</span><span class="s1">&#39;2024/6/29 11:17&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">...//</span> <span class="n">Insert</span> <span class="n">into</span> <span class="n">liscontroller</span><span class="o">.</span><span class="n">lis_application</span> <span class="p">(</span><span class="n">SPEC_NUM</span><span class="p">,</span><span class="n">BTBarcode</span><span class="p">,</span><span class="n">ASTBarcode</span><span class="p">,</span><span class="n">PATIENT_ID</span><span class="p">,</span><span class="n">MSPosition</span><span class="p">,</span><span class="n">PatientNo</span><span class="p">,</span><span class="n">FULL_NAME</span><span class="p">,</span><span class="n">FIRST_NAME</span><span class="p">,</span><span class="n">LAST_NAME</span><span class="p">,</span><span class="n">Birth</span><span class="p">,</span><span class="n">AGE</span><span class="p">,</span><span class="n">SEX</span><span class="p">,</span><span class="n">Purpose</span><span class="p">,</span><span class="n">WARD</span><span class="p">,</span><span class="n">Specimen</span><span class="p">,</span><span class="n">BedNo</span><span class="p">,</span><span class="n">Diagnosis</span><span class="p">,</span><span class="n">SpRequest</span><span class="p">,</span><span class="n">Medication</span><span class="p">,</span><span class="n">SuspectedBact</span><span class="p">,</span><span class="n">Doctor</span><span class="p">,</span><span class="n">AdviceNo</span><span class="p">,</span><span class="n">ApplyDate</span><span class="p">,</span><span class="n">SendDate</span><span class="p">,</span><span class="n">Collector</span><span class="p">,</span><span class="n">SPEC_DATE</span><span class="p">,</span><span class="n">CollectPosition</span><span class="p">,</span><span class="n">IdResult</span><span class="p">,</span><span class="n">Updated</span><span class="p">,</span><span class="n">UpdateDate</span><span class="p">,</span><span class="n">CARSS_ReadDate</span><span class="p">,</span><span class="n">StainType</span><span class="p">,</span><span class="n">StructVersion</span><span class="p">)</span> <span class="n">values</span> 
</span></span><span class="line"><span class="cl">	<span class="o">...//</span><span class="p">(</span><span class="s1">&#39;25010700606&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;202500044&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;潘攀&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;1y&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;普通细菌培养+药敏&#39;</span><span class="p">,</span><span class="s1">&#39;儿科&#39;</span><span class="p">,</span><span class="s1">&#39;痰液&#39;</span><span class="p">,</span><span class="s1">&#39;17&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;姚美清&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;2025-01-08 11:52:47&#39;</span><span class="p">,</span><span class="s1">&#39;彭娜&#39;</span><span class="p">,</span><span class="s1">&#39;2025-01-08 11:52:47&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="s1">&#39;NULL&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">...</span><span class="n">s</span> <span class="n">SqlStr</span><span class="o">=</span><span class="s2">&#34;Insert into liscontroller.lis_application (SPEC_NUM,BTBarcode,ASTBarcode,PATIENT_ID,MSPosition,PatientNo,FULL_NAME,FIRST_NAME,LAST_NAME,Birth,AGE,SEX,Purpose,WARD,Specimen,BedNo,Diagnosis,SpRequest,Medication,SuspectedBact,Doctor,AdviceNo,ApplyDate,SendDate,Collector,SPEC_DATE,CollectPosition,IdResult,Updated,UpdateDate,CARSS_ReadDate,StainType,StructVersion) values &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">PatInfo</span><span class="o">=..</span><span class="n">GetPatInfo</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">labno</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">d</span> <span class="n">Trace</span><span class="o">^</span><span class="n">MI</span><span class="o">.</span><span class="n">MIF000</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">PatInfo</span><span class="p">,</span><span class="s2">&#34;PatInfo&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">...//</span><span class="mi">2024</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">16</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span><span class="n">Mejer600</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">2406290091</span><span class="p">,,,</span><span class="n">mnwk</span><span class="o">-</span><span class="err">泌尿外科</span><span class="p">,</span><span class="err">刘乐</span><span class="p">,</span><span class="err">唐云</span><span class="p">,</span><span class="mi">0000628089</span><span class="p">,</span><span class="err">周田香</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="err">住院</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">43</span><span class="p">,,</span><span class="mi">2406290091</span><span class="p">,</span><span class="mi">2024</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">29</span> <span class="mi">11</span><span class="p">:</span><span class="mi">15</span><span class="p">,,,,,</span><span class="err">肾积水伴肾输尿管结石</span><span class="p">,,,,</span><span class="mi">2024</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">29</span> <span class="mi">06</span><span class="p">:</span><span class="mi">48</span><span class="p">,,</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">EPIS</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">PatInfo</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span>   <span class="o">//</span><span class="err">鉴定号</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">DTTime</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">PatInfo</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>   <span class="o">//</span><span class="err">核收时间</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">Name</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">PatInfo</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>   <span class="o">//</span><span class="err">姓名</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">Sex</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">PatInfo</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>   <span class="o">//</span><span class="err">性别</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">i</span> <span class="n">Sex</span><span class="o">=</span><span class="s2">&#34;1&#34;</span> <span class="n">s</span> <span class="n">Sex</span><span class="o">=</span><span class="s2">&#34;m&#34;</span> 
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">i</span> <span class="n">Sex</span><span class="o">=</span><span class="s2">&#34;2&#34;</span> <span class="n">s</span> <span class="n">Sex</span><span class="o">=</span><span class="s2">&#34;f&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">Age</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">PatInfo</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span>   <span class="o">//</span><span class="err">年龄</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">MediNo</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">PatInfo</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">29</span><span class="p">)</span>   <span class="o">//</span><span class="err">病案号</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">Location</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">PatInfo</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>   <span class="o">//</span><span class="err">科室</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">i</span> <span class="n">Location</span><span class="p">[</span><span class="s2">&#34;-&#34;</span> <span class="n">s</span> <span class="n">Location</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">//</span><span class="n">jzwkszwk</span><span class="o">-</span><span class="err">脊柱外科</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">Speciman</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">PatInfo</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>   <span class="o">//</span><span class="err">标本类型</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">BedNo</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">PatInfo</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>   <span class="o">//</span><span class="err">床号</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">Doctor</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">PatInfo</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>   <span class="o">//</span><span class="err">医生</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">CollectUser</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">PatInfo</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>   <span class="o">//</span><span class="err">采集者</span>
</span></span><span class="line"><span class="cl">    <span class="o">...//</span><span class="n">s</span> <span class="n">DTTime</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">,</span><span class="s2">&#34;/&#34;</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34; &#34;</span><span class="n">_</span><span class="o">$</span><span class="n">zt</span><span class="p">(</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>  <span class="o">//</span><span class="mi">2024</span><span class="o">/</span><span class="mi">6</span><span class="o">/</span><span class="mi">28</span> <span class="mi">9</span><span class="p">:</span><span class="mi">17</span>   <span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">zt</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s2">&#34;:&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">ValueStr</span><span class="o">=</span><span class="s2">&#34;(&#39;&#34;</span><span class="n">_EPIS_</span><span class="s2">&#34;&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#34;</span><span class="n">_MediNo_</span><span class="s2">&#34;&#39;,&#39;NULL&#39;,&#39; &#39;,&#39;&#34;</span><span class="n">_Name_</span><span class="s2">&#34;&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;&#39;,&#39;&#34;</span><span class="n">_Age_</span><span class="s2">&#34;&#39;,&#39;&#34;</span><span class="n">_Sex_</span><span class="s2">&#34;&#39;,&#39;普通细菌培养+药敏&#39;,&#39;&#34;</span><span class="n">_Location_</span><span class="s2">&#34;&#39;,&#39;&#34;</span><span class="n">_Speciman_</span><span class="s2">&#34;&#39;,&#39;&#34;</span><span class="n">_BedNo_</span><span class="s2">&#34;&#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39; &#39;,&#39;&#34;</span><span class="n">_Doctor_</span><span class="s2">&#34;&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;&#34;</span><span class="n">_DTTime_</span><span class="s2">&#34;&#39;,&#39;&#34;</span><span class="n">_CollectUser_</span><span class="s2">&#34;&#39;,&#39;&#34;</span><span class="n">_DTTime_</span><span class="s2">&#34;&#39;,&#39; &#39;,&#39;NULL&#39;,&#39;0&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;,&#39;NULL&#39;)&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">SqlStr</span><span class="o">=</span><span class="n">SqlStr_ValueStr</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">d</span> <span class="n">Trace</span><span class="o">^</span><span class="n">MI</span><span class="o">.</span><span class="n">MIF000</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">SqlStr</span><span class="p">,</span><span class="s2">&#34;SqlStr&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="o">^</span><span class="n">DL96</span><span class="p">(</span><span class="s2">&#34;Send&#34;</span><span class="p">,</span><span class="o">+$</span><span class="n">h</span><span class="p">,</span><span class="n">labno</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span>  <span class="o">//</span><span class="err">上传标识置为</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="o">...//</span><span class="err">多条命令组装多个</span><span class="n">SQL语句输出</span><span class="o">.</span><span class="n">SQL包含</span><span class="o">$</span><span class="n">StoredProcedure就当存储过程执行</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">s</span> <span class="n">Data</span><span class="o">=</span><span class="c1">##class(MI.Common.MIFBase).DemoMOutDBInfo(&#34;DSN=DL96A&#34;,SqlStr,labno)</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="n">d</span> <span class="n">OutputRow</span>
</span></span><span class="line"><span class="cl">    <span class="o">..//</span><span class="err">数据库双向上传结束</span><span class="o">******************************************************</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">qHandle</span><span class="o">=$</span><span class="n">lb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Quit</span> <span class="o">$$$</span><span class="n">OK</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="n">OutputRow</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">ColFields</span><span class="o">=</span><span class="s2">&#34;labno,labnoInfo,patInfo&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="o">^</span><span class="n">CacheTemp</span><span class="p">(</span><span class="n">repid</span><span class="p">,</span><span class="n">ind</span><span class="p">)</span><span class="o">=</span><span class="c1">##Class(LIS.Util.Common).TransListNull(Data,ColFields)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="o">+</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">quit</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">QryLabInfoClose</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">qHandle</span> <span class="n">As</span> <span class="o">%</span><span class="n">Binary</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="n">Status</span> <span class="p">[</span> <span class="n">PlaceAfter</span> <span class="o">=</span> <span class="n">QryLabInfoExecute</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">repid</span><span class="o">=$</span><span class="n">LIST</span><span class="p">(</span><span class="n">qHandle</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Kill</span> <span class="o">^</span><span class="n">CacheTemp</span><span class="p">(</span><span class="n">repid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Quit</span> <span class="o">$$$</span><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">QryLabInfoFetch</span><span class="p">(</span><span class="n">ByRef</span> <span class="n">qHandle</span> <span class="n">As</span> <span class="o">%</span><span class="n">Binary</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">Row</span> <span class="n">As</span> <span class="o">%</span><span class="n">List</span><span class="p">,</span> <span class="n">ByRef</span> <span class="n">AtEnd</span> <span class="n">As</span> <span class="o">%</span><span class="n">Integer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="n">Status</span> <span class="p">[</span> <span class="n">PlaceAfter</span> <span class="o">=</span> <span class="n">QryLabInfoExecute</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">AtEnd</span><span class="o">=$</span><span class="n">LIST</span><span class="p">(</span><span class="n">qHandle</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">repid</span><span class="o">=$</span><span class="n">LIST</span><span class="p">(</span><span class="n">qHandle</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">ind</span><span class="o">=$</span><span class="n">LIST</span><span class="p">(</span><span class="n">qHandle</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span> <span class="n">ind</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">CacheTemp</span><span class="p">(</span><span class="n">repid</span><span class="p">,</span><span class="n">ind</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">If</span> <span class="n">ind</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">Set</span> <span class="n">AtEnd</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="n">Set</span> <span class="n">Row</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">Else</span>      <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">Set</span> <span class="n">Row</span><span class="o">=^</span><span class="n">CacheTemp</span><span class="p">(</span><span class="n">repid</span><span class="p">,</span><span class="n">ind</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">qHandle</span><span class="o">=$</span><span class="n">lb</span><span class="p">(</span><span class="n">AtEnd</span><span class="p">,</span><span class="n">repid</span><span class="p">,</span><span class="n">ind</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Quit</span> <span class="o">$$$</span><span class="n">OK</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(MI.MIFLISMonitorTest).GetLabnoInfo(6,1001367)</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">GetLabnoInfo</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">labno</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">mi</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">mi</span><span class="p">),</span><span class="n">labno</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">labno</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$d(^dbo.BTMIMachineParameterD(mi)) q &#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">获取项目通道号</span>
</span></span><span class="line"><span class="cl">    <span class="n">d</span> <span class="n">ScanOne</span><span class="o">^</span><span class="n">MI</span><span class="o">.</span><span class="n">MIF000</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span><span class="n">labno</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">tcx</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">chl</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="n">f</span>  <span class="n">s</span> <span class="n">chl</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="s2">&#34;MIFTESTCODE&#34;</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">mi</span><span class="p">,</span><span class="n">labno</span><span class="p">,</span><span class="n">chl</span><span class="p">))</span> <span class="n">q</span><span class="p">:</span><span class="n">chl</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">tcx</span><span class="o">=</span><span class="n">tcx_chl_</span><span class="s2">&#34;+&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">tcx</span><span class="o">=$</span><span class="n">e</span><span class="p">(</span><span class="n">tcx</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">tcx</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">k</span> <span class="o">^</span><span class="n">TMP</span><span class="p">(</span><span class="s2">&#34;MIFTESTCODE&#34;</span><span class="p">,</span><span class="o">$</span><span class="n">j</span><span class="p">,</span><span class="n">mi</span><span class="p">,</span><span class="n">labno</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">tcx</span><span class="p">)</span> <span class="n">s</span> <span class="n">tcx</span><span class="o">=</span><span class="n">labno_</span><span class="s2">&#34;,&#34;</span><span class="n">_tcx_</span><span class="s2">&#34;|&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span> <span class="n">tcx</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(MI.MIFDL96A2).GetEPIS(&#34;56&#34;,&#34;9000000324&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">GetEPIS</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">labno</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">IndexReportID</span> <span class="n">On</span> <span class="p">(</span><span class="n">VisitNumberDR</span><span class="p">,</span> <span class="n">WorkGroupMachineDR</span><span class="p">,</span> <span class="n">OrderNo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">labno</span> <span class="o">=</span> <span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="n">labno</span><span class="p">),</span><span class="n">mi</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">labno</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span> <span class="n">q</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">EPIS</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">VisitNumberDR</span> <span class="o">=</span> <span class="o">$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(labno),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(VisitNumberDR) q &#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">WGMDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTMIMachineParameterD</span><span class="p">(</span><span class="n">mi</span><span class="p">)),</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">WGMDR</span><span class="p">),</span><span class="s1">&#39;$d(^dbo.RPVisitNumberReportI(&#34;IndexReportID&#34;,VisitNumberDR,WGMDR)) d</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">s</span> <span class="n">WGMDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexReportID&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(WGMDR) q &#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">OrderNo</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexReportID&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="n">WGMDR</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">ReportDR</span><span class="o">=$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportI</span><span class="p">(</span><span class="s2">&#34;IndexReportID&#34;</span><span class="p">,</span><span class="n">VisitNumberDR</span><span class="p">,</span><span class="n">WGMDR</span><span class="p">,</span><span class="n">OrderNo</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">EPIS</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportD</span><span class="p">(</span><span class="n">ReportDR</span><span class="p">)),</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AcceptDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportD</span><span class="p">(</span><span class="n">ReportDR</span><span class="p">)),</span><span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AcceptDate</span><span class="o">=$</span><span class="n">e</span><span class="p">(</span><span class="n">AcceptDate</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34;-&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">e</span><span class="p">(</span><span class="n">AcceptDate</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34;-&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">e</span><span class="p">(</span><span class="n">AcceptDate</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AcceptTime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberReportD</span><span class="p">(</span><span class="n">ReportDR</span><span class="p">)),</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="n">AcceptDT</span><span class="o">=</span><span class="n">AcceptDate_</span><span class="s2">&#34; &#34;</span><span class="n">_</span><span class="o">$</span><span class="n">zt</span><span class="p">(</span><span class="n">AcceptTime</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span> <span class="n">EPIS_</span><span class="s2">&#34;^&#34;</span><span class="n">_AcceptDT</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="n">w</span> <span class="c1">##Class(MI.MIFDL96A2).GetPatInfo(&#34;40&#34;,&#34;L0116440&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">GetPatInfo</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">labno</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">labno</span> <span class="o">=</span> <span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="n">labno</span><span class="p">),</span><span class="n">mi</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">labno</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span> <span class="n">q</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">VisitNumberDR</span> <span class="o">=</span> <span class="o">$</span><span class="n">o</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberI</span><span class="p">(</span><span class="s2">&#34;IndexVisitNumber&#34;</span><span class="p">,</span><span class="c1">##Class(LIS.Util.Common).IndexData(labno),&#34;&#34;))</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$l(VisitNumberDR) q &#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="err">标本信息</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">TransmitDate</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">zd</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RPVisitNumberData</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">RPVisitNumberD</span><span class="p">(</span><span class="n">VisitNumberDR</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">IndexEpisodeNo</span> <span class="n">On</span> <span class="p">(</span><span class="n">TransmitDate</span><span class="p">,</span> <span class="n">WorkGroupMachineDR</span><span class="p">,</span> <span class="n">EpisodeNo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">MedicalRecordNo</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="n">SpecimenDR</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="n">Specimen</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="n">EPIS</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">MedicalRecordNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>   <span class="o">//</span><span class="err">病案号</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">SpecimenDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">56</span><span class="p">)</span>       <span class="o">//</span><span class="err">标本类型</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">EPIS</span><span class="o">=..</span><span class="n">GetEPIS</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">labno</span><span class="p">)</span>                  <span class="o">//</span><span class="err">鉴定号</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AcceptDT</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">EPIS</span><span class="p">,</span><span class="s2">&#34;^&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">EPIS</span><span class="o">=$</span><span class="n">p</span><span class="p">(</span><span class="n">EPIS</span><span class="p">,</span><span class="s2">&#34;^&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">SpecimenDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">Specimen</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTSpecimenD</span><span class="p">(</span><span class="n">SpecimenDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">LocationDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">22</span><span class="p">),</span><span class="n">Location</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">LocationDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">Location</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTLocationD</span><span class="p">(</span><span class="n">LocationDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="n">Location</span><span class="p">[</span><span class="s2">&#34;ICU&#34;</span> <span class="n">s</span> <span class="n">Location</span><span class="o">=</span><span class="s2">&#34;重症监护室&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">DoctorDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span><span class="n">Doctor</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">DoctorDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">Doctor</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTDoctorD</span><span class="p">(</span><span class="n">DoctorDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">ReceiveDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">66</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">ReceiveTime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">67</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">ReceiveUserDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">68</span><span class="p">),</span><span class="n">ReceiveUser</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">ReceiveUserDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">ReceiveUser</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">SYSUserD</span><span class="p">(</span><span class="n">ReceiveUserDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RegNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">SurName</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">GivenName</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="n">SurName</span><span class="o">=</span><span class="n">GivenName</span> <span class="n">s</span> <span class="n">PatName</span><span class="o">=</span><span class="n">SurName</span>
</span></span><span class="line"><span class="cl">    <span class="n">e</span>  <span class="n">s</span> <span class="n">PatName</span><span class="o">=</span><span class="n">SurName_GivenName</span>  
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">SpeciesDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="n">Species</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">SpeciesDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">Species</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTSpeciesD</span><span class="p">(</span><span class="n">SpeciesDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AdmTypeDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">AdmType</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AdmTypeDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">AdmType</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTAdmissionTypeD</span><span class="p">(</span><span class="n">AdmTypeDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">BedNo</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">27</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Age</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">AgeUnitDR</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">19</span><span class="p">),</span><span class="n">AgeUnit</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="n">AgeUnitDR</span><span class="o">=</span><span class="mi">1</span> <span class="n">s</span> <span class="n">AgeUnit</span><span class="o">=</span><span class="s2">&#34;y&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="n">AgeUnitDR</span><span class="o">=</span><span class="mi">2</span> <span class="n">s</span> <span class="n">AgeUnit</span><span class="o">=</span><span class="s2">&#34;m&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="n">AgeUnitDR</span><span class="o">=</span><span class="mi">3</span> <span class="n">s</span> <span class="n">AgeUnit</span><span class="o">=</span><span class="s2">&#34;d&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="n">AgeUnitDR</span><span class="o">=</span><span class="mi">4</span> <span class="n">s</span> <span class="n">AgeUnit</span><span class="o">=</span><span class="s2">&#34;h&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span><span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">AgeUnitDR</span><span class="p">)</span> <span class="n">s</span> <span class="n">AgeUnit</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTAgeUnitD</span><span class="p">(</span><span class="n">AgeUnitDR</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">S</span> <span class="n">Age</span><span class="o">=</span><span class="n">Age_AgeUnit</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">CollectDate</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">CollectTime</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">52</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Diagnose</span><span class="o">=$</span><span class="n">tr</span><span class="p">(</span><span class="o">$</span><span class="n">lg</span><span class="p">(</span><span class="n">RPVisitNumberData</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="s2">&#34;，&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Sampleda</span><span class="o">=$</span><span class="n">zd</span><span class="p">(</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34; &#34;</span><span class="n">_</span><span class="o">$</span><span class="n">zt</span><span class="p">(</span><span class="o">$</span><span class="n">p</span><span class="p">(</span><span class="o">$</span><span class="n">h</span><span class="p">,</span><span class="s2">&#34;,&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Instrument</span> <span class="o">=</span> <span class="s2">&#34;XN&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span> <span class="n">s</span> <span class="n">Instrument</span><span class="o">=$</span><span class="n">lg</span><span class="p">(</span><span class="o">^</span><span class="n">dbo</span><span class="o">.</span><span class="n">BTMIMachineParameterD</span><span class="p">(</span><span class="n">mi</span><span class="p">),</span><span class="mi">22</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Sampleno</span><span class="o">=</span><span class="n">labno</span>   <span class="o">//</span><span class="err">检测号</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Sampletype</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Feetype</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="p">;</span><span class="err">费别</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Srcdepno</span><span class="o">=</span><span class="n">Location</span>  <span class="p">;</span><span class="err">送检科室</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Srcdocno</span><span class="o">=</span><span class="n">Doctor</span>   <span class="p">;</span><span class="err">送检医生</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Userno</span><span class="o">=</span><span class="n">ReceiveUser</span> <span class="p">;</span><span class="err">检验医生</span><span class="p">(</span><span class="err">录入者</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Patno</span><span class="o">=</span><span class="n">RegNo</span> <span class="p">;</span><span class="err">登记号</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">BarCode</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Patna</span><span class="o">=</span><span class="n">PatName</span>   <span class="p">;</span><span class="err">病人姓名</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Sex</span><span class="o">=</span><span class="mi">1</span>  <span class="p">;</span><span class="err">性别</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="n">Species</span><span class="o">=</span><span class="s2">&#34;男&#34;</span> <span class="n">s</span> <span class="n">Sex</span><span class="o">=</span><span class="s2">&#34;1&#34;</span>     <span class="p">;</span><span class="mi">1</span><span class="p">:</span><span class="err">男</span> <span class="err">，</span><span class="mi">2</span> <span class="err">女</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="n">Species</span> <span class="o">=</span><span class="s2">&#34;女&#34;</span> <span class="n">s</span> <span class="n">Sex</span><span class="o">=</span><span class="s2">&#34;2&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Pattype</span><span class="o">=</span><span class="n">AdmType</span>   <span class="p">;</span><span class="err">病人类型</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Bedno</span> <span class="o">=</span> <span class="n">BedNo</span>    <span class="p">;</span><span class="err">床号</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Patage</span><span class="o">=</span><span class="n">Age</span>  <span class="p">;</span><span class="err">年龄</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Ageunit</span><span class="o">=</span><span class="s2">&#34;&#34;</span>   <span class="p">;</span><span class="err">年龄单位</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Reqno</span><span class="o">=</span><span class="n">labno</span>  <span class="p">;</span><span class="err">申请号</span> <span class="o">=</span> <span class="err">检验号</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Reqda</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">ReceiveDate</span><span class="p">)</span> <span class="n">s</span> <span class="n">Reqda</span><span class="o">=$</span><span class="n">e</span><span class="p">(</span><span class="n">ReceiveDate</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34;-&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">e</span><span class="p">(</span><span class="n">ReceiveDate</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34;-&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">e</span><span class="p">(</span><span class="n">ReceiveDate</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34; &#34;</span><span class="n">_</span><span class="o">$</span><span class="n">zt</span><span class="p">(</span><span class="n">ReceiveTime</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">;</span><span class="err">送检日期</span> <span class="o">=</span> <span class="err">接收时间</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Reportda</span><span class="o">=</span><span class="s2">&#34;&#34;</span>   <span class="p">;</span><span class="err">报告日期</span>  <span class="o">=</span> <span class="err">初审</span><span class="p">(</span><span class="err">保存结果</span><span class="p">)</span><span class="err">时间</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Printflag</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="p">;</span><span class="err">打印标志</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Resultflag</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="p">;</span><span class="err">结果标志</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Errflag</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="p">;</span><span class="err">错误标志</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Diagnose</span> <span class="o">=</span> <span class="n">Diagnose</span>   <span class="p">;</span><span class="err">诊断</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Description</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="p">;</span><span class="err">备注</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Reserve</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="p">;</span><span class="err">保留字段</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Patnamn</span><span class="o">=</span><span class="s2">&#34;&#34;</span>   <span class="p">;</span><span class="err">姓名拼音码</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">$</span><span class="n">l</span><span class="p">(</span><span class="n">CollectDate</span><span class="p">)</span> <span class="n">s</span> <span class="n">Getda</span><span class="o">=$</span><span class="n">e</span><span class="p">(</span><span class="n">CollectDate</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34;-&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">e</span><span class="p">(</span><span class="n">CollectDate</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34;-&#34;</span><span class="n">_</span><span class="o">$</span><span class="n">e</span><span class="p">(</span><span class="n">CollectDate</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="n">_</span><span class="s2">&#34; &#34;</span><span class="n">_</span><span class="o">$</span><span class="n">zt</span><span class="p">(</span><span class="n">CollectTime</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="n">e</span>  <span class="n">s</span> <span class="n">Getda</span><span class="o">=</span><span class="n">Reqda</span> <span class="p">;</span><span class="err">接收时间</span><span class="o">/</span><span class="err">采样日期</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">Wardno</span><span class="o">=</span><span class="s2">&#34;&#34;</span>  <span class="p">;</span><span class="err">病区</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RetString</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RetString</span><span class="o">=</span><span class="n">Sampleda_</span><span class="s2">&#34;,&#34;</span><span class="n">_Instrument_</span><span class="s2">&#34;,&#34;</span><span class="n">_Sampleno_</span><span class="s2">&#34;,&#34;</span><span class="n">_Sampletype_</span><span class="s2">&#34;,&#34;</span><span class="n">_Feetype_</span><span class="s2">&#34;,&#34;</span><span class="n">_Srcdepno_</span><span class="s2">&#34;,&#34;</span><span class="n">_Srcdocno_</span><span class="s2">&#34;,&#34;</span><span class="n">_Userno_</span><span class="s2">&#34;,&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RetString</span><span class="o">=</span><span class="n">RetString_Patno_</span><span class="s2">&#34;,&#34;</span><span class="n">_Patna_</span><span class="s2">&#34;,&#34;</span><span class="n">_Sex_</span><span class="s2">&#34;,&#34;</span><span class="n">_Pattype_</span><span class="s2">&#34;,&#34;</span><span class="n">_Bedno_</span><span class="s2">&#34;,&#34;</span><span class="n">_Patage_</span><span class="s2">&#34;,&#34;</span><span class="n">_Ageunit_</span><span class="s2">&#34;,&#34;</span><span class="n">_Reqno_</span><span class="s2">&#34;,&#34;</span><span class="n">_Reqda_</span><span class="s2">&#34;,&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RetString</span><span class="o">=</span><span class="n">RetString_Reportda_</span><span class="s2">&#34;,&#34;</span><span class="n">_Printflag_</span><span class="s2">&#34;,&#34;</span><span class="n">_Resultflag_</span><span class="s2">&#34;,&#34;</span><span class="n">_Errflag_</span><span class="s2">&#34;,&#34;</span><span class="n">_Diagnose_</span><span class="s2">&#34;,&#34;</span><span class="n">_Description_</span><span class="s2">&#34;,&#34;</span><span class="n">_Reserve_</span><span class="s2">&#34;,&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">RetString</span><span class="o">=</span><span class="n">RetString_Patnamn_</span><span class="s2">&#34;,&#34;</span><span class="n">_Getda_</span><span class="s2">&#34;,&#34;</span><span class="n">_Wardno_</span><span class="s2">&#34;,&#34;</span><span class="n">_BarCode_</span><span class="s2">&#34;,&#34;</span><span class="n">_MedicalRecordNo_</span><span class="s2">&#34;,&#34;</span><span class="n">_Specimen_</span><span class="s2">&#34;,&#34;</span><span class="n">_EPIS_</span><span class="s2">&#34;,&#34;</span><span class="n">_AcceptDT</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span> <span class="n">RetString</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">///</span> <span class="err">监听做上传操作后调用改方法设置标本上传表状态</span>
</span></span><span class="line"><span class="cl"><span class="n">ClassMethod</span> <span class="n">SaveSDFMTHD</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">labno</span><span class="p">,</span> <span class="n">epis</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">P4</span><span class="p">,</span> <span class="n">P5</span><span class="p">,</span> <span class="n">P6</span><span class="p">,</span> <span class="n">P7</span><span class="p">,</span> <span class="n">P8</span><span class="p">,</span> <span class="n">P9</span><span class="p">,</span> <span class="n">P10</span><span class="p">,</span> <span class="n">P11</span><span class="p">,</span> <span class="n">P12</span><span class="p">,</span> <span class="n">P13</span><span class="p">,</span> <span class="n">Sessions</span><span class="p">,</span> <span class="n">Output</span> <span class="n">RowCount</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span><span class="p">)</span> <span class="n">As</span> <span class="o">%</span><span class="ne">String</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">mi</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">mi</span><span class="p">),</span><span class="n">labno</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">labno</span><span class="p">),</span><span class="n">epis</span> <span class="o">=</span> <span class="o">$</span><span class="n">g</span><span class="p">(</span><span class="n">epis</span><span class="p">),</span><span class="n">filename</span><span class="o">=$</span><span class="n">g</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="s1">&#39;$d(^dbo.BTMIMachineParameterD(mi)) q</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="n">ret</span><span class="o">=</span><span class="c1">##Class(MI.MachineUpload).SetSendFlag(mi,labno,&#34;S&#34;,filename)</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    <section>
        页面浏览量<span id="busuanzi_value_page_pv">Loading</span>
    </section>
</footer>


    
</article>

<div class="post-password">
	
</div>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/%E4%B8%87%E6%B3%B0wan200-da9f234969/">
        
        
            <div class="article-image">
                
                    <img src="/img/title.jpg" loading="lazy" data-key="万泰WAN200 da9f234969" data-hash="/img/title.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">万泰WAN200</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/%E4%B8%AD%E5%85%83%E5%B0%BF%E6%9C%BA1600-fe923b78ec/">
        
        
            <div class="article-image">
                
                    <img src="/img/title.jpg" loading="lazy" data-key="中元尿机1600 fe923b78ec" data-hash="/img/title.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">中元尿机1600</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/%E6%96%B0%E4%BA%A7%E4%B8%9Ax8-b385dbe43a/">
        
        
            <div class="article-image">
                
                    <img src="/img/title.jpg" loading="lazy" data-key="新产业X8 b385dbe43a" data-hash="/img/title.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">新产业X8</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/%E6%B7%B1%E5%9C%B3%E7%BE%8E%E6%A1%A5%E6%B5%81%E6%B0%B4%E7%BA%BFmejer-1600-700-fc57e82203/">
        
        
            <div class="article-image">
                <img src="/p/%E6%B7%B1%E5%9C%B3%E7%BE%8E%E6%A1%A5%E6%B5%81%E6%B0%B4%E7%BA%BFmejer-1600-700-fc57e82203/assets/image-20250822185214-cv1gaec.dc604593a69061aa7c121dd3d0294083_hu_5c73ff4d14b32423.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 深圳美桥流水线MeJer-1600&#43;700"
                        data-key="深圳美桥流水线MeJer-1600&#43;700 fc57e82203" 
                        data-hash="md5-3GBFk6aQYap8Eh3T0ClAgw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">深圳美桥流水线MeJer-1600&#43;700</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/%E7%BD%97%E6%B0%8Fe601-c082da15b5/">
        
        
            <div class="article-image">
                
                    <img src="/img/title.jpg" loading="lazy" data-key="罗氏E601 c082da15b5" data-hash="/img/title.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">罗氏E601</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo"],"lang":"zh-CN","locale":{"admin":"Admin","placeholder":null},"requiredMeta":["name","email","url"],"serverURL":"https://waline.717170.xyz"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2024 - 
        
        2025 muziyang
    </section>
    
    <section class="powerby">
        
            网站总访客数：<span id='busuanzi_value_site_uv'>Loading</span><br/>网站总访问量：<span id='busuanzi_value_site_pv'>Loading</span> <br/>
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>


<script defer src="https://cn.vercount.one/js"></script>

    </body>
</html>
